import{_ as __unplugin_components_2$2}from"./LRGrid-174f461f.js";import{_ as __unplugin_components_0$1,a as __unplugin_components_0$2}from"./LiveItem-cfda7d48.js";import{_ as __unplugin_components_0}from"./DecryptImage-37fb4348.js";import{_ as _imports_0$5,a as __unplugin_components_4}from"./ic_close-74a56691.js";import{_ as _export_sfc,x as shallowRef,r as ref,o as openBlock,c as createElementBlock,b as createBaseVNode,d as createVNode,y as mergeProps,B as unref,E as toDisplayString,H as createCommentVNode,w as withCtx,O as api,R as size,a0 as showToast,aR as onBeforeRouteUpdate,ab as withDirectives,bn as vModelText,Q as onMounted,bo as LIVE_IDENTITY,D as computed,h as createBlock,aj as vShow,F as normalizeStyle,a8 as createTextVNode,C as openBrowser,aa as vipRouter,aS as onUnmounted,M as Fragment,N as renderList,j as resolveDynamicComponent,bp as triggerRef,a6 as getName,a7 as isVip,S as nextTick,bq as GIFT_TYPE,J as normalizeClass,z as withModifiers,aJ as ApiException,a2 as getDefaultExportFromCjs,a1 as commonjsGlobal,u as useRoute,aD as onBeforeRouteLeave,$ as getUID,T as Transition,a5 as getAvatar,br as LIVE_TICKETS_TYPE}from"./index-7cd15725.js";import{i as ic_placeholder}from"./ic_placeholder-8a7ae8d9.js";import{_ as __unplugin_components_1$1}from"./LRList-04205989.js";import{_ as _imports_1$3}from"./ic_hot-f19a1b04.js";import{L as List}from"./index-dbf023d0.js";import{G as GridItem,a as Grid}from"./index-102e3561.js";import"./index-98fa3391.js";import{T as Tab,a as Tabs}from"./index-78f522e6.js";import{a as SwipeItem,S as Swipe}from"./index-c36f4566.js";import{a as showConfirmDialog}from"./function-call-b84aaa3d.js";import"./index-7437c2e4.js";import"./ic_empty_no_data_note-b651d8f8.js";import"./use-id-eb09136b.js";import"./index-c81e4327.js";import"./index-d25b80eb.js";import"./icon_diamond-42aa206c.js";import"./icon_video_pay_ali-e9101293.js";import"./use-tab-status-6006e152.js";import"./use-route-cec45656.js";import"./Dialog-cfe4b03f.js";import"./index-b56c1e9e.js";import"./use-placeholder-e29266a8.js";const _imports_1$2="data:image/webp;base64,UklGRgQBAABXRUJQVlA4WAoAAAAQAAAARwAARwAAQUxQSJYAAAABZ6CokSQ1u/tiOFRwWRsXEQG5n3bjv0gGp7W2vUnaBlEZICoqvs4QHd91A0bovnsUGtfLuxX1++hgIvqvxm0bh55ybapvEF5fTJWBt+srdDPAoFsBAd0ayOg2QOOvws+LS9kCzeJSQv30ZjmAlLlyNAEx2tGCyuLTIxc8Q1gW4tm3fxVrIOP5ezzGH8bbTxWeP9XLiwBWUDggSAAAAHAEAJ0BKkgASAA+kT6ZSKWjIqEsyACwEglpAABhrmCxGUc9t7rWq675xkwAAP74z30B//4xE1DAoPv//8YgzjS8RX/TwAAAAA==",_imports_2$2="data:image/webp;base64,UklGRjwMAABXRUJQVlA4WAoAAAAQAAAAHwEAfwAAQUxQSL0KAAABHAVpGzCdf9tXQkRMAPLoSICOs22uIqtApTFIREeXiKNexxjYANs5vQfYA3mzADSOFGkcIRpDiAjJCJHqCdrMMVeqDiNiAqxR//+6afOTQIIQFdSjDGffHHdkOVONjQjLNnuT7camyyZ77z0EHawOO3tvRT44XQ7KciOCjstGTdmQPRxb2YlsZPR5cf/3yuj+JfEyIiYgdNNf2bAgsmJV8t2ePorevp53k6tWRBY0VPqlMPqmLIp3UaR3xRdN8enNWx1OZCjyM4lwtVdXVS0pSsRUS5WGjNu3YTedjIbrJ4UqjIBXil5vwKgITaoPR5NpK2Db7YZegm1ZrDc3n224pSh3G2c3b7aAbFtQH6NjWHY/WlcmRf5hdY92K4DYaD3UxFH3Rmd4pCT0zIj2KiBe47xxFPXq+X4pIf3zVysgOu5WrC4oO2ql5KztUHCpYoemew+2h6QkDbWb2E+7EufJ/c6glKzBTpM0j50ot+6nGl1SwroaU+5vxx2YnSEtA1LiBpYJzrO29RcJjpNQAk+OkBb9Vr1Yub8uQhYXa/dXL1o03MC16oVM7lVX2AxbM9rB6U3I6Dcn2P3XkpsD/CpDVpe/4HDTitEBvhYhs4uvcBi1YLiDD4OQ3YMPsBs29mIDdzFkeLyDzYuG+iv4EEOWxw+w6jezgK+DkOmDr7BoZJbwqwjZXvxCmjVQnnEqQ8aXJ5zL2uIW1zch699csY11zaEKmV/BvKZpwrqXe7010rSWuMexCNlfHLGPddwiTcIz4CThtobxBcvwLLjEZfxvrUAqsH8gkAJac6oBaJT9hI0ANbnEgU7X/gJXJxDPYTRAUPYbBgFG24sB7bIfsR2I2QoChPYnjAII2mkDOkS3lWOPHqS5QR6PZ5CupANos2FkgVrnvPD9998/NgAHfAZ7rtXb40Cz1aTLLrtsnB3fli1btpzopFoga1jdDqwW5y4HnhmAy4H+owvIi8BDdkYAnOEkWQ3cbrUdaNKN5wOgVYq4+cA2iyqg16+bRoDRxZy/F6hStQBR0cyRXwA/LLA9qdiSKNCi8KaAGZpxv0nufyq6ZgApr6ka6PZo5iZKAE83UG0KA4+KXkJ7BuKuokseBcKmBFCnlzO/Bvrrz7BuAr4rK77qgISI+DJAmVaCXwI0is2VwN1SfJUBGZ/IFGCz6OS0LwDCYvM84DNfESabgSkii4Bmh6zbo8wC2T3mN0Xk3K8BnhKbQ98DLhGtNnQre4F0t/lWTTUDi0TiwNkO2UTOcfH+FfNrHjt3AP8frJcmcl6gqbOBuEgXYGjDWI35ZZ/YPLEX+s+UAnfMsmGOMIAu8QNptzZuBsje5RKbg9cAi6SwDf9Dmgcd4U4D/kogKQ499jjla8A/jjMf434Nvp4ptm8Dtg3VzSFVyn8BrVXmo/bJ4Es/B5jlBEkClfOAqFMslwPPiPqQT7YuucH2bX3ASzdY/0oTlo8DzWI5YAfdsBPlZwc6IQo0LATCGpFTR+xkX27S3Avllm6LMc/3odz73M/FiWFgYQSo14lIIbM5QvUp6r0vHC/OrAciMWBiqaLORk4Qp04EYglgpHb651iuAe6aoz63QHUt/rk4dySQSAIV2tkjlv8BKkXtKUT9/57rESdXAMl3AUNfG4ATCsgTIyxFtfQIcbgBvNsDBPS1GziqgDwkNhVniNMDQE8f4NXFES25pYARA3SyM08sNF6gTyNlf0mTWz8wyFbSBs78qiD1AAEdHLz4B8jNB3wv+vvx1VN0FQB63gUMDXz4Heacfgq8r71RT6dpEoloyQDeTQIVGlB35jQVeMveJv1seAfQVwWQXAWEnDRk2sNfWbw9UXK6GnhyoMqdeWwOT2PdJPKilkLAqhXAJMf4fxn9FsuO8aK2dT9w90A5/uj6x3Zi2fvsT0UiWpoErIgA9Q6Z/3oG661nibWt14F5GvLMe2I3NrdeGxAReVFL9UBkIRB2yErsPiPmweXl5eXvQ6Zc/RFwUbnlccDW8vLyg53n/hKb68eJWk9hYEEDEHXIfYrsW1ttHE1ePuQ8+YedZrGMaCkKNFQCSYfUAO/cfLQsLzzXAR88NPsl/SWBSj+Qdjtj2O5Fp4pIITq948aTRORxey/qyJ0G/NIFGM6wtnPYJvvbLT7flOOdGrDUnwF0icSBs3WR671Aei/sHiaa1t/ZQFxkEdCspcO+A5Y8Ciwu1pqBRSJTgM1aegj44dBDv4H+0wve4Ykbyp2wGZgi4ssAZRo6rh9YJnIjsH5QoTsReCX/yoCMT0QSQJ1+DugE0mUiQ3YCSwvdKCCRf3VAQkQkDDyqHXcbwFIRkdkANxa46UBb/j0KhE3VQLdHN38FWDvUJC0Avy5sTcCDeefpBqpN3hQwQzPXAXQdJcrBbwL9MwrafcA9eTcDSHlN0gJEtTJoYRbIjBHLwC6g75IC4srtaaAh76JAiyirgF6/Rg5+HfNlYvPEbwCeGFogznpxcW7/B36Rb/5eoEol24AmfYz8EPPvxfaUNMDaY3S2XHXE5RthpcVIi8Be4Ef5Nh/YJpa3A6sdtMue96Y9AJnfSY5npQB65rm00mbL/Tnwj5s6swDfuuRA060WdwA7JN9XA7dbGVmg1jGVAH9Ruc7fjfnLGsn5uHcxrx6pkSHfAktVnjD2fybyBbBz6mAROfquLNCcb7VA1rCSNqDDAb95NfLg71/pN12pGP1flLuOkwEsW2eC547UwBnL7rqy4crVAFep7sNu6v6QiKzB/F139zcop+RbB9AmNoMAofybjnX2NNMjqP95sAyo72UF/9LA8dicrJpp1ds62yvmqxU217rybBRA0I7EgPb8O9jGk2KesNf0wRwZ8It6TGM14P7aKulWDc+YPnu2wS+W3v/Z21whed4OxMT2aIBg3slOVd99QxVyC2QWHSj78JAIrBQdvmGx43SxXPVD7PqTXWJ72JJPLL5bd98QyfMgwGh7Egc6XXk35vzzzz9/9snDxNL18tsVso9nfzJJC/XPPPPMM08vuOgAsTaGyEAOP858pOS/qxOIS441AI15N4BDXbLPh0sx3AhQk4tEgVTAcSViIAVEJefxBcvngSUu438LFdLkOWCSUIUa4x7HIv+KI/axjjBNWPdyr7dGmoZ651DlXgXzUHPc4vom795csY11hfKMU5lz5QnnMtQ/S/hV5FvxC2kWmlzA10GuDb7CIjTaX8GHmGfxA6z6zYQXG7iLORbvYPMiND3cwYdBfg0+wG4Ymh8d4GuRW8VXOIxCG28O8KvMq/IXHG5CO0c7OL3JqTcn2I1CW4cbuFa9XOpVV9gMQ3tfrNxfF3lUrN1fvQht7i8SHCc5NDlCWvRDy2dnSMtAqRNYJjjPQvvLrfupRlcp42pMub8tQxfjPLnfGSxdgp2Y0zyGjk7396A9VJqE2lHup6G78fZigo7a0qO2A+XlNoZOj1sVsLrJX0r4m1ajbh2HztfEFdAbneEpDTwzor2o4zXyvzg6pgC6H60rK/bK6h7txjI2WrQZbMsqzJubzzbcxZnbOLt5M9bZtqBo1bh9u4U5nYyG6yeGKoyAt/jxBoyK0MT6cDSZxu722w3Rb1VLyqrYT7VUiaa91eFEptjLJMLVXtG6b8qieFex1hVfNMUnhdFfOW9hJJZIvtvTV/z09bybTMQiC+dV+sWZAFZQOCBYAQAAcBoAnQEqIAGAAD59LpNHpKKhoTcfWACQD4lpbuDAW/gH4AZYZJr9AP4BigFmA/gH4MfoB/TfIA/AD9AP4B0AH4AfoBAgP4B+AF7pov+gH8A/AD9APz97/DFXVdRfIF6zj+BNQADaErAeAuRXlyK8s5U+07LViN94V4pwPF5wGMoOCj1d0lVarG40U6ip1d7t+pA/7XjzzurujEb8MWkK9ANt9I/jJHxMb2MIncxOQFqRTXbUmovpxvRSbDyV2RAQ2OrunKAs9le/kXcvtKHINwkppwMDCxYNy/pMAAD5iQNaUbDovujQicjtaSMl/6Sbc95XdP4D2HYex86bkwa9sk2Eth4ijNExywDU2WQygpQnOS2QKvsQG5ypaJjeoZGvsl4IDjrSyTKp99iCvXOAd6kSeGnq6x1T0aymkoASbYLgWaCC3uRCroofU3YDB75vNkZUJfN/QAA=",DownMicRecView_vue_vue_type_style_index_0_scoped_84551c5c_lang="",_hoisted_1$a={class:"root"},_hoisted_2$9={class:"rlt-root"},_hoisted_3$8={class:"homeowner-avatar"},_hoisted_4$5={class:"tv-homeowner-name"},_hoisted_5$4={class:"tv-hot"},_sfc_main$d={__name:"DownMicRecView",emits:["close"],setup(o,{expose:u,emit:r}){const t=shallowRef({}),e=ref(!1),i=ref(null),n=r,s=h=>api.getRecRoom(h),a=h=>size(h)<=4?h:h.sort(()=>.5-Math.random()).slice(0,4),l=()=>{api.focus(t.value.anchorId).then(h=>{h&&(showToast({message:"已关注",position:"middle"}),e.value=!0)})},c=()=>{i.value.refresh()};return u({setData:h=>{t.value=h,e.value=h.isFollow}}),(h,p)=>{const d=__unplugin_components_0,v=__unplugin_components_0$1,g=__unplugin_components_2$2;return openBlock(),createElementBlock("div",_hoisted_1$a,[createBaseVNode("div",_hoisted_2$9,[createVNode(d,mergeProps({url:t.value.cover,isDecrypt:!1,loadingIcon:unref(ic_placeholder)},{class:"iv-bg"}),null,16),createBaseVNode("img",{class:"iv-close",src:_imports_0$5,alt:"关闭",onClick:p[0]||(p[0]=y=>n("close"))}),createBaseVNode("div",_hoisted_3$8,[createVNode(d,mergeProps({url:t.value.avatar,isDecrypt:!1,loadingIcon:unref(ic_placeholder),radius:40},{class:"circle-image"}),null,16),createBaseVNode("span",_hoisted_4$5,toDisplayString(t.value.name),1),createBaseVNode("span",_hoisted_5$4,toDisplayString(t.value.renqi)+"人看过",1),e.value?createCommentVNode("",!0):(openBlock(),createElementBlock("button",{key:0,class:"tv-add-follow",onClick:l},p[1]||(p[1]=[createBaseVNode("img",{class:"icon",src:_imports_1$2,alt:"加关注"},null,-1),createBaseVNode("span",null,"加关注",-1)])))]),p[2]||(p[2]=createBaseVNode("span",{class:"tv-switch"},"为您推荐的在线主播",-1)),createBaseVNode("img",{class:"iv-switch",src:_imports_2$2,alt:"切换",onClick:c}),createVNode(g,{"column-num":2,"key-prop":"pullUrl","api-promise":s,"data-convert":a,"disabled-refresh":!0,"disabled-load-more":!0,class:"recycler-view",ref_key:"lrGridRef",ref:i},{default:withCtx(y=>[createVNode(v,{options:y,tabType:1},null,8,["options"])]),_:1},512)])])}}},__unplugin_components_10=_export_sfc(_sfc_main$d,[["__scopeId","data-v-84551c5c"]]),_imports_0$4="data:image/webp;base64,UklGRpgIAABXRUJQVlA4WAoAAAAQAAAAhwAAxwAAQUxQSLADAAABkAL/n5tYN6g4VBzqtSsoVBQWhXu9uIbEXr8o7DXUK6hIFAq36tpr1zKT2YhrCy6vJczkShZm+ibZ/HefiwgIbiQpkpx7PHBY1XAvmAIiiiIbMhnZUCjIBl2XC+n04aFcmJ/HWCZommXJhOnpr18xlge53M4OxvLgzRvTxFgWTE8bBu5HDty7V6kMaqYMSKXy+Y8fhz8meqlULre8PFotxS6Tefx4fb3fRYcibqqaz5dK1eq43wDxUtVstlAolSoVwxj/04dWvF/rmzflsq5Xq4aBkGniCRGlbDbM77xoTU8vLyOERyJ6hcLo2FEGaFq9jvuRA6pareJ+ZEGxuL+PsSxIpZaXcT+yIJ02DIzlgao2GhiLG+tr8kBRouqmtk2I43je9XUQdPsJgutrz3McQmxbLKLpp4S4LqU95lDquoSIQqmEQ6fd9v1eJPH9Vgt+2WzYOenZWafTizSdztkZ5BSl2Qx7HUp7kYfSdhteUV3BcXqxxXFgpqqHh2H8+dOLNX/+QGx5OZrD4jwKWul0mPe12z0u0m7DKewtzs4o5QOlZ2eQQohd2I4adbeFUy4XxRV4uQCUlpfZ+T5ffB9K7OMuQnrchRAIqSpmjuvyx3UhVCiwz+D7nYTD2DZ8yuVwR/N4MHzW19lHoXxyHPjU66w8j0+eBx+EWF1f8+n6Gj5fv7IKAj4FAXzY18C6XT51u/8v5OM0+ajj8tHn5WMcKE/zhGIxSfM3Sm0bDjDM7z0PY/gMVkuTtf4zNQWfSiVp64PwyefZtVq8rR9DKZXa30/K/gKQ+pmfT8b+E6QyGctKwv4kmIayvs7/Pjq07t2zLL7/vwFUI9F1HCqOE+9hMFPV4ZWPMPeNo5JSOqgT4BqTYhGHzNlZ1N220xn0EKiNr6JhLxPVGNX3h68DvXS62cQRhBDXDfO3QqnnEYL7gd5oX+nfL5LYNiGO43nX10HQ7ScIrq89z3EIGZ7Bg25iNO3kBMcc0RjM505OxI7tlcNDgWPM9DRCwsYcVTUMQQuVt29NU/wm99taTexYq2mjIVrRfKhWsyyZMLxqVio1GuIWps8Ui7per3/9Kgcmzfay2Xz++fNyWddrtWbTNMUnjt8VTXv+fH7+40eERCXe3xZNe/u2Wt3ZEaVo6+7jx+vr+/tgSlByufl5hMSPZT1lfd00RYC3Ojs/f3gImaR+qFKxLOgk8W8FIajx3IUNAxyJj6IYBjySfxRCEEn6fUEBRAxDNjx+LBvu3ZMNigIGBVZQOCDCBAAA8B4AnQEqiADIAD6RRp9LpaOioaSx6ViwEglN3BeADQVKWRo02fGY1f07ToPMA/U7p2eYf9nOpl6AH+i6hz0APLc9lSvFvx3K5pC/w/EavBtxd/Dy8Irfp/8Vf+b4Ax1X/A8vH9UMF209QSCena8QxkhI4Cx8ZZDPuoEHAXQhnSwu5UJ5c0ZglVRS+lPx2fmNMnkjAZcwPs5ZPQsdUYk/swgcFYIYELQMypgKthWTfTIGUdEpMjKPDnnkBpn4gkzaMSrXhKe5yVWxuY6/ZP4gpR4wiQFq2kjGR+wJhqsylXlUN57nI5sp1NIFXVihjgMXSaep2bg/WRv9rE6gSqZCAAD+1UQCzlRicPApuFA7A1IcepNTUMWfL0fRM1PfSzrw/9f5Tf/3tZxLun5uvfVlrcxEI7lEPvcOhCcQ6Aht76ce1qic1Ml3p41eIxlsXJg3vWUPikDTMQCigCbtW2VkUGjK/igFr7J0C3iHmk09UNanrB+z8MN+pF6c3i4yfmdy6GT2MpMAAMTSQAFZlh3T4uc/bDsu/BQ0/B0EZQimtIa+L7kdNM+hF2/kSSm1eO7rGGh5u7fvsfHZMV7HrNT/5E77zRPZhapLj3M8lXus8vu4rQm1/SBBh9FNekkBcT1kN5TyWsOv5TbQrSFDQHYohxU+EHnp6Of8+WdSIOHi+TDdYDClEaSpXKfCY/1PgxtVbvHN9k4jhkQ66zgzpWYn7nnzu6j6KPigo4ATx3Hg92jX64vQxFkkLDmwF8qSchZK/wUkkXES8KSb5vDw2VDysdWt88K8xpKk8+EJ8VtpoTXwIFIjQ1+5So0OoLWmVoAHJx1meuc0vhwbDIk+61f7JGzoAWnhlW0R3GDtW1QQjLQCfDK6I/gCak74lqZvJ3EABQ8p1XKtfUFLBh+Xb9eR/IHCKi8JhGfxpirThr0/UKsnfnHTlFC4h3EmG1rA2KGJ1boPi9jMd/yqztr5CMJHJefn4VPPOGjbUQ2oBTbivP3ZdHuguAW/sNxvgE5PuJEXbXeVebVXAZlw8Z/UqqPqrUklVaNDeUfU7GfCyLhKhds/53FCUprOebOiT2SktebF6WZnkD7otwIKQmxJxNvz7WjnrmKPRfT1Fx+pXREk7qe1K4PrF6QLKM+Cyo9sX+Q8H2dA5uh9yWAL8+OnEHTgKY8SYdOGjzZAUlduK1WC1vji9BADn2x09K5uNBxMYWItz64/a1v+yfGwjH3Dsg+aboj3EN50I5Hw6AOPJCGvbU8g2pnidK0ohFYtIxjlBFvz3Kf/c29/K1MsQXOViYiM0Zgixrpg0WcUSIUOgpkbsyzEHpuWI8UZA8vW6lO+UY51jM/yzFYA0u3Tp7OljvwE5BW3j/wVQX/DmHUMIQ6MeoyuJpS8Pe7OXfHX3f3jCb4ZlkZ1ugW/ZNnnxrg5/rhEy/rYMOZQBKRifySGOWmB7TW1lwBPbPPhctW50TB1/lh4yX67BP/YvAlKzjfW5rdCs8T0fu/NT4ogIGft/b7C/OmIBUILQlwjWy/DVyJR0Zbx36BtimF7wDC9DE57mxLvnntCRDxNQcsdw+nYP4gdvkamKRF1EOnZAmpm8CYSHNQAABtWA+8XStVggCArPkDBGQAA",DrawerRecommendView_vue_vue_type_style_index_0_scoped_ab308edc_lang="",_hoisted_1$9={class:"root"},_hoisted_2$8={class:"refresh-slide-layout"},_hoisted_3$7={class:"relative-layout"},_sfc_main$c={__name:"DrawerRecommendView",emits:["close"],setup(o,{emit:u}){const r=u,t=n=>api.getRecRoom(n),e=n=>n,i=()=>{r("close")};return(n,s)=>{const a=__unplugin_components_0$1,l=__unplugin_components_1$1;return openBlock(),createElementBlock("div",_hoisted_1$9,[createBaseVNode("div",_hoisted_2$8,[createBaseVNode("img",{class:"close-button",src:_imports_0$4,alt:"关闭推荐",onClick:i}),createBaseVNode("div",_hoisted_3$7,[s[0]||(s[0]=createBaseVNode("span",{class:"title"},"为您推荐",-1)),createVNode(l,{"key-prop":"pullUrl","api-promise":t,class:"rcv","data-convert":e},{default:withCtx(c=>[createVNode(a,{options:c,tabType:1,type:1,class:"rcv_item"},null,8,["options"])]),_:1})])])])}}},__unplugin_components_9=_export_sfc(_sfc_main$c,[["__scopeId","data-v-ab308edc"]]),SendMsgView_vue_vue_type_style_index_0_scoped_34a3e756_lang="",_hoisted_1$8={class:"constraint-layout"},_sfc_main$b={__name:"SendMsgView",emits:["sendMsg"],setup(o,{expose:u,emit:r}){const t=r,e=ref(null),i=ref("");onBeforeRouteUpdate((a,l)=>{i.value=""});const n=()=>{e.value.focus()},s=()=>{size(i.value)&&(t("sendMsg",i.value),i.value="")};return u({inputFocus:n}),(a,l)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$8,[withDirectives(createBaseVNode("input",{class:"et-content",type:"text",maxlength:"50",placeholder:"输入内容",ref_key:"inputRef",ref:e,"onUpdate:modelValue":l[0]||(l[0]=c=>i.value=c)},null,512),[[vModelText,i.value]]),createBaseVNode("button",{class:"tv-send",onClick:s},"发送")])]))}},__unplugin_components_8=_export_sfc(_sfc_main$b,[["__scopeId","data-v-34a3e756"]]),_imports_0$3="data:image/webp;base64,UklGRsIFAABXRUJQVlA4WAoAAAAQAAAATwAATwAAQUxQSGECAAABkAQAjCFJmZ6zbbPXxuts27bvXrZt27Zt27bNMXbzaGU6dXhGxATAf8ossRFpRJJ7ix/RPjmNMOK/our9nIJI+wg1twpiAOosK4bjeiaI4a6eZWI4rGeMGPrrKSuG7J+0zoIgy9nUXhQQBcj7khCdS7OBQHt/wRgQ6qr32EMolg/vcbdQovE92lOJZAx+RqwphEwVh+6+9uI3KpO/P7m0sV9CKj6pGi6+k4SE7gvTy7AIm/EFA/hkcH6TSR2uYKD9+6uYqdxNNOXeUmYpug3N6p2WmabigS8f9iTq6O1GE3+upGXpeNX1dVs0AIxIRkT091FLuQjN7eulZtmESk9jKJuMqt5IRfaTaPoFKRR9UN1ecBtqLgGAIs+Q4bG0APBMA0e90roBkOE2stwAkBG1dz3SugCWnch0CKR0a61eqzUbxiLX5LpwSat3iFvtd+EayNdWuLrGi4zQxqnwt0r9lBFuhTnJineJAFBq9rmHiBcHIeumHxBvHx6dFdSDEdHDy4n42wI6JTsK8CToPiuCqfpmiaC5vtYiKKUvWAA2iz6rg99JMHiW3zQjs/i1MNKGX2kjIex+S0asDm6nwPA5btONzebW0lhbbrKxUGY2yZjVwes0EJ7nNYNiDq+WFG15yRShAfoZIJtEYXUG5n2ATgPpeU4zaOZwakXTjlMQTRgju0RjdfI5A8QX+MykmsunNVV7PsFU4WzsEpUky7IcSh0cSh0iy3IxoA/e/xNN/2FFDqAPdSHLFxnpjiDTsWSSnctJMvjKZR/dGi696HI+43FIooMMIw5fM/2ObhL8XwYAVlA4IDoDAACQEwCdASpQAFAAPp1EnEosKqShqlQMOLATiWwAyQ4TWX5e/T/OGrf9O/EXOtIK7LpwHmAc5bzD+cL/iv2A94voAf2vqKfQA/ZL04P2k+DX92vTAaL41lBM7knu7Pe1XjpenhvbEgEX+/lDEhcscF79MLXPmL8mfE0jPxnaBinFKbzxS9a2Qw2/sNQfoeBFibtUyG1W8WdfA9U0dRg1xw9b3P7HvsAA/vz4QLnzNR/7yC0HOOdlzP9We/0jzzTWGAaba0dE5B7F28tym1y5/4ctxx5cdWxW+5wm1zPWrZjf/l1SY+20077+m3vW6DL66O4QNKC5syEwe/+vM/d/4J4GsVANc9+oy+QfH+1mjOvLGo+wqZZ0yJfwN4jX8ny2T1dXhrNySEyWlkRg/BJNXT87phFVkzKtND7wzzbpPR7Gbz8x6Xk/rJGFrkAX5WF8ln3gE+/8qMM99wffvLUbLJSUhD66ZmNaLRZ2H/QbcPELIz3/oubyJLbt1oy9vFeWfPGl8z2Q9R2SAX40DCqF+8gtQdgVWL84nAHTXWvpAnEFPBTzCcaSWQpfpH8E8CFJAD8dXdypt7XPeG2D5f4t7dMSQ0Yn8gGdz6lI2a8alZ05Eut41LBr+Fg4iT6okqttbO1bnScYF5ajynJPPufyuFtt4isDg3LMcgQPd7R37KTMBpDWk2CUm4XS3sgVMl3sN+QefeeBkEZUvAkrOX+PtPt1HDwM0u2GAQLxCD394oM/Yl2tWrL0SyR5T4uRskV3xbLaLo101aWa7AxFLCDPC64SPfeWKVAuZkq6Tg4qiRuXSGyl393Grmka/WspjD/TZJQ1v//+VlQDkb48PDokxeDGPmH1f1yIlkGS7pnkkLA0IbifgXqWQYBxz0oCkbaVCWf9PXPANDmZi9HvdT0e93NwRs0f4NYCRCgd5blGv/7KjgTAhUN0LrEIf+hgDP93ngA4/L0YfF7mN+wZTVdPyaB7Wz+fB92m7b21miGKzgeXr30kxLEPcXwZIMHs0aI41jwo/pyBuMCSFPP/gowJu+JQDkhQAAZE2DY6kyyrNyhIxAj7/k+7zfTr/f1jutmy9AP7FequW9oZFAAA",TextItemProvider_vue_vue_type_style_index_0_scoped_84fc4d23_lang="",_hoisted_1$7={class:"relative-layout"},_hoisted_2$7={key:1,src:_imports_0$3,alt:"VIP Icon",class:"iv-vip"},_sfc_main$a={__name:"TextItemProvider",props:{data:{}},setup(o){const u=ref(!1),r=ref(!1),t=o;onMounted(()=>{e()});function e(){switch(t.data.textMessageExtra.identity){case LIVE_IDENTITY.HOMEOWNER_IDENTITY:case LIVE_IDENTITY.ROOM_ADMIN_IDENTITY:u.value=!1;break;default:u.value=!0;break}}const i=computed(()=>{const c=t.data.textMessageExtra.identity;return c===LIVE_IDENTITY.HOMEOWNER_IDENTITY?"主播":c===LIVE_IDENTITY.ROOM_ADMIN_IDENTITY?"房管":""}),n=computed(()=>i.value==="主播"?(r.value=!0,{background:"linear-gradient(90deg, #6950FB, #B83AF3)"}):i.value==="房管"?(r.value=!0,{background:"linear-gradient(90deg, #1481FF, #07A2FF)"}):(r.value=!1,{})),s=computed(()=>{const c=t.data.textMessageExtra.identity;return c===LIVE_IDENTITY.HOMEOWNER_IDENTITY?{color:"#00FFF7"}:c===LIVE_IDENTITY.ROOM_ADMIN_IDENTITY?{color:"#00FF7B"}:{color:"#FFC700"}}),a=computed(()=>{const c=t.data.content||"";if(c.includes("我要开通"))return{color:"#00FFF7","text-decoration":"underline"};if(c.includes("我也要约"))return{color:"#00FF7B","text-decoration":"underline"};{const f=t.data.textMessageExtra.identity;return f===LIVE_IDENTITY.HOMEOWNER_IDENTITY?{color:"#00FFF7"}:f===LIVE_IDENTITY.ROOM_ADMIN_IDENTITY?{color:"#00FF7B"}:{color:"#ffffff"}}}),l=()=>{size(t.data.JumpUrl)>0?openBrowser(t.data.JumpUrl):t.data.content.includes("我要开通")&&vipRouter()};return(c,f)=>{const h=__unplugin_components_0$2;return openBlock(),createElementBlock("div",{onClick:l},[createBaseVNode("div",_hoisted_1$7,[u.value?(openBlock(),createBlock(h,{key:0,class:"custom-level",options:{level:t.data.textMessageExtra.level}},null,8,["options"])):createCommentVNode("",!0),withDirectives(createBaseVNode("span",{class:"tv-identity",style:normalizeStyle(n.value)},toDisplayString(i.value),5),[[vShow,r.value]]),t.data.isVip!==0?(openBlock(),createElementBlock("img",_hoisted_2$7)):createCommentVNode("",!0),createBaseVNode("span",{class:"tv-content",style:normalizeStyle(s.value)},[createTextVNode(toDisplayString(t.data.name||""),1),createBaseVNode("span",{class:"tv-content",style:normalizeStyle(a.value)},toDisplayString(t.data.content||""),5)],4)])])}}},TextItemProvider=_export_sfc(_sfc_main$a,[["__scopeId","data-v-84fc4d23"]]),GiftItemProvider_vue_vue_type_style_index_0_scoped_3065771e_lang="",_hoisted_1$6={class:"gift-item"},_hoisted_2$6={class:"gift-content"},_hoisted_3$6={style:{color:"#02a9f1"}},_hoisted_4$4={style:{color:"#f31b70"}},_hoisted_5$3={style:{color:"#ffffff"}},_hoisted_6$2={style:{color:"#ffa658"}},_sfc_main$9={__name:"GiftItemProvider",props:{data:{}},setup(o){const u=o;return(r,t)=>{const e=__unplugin_components_0$2;return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$6,[createVNode(e,{options:{level:u.data.level},class:"custom-level"},null,8,["options"]),createBaseVNode("div",_hoisted_2$6,[createBaseVNode("span",_hoisted_3$6,toDisplayString(u.data.senderName),1),t[0]||(t[0]=createBaseVNode("span",{style:{color:"#ffffff"}}," 送给 ",-1)),createBaseVNode("span",_hoisted_4$4,toDisplayString(u.data.receiveName),1),createBaseVNode("span",_hoisted_5$3,toDisplayString(u.data.count)+"个 ",1),createBaseVNode("span",_hoisted_6$2,toDisplayString(u.data.giftName),1)])])])}}},GiftItemProvider=_export_sfc(_sfc_main$9,[["__scopeId","data-v-3065771e"]]),PublicScreenRcvView_vue_vue_type_style_index_0_scoped_c4411499_lang="",_sfc_main$8={__name:"PublicScreenRcvView",setup(o,{expose:u}){let r=shallowRef([]),t=null,e=0,i=null,n=null,s=ref(null);onUnmounted(()=>{i&&window.clearInterval(i)}),onBeforeRouteUpdate((v,g)=>{t=null,e=0,r.value=[],i&&window.clearInterval(i)});function a(){api.getFakeMessage().then(v=>{t=v,e=0,i=window.setInterval(function(){if(e>=0&&e<size(t)){const g=t[e];l(g),e++}else size(t)>0&&e>=size(t)&&(window.clearInterval(i),a())},3e3)})}function l(v){const g={content:v.text,name:v.name,isVip:v.isVip,JumpUrl:(v==null?void 0:v.JumpUrl)||"",textMessageExtra:{level:0,identity:LIVE_IDENTITY.TOURISTS_IDENTITY}};r.value.push({type:"TextItemProvider",data:g}),triggerRef(r),h()}function c(v){r.value.push({type:"GiftItemProvider",data:v}),triggerRef(r),h()}function f(v){const g={content:v,name:getName(),isVip:isVip(),JumpUrl:"",textMessageExtra:{level:(n==null?void 0:n.level)||1,identity:LIVE_IDENTITY.TOURISTS_IDENTITY}};r.value.push({type:"TextItemProvider",data:g}),triggerRef(r),h()}function h(){nextTick(()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)})}const p=v=>{switch(v){case"TextItemProvider":return TextItemProvider;case"GiftItemProvider":return GiftItemProvider;default:return null}};function d(v){n=v}return u({setSelfInfoCardBean:d,apiFakeMessage:a,chatRoomGift:c,chatRoomTxt:f}),(v,g)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("div",{class:"root",ref_key:"divRef",ref:s},[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(r),(y,m)=>(openBlock(),createBlock(resolveDynamicComponent(p(y.type)),{key:m,data:y.data,class:"item"},null,8,["data"]))),128))],512)]))}},__unplugin_components_7$1=_export_sfc(_sfc_main$8,[["__scopeId","data-v-c4411499"]]),GiftRcvView_vue_vue_type_style_index_0_scoped_f7584e2d_lang="",_hoisted_1$5={class:"clt-info"},_hoisted_2$5=["src"],_hoisted_3$5={class:"tv_root"},_hoisted_4$3={class:"tv-sender"},_hoisted_5$2={class:"tv-recipient"},_hoisted_6$1=["src"],_hoisted_7={class:"count_root"},_hoisted_8={class:"tv-count"},_sfc_main$7={__name:"GiftRcvView",setup(o,{expose:u}){const r=shallowRef({}),t=ref(null),e=ref(0);let i=null;onBeforeRouteUpdate((l,c)=>{e.value=0,i&&i.cancel()});const n=()=>{t.value&&(i&&i.cancel(),i=t.value.animate([{opacity:0,offset:0},{opacity:1,offset:.3},{opacity:1,offset:1}],{duration:1e4,fill:"forwards"}),i.onfinish=s)},s=()=>{i&&i.cancel()};return onUnmounted(()=>{s()}),u({setData:l=>{r.value=l,n()}}),(l,c)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("div",{class:"constraint-layout",ref_key:"giftContainerRef",ref:t,style:normalizeStyle({opacity:e.value})},[createBaseVNode("div",_hoisted_1$5,[createBaseVNode("img",{class:"iv-avatar",src:r.value.senderAvatar,alt:"头像"},null,8,_hoisted_2$5),createBaseVNode("div",_hoisted_3$5,[createBaseVNode("span",_hoisted_4$3,toDisplayString(r.value.senderName),1),createBaseVNode("span",_hoisted_5$2,toDisplayString(r.value.receiveName),1)]),createBaseVNode("img",{class:"iv-cover",src:r.value.giftUrl,alt:"封面"},null,8,_hoisted_6$1)]),createBaseVNode("div",_hoisted_7,[c[0]||(c[0]=createBaseVNode("span",{class:"tv-x"},"x",-1)),createBaseVNode("span",_hoisted_8,toDisplayString(r.value.count),1)])],4)]))}},__unplugin_components_6=_export_sfc(_sfc_main$7,[["__scopeId","data-v-f7584e2d"]]),_imports_0$2="data:image/webp;base64,UklGRgIIAABXRUJQVlA4WAoAAAAQAAAAXwAAXwAAQUxQSJkDAAABoHTb2to2e+QB1lFdCmeGk6S/gJmZGYfscZmZmSHwA9rIZZ4yc+tVVVn0FoxypffpR470vk+/cUQwcts2kjT7tJ1T0mV+AGJUK0euOBR99JmlMNkWe/0gemjFiEoVaOjpNma79kxvZj/TpmVz5Lb1y0z/ZM36s6atY7t7JOOtmLTn9gsjYaEjrfjXF/d3T6rwyiOvb2S/9sFCd37Q9kd650lBCVaPP2NkUIAZ4+SE6qAi/CpUNLAhg8I0GwcVhQRf+Ocez6BQzbOL/ELpfZOZKFiT3eotrlh4fczkKN5sbENYTCm1pk4XdhXvE8dccr2uVhVAyZTDLSjM9Oo05rblyNQS1+TPuphEiaYO9sx3iW/+axulurlqns8dSxlKly1xleYWMy4fzpZ4nddY+M9OYVtU4JCyea+QiK/nlTmLt6maTQVbm97ZSbaoOZRAMqYO1ygdE65rQUK21IU7ZqOOpNQ3dJypY5wWPNang0L+GyYS07zpz1mm05x2Tg3OFoZynYuOmUhO83RRjlOgXwoJmhwQ/C+V55Ck5yv/ex6eoElyROA/nziBRD3R69+9QcSgihHx/kP5/gxVMvvL/2FSFMkanQwAnj0f6fJpnweg+22LLtbt7gBjXiBhX4wB2GpQxtgKoCUok2gC9alFGeupWq0jafXqCS20aZmw6httvq08m6BN4uy1tHim7BY6AtMeZ8XzUGgeyz76bCFprc/tNm1sluC04Un835f+Df0i9Bt6nKVN9tG1NG1SGv28Sr9foN+v0e+X6Y8ryI+L6I/rJI5LbVHjUvrjavrzAvLzGurzsgMV9OeVf8a8GAIjUmTn9eTXJf6cdRWl+EyW9roQhBYxTq9HWxgivi53y69QX1ckvi76ZRXxdd22hrCTdenDSTr8PFSr0F5XvzS1M/3/As7MX0gj+jhbVABO9S6lsHG2xAsuXMrkw5aAK33z38lu7dU8H7gzf9ZFqR9NXZqdD24tmXJYYoC3HJlaAu5Va+p0Sc1zva5WBREq4fUxU8IFN2MbwgqIsvdNJryfMNnNPiBS/4JTGbHETy/yg1CUUNHAhqzAp40Di0IKCFYJVk84YwgpnjFOTqgOKiDDvL6R/doH7nJk/kHbH+mdB9L0Vkzac/eFkfjl8F3864vbuyZVeEGunm5jtjc905vZz7Rp2RyR25aZjrNm/VnTljHdPEBDtXLkikPRR59ZCjHFPj64fHrFiEoVhAgAVlA4IEIEAAAQFwCdASpgAGAAPok6l0elI6IhNHTp2KARCWgNuC4ACS7Zu16voHJAc2kIucB5gH6q9J3zAfth6Onqt9ADpAPQA6Sf9wv2dyfOE+V2wt0qDPO749AD9YFVV6lQCG7o2KjrHrVUs1kDTHcfJtT30wKIOiC6TsPnNuf1//itk3zzt5/hYfIJmhfULBFKWkwcY6zGPZqqrDT/+5AlnpNuWMGgjN+mYCNMXbVIU3QGtzWVa0Cr9VAJZ4zEbpQQ8IRV1+owAP75Df//bsf/25D//2xBxt1pS547f8TyER9o5SDEdG/BsLw8/OidviM4e3CbroTOfrnQBNf+L1G3ScHXGHP3gbXnih5x6Qa0ZV3iWh9yucp2jgtimpgWjYW60poj+nt04gZ/SjPq5vQVm/J3m4u6t9/n8PVWspxi/8EECLEyjOF6uLOEQh/XV9VWtA7CbyOLAb5Hi5Wu6dsSoPW58t71mMA3DvkFol1ZO0blL3miLLdRAbCIc/MhfBYfsRts/ZjGYzGNXSEKkgtd7COSQmKbZkmfag0UItlAmCAd38Rn20Dt2Azkw0YAKbX9FhGNMQOxsiJ6+Xctfl2nNdH68KAHUq+IPirVGAKytaX+GXpD/9JCGUR3bdiBTeYplK2WBX+5g2neV2pYK/7+dtIZ6ZUQ7HQzi8TJNmpRXxb3EsHVsjQA32ZgnO1ovr0O0ZcmeYhEwxT2H467G8e1To1z9nlmp8hhugtPa8ykWma5RaK8Zyp7X8u66jLVEuf5pZ1mH5OFOlNhnfW9MOyshf7KmBtWo/CxtknlpZ1CwHqsNM2U36pijjsqs8e3wI+iwvp7FwJ6yL6eJ3zdBCdyF3EkaXToX+it2ixVw9PSbp8+Z2Nu2c9FxGwMh+JSCJOMsVNcnCGZ9cYP8NZw0Ph2eSikJygTYWgcWaZI9GMHYiceXlcaa6E9DbAmkeISRu4nm5SyJ/vCLGrltGsZLyEVQhMoxFY1CGHSPK1+8YbqEhQmR40SYbCgjOx4HTQbBMzhROagBo2o8YABsG6aUCI52SWhXyzSq3Oz5XqsA4guxlA+b9KCzO877Rzx2i2qbNPvhM1NC1nFXWJzV++Mxlp7BOku8VyBDKc91vS7xiqtdNAE1apvhgyuvFLWsUTEsW7BjTfeFwjmPnqM1FF3Caehj8eJPyHGOYvD1k2tuuhuIpVjRiTw1VQ4UHoQf7NeAj9ezREAX4yLurwEyL9QCeJZNIQVzW3BBwzasB5Jlhmh8yOtYlNKuf+DsvprdnG/+adF1CUw00H/VIACXDl7ZYWWNxWRHOkK8WvrfNzVOdtVC5D9tA4R1nTFdMlKZuJNOLJbbbItkaDDJCrrjP03aopuKIe3nQTOEExQ8aceRQ/o4YrGE3z1T/5IuIRB69pb8TufdaORDMISE2vnef+8z//v5P/77P//35Sfwh9Bu43HcXuqQkZ0KAAA",_imports_2$1="data:image/webp;base64,UklGRi4BAABXRUJQVlA4WAoAAAAQAAAATwAATwAAQUxQSK4AAAABgGtb2/HobbPS2Sqz7OQObLtSmQt2a435+6+e8RQRYTBpm87AbqH/3+eajk1QmzwzzLkENPsjwzDMSxVnXYYRqcEsw6BRzKTqKAIHOEEZDZgX0F7itYnCL6P1CWqj8O2AdVB4ZXRhbOF4pN56ePp4GijcG4mzHk4TZfGLZFW0tiqwnpJoZTFK/IR7/OzKfIXF0FKuwaIcWtRGiyz3YBENHhhmlySkcw67GvpHfgRWUDggWgAAAHAGAJ0BKlAAUAA+jTSXR6UioiEx/bgAoBGJaQAVIACtgkjU9dfypQ5itCLuUpcs1YsLZdaqriTzpEKuoAD++TOpn81Bq/oZwAAVn4yZ/+jh5+LPv9ooAAAAAA==",HomeownerInfoView_vue_vue_type_style_index_0_scoped_e824ff60_lang="",_hoisted_1$4={class:"homeowner_info_ni"},_hoisted_2$4={class:"homeowner_info_name"},_hoisted_3$4={class:"homeowner_info_id"},_hoisted_4$2={class:"homeowner_hot_txt"},_hoisted_5$1={class:"homeowner_tip"},_sfc_main$6={__name:"HomeownerInfoView",setup(o,{expose:u}){const r=ref(""),t=ref(""),e=ref(""),i=ref(!1),n=ref(""),s=ref(""),a=ref(!1),l=ref(""),c=ref(!1);onBeforeRouteUpdate((S,_)=>{r.value="",t.value="",e.value="",i.value=!1,n.value="",s.value="",a.value=!1,l.value="",c.value=!1});const f=()=>{api.focus(r.value).then(S=>{S&&(showToast({message:"已关注",position:"middle"}),i.value=!0)})},h=()=>{},p=()=>{};function d(S){r.value=S.anchorId,t.value=S.avatar,e.value=size(S.name)>0?S.name:"",i.value=S.isFollow,n.value=""+S.renqi}function v(S){n.value=""+S}function g(S,_){a.value=!0,s.value=S===2?`按场直播${_}钻石/场`:`按时长直播${_}钻石/分钟`}function y(S){c.value=!0,l.value=`预计倒计时${S}秒`}function m(){a.value=!1,c.value=!1}return u({setData:d,showCostTip:g,showCostTimerTip:y,setHotValue:v,goneCost:m}),(S,_)=>{const A=__unplugin_components_0;return openBlock(),createElementBlock("div",null,[createBaseVNode("div",{class:"homeowner_info",onClick:h},[createVNode(A,mergeProps({url:t.value,isDecrypt:!1,loadingIcon:unref(ic_placeholder),radius:16},{class:"homeowner_info_avatar"}),null,16),createBaseVNode("div",_hoisted_1$4,[createBaseVNode("span",_hoisted_2$4,toDisplayString(e.value),1),createBaseVNode("span",_hoisted_3$4,"ID:"+toDisplayString(r.value),1)]),withDirectives(createBaseVNode("img",{class:"homeowner_info_focus",src:_imports_0$2,onClick:f},null,512),[[vShow,!i.value]])]),createBaseVNode("div",{class:"homeowner_hot",onClick:p},[_[0]||(_[0]=createBaseVNode("img",{class:"homeowner_hot_img",src:_imports_1$3},null,-1)),createBaseVNode("span",_hoisted_4$2,toDisplayString(n.value)+"人看过",1),_[1]||(_[1]=createBaseVNode("img",{class:"homeowner_hot_arrow",src:_imports_2$1},null,-1))]),createBaseVNode("div",_hoisted_5$1,[withDirectives(createBaseVNode("span",{class:"homeowner_cost_time_tip"},toDisplayString(s.value),513),[[vShow,a.value]]),withDirectives(createBaseVNode("span",{class:"homeowner_cost_time_tip"},toDisplayString(l.value),513),[[vShow,c.value]])])])}}},__unplugin_components_5=_export_sfc(_sfc_main$6,[["__scopeId","data-v-e824ff60"]]),GiftCountSelector_vue_vue_type_style_index_0_scoped_6a69f7ff_lang="",_hoisted_1$3=["onClick"],_hoisted_2$3={class:"item-count"},_hoisted_3$3={class:"item-description"},_sfc_main$5={__name:"GiftCountSelector",emits:["select"],setup(o,{emit:u}){const r=u,t=[{count:1,des:"一心一意"},{count:10,des:"十全十美"},{count:38,des:"想你爱你"},{count:66,des:"一切顺利"},{count:188,des:"要抱抱"},{count:520,des:"我爱你"}],e=i=>{r("select",i)};return(i,n)=>{const s=List;return openBlock(),createBlock(s,{class:"list_root"},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(t,a=>createBaseVNode("div",{class:"item-container",onClick:l=>e(a.count),key:a.des},[createBaseVNode("span",_hoisted_2$3,toDisplayString(a.count),1),createBaseVNode("span",_hoisted_3$3,toDisplayString(a.des),1)],8,_hoisted_1$3)),64))]),_:1})}}},__unplugin_components_7=_export_sfc(_sfc_main$5,[["__scopeId","data-v-6a69f7ff"]]),_imports_0$1=""+new URL("../webp/name-77e17098.webp",import.meta.url).href,GiftItem_vue_vue_type_style_index_0_scoped_154e7b62_lang="",_hoisted_1$2={class:"item-content-layout"},_hoisted_2$2=["src"],_hoisted_3$2={class:"item-gift-price"},_hoisted_4$1={class:"vip-exclusive",src:_imports_0$1,alt:"VIP Exclusive"},_sfc_main$4={__name:"GiftItem",props:{options:{default:{},type:Object},type:"",index:0,page:0,selectIndex:-1,selectTabType:"",selectPage:-1},setup(o){const u=o,r=computed(()=>u.selectIndex===u.index&&u.selectTabType===u.type&&u.selectPage===u.page),t=computed(()=>{switch(u.type){case GIFT_TYPE.GIFT_TAB:case GIFT_TYPE.ADVANCED_TAB:return`${u.options.propPrice} 钻石`;case GIFT_TYPE.BACKPACK_TAB:return`x ${u.options.count}`;default:return""}}),e=computed(()=>isVip()||u.options.propIsVip!==1?"#FFFFFF":"#999999"),i=computed(()=>isVip?1:u.options.propIsVip===1?.5:1);return(n,s)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["container",{select_shape:r.value}])},[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("img",{class:normalizeClass(["item-gift-icon",{animated_scale:r.value}]),style:normalizeStyle({opacity:i.value}),src:u.options.propImage,alt:"Gift Icon"},null,14,_hoisted_2$2),createBaseVNode("span",{class:"item-gift-name",style:normalizeStyle({color:e.value})},toDisplayString(u.options.propName),5),createBaseVNode("span",_hoisted_3$2,toDisplayString(t.value),1)]),withDirectives(createBaseVNode("img",_hoisted_4$1,null,512),[[vShow,u.options.propIsVip===1]])],2))}},__unplugin_components_2$1=_export_sfc(_sfc_main$4,[["__scopeId","data-v-154e7b62"]]),_imports_0="data:image/webp;base64,UklGRjgIAABXRUJQVlA4WAoAAAAQAAAARwAASwAAQUxQSDkCAAABkDYAbBnRyrO7Z9u2bdu2bdu2bdu2bdu2eb7b5cPYJhExASAyapqyA9ZffudSVde7y+sHlksTDSjGrD379He0+P3MvLqxJHPmnfzYg7Z6nkzN55RHqb3PiwK9++s5JCm+x4uCfQdKy5ByoRsl9C5PJ6zaY5T0eX0xkUe4UVrf5OgC4m5Gqfclti3NSZT8alabUl1B6e9lsSX5JSR4L6MNsQ4jycsJLDkWI9Htka10DlPBkRZyf0eyrnKmIh9BwjfjmumOpCcpRslf0vqW02g0El9pkPwDtX/59UYj+RWKJs5teh/TaCqr9LCzZhkyeAIA4r3i4FcugLo+DsIDAKYgi5uUiAd4uB034SMe/qXP4OIBy5VAJnu14mLhMC4urODiy1kugi/Z+MvFzxAXXpUL1cPF789c3LnNxbrdXAydwEWdukwEsmV28fAscbw7PByIqGzkYRJAb5UDT1WAjN84eBQNAHZzMAkAoCED/kKaBA/pHY2iUcaRU1uCbvJ31C5F0YOhxIINwDDBfVqHohpBU5XSnyJg0rGG0ggwnfoxnZOxzEHF/1TeZQOr3QI0/lcHyxEmkQh2BBsjziMQ6KvYAVHmShfsq4C9zhF+uf60AduV1l9lelIFRBa6Js+hDCA2/kyXHF8HRgPh5U5IENiWG2SMWu9iQIz7YDknSBqpyd6/9n3ZUEUBiR3Z+pz9ErYW+HiofVqQP1unxcef/DX6+eDQnJZpgWrkROmLz3vi994Zny9tgoggFgBWUDgg2AUAAJAcAJ0BKkgATAA+kT6YSKWjoiEs1NxAsBIJbAC2RxMEj578s3yi15+5fjHirTN23PQb5gH6tdLnzDftJ63Xoc/xHqAftv1qPoMeXJ7Jf7qftf7V2OAeWuRHG5XG3VGbErq73dQn9Wetb6Ff6ANLr7U5CVgsleeSj4/0/lx4xf9RlzVyaiMv6hI72WEuzw6HzrEEj6+bbNT3LpcV3cGRF+RmULw0LWbTQRTCs+Te9uacJrFN1kMQHa/K8aEBlp/fGeKfG/0GrEyG3Viqw1SkSVgQYpIr89pPf6TeAb8e1gggwRh7+31iUDA3J1McAAD+9effvlh3jU++hd2Pp37RAugQRPqkgVRrZPK27CmAUcqDfujWf/3Kf/FzgoKlCfTXmLIJP8CxPsnttEpsO7KMVBCVPvSmJcFqJtjF2aA9D5t/g9jMs5iSDT1kSWgkIoH3MZaNlFkenj1j2A/Yl//h5WexhkMRubwTcydFm9X3mKnZ1lrIefJgO0IUIXwJ4+LO6XzKhF+PliRiphQkhd+LVuuIdvX3+JO/6mo+kJGKy0zVsyiXXN99rT4m8n7qMFfOVZwUI80UdzvSHScnYFxewhb+ddSAfDgcCVyv7JdBGTSSsg9xfV+xy2dcdumMGxmU1jMOdvExrOVVWJW+jqcT/Zzr///GK2BPFaZXVJhRY4PPGtdA5uBRAZizOuuYIRn6QnqcWUn7Nw5wf6Du3JRDcnlGXoN+vn//P7OgMylLEjr1gSDwLiV//ASoq28eQkZKMGp5IfAvLdv4ZnLnrGrboKl9IrIz6mEekv5k1xhUCHMfWy3wCwKiSJPZVGvsG3AHLVWXO9yH/IyLv6iUah4TcqnpovbMDBzU5I5DVE9oJVMmXsGR2KOldtuKCQjNcA/UZ6UY9Hi2mHUzsEjnYqpvhc7PYs3SEbqTzxICckPc8M3apciwxh0KpCJAr8blB9qIASl6b4CXSTR/0aGfmRWQzUhc6Sgi6LwAtq/d3S7KB/N8sUOfnXv/wyu0HcJr+mwLqB1NK6z6+q/kIW/hzTbXNQMar28aVQkbqJuslvDTsF4dr+kDnfAimr1CCgNwDzZmSk+0wMpeTeCLUltxC9VBsZWNeI5KAc0ueajahZ6D1p5Mee/8RJW81NaWhtiKqSwSIzk9AlfvvSKvGfGlo1J4mt7Ds8Kbgfk0EK1xOWbil9d3ciPRZCjQIZoj34nU3rPMlybok5ejT6X5x58DAHURY1JH7qrmXD2yzefNGNcPHcZ8suLvCSI8SiuMRtgsEiOnsQYXYEy7YStjHjM1agCAP3S0Hz22s7cq0LVxenFVX/D7A7lNpHSL3DagGLzVgVn9SP8fb0Mb4k3Kp9S1dLpYtIeP/w+hMdqYnO+MnvNdidLa+Z9SWc9cS+iYR9lF47aQF3WZ6niLIsdiHWA5jPMBeiKqnEfhPGz0Zm5VEy6SbvQQtZvpiJZzXq3dZQkJNkNcIt6O85clNHjwOH8G5N8vEruYWYe9N/gpLibIJb1uNyPFeAhHLq7WCM5TiEukV2uIx1lEJeRDstn6Ufe4s4/deOQf6LgVGAIvDTtcn7MppV0KlgYvxrAOXTPzzDi1M05pGhnmlDwa/FRJtKxpnw5yd8PETpBvgR8Jv1G2jttd9XXXMekw5vH7+g085dAtZlmkiawpcPnZ3J3vyEbGTIVAyG+MRpub/Kb/BvUxkf5yfhjd3Pu4aQf8gYAtPcPRv3p5pfhuF5B6OPJdz8RzygGvLQKr9ifpZ2uXLiP1PcsUWm1g46MarpJuCLY/WFlviA+QhMvLv7s+OB1EYkffMnaGeqXr2uS8Fe5lLz5fXD9wJmyg9KP2EijiF9BObrq49rfwBbd9kcLoxRLlQmDOTZfU5WPPHt5VIM9aFnIYP6+j9kyyffISj+yRHQA2STjiyuW3gNEDDdz5j6SbohBD/ieiIKf5sZa3SsXThFYiZe6CaePBiQMG/2+awHCjls4ncn/zFHf1654ERAAA",_imports_1$1="data:image/webp;base64,UklGRpoBAABXRUJQVlA4WAoAAAAQAAAARwAARwAAQUxQSCMBAAABkHPbtrFnJ7ZtV7bZ2bZtJ53N1k5pJ5/N/atyXt2bNmNExATQG5SejY3ur0LqD+BH0isQ+BMAfvhL5/Ie7DtnyczOoPDMTCq9TSi5qSfTBJSekqgJKrZJkwZ+eIRDtiQhv7kNbe117k+UFG4fwZ4aERmdMPjiLYHFJdgHOyIi2zsGd7bC6e2A/eZHrPcXBidGos2A/RdHCqP+MFjXFqsNfBEpmc1hRKgs8P2kdCuHSoEi/nAr2srRFPc/VRjPz2CPDUlFvU0GPwMEsboGe2dDKpudMXjvIoTBAdgvPqRG53cMzsxF6Ab7N5rU6v+DwbQIz1weqTnlP/NfT4B3TBepvZz5YyhA94sFLfXR0ItpElC3+/ldty5pUKv2/sO4sQhv9gIAVlA4IFAAAACQBQCdASpIAEgAPpE+mUiloyKhLMgAsBIJaQAAYg/tIE3YhcVmxBbf2KTHCygeI3nJmVXmoAD++M95QCs/9+2f/1CAO//iOav/WQAAAAAAAA==",GiftDialog_vue_vue_type_style_index_0_scoped_f8f719b8_lang="",_hoisted_1$1={class:"root_dialog"},_hoisted_2$1={class:"dialog_second"},_hoisted_3$1={class:"cl-bottom-layout"},_hoisted_4={class:"tv-diamond-count"},_hoisted_5={class:"llt-send"},_hoisted_6={class:"tv-gift-count"},_sfc_main$3={__name:"GiftDialog",emits:["diamond","sendGiftSuccess"],setup(o,{expose:u,emit:r}){const t=ref(!1),e=ref(0),i=ref(0),n=ref(!1),s=ref(0),a=shallowRef([]),l=shallowRef([]),c=shallowRef([]),f=ref(1),h=ref(-1),p=ref(""),d=ref(-1),v=[GIFT_TYPE.GIFT_TAB,GIFT_TYPE.ADVANCED_TAB,GIFT_TYPE.BACKPACK_TAB];let g="",y="",m=0;const S=r;onBeforeRouteUpdate(($,F)=>{t.value=!1,e.value=0,i.value=0,n.value=!1,f.value=1,h.value=-1,p.value="",d.value=-1,_()}),onMounted(()=>{_()});function _(){api.propsListNew().then($=>{$&&(s.value=$.diamond,a.value=$.normalList,l.value=$.userPropList,c.value=$.plusList)})}function A($){const K=[];for(let Y=0;Y<$.length;Y+=8)K.push($.slice(Y,Y+8));return K}const k=computed(()=>A(a.value)),w=computed(()=>A(l.value)),I=computed(()=>A(c.value)),N=$=>{switch($.title){case GIFT_TYPE.GIFT_TAB:i.value=0;break;case GIFT_TYPE.ADVANCED_TAB:i.value=Math.ceil(size(a.value)/8);break;case GIFT_TYPE.BACKPACK_TAB:i.value=Math.ceil(size(a.value)/8)+Math.ceil(size(c.value)/8);break}n.value=!1},x=$=>{const F=Math.ceil(size(a.value)/8),K=Math.ceil(size(l.value)/8),Y=Math.ceil(size(c.value)/8),G=$.index;G<=F-1?e.value=0:G>F-1&&G<=F+Y-1?e.value=1:G>F+Y-1&&G<=F+Y+K-1&&(e.value=2),n.value=!1},M=()=>{S("diamond")},b=()=>{n.value=!n.value},T=$=>{f.value=$,b()},C=($=!0)=>{t.value=$},D=($,F,K)=>{h.value=$,p.value=F,d.value=K},P=()=>{let $=null;switch(p.value){case GIFT_TYPE.GIFT_TAB:$=a.value;break;case GIFT_TYPE.ADVANCED_TAB:$=c.value;break;case GIFT_TYPE.BACKPACK_TAB:$=l.value;break}if($===null){showToast({message:"请选择礼物",position:"middle"});return}let F=null;A($).forEach((Y,G)=>{G===d.value&&(F=Y[h.value])});const K=()=>{api.sentGift(p.value,y,m,F,f.value,g).then(Y=>{Y instanceof ApiException||(S("sendGiftSuccess",F,f.value),C(!1))})};F&&(p.value===GIFT_TYPE.BACKPACK_TAB?F.count>=f.value?K():showToast({message:"礼物数量不够",position:"middle"}):K())};function B($,F,K){g=$,y=F,m=K}return u({show:C,setData:B}),($,F)=>{const K=Tab,Y=Tabs,G=__unplugin_components_2$1,H=GridItem,Q=Grid,J=SwipeItem,ne=Swipe,ie=__unplugin_components_7;return t.value?(openBlock(),createElementBlock("div",{key:0,class:"root",onClick:F[1]||(F[1]=withModifiers(se=>C(!1),["self"]))},[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createVNode(Y,{active:e.value,"onUpdate:active":F[0]||(F[0]=se=>e.value=se),swipeable:"",onClickTab:N,shrink:"","title-active-color":"#ffffff","title-inactive-color":"#999999"},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(v,se=>createVNode(K,{title:se,key:se},null,8,["title"])),64))]),_:1},8,["active"]),F[6]||(F[6]=createBaseVNode("div",{class:"v-tab-line"},null,-1)),createVNode(ne,{"indicator-color":"white","initial-swipe":i.value,onDragEnd:x,class:"swipe_root",loop:!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(k.value,(se,X)=>(openBlock(),createBlock(J,{key:"gift-"+X},{default:withCtx(()=>[createVNode(Q,{border:!1,"column-num":"4",class:"grid_transparent"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(se,(ce,he)=>(openBlock(),createBlock(H,{key:ce.propId,onClick:ye=>D(he,unref(GIFT_TYPE).GIFT_TAB,X)},{default:withCtx(()=>[createVNode(G,mergeProps({ref_for:!0},{options:ce,type:unref(GIFT_TYPE).GIFT_TAB,index:he,page:X,selectIndex:h.value,selectTabType:p.value,selectPage:d.value}),null,16)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024))),128)),(openBlock(!0),createElementBlock(Fragment,null,renderList(I.value,(se,X)=>(openBlock(),createBlock(J,{key:"advanced-"+X},{default:withCtx(()=>[createVNode(Q,{border:!1,"column-num":"4",gutter:0,class:"grid_transparent"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(se,(ce,he)=>(openBlock(),createBlock(H,{key:ce.propId,onClick:ye=>D(he,unref(GIFT_TYPE).ADVANCED_TAB,X)},{default:withCtx(()=>[createVNode(G,mergeProps({ref_for:!0},{options:ce,type:unref(GIFT_TYPE).ADVANCED_TAB,index:he,page:X,selectIndex:h.value,selectTabType:p.value,selectPage:d.value}),null,16)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024))),128)),(openBlock(!0),createElementBlock(Fragment,null,renderList(w.value,(se,X)=>(openBlock(),createBlock(J,{key:"backpack-"+X},{default:withCtx(()=>[createVNode(Q,{border:!1,"column-num":"4",class:"grid_transparent"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(se,(ce,he)=>(openBlock(),createBlock(H,{key:ce.propId,onClick:ye=>D(he,unref(GIFT_TYPE).BACKPACK_TAB,X)},{default:withCtx(()=>[createVNode(G,mergeProps({ref_for:!0},{options:ce,type:unref(GIFT_TYPE).BACKPACK_TAB,index:he,page:X,selectIndex:h.value,selectTabType:p.value,selectPage:d.value}),null,16)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["initial-swipe"]),createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",{class:"llt-diamond",onClick:M},[F[2]||(F[2]=createBaseVNode("img",{class:"iv-diamond",src:_imports_0,alt:"Diamond Icon"},null,-1)),createBaseVNode("span",_hoisted_4,toDisplayString(s.value),1),F[3]||(F[3]=createBaseVNode("div",{class:"v-line"},null,-1)),F[4]||(F[4]=createBaseVNode("span",{class:"tv-recharge"},"充值",-1))]),createBaseVNode("div",_hoisted_5,[createBaseVNode("div",{class:"cout_select",onClick:b},[createBaseVNode("span",_hoisted_6,toDisplayString(f.value),1),F[5]||(F[5]=createBaseVNode("img",{class:"iv-gift-experience-arrows",src:_imports_1$1,alt:"Gift Arrows"},null,-1))]),createBaseVNode("span",{class:"tv-send",onClick:P},"赠送")])]),withDirectives(createVNode(ie,{class:"above-element",onSelect:T},null,512),[[vShow,n.value]])])])])):createCommentVNode("",!0)}}},__unplugin_components_3=_export_sfc(_sfc_main$3,[["__scopeId","data-v-f8f719b8"]]);var svga_min={exports:{}};(function(module,exports){(function(o,u){module.exports=u()})(window,function(){return function(o){function u(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return o[t].call(e.exports,e,e.exports,u),e.l=!0,e.exports}var r={};return u.m=o,u.c=r,u.d=function(t,e,i){u.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},u.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},u.t=function(t,e){if(1&e&&(t=u(t)),8&e||4&e&&typeof t=="object"&&t&&t.__esModule)return t;var i=Object.create(null);if(u.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&typeof t!="string")for(var n in t)u.d(i,n,(function(s){return t[s]}).bind(null,n));return i},u.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return u.d(e,"a",e),e},u.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},u.p="",u(u.s=64)}([function(o,u,r){var t,e,i=o.exports=r(1),n=r(20);i.codegen=r(47),i.fetch=r(48),i.path=r(49),i.fs=i.inquire("fs"),i.toArray=function(f){if(f){for(var h=Object.keys(f),p=new Array(h.length),d=0;d<h.length;)p[d]=f[h[d++]];return p}return[]},i.toObject=function(f){for(var h={},p=0;p<f.length;){var d=f[p++],v=f[p++];v!==void 0&&(h[d]=v)}return h};var s=/\\/g,a=/"/g;i.isReserved=function(f){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(f)},i.safeProp=function(f){return!/^[$\w_]+$/.test(f)||i.isReserved(f)?'["'+f.replace(s,"\\\\").replace(a,'\\"')+'"]':"."+f},i.ucFirst=function(f){return f.charAt(0).toUpperCase()+f.substring(1)};var l=/_([a-z])/g;i.camelCase=function(f){return f.substring(0,1)+f.substring(1).replace(l,function(h,p){return p.toUpperCase()})},i.compareFieldsById=function(f,h){return f.id-h.id},i.decorateType=function(f,h){if(f.$type)return h&&f.$type.name!==h&&(i.decorateRoot.remove(f.$type),f.$type.name=h,i.decorateRoot.add(f.$type)),f.$type;t||(t=r(22));var p=new t(h||f.name);return i.decorateRoot.add(p),p.ctor=f,Object.defineProperty(f,"$type",{value:p,enumerable:!1}),Object.defineProperty(f.prototype,"$type",{value:p,enumerable:!1}),p};var c=0;i.decorateEnum=function(f){if(f.$type)return f.$type;e||(e=r(2));var h=new e("Enum"+c++,f);return i.decorateRoot.add(h),Object.defineProperty(f,"$type",{value:h,enumerable:!1}),h},i.setProperty=function(f,h,p){if(typeof f!="object")throw TypeError("dst must be an object");if(!h)throw TypeError("path must be specified");return function d(v,g,y){var m=g.shift();if(g.length>0)v[m]=d(v[m]||{},g,y);else{var S=v[m];S&&(y=[].concat(S).concat(y)),v[m]=y}return v}(f,h=h.split("."),p)},Object.defineProperty(i,"decorateRoot",{get:function(){return n.decorated||(n.decorated=new(r(30)))}})},function(o,u,r){(function(t){function e(s,a,l){for(var c=Object.keys(a),f=0;f<c.length;++f)s[c[f]]!==void 0&&l||(s[c[f]]=a[c[f]]);return s}function i(s){function a(l,c){if(!(this instanceof a))return new a(l,c);Object.defineProperty(this,"message",{get:function(){return l}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),c&&e(this,c)}return(a.prototype=Object.create(Error.prototype)).constructor=a,Object.defineProperty(a.prototype,"name",{get:function(){return s}}),a.prototype.toString=function(){return this.name+": "+this.message},a}var n=u;n.asPromise=r(17),n.base64=r(38),n.EventEmitter=r(39),n.float=r(40),n.inquire=r(18),n.utf8=r(41),n.pool=r(42),n.LongBits=r(43),n.isNode=!!(t!==void 0&&t&&t.process&&t.process.versions&&t.process.versions.node),n.global=n.isNode&&t||typeof window<"u"&&window||typeof self<"u"&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},n.isString=function(s){return typeof s=="string"||s instanceof String},n.isObject=function(s){return s&&typeof s=="object"},n.isset=n.isSet=function(s,a){var l=s[a];return!(l==null||!s.hasOwnProperty(a))&&(typeof l!="object"||(Array.isArray(l)?l.length:Object.keys(l).length)>0)},n.Buffer=function(){try{var s=n.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch{return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(s){return typeof s=="number"?n.Buffer?n._Buffer_allocUnsafe(s):new n.Array(s):n.Buffer?n._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},n.Array=typeof Uint8Array<"u"?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(s){return s?n.LongBits.from(s).toHash():n.LongBits.zeroHash},n.longFromHash=function(s,a){var l=n.LongBits.fromHash(s);return n.Long?n.Long.fromBits(l.lo,l.hi,a):l.toNumber(!!a)},n.merge=e,n.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(s){for(var a={},l=0;l<s.length;++l)a[s[l]]=1;return function(){for(var c=Object.keys(this),f=c.length-1;f>-1;--f)if(a[c[f]]===1&&this[c[f]]!==void 0&&this[c[f]]!==null)return c[f]}},n.oneOfSetter=function(s){return function(a){for(var l=0;l<s.length;++l)s[l]!==a&&delete this[s[l]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var s=n.Buffer;s?(n._Buffer_from=s.from!==Uint8Array.from&&s.from||function(a,l){return new s(a,l)},n._Buffer_allocUnsafe=s.allocUnsafe||function(a){return new s(a)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(37))},function(o,u,r){function t(s,a,l,c,f){if(e.call(this,s,l),a&&typeof a!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=c,this.comments=f||{},this.reserved=void 0,a)for(var h=Object.keys(a),p=0;p<h.length;++p)typeof a[h[p]]=="number"&&(this.valuesById[this.values[h[p]]=a[h[p]]]=h[p])}o.exports=t;var e=r(3);((t.prototype=Object.create(e.prototype)).constructor=t).className="Enum";var i=r(6),n=r(0);t.fromJSON=function(s,a){var l=new t(s,a.values,a.options,a.comment,a.comments);return l.reserved=a.reserved,l},t.prototype.toJSON=function(s){var a=!!s&&!!s.keepComments;return n.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",a?this.comment:void 0,"comments",a?this.comments:void 0])},t.prototype.add=function(s,a,l){if(!n.isString(s))throw TypeError("name must be a string");if(!n.isInteger(a))throw TypeError("id must be an integer");if(this.values[s]!==void 0)throw Error("duplicate name '"+s+"' in "+this);if(this.isReservedId(a))throw Error("id "+a+" is reserved in "+this);if(this.isReservedName(s))throw Error("name '"+s+"' is reserved in "+this);if(this.valuesById[a]!==void 0){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+a+" in "+this);this.values[s]=a}else this.valuesById[this.values[s]=a]=s;return this.comments[s]=l||null,this},t.prototype.remove=function(s){if(!n.isString(s))throw TypeError("name must be a string");var a=this.values[s];if(a==null)throw Error("name '"+s+"' does not exist in "+this);return delete this.valuesById[a],delete this.values[s],delete this.comments[s],this},t.prototype.isReservedId=function(s){return i.isReservedId(this.reserved,s)},t.prototype.isReservedName=function(s){return i.isReservedName(this.reserved,s)}},function(o,u,r){function t(n,s){if(!i.isString(n))throw TypeError("name must be a string");if(s&&!i.isObject(s))throw TypeError("options must be an object");this.options=s,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}o.exports=t,t.className="ReflectionObject";var e,i=r(0);Object.defineProperties(t.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],s=this.parent;s;)n.unshift(s.name),s=s.parent;return n.join(".")}}}),t.prototype.toJSON=function(){throw Error()},t.prototype.onAdd=function(n){this.parent&&this.parent!==n&&this.parent.remove(this),this.parent=n,this.resolved=!1;var s=n.root;s instanceof e&&s._handleAdd(this)},t.prototype.onRemove=function(n){var s=n.root;s instanceof e&&s._handleRemove(this),this.parent=null,this.resolved=!1},t.prototype.resolve=function(){return this.resolved?this:(this.root instanceof e&&(this.resolved=!0),this)},t.prototype.getOption=function(n){if(this.options)return this.options[n]},t.prototype.setOption=function(n,s,a){return a&&this.options&&this.options[n]!==void 0||((this.options||(this.options={}))[n]=s),this},t.prototype.setParsedOption=function(n,s,a){this.parsedOptions||(this.parsedOptions=[]);var l=this.parsedOptions;if(a){var c=l.find(function(p){return Object.prototype.hasOwnProperty.call(p,n)});if(c){var f=c[n];i.setProperty(f,a,s)}else(c={})[n]=i.setProperty({},a,s),l.push(c)}else{var h={};h[n]=s,l.push(h)}return this},t.prototype.setOptions=function(n,s){if(n)for(var a=Object.keys(n),l=0;l<a.length;++l)this.setOption(a[l],n[a[l]],s);return this},t.prototype.toString=function(){var n=this.constructor.className,s=this.fullName;return s.length?n+" "+s:n},t._configure=function(n){e=n}},function(o,u,r){function t(c,f,h,p,d,v,g){if(a.isObject(p)?(g=d,v=p,p=d=void 0):a.isObject(d)&&(g=v,v=d,d=void 0),e.call(this,c,v),!a.isInteger(f)||f<0)throw TypeError("id must be a non-negative integer");if(!a.isString(h))throw TypeError("type must be a string");if(p!==void 0&&!l.test(p=p.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(d!==void 0&&!a.isString(d))throw TypeError("extend must be a string");this.rule=p&&p!=="optional"?p:void 0,this.type=h,this.id=f,this.extend=d||void 0,this.required=p==="required",this.optional=!this.required,this.repeated=p==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&s.long[h]!==void 0,this.bytes=h==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=g}o.exports=t;var e=r(3);((t.prototype=Object.create(e.prototype)).constructor=t).className="Field";var i,n=r(2),s=r(7),a=r(0),l=/^required|optional|repeated$/;t.fromJSON=function(c,f){return new t(c,f.id,f.type,f.rule,f.extend,f.options,f.comment)},Object.defineProperty(t.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}}),t.prototype.setOption=function(c,f,h){return c==="packed"&&(this._packed=null),e.prototype.setOption.call(this,c,f,h)},t.prototype.toJSON=function(c){var f=!!c&&!!c.keepComments;return a.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",f?this.comment:void 0])},t.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=s.defaults[this.type])===void 0&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof n&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==!0&&(this.options.packed===void 0||!this.resolvedType||this.resolvedType instanceof n)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var c;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,c=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,c=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=c}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},t.d=function(c,f,h,p){return typeof f=="function"?f=a.decorateType(f).name:f&&typeof f=="object"&&(f=a.decorateEnum(f).name),function(d,v){a.decorateType(d.constructor).add(new t(v,c,f,h,{default:p}))}},t._configure=function(c){i=c}},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.BezierPath=function t(e,i,n){(function(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")})(this,t),this._d=e,this._transform=i,this._styles=n}},function(o,u,r){function t(h,p){if(h&&h.length){for(var d={},v=0;v<h.length;++v)d[h[v].name]=h[v].toJSON(p);return d}}function e(h,p){n.call(this,h,p),this.nested=void 0,this._nestedArray=null}function i(h){return h._nestedArray=null,h}o.exports=e;var n=r(3);((e.prototype=Object.create(n.prototype)).constructor=e).className="Namespace";var s,a,l,c=r(4),f=r(0);e.fromJSON=function(h,p){return new e(h,p.options).addJSON(p.nested)},e.arrayToJSON=t,e.isReservedId=function(h,p){if(h){for(var d=0;d<h.length;++d)if(typeof h[d]!="string"&&h[d][0]<=p&&h[d][1]>p)return!0}return!1},e.isReservedName=function(h,p){if(h){for(var d=0;d<h.length;++d)if(h[d]===p)return!0}return!1},Object.defineProperty(e.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=f.toArray(this.nested))}}),e.prototype.toJSON=function(h){return f.toObject(["options",this.options,"nested",t(this.nestedArray,h)])},e.prototype.addJSON=function(h){if(h)for(var p,d=Object.keys(h),v=0;v<d.length;++v)p=h[d[v]],this.add((p.fields!==void 0?s.fromJSON:p.values!==void 0?l.fromJSON:p.methods!==void 0?a.fromJSON:p.id!==void 0?c.fromJSON:e.fromJSON)(d[v],p));return this},e.prototype.get=function(h){return this.nested&&this.nested[h]||null},e.prototype.getEnum=function(h){if(this.nested&&this.nested[h]instanceof l)return this.nested[h].values;throw Error("no such enum: "+h)},e.prototype.add=function(h){if(!(h instanceof c&&h.extend!==void 0||h instanceof s||h instanceof l||h instanceof a||h instanceof e))throw TypeError("object must be a valid nested object");if(this.nested){var p=this.get(h.name);if(p){if(!(p instanceof e&&h instanceof e)||p instanceof s||p instanceof a)throw Error("duplicate name '"+h.name+"' in "+this);for(var d=p.nestedArray,v=0;v<d.length;++v)h.add(d[v]);this.remove(p),this.nested||(this.nested={}),h.setOptions(p.options,!0)}}else this.nested={};return this.nested[h.name]=h,h.onAdd(this),i(this)},e.prototype.remove=function(h){if(!(h instanceof n))throw TypeError("object must be a ReflectionObject");if(h.parent!==this)throw Error(h+" is not a member of "+this);return delete this.nested[h.name],Object.keys(this.nested).length||(this.nested=void 0),h.onRemove(this),i(this)},e.prototype.define=function(h,p){if(f.isString(h))h=h.split(".");else if(!Array.isArray(h))throw TypeError("illegal path");if(h&&h.length&&h[0]==="")throw Error("path must be relative");for(var d=this;h.length>0;){var v=h.shift();if(d.nested&&d.nested[v]){if(!((d=d.nested[v])instanceof e))throw Error("path conflicts with non-namespace objects")}else d.add(d=new e(v))}return p&&d.addJSON(p),d},e.prototype.resolveAll=function(){for(var h=this.nestedArray,p=0;p<h.length;)h[p]instanceof e?h[p++].resolveAll():h[p++].resolve();return this.resolve()},e.prototype.lookup=function(h,p,d){if(typeof p=="boolean"?(d=p,p=void 0):p&&!Array.isArray(p)&&(p=[p]),f.isString(h)&&h.length){if(h===".")return this.root;h=h.split(".")}else if(!h.length)return this;if(h[0]==="")return this.root.lookup(h.slice(1),p);var v=this.get(h[0]);if(v){if(h.length===1){if(!p||p.indexOf(v.constructor)>-1)return v}else if(v instanceof e&&(v=v.lookup(h.slice(1),p,!0)))return v}else for(var g=0;g<this.nestedArray.length;++g)if(this._nestedArray[g]instanceof e&&(v=this._nestedArray[g].lookup(h,p,!0)))return v;return this.parent===null||d?null:this.parent.lookup(h,p)},e.prototype.lookupType=function(h){var p=this.lookup(h,[s]);if(!p)throw Error("no such type: "+h);return p},e.prototype.lookupEnum=function(h){var p=this.lookup(h,[l]);if(!p)throw Error("no such Enum '"+h+"' in "+this);return p},e.prototype.lookupTypeOrEnum=function(h){var p=this.lookup(h,[s,l]);if(!p)throw Error("no such Type or Enum '"+h+"' in "+this);return p},e.prototype.lookupService=function(h){var p=this.lookup(h,[a]);if(!p)throw Error("no such Service '"+h+"' in "+this);return p},e._configure=function(h,p,d){s=h,a=p,l=d}},function(o,u,r){function t(s,a){var l=0,c={};for(a|=0;l<s.length;)c[n[l+a]]=s[l++];return c}var e=u,i=r(0),n=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];e.basic=t([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),e.defaults=t([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),e.long=t([0,0,0,1,1],7),e.mapKey=t([0,0,0,5,5,0,0,0,1,1,0,2],2),e.packed=t([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(o,u,r){function t(s,a){return Object.prototype.hasOwnProperty.call(s,a)}var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";u.assign=function(s){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)t(l,c)&&(s[c]=l[c])}}return s},u.shrinkBuf=function(s,a){return s.length===a?s:s.subarray?s.subarray(0,a):(s.length=a,s)};var i={arraySet:function(s,a,l,c,f){if(a.subarray&&s.subarray)s.set(a.subarray(l,l+c),f);else for(var h=0;h<c;h++)s[f+h]=a[l+h]},flattenChunks:function(s){var a,l,c,f,h,p;for(c=0,a=0,l=s.length;a<l;a++)c+=s[a].length;for(p=new Uint8Array(c),f=0,a=0,l=s.length;a<l;a++)h=s[a],p.set(h,f),f+=h.length;return p}},n={arraySet:function(s,a,l,c,f){for(var h=0;h<c;h++)s[f+h]=a[l+h]},flattenChunks:function(s){return[].concat.apply([],s)}};u.setTyped=function(s){s?(u.Buf8=Uint8Array,u.Buf16=Uint16Array,u.Buf32=Int32Array,u.assign(u,i)):(u.Buf8=Array,u.Buf16=Array,u.Buf32=Array,u.assign(u,n))},u.setTyped(e)},function(o,u,r){function t(m,S,_){this.fn=m,this.len=S,this.next=void 0,this.val=_}function e(){}function i(m){this.head=m.head,this.tail=m.tail,this.len=m.len,this.next=m.states}function n(){this.len=0,this.head=new t(e,0,0),this.tail=this.head,this.states=null}function s(m,S,_){S[_]=255&m}function a(m,S){this.len=m,this.next=void 0,this.val=S}function l(m,S,_){for(;m.hi;)S[_++]=127&m.lo|128,m.lo=(m.lo>>>7|m.hi<<25)>>>0,m.hi>>>=7;for(;m.lo>127;)S[_++]=127&m.lo|128,m.lo=m.lo>>>7;S[_++]=m.lo}function c(m,S,_){S[_]=255&m,S[_+1]=m>>>8&255,S[_+2]=m>>>16&255,S[_+3]=m>>>24}o.exports=n;var f,h=r(1),p=h.LongBits,d=h.base64,v=h.utf8,g=function(){return h.Buffer?function(){return(n.create=function(){return new f})()}:function(){return new n}};n.create=g(),n.alloc=function(m){return new h.Array(m)},h.Array!==Array&&(n.alloc=h.pool(n.alloc,h.Array.prototype.subarray)),n.prototype._push=function(m,S,_){return this.tail=this.tail.next=new t(m,S,_),this.len+=S,this},a.prototype=Object.create(t.prototype),a.prototype.fn=function(m,S,_){for(;m>127;)S[_++]=127&m|128,m>>>=7;S[_]=m},n.prototype.uint32=function(m){return this.len+=(this.tail=this.tail.next=new a((m>>>=0)<128?1:m<16384?2:m<2097152?3:m<268435456?4:5,m)).len,this},n.prototype.int32=function(m){return m<0?this._push(l,10,p.fromNumber(m)):this.uint32(m)},n.prototype.sint32=function(m){return this.uint32((m<<1^m>>31)>>>0)},n.prototype.uint64=function(m){var S=p.from(m);return this._push(l,S.length(),S)},n.prototype.int64=n.prototype.uint64,n.prototype.sint64=function(m){var S=p.from(m).zzEncode();return this._push(l,S.length(),S)},n.prototype.bool=function(m){return this._push(s,1,m?1:0)},n.prototype.fixed32=function(m){return this._push(c,4,m>>>0)},n.prototype.sfixed32=n.prototype.fixed32,n.prototype.fixed64=function(m){var S=p.from(m);return this._push(c,4,S.lo)._push(c,4,S.hi)},n.prototype.sfixed64=n.prototype.fixed64,n.prototype.float=function(m){return this._push(h.float.writeFloatLE,4,m)},n.prototype.double=function(m){return this._push(h.float.writeDoubleLE,8,m)};var y=h.Array.prototype.set?function(m,S,_){S.set(m,_)}:function(m,S,_){for(var A=0;A<m.length;++A)S[_+A]=m[A]};n.prototype.bytes=function(m){var S=m.length>>>0;if(!S)return this._push(s,1,0);if(h.isString(m)){var _=n.alloc(S=d.length(m));d.decode(m,_,0),m=_}return this.uint32(S)._push(y,S,m)},n.prototype.string=function(m){var S=v.length(m);return S?this.uint32(S)._push(v.write,S,m):this._push(s,1,0)},n.prototype.fork=function(){return this.states=new i(this),this.head=this.tail=new t(e,0,0),this.len=0,this},n.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new t(e,0,0),this.len=0),this},n.prototype.ldelim=function(){var m=this.head,S=this.tail,_=this.len;return this.reset().uint32(_),_&&(this.tail.next=m.next,this.tail=S,this.len+=_),this},n.prototype.finish=function(){for(var m=this.head.next,S=this.constructor.alloc(this.len),_=0;m;)m.fn(m.val,S,_),_+=m.len,m=m.next;return S},n._configure=function(m){f=m,n.create=g(),f._configure()}},function(o,u,r){function t(d,v){return RangeError("index out of range: "+d.pos+" + "+(v||1)+" > "+d.len)}function e(d){this.buf=d,this.pos=0,this.len=d.length}function i(){var d=new c(0,0),v=0;if(!(this.len-this.pos>4)){for(;v<3;++v){if(this.pos>=this.len)throw t(this);if(d.lo=(d.lo|(127&this.buf[this.pos])<<7*v)>>>0,this.buf[this.pos++]<128)return d}return d.lo=(d.lo|(127&this.buf[this.pos++])<<7*v)>>>0,d}for(;v<4;++v)if(d.lo=(d.lo|(127&this.buf[this.pos])<<7*v)>>>0,this.buf[this.pos++]<128)return d;if(d.lo=(d.lo|(127&this.buf[this.pos])<<28)>>>0,d.hi=(d.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return d;if(v=0,this.len-this.pos>4){for(;v<5;++v)if(d.hi=(d.hi|(127&this.buf[this.pos])<<7*v+3)>>>0,this.buf[this.pos++]<128)return d}else for(;v<5;++v){if(this.pos>=this.len)throw t(this);if(d.hi=(d.hi|(127&this.buf[this.pos])<<7*v+3)>>>0,this.buf[this.pos++]<128)return d}throw Error("invalid varint encoding")}function n(d,v){return(d[v-4]|d[v-3]<<8|d[v-2]<<16|d[v-1]<<24)>>>0}function s(){if(this.pos+8>this.len)throw t(this,8);return new c(n(this.buf,this.pos+=4),n(this.buf,this.pos+=4))}o.exports=e;var a,l=r(1),c=l.LongBits,f=l.utf8,h=typeof Uint8Array<"u"?function(d){if(d instanceof Uint8Array||Array.isArray(d))return new e(d);throw Error("illegal buffer")}:function(d){if(Array.isArray(d))return new e(d);throw Error("illegal buffer")},p=function(){return l.Buffer?function(d){return(e.create=function(v){return l.Buffer.isBuffer(v)?new a(v):h(v)})(d)}:h};e.create=p(),e.prototype._slice=l.Array.prototype.subarray||l.Array.prototype.slice,e.prototype.uint32=function(){var d=4294967295;return function(){if(d=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(d=(d|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(d=(d|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(d=(d|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(d=(d|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return d;if((this.pos+=5)>this.len)throw this.pos=this.len,t(this,10);return d}}(),e.prototype.int32=function(){return 0|this.uint32()},e.prototype.sint32=function(){var d=this.uint32();return d>>>1^-(1&d)|0},e.prototype.bool=function(){return this.uint32()!==0},e.prototype.fixed32=function(){if(this.pos+4>this.len)throw t(this,4);return n(this.buf,this.pos+=4)},e.prototype.sfixed32=function(){if(this.pos+4>this.len)throw t(this,4);return 0|n(this.buf,this.pos+=4)},e.prototype.float=function(){if(this.pos+4>this.len)throw t(this,4);var d=l.float.readFloatLE(this.buf,this.pos);return this.pos+=4,d},e.prototype.double=function(){if(this.pos+8>this.len)throw t(this,4);var d=l.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,d},e.prototype.bytes=function(){var d=this.uint32(),v=this.pos,g=this.pos+d;if(g>this.len)throw t(this,d);return this.pos+=d,Array.isArray(this.buf)?this.buf.slice(v,g):v===g?new this.buf.constructor(0):this._slice.call(this.buf,v,g)},e.prototype.string=function(){var d=this.bytes();return f.read(d,0,d.length)},e.prototype.skip=function(d){if(typeof d=="number"){if(this.pos+d>this.len)throw t(this,d);this.pos+=d}else do if(this.pos>=this.len)throw t(this);while(128&this.buf[this.pos++]);return this},e.prototype.skipType=function(d){switch(d){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(d=7&this.uint32())!=4;)this.skipType(d);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+d+" at offset "+this.pos)}return this},e._configure=function(d){a=d,e.create=p(),a._configure();var v=l.Long?"toLong":"toNumber";l.merge(e.prototype,{int64:function(){return i.call(this)[v](!1)},uint64:function(){return i.call(this)[v](!0)},sint64:function(){return i.call(this).zzDecode()[v](!1)},fixed64:function(){return s.call(this)[v](!0)},sfixed64:function(){return s.call(this)[v](!1)}})}},function(o,u,r){function t(a,l,c,f){if(Array.isArray(l)||(c=l,l=void 0),i.call(this,a,c),l!==void 0&&!Array.isArray(l))throw TypeError("fieldNames must be an Array");this.oneof=l||[],this.fieldsArray=[],this.comment=f}function e(a){if(a.parent)for(var l=0;l<a.fieldsArray.length;++l)a.fieldsArray[l].parent||a.parent.add(a.fieldsArray[l])}o.exports=t;var i=r(3);((t.prototype=Object.create(i.prototype)).constructor=t).className="OneOf";var n=r(4),s=r(0);t.fromJSON=function(a,l){return new t(a,l.oneof,l.options,l.comment)},t.prototype.toJSON=function(a){var l=!!a&&!!a.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",l?this.comment:void 0])},t.prototype.add=function(a){if(!(a instanceof n))throw TypeError("field must be a Field");return a.parent&&a.parent!==this.parent&&a.parent.remove(a),this.oneof.push(a.name),this.fieldsArray.push(a),a.partOf=this,e(this),this},t.prototype.remove=function(a){if(!(a instanceof n))throw TypeError("field must be a Field");var l=this.fieldsArray.indexOf(a);if(l<0)throw Error(a+" is not a member of "+this);return this.fieldsArray.splice(l,1),(l=this.oneof.indexOf(a.name))>-1&&this.oneof.splice(l,1),a.partOf=null,this},t.prototype.onAdd=function(a){i.prototype.onAdd.call(this,a);for(var l=0;l<this.oneof.length;++l){var c=a.get(this.oneof[l]);c&&!c.partOf&&(c.partOf=this,this.fieldsArray.push(c))}e(this)},t.prototype.onRemove=function(a){for(var l,c=0;c<this.fieldsArray.length;++c)(l=this.fieldsArray[c]).parent&&l.parent.remove(l);i.prototype.onRemove.call(this,a)},t.d=function(){for(var a=new Array(arguments.length),l=0;l<arguments.length;)a[l]=arguments[l++];return function(c,f){s.decorateType(c.constructor).add(new t(f,a)),Object.defineProperty(c,f,{get:s.oneOfGetter(a),set:s.oneOfSetter(a)})}}},function(o,u,r){function t(i){if(i)for(var n=Object.keys(i),s=0;s<n.length;++s)this[n[s]]=i[n[s]]}o.exports=t;var e=r(1);t.create=function(i){return this.$type.create(i)},t.encode=function(i,n){return this.$type.encode(i,n)},t.encodeDelimited=function(i,n){return this.$type.encodeDelimited(i,n)},t.decode=function(i){return this.$type.decode(i)},t.decodeDelimited=function(i){return this.$type.decodeDelimited(i)},t.verify=function(i){return this.$type.verify(i)},t.fromObject=function(i){return this.$type.fromObject(i)},t.toObject=function(i,n){return this.$type.toObject(i,n)},t.prototype.toJSON=function(){return this.$type.toObject(this,e.toJSONOptions)}},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.Parser=void 0;var t=function(){function n(s,a){for(var l=0;l<a.length;l++){var c=a[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(s,c.key,c)}}return function(s,a,l){return a&&n(s.prototype,a),l&&n(s,l),s}}(),e=r(31),i=function(n){return n&&n.__esModule?n:{default:n}}(r(50));u.Parser=function(){function n(){(function(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")})(this,n)}return t(n,[{key:"load",value:function(s,a,l){this.loadViaWorker(s,a,l)}},{key:"loadViaWorker",value:function(s,a,l){(0,i.default)(s,function(c){var f=c.movie;f.version=c.ver;var h=c.images,p=new e.VideoEntity(f,h);a(p)},l)}}]),n}()},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.RectPath=void 0;var t=r(5);u.RectPath=function(e){function i(n,s,a,l,c,f,h){(function(d,v){if(!(d instanceof v))throw new TypeError("Cannot call a class as a function")})(this,i);var p=function(d,v){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!v||typeof v!="object"&&typeof v!="function"?d:v}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return p._x=n,p._y=s,p._width=a,p._height=l,p._cornerRadius=c,p._transform=f,p._styles=h,p}return function(n,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);n.prototype=Object.create(s&&s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(n,s):n.__proto__=s)}(i,e),i}(t.BezierPath)},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.EllipsePath=void 0;var t=r(5);u.EllipsePath=function(e){function i(n,s,a,l,c,f){(function(p,d){if(!(p instanceof d))throw new TypeError("Cannot call a class as a function")})(this,i);var h=function(p,d){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||typeof d!="object"&&typeof d!="function"?p:d}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return h._x=n,h._y=s,h._radiusX=a,h._radiusY=l,h._transform=c,h._styles=f,h}return function(n,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);n.prototype=Object.create(s&&s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(n,s):n.__proto__=s)}(i,e),i}(t.BezierPath)},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0});var t=r(34),e=JSON.parse('{"nested":{"com":{"nested":{"opensource":{"nested":{"svga":{"options":{"objc_class_prefix":"SVGAProto","java_package":"com.opensource.svgaplayer.proto"},"nested":{"MovieParams":{"fields":{"viewBoxWidth":{"type":"float","id":1},"viewBoxHeight":{"type":"float","id":2},"fps":{"type":"int32","id":3},"frames":{"type":"int32","id":4}}},"SpriteEntity":{"fields":{"imageKey":{"type":"string","id":1},"frames":{"rule":"repeated","type":"FrameEntity","id":2},"matteKey":{"type":"string","id":3}}},"AudioEntity":{"fields":{"audioKey":{"type":"string","id":1},"startFrame":{"type":"int32","id":2},"endFrame":{"type":"int32","id":3},"startTime":{"type":"int32","id":4},"totalTime":{"type":"int32","id":5}}},"Layout":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"width":{"type":"float","id":3},"height":{"type":"float","id":4}}},"Transform":{"fields":{"a":{"type":"float","id":1},"b":{"type":"float","id":2},"c":{"type":"float","id":3},"d":{"type":"float","id":4},"tx":{"type":"float","id":5},"ty":{"type":"float","id":6}}},"ShapeEntity":{"oneofs":{"args":{"oneof":["shape","rect","ellipse"]}},"fields":{"type":{"type":"ShapeType","id":1},"shape":{"type":"ShapeArgs","id":2},"rect":{"type":"RectArgs","id":3},"ellipse":{"type":"EllipseArgs","id":4},"styles":{"type":"ShapeStyle","id":10},"transform":{"type":"Transform","id":11}},"nested":{"ShapeType":{"values":{"SHAPE":0,"RECT":1,"ELLIPSE":2,"KEEP":3}},"ShapeArgs":{"fields":{"d":{"type":"string","id":1}}},"RectArgs":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"width":{"type":"float","id":3},"height":{"type":"float","id":4},"cornerRadius":{"type":"float","id":5}}},"EllipseArgs":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"radiusX":{"type":"float","id":3},"radiusY":{"type":"float","id":4}}},"ShapeStyle":{"fields":{"fill":{"type":"RGBAColor","id":1},"stroke":{"type":"RGBAColor","id":2},"strokeWidth":{"type":"float","id":3},"lineCap":{"type":"LineCap","id":4},"lineJoin":{"type":"LineJoin","id":5},"miterLimit":{"type":"float","id":6},"lineDashI":{"type":"float","id":7},"lineDashII":{"type":"float","id":8},"lineDashIII":{"type":"float","id":9}},"nested":{"RGBAColor":{"fields":{"r":{"type":"float","id":1},"g":{"type":"float","id":2},"b":{"type":"float","id":3},"a":{"type":"float","id":4}}},"LineCap":{"values":{"LineCap_BUTT":0,"LineCap_ROUND":1,"LineCap_SQUARE":2}},"LineJoin":{"values":{"LineJoin_MITER":0,"LineJoin_ROUND":1,"LineJoin_BEVEL":2}}}}}},"FrameEntity":{"fields":{"alpha":{"type":"float","id":1},"layout":{"type":"Layout","id":2},"transform":{"type":"Transform","id":3},"clipPath":{"type":"string","id":4},"shapes":{"rule":"repeated","type":"ShapeEntity","id":5}}},"MovieEntity":{"fields":{"version":{"type":"string","id":1},"params":{"type":"MovieParams","id":2},"images":{"keyType":"string","type":"bytes","id":3},"sprites":{"rule":"repeated","type":"SpriteEntity","id":4},"audios":{"rule":"repeated","type":"AudioEntity","id":5}}}}}}}}}}}'),i=u.proto=t.Root.fromJSON(e);u.ProtoMovieEntity=i.lookupType("com.opensource.svga.MovieEntity")},function(o,u,r){o.exports=function(t,e){for(var i=new Array(arguments.length-1),n=0,s=2,a=!0;s<arguments.length;)i[n++]=arguments[s++];return new Promise(function(l,c){i[n]=function(f){if(a)if(a=!1,f)c(f);else{for(var h=new Array(arguments.length-1),p=0;p<h.length;)h[p++]=arguments[p];l.apply(null,h)}};try{t.apply(e||null,i)}catch(f){a&&(a=!1,c(f))}})}},function(module,exports,__webpack_require__){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(o){}return null}module.exports=inquire},function(o,u,r){u.Service=r(46)},function(o,u,r){o.exports={}},function(o,u,r){function t(s,a,l,c){return a.resolvedType.group?s("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",l,c,(a.id<<3|3)>>>0,(a.id<<3|4)>>>0):s("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",l,c,(a.id<<3|2)>>>0)}o.exports=function(s){for(var a,l=n.codegen(["m","w"],s.name+"$encode")("if(!w)")("w=Writer.create()"),c=s.fieldsArray.slice().sort(n.compareFieldsById),f=0;f<c.length;++f){var h=c[f].resolve(),p=s._fieldsArray.indexOf(h),d=h.resolvedType instanceof e?"int32":h.type,v=i.basic[d];a="m"+n.safeProp(h.name),h.map?(l("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",a,h.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",a)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(h.id<<3|2)>>>0,8|i.mapKey[h.keyType],h.keyType),v===void 0?l("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",p,a):l(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|v,d,a),l("}")("}")):h.repeated?(l("if(%s!=null&&%s.length){",a,a),h.packed&&i.packed[d]!==void 0?l("w.uint32(%i).fork()",(h.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",a)("w.%s(%s[i])",d,a)("w.ldelim()"):(l("for(var i=0;i<%s.length;++i)",a),v===void 0?t(l,h,p,a+"[i]"):l("w.uint32(%i).%s(%s[i])",(h.id<<3|v)>>>0,d,a)),l("}")):(h.optional&&l("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",a,h.name),v===void 0?t(l,h,p,a):l("w.uint32(%i).%s(%s)",(h.id<<3|v)>>>0,d,a))}return l("return w")};var e=r(2),i=r(7),n=r(0)},function(o,u,r){function t(_,A){i.call(this,_,A),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function e(_){return _._fieldsById=_._fieldsArray=_._oneofsArray=null,delete _.encode,delete _.decode,delete _.verify,_}o.exports=t;var i=r(6);((t.prototype=Object.create(i.prototype)).constructor=t).className="Type";var n=r(2),s=r(11),a=r(4),l=r(23),c=r(24),f=r(12),h=r(10),p=r(9),d=r(0),v=r(21),g=r(26),y=r(27),m=r(28),S=r(29);Object.defineProperties(t.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var _=Object.keys(this.fields),A=0;A<_.length;++A){var k=this.fields[_[A]],w=k.id;if(this._fieldsById[w])throw Error("duplicate id "+w+" in "+this);this._fieldsById[w]=k}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=t.generateConstructor(this)())},set:function(_){var A=_.prototype;A instanceof f||((_.prototype=new f).constructor=_,d.merge(_.prototype,A)),_.$type=_.prototype.$type=this,d.merge(_,f,!0),this._ctor=_;for(var k=0;k<this.fieldsArray.length;++k)this._fieldsArray[k].resolve();var w={};for(k=0;k<this.oneofsArray.length;++k)w[this._oneofsArray[k].resolve().name]={get:d.oneOfGetter(this._oneofsArray[k].oneof),set:d.oneOfSetter(this._oneofsArray[k].oneof)};k&&Object.defineProperties(_.prototype,w)}}}),t.generateConstructor=function(_){for(var A,k=d.codegen(["p"],_.name),w=0;w<_.fieldsArray.length;++w)(A=_._fieldsArray[w]).map?k("this%s={}",d.safeProp(A.name)):A.repeated&&k("this%s=[]",d.safeProp(A.name));return k("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},t.fromJSON=function(_,A){var k=new t(_,A.options);k.extensions=A.extensions,k.reserved=A.reserved;for(var w=Object.keys(A.fields),I=0;I<w.length;++I)k.add((A.fields[w[I]].keyType!==void 0?l.fromJSON:a.fromJSON)(w[I],A.fields[w[I]]));if(A.oneofs)for(w=Object.keys(A.oneofs),I=0;I<w.length;++I)k.add(s.fromJSON(w[I],A.oneofs[w[I]]));if(A.nested)for(w=Object.keys(A.nested),I=0;I<w.length;++I){var N=A.nested[w[I]];k.add((N.id!==void 0?a.fromJSON:N.fields!==void 0?t.fromJSON:N.values!==void 0?n.fromJSON:N.methods!==void 0?c.fromJSON:i.fromJSON)(w[I],N))}return A.extensions&&A.extensions.length&&(k.extensions=A.extensions),A.reserved&&A.reserved.length&&(k.reserved=A.reserved),A.group&&(k.group=!0),A.comment&&(k.comment=A.comment),k},t.prototype.toJSON=function(_){var A=i.prototype.toJSON.call(this,_),k=!!_&&!!_.keepComments;return d.toObject(["options",A&&A.options||void 0,"oneofs",i.arrayToJSON(this.oneofsArray,_),"fields",i.arrayToJSON(this.fieldsArray.filter(function(w){return!w.declaringField}),_)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",A&&A.nested||void 0,"comment",k?this.comment:void 0])},t.prototype.resolveAll=function(){for(var _=this.fieldsArray,A=0;A<_.length;)_[A++].resolve();var k=this.oneofsArray;for(A=0;A<k.length;)k[A++].resolve();return i.prototype.resolveAll.call(this)},t.prototype.get=function(_){return this.fields[_]||this.oneofs&&this.oneofs[_]||this.nested&&this.nested[_]||null},t.prototype.add=function(_){if(this.get(_.name))throw Error("duplicate name '"+_.name+"' in "+this);if(_ instanceof a&&_.extend===void 0){if(this._fieldsById?this._fieldsById[_.id]:this.fieldsById[_.id])throw Error("duplicate id "+_.id+" in "+this);if(this.isReservedId(_.id))throw Error("id "+_.id+" is reserved in "+this);if(this.isReservedName(_.name))throw Error("name '"+_.name+"' is reserved in "+this);return _.parent&&_.parent.remove(_),this.fields[_.name]=_,_.message=this,_.onAdd(this),e(this)}return _ instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[_.name]=_,_.onAdd(this),e(this)):i.prototype.add.call(this,_)},t.prototype.remove=function(_){if(_ instanceof a&&_.extend===void 0){if(!this.fields||this.fields[_.name]!==_)throw Error(_+" is not a member of "+this);return delete this.fields[_.name],_.parent=null,_.onRemove(this),e(this)}if(_ instanceof s){if(!this.oneofs||this.oneofs[_.name]!==_)throw Error(_+" is not a member of "+this);return delete this.oneofs[_.name],_.parent=null,_.onRemove(this),e(this)}return i.prototype.remove.call(this,_)},t.prototype.isReservedId=function(_){return i.isReservedId(this.reserved,_)},t.prototype.isReservedName=function(_){return i.isReservedName(this.reserved,_)},t.prototype.create=function(_){return new this.ctor(_)},t.prototype.setup=function(){for(var _=this.fullName,A=[],k=0;k<this.fieldsArray.length;++k)A.push(this._fieldsArray[k].resolve().resolvedType);this.encode=v(this)({Writer:p,types:A,util:d}),this.decode=g(this)({Reader:h,types:A,util:d}),this.verify=y(this)({types:A,util:d}),this.fromObject=m.fromObject(this)({types:A,util:d}),this.toObject=m.toObject(this)({types:A,util:d});var w=S[_];if(w){var I=Object.create(this);I.fromObject=this.fromObject,this.fromObject=w.fromObject.bind(I),I.toObject=this.toObject,this.toObject=w.toObject.bind(I)}return this},t.prototype.encode=function(_,A){return this.setup().encode(_,A)},t.prototype.encodeDelimited=function(_,A){return this.encode(_,A&&A.len?A.fork():A).ldelim()},t.prototype.decode=function(_,A){return this.setup().decode(_,A)},t.prototype.decodeDelimited=function(_){return _ instanceof h||(_=h.create(_)),this.decode(_,_.uint32())},t.prototype.verify=function(_){return this.setup().verify(_)},t.prototype.fromObject=function(_){return this.setup().fromObject(_)},t.prototype.toObject=function(_,A){return this.setup().toObject(_,A)},t.d=function(_){return function(A){d.decorateType(A,_)}}},function(o,u,r){function t(s,a,l,c,f,h){if(e.call(this,s,a,c,void 0,void 0,f,h),!n.isString(l))throw TypeError("keyType must be a string");this.keyType=l,this.resolvedKeyType=null,this.map=!0}o.exports=t;var e=r(4);((t.prototype=Object.create(e.prototype)).constructor=t).className="MapField";var i=r(7),n=r(0);t.fromJSON=function(s,a){return new t(s,a.id,a.keyType,a.type,a.options,a.comment)},t.prototype.toJSON=function(s){var a=!!s&&!!s.keepComments;return n.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",a?this.comment:void 0])},t.prototype.resolve=function(){if(this.resolved)return this;if(i.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return e.prototype.resolve.call(this)},t.d=function(s,a,l){return typeof l=="function"?l=n.decorateType(l).name:l&&typeof l=="object"&&(l=n.decorateEnum(l).name),function(c,f){n.decorateType(c.constructor).add(new t(f,s,a,l))}}},function(o,u,r){function t(l,c){i.call(this,l,c),this.methods={},this._methodsArray=null}function e(l){return l._methodsArray=null,l}o.exports=t;var i=r(6);((t.prototype=Object.create(i.prototype)).constructor=t).className="Service";var n=r(25),s=r(0),a=r(19);t.fromJSON=function(l,c){var f=new t(l,c.options);if(c.methods)for(var h=Object.keys(c.methods),p=0;p<h.length;++p)f.add(n.fromJSON(h[p],c.methods[h[p]]));return c.nested&&f.addJSON(c.nested),f.comment=c.comment,f},t.prototype.toJSON=function(l){var c=i.prototype.toJSON.call(this,l),f=!!l&&!!l.keepComments;return s.toObject(["options",c&&c.options||void 0,"methods",i.arrayToJSON(this.methodsArray,l)||{},"nested",c&&c.nested||void 0,"comment",f?this.comment:void 0])},Object.defineProperty(t.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),t.prototype.get=function(l){return this.methods[l]||i.prototype.get.call(this,l)},t.prototype.resolveAll=function(){for(var l=this.methodsArray,c=0;c<l.length;++c)l[c].resolve();return i.prototype.resolve.call(this)},t.prototype.add=function(l){if(this.get(l.name))throw Error("duplicate name '"+l.name+"' in "+this);return l instanceof n?(this.methods[l.name]=l,l.parent=this,e(this)):i.prototype.add.call(this,l)},t.prototype.remove=function(l){if(l instanceof n){if(this.methods[l.name]!==l)throw Error(l+" is not a member of "+this);return delete this.methods[l.name],l.parent=null,e(this)}return i.prototype.remove.call(this,l)},t.prototype.create=function(l,c,f){for(var h,p=new a.Service(l,c,f),d=0;d<this.methodsArray.length;++d){var v=s.lcFirst((h=this._methodsArray[d]).resolve().name).replace(/[^$\w_]/g,"");p[v]=s.codegen(["r","c"],s.isReserved(v)?v+"_":v)("return this.rpcCall(m,q,s,r,c)")({m:h,q:h.resolvedRequestType.ctor,s:h.resolvedResponseType.ctor})}return p}},function(o,u,r){function t(n,s,a,l,c,f,h,p,d){if(i.isObject(c)?(h=c,c=f=void 0):i.isObject(f)&&(h=f,f=void 0),s!==void 0&&!i.isString(s))throw TypeError("type must be a string");if(!i.isString(a))throw TypeError("requestType must be a string");if(!i.isString(l))throw TypeError("responseType must be a string");e.call(this,n,h),this.type=s||"rpc",this.requestType=a,this.requestStream=!!c||void 0,this.responseType=l,this.responseStream=!!f||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=p,this.parsedOptions=d}o.exports=t;var e=r(3);((t.prototype=Object.create(e.prototype)).constructor=t).className="Method";var i=r(0);t.fromJSON=function(n,s){return new t(n,s.type,s.requestType,s.responseType,s.requestStream,s.responseStream,s.options,s.comment,s.parsedOptions)},t.prototype.toJSON=function(n){var s=!!n&&!!n.keepComments;return i.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",s?this.comment:void 0,"parsedOptions",this.parsedOptions])},t.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),e.prototype.resolve.call(this))}},function(o,u,r){function t(s){return"missing required '"+s.name+"'"}o.exports=function(s){var a=n.codegen(["r","l"],s.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(s.fieldsArray.filter(function(d){return d.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");s.group&&a("if((t&7)===4)")("break"),a("switch(t>>>3){");for(var l=0;l<s.fieldsArray.length;++l){var c=s._fieldsArray[l].resolve(),f=c.resolvedType instanceof e?"int32":c.type,h="m"+n.safeProp(c.name);a("case %i:",c.id),c.map?(a("if(%s===util.emptyObject)",h)("%s={}",h)("var c2 = r.uint32()+r.pos"),i.defaults[c.keyType]!==void 0?a("k=%j",i.defaults[c.keyType]):a("k=null"),i.defaults[f]!==void 0?a("value=%j",i.defaults[f]):a("value=null"),a("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",c.keyType)("case 2:"),i.basic[f]===void 0?a("value=types[%i].decode(r,r.uint32())",l):a("value=r.%s()",f),a("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),i.long[c.keyType]!==void 0?a('%s[typeof k==="object"?util.longToHash(k):k]=value',h):a("%s[k]=value",h)):c.repeated?(a("if(!(%s&&%s.length))",h,h)("%s=[]",h),i.packed[f]!==void 0&&a("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",h,f)("}else"),i.basic[f]===void 0?a(c.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",h,l):a("%s.push(r.%s())",h,f)):i.basic[f]===void 0?a(c.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",h,l):a("%s=r.%s()",h,f),a("break")}for(a("default:")("r.skipType(t&7)")("break")("}")("}"),l=0;l<s._fieldsArray.length;++l){var p=s._fieldsArray[l];p.required&&a("if(!m.hasOwnProperty(%j))",p.name)("throw util.ProtocolError(%j,{instance:m})",t(p))}return a("return m")};var e=r(2),i=r(7),n=r(0)},function(o,u,r){function t(a,l){return a.name+": "+l+(a.repeated&&l!=="array"?"[]":a.map&&l!=="object"?"{k:"+a.keyType+"}":"")+" expected"}function e(a,l,c,f){if(l.resolvedType)if(l.resolvedType instanceof n){a("switch(%s){",f)("default:")("return%j",t(l,"enum value"));for(var h=Object.keys(l.resolvedType.values),p=0;p<h.length;++p)a("case %i:",l.resolvedType.values[h[p]]);a("break")("}")}else a("{")("var e=types[%i].verify(%s);",c,f)("if(e)")("return%j+e",l.name+".")("}");else switch(l.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.isInteger(%s))",f)("return%j",t(l,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",f,f,f,f)("return%j",t(l,"integer|Long"));break;case"float":case"double":a('if(typeof %s!=="number")',f)("return%j",t(l,"number"));break;case"bool":a('if(typeof %s!=="boolean")',f)("return%j",t(l,"boolean"));break;case"string":a("if(!util.isString(%s))",f)("return%j",t(l,"string"));break;case"bytes":a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',f,f,f)("return%j",t(l,"buffer"))}return a}function i(a,l,c){switch(l.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.key32Re.test(%s))",c)("return%j",t(l,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.key64Re.test(%s))",c)("return%j",t(l,"integer|Long key"));break;case"bool":a("if(!util.key2Re.test(%s))",c)("return%j",t(l,"boolean key"))}return a}o.exports=function(a){var l=s.codegen(["m"],a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),c={};a.oneofsArray.length&&l("var p={}");for(var f=0;f<a.fieldsArray.length;++f){var h=a._fieldsArray[f].resolve(),p="m"+s.safeProp(h.name);if(h.optional&&l("if(%s!=null&&m.hasOwnProperty(%j)){",p,h.name),h.map)l("if(!util.isObject(%s))",p)("return%j",t(h,"object"))("var k=Object.keys(%s)",p)("for(var i=0;i<k.length;++i){"),i(l,h,"k[i]"),e(l,h,f,p+"[k[i]]")("}");else if(h.repeated)l("if(!Array.isArray(%s))",p)("return%j",t(h,"array"))("for(var i=0;i<%s.length;++i){",p),e(l,h,f,p+"[i]")("}");else{if(h.partOf){var d=s.safeProp(h.partOf.name);c[h.partOf.name]===1&&l("if(p%s===1)",d)("return%j",h.partOf.name+": multiple values"),c[h.partOf.name]=1,l("p%s=1",d)}e(l,h,f,p)}h.optional&&l("}")}return l("return null")};var n=r(2),s=r(0)},function(o,u,r){function t(a,l,c,f){if(l.resolvedType)if(l.resolvedType instanceof n){a("switch(d%s){",f);for(var h=l.resolvedType.values,p=Object.keys(h),d=0;d<p.length;++d)l.repeated&&h[p[d]]===l.typeDefault&&a("default:"),a("case%j:",p[d])("case %i:",h[p[d]])("m%s=%j",f,h[p[d]])("break");a("}")}else a('if(typeof d%s!=="object")',f)("throw TypeError(%j)",l.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",f,c,f);else{var v=!1;switch(l.type){case"double":case"float":a("m%s=Number(d%s)",f,f);break;case"uint32":case"fixed32":a("m%s=d%s>>>0",f,f);break;case"int32":case"sint32":case"sfixed32":a("m%s=d%s|0",f,f);break;case"uint64":v=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",f,f,v)('else if(typeof d%s==="string")',f)("m%s=parseInt(d%s,10)",f,f)('else if(typeof d%s==="number")',f)("m%s=d%s",f,f)('else if(typeof d%s==="object")',f)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",f,f,f,v?"true":"");break;case"bytes":a('if(typeof d%s==="string")',f)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",f,f,f)("else if(d%s.length)",f)("m%s=d%s",f,f);break;case"string":a("m%s=String(d%s)",f,f);break;case"bool":a("m%s=Boolean(d%s)",f,f)}}return a}function e(a,l,c,f){if(l.resolvedType)l.resolvedType instanceof n?a("d%s=o.enums===String?types[%i].values[m%s]:m%s",f,c,f,f):a("d%s=types[%i].toObject(m%s,o)",f,c,f);else{var h=!1;switch(l.type){case"double":case"float":a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",f,f,f,f);break;case"uint64":h=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a('if(typeof m%s==="number")',f)("d%s=o.longs===String?String(m%s):m%s",f,f,f)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",f,f,f,f,h?"true":"",f);break;case"bytes":a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",f,f,f,f,f);break;default:a("d%s=m%s",f,f)}}return a}var i=u,n=r(2),s=r(0);i.fromObject=function(a){var l=a.fieldsArray,c=s.codegen(["d"],a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!l.length)return c("return new this.ctor");c("var m=new this.ctor");for(var f=0;f<l.length;++f){var h=l[f].resolve(),p=s.safeProp(h.name);h.map?(c("if(d%s){",p)('if(typeof d%s!=="object")',p)("throw TypeError(%j)",h.fullName+": object expected")("m%s={}",p)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",p),t(c,h,f,p+"[ks[i]]")("}")("}")):h.repeated?(c("if(d%s){",p)("if(!Array.isArray(d%s))",p)("throw TypeError(%j)",h.fullName+": array expected")("m%s=[]",p)("for(var i=0;i<d%s.length;++i){",p),t(c,h,f,p+"[i]")("}")("}")):(h.resolvedType instanceof n||c("if(d%s!=null){",p),t(c,h,f,p),h.resolvedType instanceof n||c("}"))}return c("return m")},i.toObject=function(a){var l=a.fieldsArray.slice().sort(s.compareFieldsById);if(!l.length)return s.codegen()("return {}");for(var c=s.codegen(["m","o"],a.name+"$toObject")("if(!o)")("o={}")("var d={}"),f=[],h=[],p=[],d=0;d<l.length;++d)l[d].partOf||(l[d].resolve().repeated?f:l[d].map?h:p).push(l[d]);if(f.length){for(c("if(o.arrays||o.defaults){"),d=0;d<f.length;++d)c("d%s=[]",s.safeProp(f[d].name));c("}")}if(h.length){for(c("if(o.objects||o.defaults){"),d=0;d<h.length;++d)c("d%s={}",s.safeProp(h[d].name));c("}")}if(p.length){for(c("if(o.defaults){"),d=0;d<p.length;++d){var v=p[d],g=s.safeProp(v.name);if(v.resolvedType instanceof n)c("d%s=o.enums===String?%j:%j",g,v.resolvedType.valuesById[v.typeDefault],v.typeDefault);else if(v.long)c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",v.typeDefault.low,v.typeDefault.high,v.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",g)("}else")("d%s=o.longs===String?%j:%i",g,v.typeDefault.toString(),v.typeDefault.toNumber());else if(v.bytes){var y="["+Array.prototype.slice.call(v.typeDefault).join(",")+"]";c("if(o.bytes===String)d%s=%j",g,String.fromCharCode.apply(String,v.typeDefault))("else{")("d%s=%s",g,y)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",g,g)("}")}else c("d%s=%j",g,v.typeDefault)}c("}")}var m=!1;for(d=0;d<l.length;++d){v=l[d];var S=a._fieldsArray.indexOf(v);g=s.safeProp(v.name),v.map?(m||(m=!0,c("var ks2")),c("if(m%s&&(ks2=Object.keys(m%s)).length){",g,g)("d%s={}",g)("for(var j=0;j<ks2.length;++j){"),e(c,v,S,g+"[ks2[j]]")("}")):v.repeated?(c("if(m%s&&m%s.length){",g,g)("d%s=[]",g)("for(var j=0;j<m%s.length;++j){",g),e(c,v,S,g+"[j]")("}")):(c("if(m%s!=null&&m.hasOwnProperty(%j)){",g,v.name),e(c,v,S,g),v.partOf&&c("if(o.oneofs)")("d%s=%j",s.safeProp(v.partOf.name),v.name)),c("}")}return c("return d")}},function(o,u,r){var t=u,e=r(12);t[".google.protobuf.Any"]={fromObject:function(i){if(i&&i["@type"]){var n=i["@type"].substring(i["@type"].lastIndexOf("/")+1),s=this.lookup(n);if(s){var a=i["@type"].charAt(0)==="."?i["@type"].substr(1):i["@type"];return a.indexOf("/")===-1&&(a="/"+a),this.create({type_url:a,value:s.encode(s.fromObject(i)).finish()})}}return this.fromObject(i)},toObject:function(i,n){var s="",a="";if(n&&n.json&&i.type_url&&i.value){a=i.type_url.substring(i.type_url.lastIndexOf("/")+1),s=i.type_url.substring(0,i.type_url.lastIndexOf("/")+1);var l=this.lookup(a);l&&(i=l.decode(i.value))}if(!(i instanceof this.ctor)&&i instanceof e){var c=i.$type.toObject(i,n);return s===""&&(s="type.googleapis.com/"),a=s+(i.$type.fullName[0]==="."?i.$type.fullName.substr(1):i.$type.fullName),c["@type"]=a,c}return this.toObject(i,n)}}},function(o,u,r){function t(v){n.call(this,"",v),this.deferred=[],this.files=[]}function e(){}function i(v,g){var y=g.parent.lookup(g.extend);if(y){var m=new c(g.fullName,g.id,g.type,g.rule,void 0,g.options);return m.declaringField=g,g.extensionField=m,y.add(m),!0}return!1}o.exports=t;var n=r(6);((t.prototype=Object.create(n.prototype)).constructor=t).className="Root";var s,a,l,c=r(4),f=r(2),h=r(11),p=r(0);t.fromJSON=function(v,g){return g||(g=new t),v.options&&g.setOptions(v.options),g.addJSON(v.nested)},t.prototype.resolvePath=p.path.resolve,t.prototype.fetch=p.fetch,t.prototype.load=function v(g,y,m){function S(b,T){if(m){var C=m;if(m=null,I)throw b;C(b,T)}}function _(b){var T=b.lastIndexOf("google/protobuf/");if(T>-1){var C=b.substring(T);if(C in l)return C}return null}function A(b,T){try{if(p.isString(T)&&T.charAt(0)==="{"&&(T=JSON.parse(T)),p.isString(T)){a.filename=b;var C,D=a(T,w,y),P=0;if(D.imports)for(;P<D.imports.length;++P)(C=_(D.imports[P])||w.resolvePath(b,D.imports[P]))&&k(C);if(D.weakImports)for(P=0;P<D.weakImports.length;++P)(C=_(D.weakImports[P])||w.resolvePath(b,D.weakImports[P]))&&k(C,!0)}else w.setOptions(T.options).addJSON(T.nested)}catch(B){S(B)}I||N||S(null,w)}function k(b,T){if(!(w.files.indexOf(b)>-1)){if(w.files.push(b),b in l)return void(I?A(b,l[b]):(++N,setTimeout(function(){--N,A(b,l[b])})));if(I){var C;try{C=p.fs.readFileSync(b).toString("utf8")}catch(D){return void(T||S(D))}A(b,C)}else++N,w.fetch(b,function(D,P){if(--N,m)return D?void(T?N||S(null,w):S(D)):void A(b,P)})}}typeof y=="function"&&(m=y,y=void 0);var w=this;if(!m)return p.asPromise(v,w,g,y);var I=m===e,N=0;p.isString(g)&&(g=[g]);for(var x,M=0;M<g.length;++M)(x=w.resolvePath("",g[M]))&&k(x);if(I)return w;N||S(null,w)},t.prototype.loadSync=function(v,g){if(!p.isNode)throw Error("not supported");return this.load(v,g,e)},t.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(v){return"'extend "+v.extend+"' in "+v.parent.fullName}).join(", "));return n.prototype.resolveAll.call(this)};var d=/^[A-Z]/;t.prototype._handleAdd=function(v){if(v instanceof c)v.extend===void 0||v.extensionField||i(0,v)||this.deferred.push(v);else if(v instanceof f)d.test(v.name)&&(v.parent[v.name]=v.values);else if(!(v instanceof h)){if(v instanceof s)for(var g=0;g<this.deferred.length;)i(0,this.deferred[g])?this.deferred.splice(g,1):++g;for(var y=0;y<v.nestedArray.length;++y)this._handleAdd(v._nestedArray[y]);d.test(v.name)&&(v.parent[v.name]=v)}},t.prototype._handleRemove=function(v){if(v instanceof c){if(v.extend!==void 0)if(v.extensionField)v.extensionField.parent.remove(v.extensionField),v.extensionField=null;else{var g=this.deferred.indexOf(v);g>-1&&this.deferred.splice(g,1)}}else if(v instanceof f)d.test(v.name)&&delete v.parent[v.name];else if(v instanceof n){for(var y=0;y<v.nestedArray.length;++y)this._handleRemove(v._nestedArray[y]);d.test(v.name)&&delete v.parent[v.name]}},t._configure=function(v,g,y){s=v,a=g,l=y}},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.VideoEntity=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},e=function(){function s(a,l){for(var c=0;c<l.length;c++){var f=l[c];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(a,f.key,f)}}return function(a,l,c){return l&&s(a.prototype,l),c&&s(a,c),a}}(),i=r(32),n=r(16).ProtoMovieEntity;u.VideoEntity=function(){function s(a,l){(function(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")})(this,s),this.version="",this.videoSize={width:0,height:0},this.FPS=20,this.frames=0,this.images={},this.sprites=[],this.audios=[],(a===void 0?"undefined":t(a))==="object"&&a.$type==n?(t(a.params)==="object"&&(this.version=a.ver,this.videoSize.width=a.params.viewBoxWidth||0,this.videoSize.height=a.params.viewBoxHeight||0,this.FPS=a.params.fps||20,this.frames=a.params.frames||0),this.resetSprites(a),this.audios=a.audios):a&&(a.movie&&(a.movie.viewBox&&(this.videoSize.width=parseFloat(a.movie.viewBox.width)||0,this.videoSize.height=parseFloat(a.movie.viewBox.height)||0),this.version=a.ver,this.FPS=parseInt(a.movie.fps)||20,this.frames=parseInt(a.movie.frames)||0),this.resetSprites(a)),l&&(this.images=l)}return e(s,[{key:"resetSprites",value:function(a){a.sprites instanceof Array&&(this.sprites=a.sprites.map(function(l){return new i.SpriteEntity(l)}))}}]),s}()},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.SpriteEntity=void 0;var t=r(33);r(5),r(14),r(15),u.SpriteEntity=function e(i){(function(n,s){if(!(n instanceof s))throw new TypeError("Cannot call a class as a function")})(this,e),this.matteKey=null,this.imageKey=null,this.frames=[],this.matteKey=i.matteKey,this.imageKey=i.imageKey,i.frames&&(this.frames=i.frames.map(function(n){return new t.FrameEntity(n)}))}},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.FrameEntity=void 0;var t=r(5);u.FrameEntity=function e(i){(function(d,v){if(!(d instanceof v))throw new TypeError("Cannot call a class as a function")})(this,e),this.alpha=0,this.transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this.layout={x:0,y:0,width:0,height:0},this.nx=0,this.ny=0,this.maskPath=null,this.shapes=[],this.alpha=parseFloat(i.alpha)||0,i.layout&&(this.layout.x=parseFloat(i.layout.x)||0,this.layout.y=parseFloat(i.layout.y)||0,this.layout.width=parseFloat(i.layout.width)||0,this.layout.height=parseFloat(i.layout.height)||0),i.transform&&(this.transform.a=parseFloat(i.transform.a)||1,this.transform.b=parseFloat(i.transform.b)||0,this.transform.c=parseFloat(i.transform.c)||0,this.transform.d=parseFloat(i.transform.d)||1,this.transform.tx=parseFloat(i.transform.tx)||0,this.transform.ty=parseFloat(i.transform.ty)||0),i.clipPath&&i.clipPath.length>0&&(this.maskPath=new t.BezierPath(i.clipPath,void 0,{fill:"#000000"})),i.shapes&&(i.shapes instanceof Array&&i.shapes.forEach(function(d){switch(d.pathArgs=d.args,d.type){case 0:d.type="shape",d.pathArgs=d.shape;break;case 1:d.type="rect",d.pathArgs=d.rect;break;case 2:d.type="ellipse",d.pathArgs=d.ellipse;break;case 3:d.type="keep"}if(d.styles){d.styles.fill&&(typeof d.styles.fill.r=="number"&&(d.styles.fill[0]=d.styles.fill.r),typeof d.styles.fill.g=="number"&&(d.styles.fill[1]=d.styles.fill.g),typeof d.styles.fill.b=="number"&&(d.styles.fill[2]=d.styles.fill.b),typeof d.styles.fill.a=="number"&&(d.styles.fill[3]=d.styles.fill.a)),d.styles.stroke&&(typeof d.styles.stroke.r=="number"&&(d.styles.stroke[0]=d.styles.stroke.r),typeof d.styles.stroke.g=="number"&&(d.styles.stroke[1]=d.styles.stroke.g),typeof d.styles.stroke.b=="number"&&(d.styles.stroke[2]=d.styles.stroke.b),typeof d.styles.stroke.a=="number"&&(d.styles.stroke[3]=d.styles.stroke.a));var v=d.styles.lineDash||[];switch(d.styles.lineDashI>0&&v.push(d.styles.lineDashI),d.styles.lineDashII>0&&(v.length<1&&v.push(0),v.push(d.styles.lineDashII),v.push(0)),d.styles.lineDashIII>0&&(v.length<2&&(v.push(0),v.push(0)),v[2]=d.styles.lineDashIII),d.styles.lineDash=v,d.styles.lineJoin){case 0:d.styles.lineJoin="miter";break;case 1:d.styles.lineJoin="round";break;case 2:d.styles.lineJoin="bevel"}switch(d.styles.lineCap){case 0:d.styles.lineCap="butt";break;case 1:d.styles.lineCap="round";break;case 2:d.styles.lineCap="square"}}}),i.shapes[0]&&i.shapes[0].type==="keep"?this.shapes=e.lastShapes:(this.shapes=i.shapes,e.lastShapes=i.shapes));var n=this.transform.a*this.layout.x+this.transform.c*this.layout.y+this.transform.tx,s=this.transform.a*(this.layout.x+this.layout.width)+this.transform.c*this.layout.y+this.transform.tx,a=this.transform.a*this.layout.x+this.transform.c*(this.layout.y+this.layout.height)+this.transform.tx,l=this.transform.a*(this.layout.x+this.layout.width)+this.transform.c*(this.layout.y+this.layout.height)+this.transform.tx,c=this.transform.b*this.layout.x+this.transform.d*this.layout.y+this.transform.ty,f=this.transform.b*(this.layout.x+this.layout.width)+this.transform.d*this.layout.y+this.transform.ty,h=this.transform.b*this.layout.x+this.transform.d*(this.layout.y+this.layout.height)+this.transform.ty,p=this.transform.b*(this.layout.x+this.layout.width)+this.transform.d*(this.layout.y+this.layout.height)+this.transform.ty;this.nx=Math.min(Math.min(a,l),Math.min(n,s)),this.ny=Math.min(Math.min(h,p),Math.min(c,f))}},function(o,u,r){o.exports=r(35)},function(o,u,r){var t=o.exports=r(36);t.build="light",t.load=function(e,i,n){return typeof i=="function"?(n=i,i=new t.Root):i||(i=new t.Root),i.load(e,n)},t.loadSync=function(e,i){return i||(i=new t.Root),i.loadSync(e)},t.encoder=r(21),t.decoder=r(26),t.verifier=r(27),t.converter=r(28),t.ReflectionObject=r(3),t.Namespace=r(6),t.Root=r(30),t.Enum=r(2),t.Type=r(22),t.Field=r(4),t.OneOf=r(11),t.MapField=r(23),t.Service=r(24),t.Method=r(25),t.Message=r(12),t.wrappers=r(29),t.types=r(7),t.util=r(0),t.ReflectionObject._configure(t.Root),t.Namespace._configure(t.Type,t.Service,t.Enum),t.Root._configure(t.Type),t.Field._configure(t.Type)},function(o,u,r){function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}var e=u;e.build="minimal",e.Writer=r(9),e.BufferWriter=r(44),e.Reader=r(10),e.BufferReader=r(45),e.util=r(1),e.rpc=r(19),e.roots=r(20),e.configure=t,t()},function(o,u){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch{typeof window=="object"&&(r=window)}o.exports=r},function(o,u,r){var t=u;t.length=function(s){var a=s.length;if(!a)return 0;for(var l=0;--a%4>1&&s.charAt(a)==="=";)++l;return Math.ceil(3*s.length)/4-l};for(var e=new Array(64),i=new Array(123),n=0;n<64;)i[e[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(s,a,l){for(var c,f=null,h=[],p=0,d=0;a<l;){var v=s[a++];switch(d){case 0:h[p++]=e[v>>2],c=(3&v)<<4,d=1;break;case 1:h[p++]=e[c|v>>4],c=(15&v)<<2,d=2;break;case 2:h[p++]=e[c|v>>6],h[p++]=e[63&v],d=0}p>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,h)),p=0)}return d&&(h[p++]=e[c],h[p++]=61,d===1&&(h[p++]=61)),f?(p&&f.push(String.fromCharCode.apply(String,h.slice(0,p))),f.join("")):String.fromCharCode.apply(String,h.slice(0,p))},t.decode=function(s,a,l){for(var c,f=l,h=0,p=0;p<s.length;){var d=s.charCodeAt(p++);if(d===61&&h>1)break;if((d=i[d])===void 0)throw Error("invalid encoding");switch(h){case 0:c=d,h=1;break;case 1:a[l++]=c<<2|(48&d)>>4,c=d,h=2;break;case 2:a[l++]=(15&c)<<4|(60&d)>>2,c=d,h=3;break;case 3:a[l++]=(3&c)<<6|d,h=0}}if(h===1)throw Error("invalid encoding");return l-f},t.test=function(s){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(s)}},function(o,u,r){function t(){this._listeners={}}o.exports=t,t.prototype.on=function(e,i,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:i,ctx:n||this}),this},t.prototype.off=function(e,i){if(e===void 0)this._listeners={};else if(i===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],s=0;s<n.length;)n[s].fn===i?n.splice(s,1):++s;return this},t.prototype.emit=function(e){var i=this._listeners[e];if(i){for(var n=[],s=1;s<arguments.length;)n.push(arguments[s++]);for(s=0;s<i.length;)i[s].fn.apply(i[s++].ctx,n)}return this}},function(o,u,r){function t(a){return typeof Float32Array<"u"?function(){function l(g,y,m){p[0]=g,y[m]=d[0],y[m+1]=d[1],y[m+2]=d[2],y[m+3]=d[3]}function c(g,y,m){p[0]=g,y[m]=d[3],y[m+1]=d[2],y[m+2]=d[1],y[m+3]=d[0]}function f(g,y){return d[0]=g[y],d[1]=g[y+1],d[2]=g[y+2],d[3]=g[y+3],p[0]}function h(g,y){return d[3]=g[y],d[2]=g[y+1],d[1]=g[y+2],d[0]=g[y+3],p[0]}var p=new Float32Array([-0]),d=new Uint8Array(p.buffer),v=d[3]===128;a.writeFloatLE=v?l:c,a.writeFloatBE=v?c:l,a.readFloatLE=v?f:h,a.readFloatBE=v?h:f}():function(){function l(f,h,p,d){var v=h<0?1:0;if(v&&(h=-h),h===0)f(1/h>0?0:2147483648,p,d);else if(isNaN(h))f(2143289344,p,d);else if(h>34028234663852886e22)f((v<<31|2139095040)>>>0,p,d);else if(h<11754943508222875e-54)f((v<<31|Math.round(h/1401298464324817e-60))>>>0,p,d);else{var g=Math.floor(Math.log(h)/Math.LN2);f((v<<31|g+127<<23|8388607&Math.round(h*Math.pow(2,-g)*8388608))>>>0,p,d)}}function c(f,h,p){var d=f(h,p),v=2*(d>>31)+1,g=d>>>23&255,y=8388607&d;return g===255?y?NaN:v*(1/0):g===0?1401298464324817e-60*v*y:v*Math.pow(2,g-150)*(y+8388608)}a.writeFloatLE=l.bind(null,e),a.writeFloatBE=l.bind(null,i),a.readFloatLE=c.bind(null,n),a.readFloatBE=c.bind(null,s)}(),typeof Float64Array<"u"?function(){function l(g,y,m){p[0]=g,y[m]=d[0],y[m+1]=d[1],y[m+2]=d[2],y[m+3]=d[3],y[m+4]=d[4],y[m+5]=d[5],y[m+6]=d[6],y[m+7]=d[7]}function c(g,y,m){p[0]=g,y[m]=d[7],y[m+1]=d[6],y[m+2]=d[5],y[m+3]=d[4],y[m+4]=d[3],y[m+5]=d[2],y[m+6]=d[1],y[m+7]=d[0]}function f(g,y){return d[0]=g[y],d[1]=g[y+1],d[2]=g[y+2],d[3]=g[y+3],d[4]=g[y+4],d[5]=g[y+5],d[6]=g[y+6],d[7]=g[y+7],p[0]}function h(g,y){return d[7]=g[y],d[6]=g[y+1],d[5]=g[y+2],d[4]=g[y+3],d[3]=g[y+4],d[2]=g[y+5],d[1]=g[y+6],d[0]=g[y+7],p[0]}var p=new Float64Array([-0]),d=new Uint8Array(p.buffer),v=d[7]===128;a.writeDoubleLE=v?l:c,a.writeDoubleBE=v?c:l,a.readDoubleLE=v?f:h,a.readDoubleBE=v?h:f}():function(){function l(f,h,p,d,v,g){var y=d<0?1:0;if(y&&(d=-d),d===0)f(0,v,g+h),f(1/d>0?0:2147483648,v,g+p);else if(isNaN(d))f(0,v,g+h),f(2146959360,v,g+p);else if(d>17976931348623157e292)f(0,v,g+h),f((y<<31|2146435072)>>>0,v,g+p);else{var m;if(d<22250738585072014e-324)f((m=d/5e-324)>>>0,v,g+h),f((y<<31|m/4294967296)>>>0,v,g+p);else{var S=Math.floor(Math.log(d)/Math.LN2);S===1024&&(S=1023),f(4503599627370496*(m=d*Math.pow(2,-S))>>>0,v,g+h),f((y<<31|S+1023<<20|1048576*m&1048575)>>>0,v,g+p)}}}function c(f,h,p,d,v){var g=f(d,v+h),y=f(d,v+p),m=2*(y>>31)+1,S=y>>>20&2047,_=4294967296*(1048575&y)+g;return S===2047?_?NaN:m*(1/0):S===0?5e-324*m*_:m*Math.pow(2,S-1075)*(_+4503599627370496)}a.writeDoubleLE=l.bind(null,e,0,4),a.writeDoubleBE=l.bind(null,i,4,0),a.readDoubleLE=c.bind(null,n,0,4),a.readDoubleBE=c.bind(null,s,4,0)}(),a}function e(a,l,c){l[c]=255&a,l[c+1]=a>>>8&255,l[c+2]=a>>>16&255,l[c+3]=a>>>24}function i(a,l,c){l[c]=a>>>24,l[c+1]=a>>>16&255,l[c+2]=a>>>8&255,l[c+3]=255&a}function n(a,l){return(a[l]|a[l+1]<<8|a[l+2]<<16|a[l+3]<<24)>>>0}function s(a,l){return(a[l]<<24|a[l+1]<<16|a[l+2]<<8|a[l+3])>>>0}o.exports=t(t)},function(o,u,r){var t=u;t.length=function(e){for(var i=0,n=0,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?i+=1:n<2048?i+=2:(64512&n)==55296&&(64512&e.charCodeAt(s+1))==56320?(++s,i+=4):i+=3;return i},t.read=function(e,i,n){if(n-i<1)return"";for(var s,a=null,l=[],c=0;i<n;)(s=e[i++])<128?l[c++]=s:s>191&&s<224?l[c++]=(31&s)<<6|63&e[i++]:s>239&&s<365?(s=((7&s)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++])-65536,l[c++]=55296+(s>>10),l[c++]=56320+(1023&s)):l[c++]=(15&s)<<12|(63&e[i++])<<6|63&e[i++],c>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,l)),c=0);return a?(c&&a.push(String.fromCharCode.apply(String,l.slice(0,c))),a.join("")):String.fromCharCode.apply(String,l.slice(0,c))},t.write=function(e,i,n){for(var s,a,l=n,c=0;c<e.length;++c)(s=e.charCodeAt(c))<128?i[n++]=s:s<2048?(i[n++]=s>>6|192,i[n++]=63&s|128):(64512&s)==55296&&(64512&(a=e.charCodeAt(c+1)))==56320?(s=65536+((1023&s)<<10)+(1023&a),++c,i[n++]=s>>18|240,i[n++]=s>>12&63|128,i[n++]=s>>6&63|128,i[n++]=63&s|128):(i[n++]=s>>12|224,i[n++]=s>>6&63|128,i[n++]=63&s|128);return n-l}},function(o,u,r){o.exports=function(t,e,i){var n=i||8192,s=n>>>1,a=null,l=n;return function(c){if(c<1||c>s)return t(c);l+c>n&&(a=t(n),l=0);var f=e.call(a,l,l+=c);return 7&l&&(l=1+(7|l)),f}}},function(o,u,r){function t(a,l){this.lo=a>>>0,this.hi=l>>>0}o.exports=t;var e=r(1),i=t.zero=new t(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var n=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(a){if(a===0)return i;var l=a<0;l&&(a=-a);var c=a>>>0,f=(a-c)/4294967296>>>0;return l&&(f=~f>>>0,c=~c>>>0,++c>4294967295&&(c=0,++f>4294967295&&(f=0))),new t(c,f)},t.from=function(a){if(typeof a=="number")return t.fromNumber(a);if(e.isString(a)){if(!e.Long)return t.fromNumber(parseInt(a,10));a=e.Long.fromString(a)}return a.low||a.high?new t(a.low>>>0,a.high>>>0):i},t.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var l=1+~this.lo>>>0,c=~this.hi>>>0;return l||(c=c+1>>>0),-(l+4294967296*c)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(a){return e.Long?new e.Long(0|this.lo,0|this.hi,!!a):{low:0|this.lo,high:0|this.hi,unsigned:!!a}};var s=String.prototype.charCodeAt;t.fromHash=function(a){return a===n?i:new t((s.call(a,0)|s.call(a,1)<<8|s.call(a,2)<<16|s.call(a,3)<<24)>>>0,(s.call(a,4)|s.call(a,5)<<8|s.call(a,6)<<16|s.call(a,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},t.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},t.prototype.length=function(){var a=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return c===0?l===0?a<16384?a<128?1:2:a<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:c<128?9:10}},function(o,u,r){function t(){i.call(this)}function e(s,a,l){s.length<40?n.utf8.write(s,a,l):a.utf8Write?a.utf8Write(s,l):a.write(s,l)}o.exports=t;var i=r(9);(t.prototype=Object.create(i.prototype)).constructor=t;var n=r(1);t._configure=function(){t.alloc=n._Buffer_allocUnsafe,t.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&n.Buffer.prototype.set.name==="set"?function(s,a,l){a.set(s,l)}:function(s,a,l){if(s.copy)s.copy(a,l,0,s.length);else for(var c=0;c<s.length;)a[l++]=s[c++]}},t.prototype.bytes=function(s){n.isString(s)&&(s=n._Buffer_from(s,"base64"));var a=s.length>>>0;return this.uint32(a),a&&this._push(t.writeBytesBuffer,a,s),this},t.prototype.string=function(s){var a=n.Buffer.byteLength(s);return this.uint32(a),a&&this._push(e,a,s),this},t._configure()},function(o,u,r){function t(n){e.call(this,n)}o.exports=t;var e=r(10);(t.prototype=Object.create(e.prototype)).constructor=t;var i=r(1);t._configure=function(){i.Buffer&&(t.prototype._slice=i.Buffer.prototype.slice)},t.prototype.string=function(){var n=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+n,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+n,this.len))},t._configure()},function(o,u,r){function t(i,n,s){if(typeof i!="function")throw TypeError("rpcImpl must be a function");e.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=!!n,this.responseDelimited=!!s}o.exports=t;var e=r(1);(t.prototype=Object.create(e.EventEmitter.prototype)).constructor=t,t.prototype.rpcCall=function i(n,s,a,l,c){if(!l)throw TypeError("request must be specified");var f=this;if(!c)return e.asPromise(i,f,n,s,a,l);if(f.rpcImpl)try{return f.rpcImpl(n,s[f.requestDelimited?"encodeDelimited":"encode"](l).finish(),function(h,p){if(h)return f.emit("error",h,n),c(h);if(p!==null){if(!(p instanceof a))try{p=a[f.responseDelimited?"decodeDelimited":"decode"](p)}catch(d){return f.emit("error",d,n),c(d)}return f.emit("data",p,n),c(null,p)}f.end(!0)})}catch(h){return f.emit("error",h,n),void setTimeout(function(){c(h)},0)}else setTimeout(function(){c(Error("already ended"))},0)},t.prototype.end=function(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(o,u,r){function t(e,i){function n(l){if(typeof l!="string"){var c=s();if(t.verbose&&console.log("codegen: "+c),c="return "+c,l){for(var f=Object.keys(l),h=new Array(f.length+1),p=new Array(f.length),d=0;d<f.length;)h[d]=f[d],p[d]=l[f[d++]];return h[d]=c,Function.apply(null,h).apply(null,p)}return Function(c)()}for(var v=new Array(arguments.length-1),g=0;g<v.length;)v[g]=arguments[++g];if(g=0,l=l.replace(/%([%dfijs])/g,function(y,m){var S=v[g++];switch(m){case"d":case"f":return String(Number(S));case"i":return String(Math.floor(S));case"j":return JSON.stringify(S);case"s":return String(S)}return"%"}),g!==v.length)throw Error("parameter count mismatch");return a.push(l),n}function s(l){return"function "+(l||i||"")+"("+(e&&e.join(",")||"")+`){
  `+a.join(`
  `)+`
}`}typeof e=="string"&&(i=e,e=void 0);var a=[];return n.toString=s,n}o.exports=t,t.verbose=!1},function(o,u,r){function t(n,s,a){return typeof s=="function"?(a=s,s={}):s||(s={}),a?!s.xhr&&i&&i.readFile?i.readFile(n,function(l,c){return l&&typeof XMLHttpRequest<"u"?t.xhr(n,s,a):l?a(l):a(null,s.binary?c:c.toString("utf8"))}):t.xhr(n,s,a):e(t,this,n,s)}o.exports=t;var e=r(17),i=r(18)("fs");t.xhr=function(n,s,a){var l=new XMLHttpRequest;l.onreadystatechange=function(){if(l.readyState===4){if(l.status!==0&&l.status!==200)return a(Error("status "+l.status));if(s.binary){var c=l.response;if(!c){c=[];for(var f=0;f<l.responseText.length;++f)c.push(255&l.responseText.charCodeAt(f))}return a(null,typeof Uint8Array<"u"?new Uint8Array(c):c)}return a(null,l.responseText)}},s.binary&&("overrideMimeType"in l&&l.overrideMimeType("text/plain; charset=x-user-defined"),l.responseType="arraybuffer"),l.open("GET",n),l.send()}},function(o,u,r){var t=u,e=t.isAbsolute=function(n){return/^(?:\/|\w+:)/.test(n)},i=t.normalize=function(n){var s=(n=n.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),a=e(n),l="";a&&(l=s.shift()+"/");for(var c=0;c<s.length;)s[c]===".."?c>0&&s[c-1]!==".."?s.splice(--c,2):a?s.splice(c,1):++c:s[c]==="."?s.splice(c,1):++c;return l+s.join("/")};t.resolve=function(n,s,a){return a||(s=i(s)),e(s)?s:(a||(n=i(n)),(n=n.replace(/(?:\/|^)[^/]+$/,"")).length?i(n+"/"+s):s)}},function(o,u,r){var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},e=r(16).ProtoMovieEntity,i=r(8).assign,n=r(51),s={};i(s,n);var a=function(c){for(var f=[],h=0;h<c.length;h+=32768)f.push(String.fromCharCode.apply(null,c.subarray(h,h+32768)));return f.join("")},l={loadAssets:function(c,f,h){if((typeof JSZipUtils>"u"?"undefined":t(JSZipUtils))==="object"&&typeof JSZip=="function")if(c.toString()=="[object File]")l._readBlobAsArrayBuffer(c,function(v){var g=new Uint8Array(v,0,4);g[0]==80&&g[1]==75&&g[2]==3&&g[3]==4?JSZip.loadAsync(v).then(function(y){l._decodeAssets(y,f)}):l.load_viaProto(v,f,h)});else if(c.indexOf("data:svga/1.0;base64,")>=0){var p=l._base64ToArrayBuffer(c.substring(21));JSZip.loadAsync(p).then(function(v){l._decodeAssets(v,f)})}else c.indexOf("data:svga/2.0;base64,")>=0?(p=l._base64ToArrayBuffer(c.substring(21)),l.load_viaProto(p,f,h)):JSZipUtils.getBinaryContent(c,function(v,g){if(v)throw h&&h(v),console.error(v),v;var y=new Uint8Array(g,0,4);y[0]==80&&y[1]==75&&y[2]==3&&y[3]==4?JSZip.loadAsync(g).then(function(m){l._decodeAssets(m,f)}):l.load_viaProto(g,f,h)});else{var d=new XMLHttpRequest;d.open("GET",c,!0),d.responseType="arraybuffer",d.onload=function(){l.load_viaProto(d.response,f,h)},d.onerror=function(v){if(!h)throw console.error(v),v;h(v)},d.send()}},load_viaProto:function(c,f,h){try{var p=s.inflate(c),d=e.decode(p),v={};l._loadImages(v,void 0,d,function(){d.ver="2.0",f({movie:d,images:v})})}catch(g){if(h)return void h(g);throw console.error(g),g}},_decodeAssets:function(c,f){var h="1.0";c.file("movie.binary")&&(h="1.5"),c.file("movie.spec").async("string").then(function(p){var d=JSON.parse(p),v={};d.ver=h,l._loadImages(v,c,d,function(){f({movie:d,images:v})})})},_loadImages:function(c,f,h,p){var d=this;if((h===void 0?"undefined":t(h))==="object"&&h.$type==e){var v=!0;if(f)e:for(var g in h.images)switch(function(k){if(h.images.hasOwnProperty(k)){var w=h.images[k],I=a(w);return c.hasOwnProperty(k)?"continue":(v=!1,f.file(I+".png").async("base64").then((function(N){c[k]=N,l._loadImages(c,f,h,p)}).bind(d)),"break")}}(g)){case"continue":continue;case"break":break e}else for(var y in h.images)if(h.images.hasOwnProperty(y)){var m=h.images[y],S=void 0;try{S=a(m)}catch{S=a(m)}c[y]=btoa(S)}v&&p.call(this)}else{v=!0;for(var _ in h.images)if(h.images.hasOwnProperty(_)){var A=h.images[_];if(c.hasOwnProperty(_))continue;v=!1,f.file(A+".png").async("base64").then((function(k){c[_]=k,l._loadImages(c,f,h,p)}).bind(this));break}v&&p.call(this)}},_base64ToArrayBuffer:function(c){for(var f=window.atob(c),h=f.length,p=new Uint8Array(h),d=0;d<h;d++)p[d]=f.charCodeAt(d);return p.buffer},_readBlobAsArrayBuffer:function(c,f){var h=new FileReader;h.onload=function(p){f(p.target.result)},h.readAsArrayBuffer(c)}};o.exports=function(c,f,h){l.loadAssets(c,f,h)}},function(o,u,r){function t(p){if(!(this instanceof t))return new t(p);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},p||{});var d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,d.windowBits===0&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||p&&p.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&!(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=i.inflateInit2(this.strm,d.windowBits);if(v!==a.Z_OK)throw new Error(l[v]);if(this.header=new f,i.inflateGetHeader(this.strm,this.header),d.dictionary&&(typeof d.dictionary=="string"?d.dictionary=s.string2buf(d.dictionary):h.call(d.dictionary)==="[object ArrayBuffer]"&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(v=i.inflateSetDictionary(this.strm,d.dictionary))!==a.Z_OK))throw new Error(l[v])}function e(p,d){var v=new t(d);if(v.push(p,!0),v.err)throw v.msg||l[v.err];return v.result}var i=r(52),n=r(8),s=r(57),a=r(58),l=r(59),c=r(60),f=r(61),h=Object.prototype.toString;t.prototype.push=function(p,d){var v,g,y,m,S,_=this.strm,A=this.options.chunkSize,k=this.options.dictionary,w=!1;if(this.ended)return!1;g=d===~~d?d:d===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof p=="string"?_.input=s.binstring2buf(p):h.call(p)==="[object ArrayBuffer]"?_.input=new Uint8Array(p):_.input=p,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new n.Buf8(A),_.next_out=0,_.avail_out=A),(v=i.inflate(_,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&k&&(v=i.inflateSetDictionary(this.strm,k)),v===a.Z_BUF_ERROR&&w===!0&&(v=a.Z_OK,w=!1),v!==a.Z_STREAM_END&&v!==a.Z_OK)return this.onEnd(v),this.ended=!0,!1;_.next_out&&(_.avail_out!==0&&v!==a.Z_STREAM_END&&(_.avail_in!==0||g!==a.Z_FINISH&&g!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=s.utf8border(_.output,_.next_out),m=_.next_out-y,S=s.buf2string(_.output,y),_.next_out=m,_.avail_out=A-m,m&&n.arraySet(_.output,_.output,y,m,0),this.onData(S)):this.onData(n.shrinkBuf(_.output,_.next_out)))),_.avail_in===0&&_.avail_out===0&&(w=!0)}while((_.avail_in>0||_.avail_out===0)&&v!==a.Z_STREAM_END);return v===a.Z_STREAM_END&&(g=a.Z_FINISH),g===a.Z_FINISH?(v=i.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===a.Z_OK):g!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),_.avail_out=0,!0)},t.prototype.onData=function(p){this.chunks.push(p)},t.prototype.onEnd=function(p){p===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},u.Inflate=t,u.inflate=e,u.inflateRaw=function(p,d){return(d=d||{}).raw=!0,e(p,d)},u.ungzip=e},function(o,u,r){function t(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new p.Buf16(320),this.work=new p.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function i(O){var U;return O&&O.state?(U=O.state,O.total_in=O.total_out=U.total=0,O.msg="",U.wrap&&(O.adler=1&U.wrap),U.mode=P,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new p.Buf32(Ue),U.distcode=U.distdyn=new p.Buf32(Ve),U.sane=1,U.back=-1,I):M}function n(O){var U;return O&&O.state?((U=O.state).wsize=0,U.whave=0,U.wnext=0,i(O)):M}function s(O,U){var E,z;return O&&O.state?(z=O.state,U<0?(E=0,U=-U):(E=1+(U>>4),U<48&&(U&=15)),U&&(U<8||U>15)?M:(z.window!==null&&z.wbits!==U&&(z.window=null),z.wrap=E,z.wbits=U,n(O))):M}function a(O,U){var E,z;return O?(z=new e,O.state=z,z.window=null,(E=s(O,U))!==I&&(O.state=null),E):M}function l(O){if($e){var U;for(f=new p.Buf32(512),h=new p.Buf32(32),U=0;U<144;)O.lens[U++]=8;for(;U<256;)O.lens[U++]=9;for(;U<280;)O.lens[U++]=7;for(;U<288;)O.lens[U++]=8;for(y(S,O.lens,0,288,f,0,O.work,{bits:9}),U=0;U<32;)O.lens[U++]=5;y(_,O.lens,0,32,h,0,O.work,{bits:5}),$e=!1}O.lencode=f,O.lenbits=9,O.distcode=h,O.distbits=5}function c(O,U,E,z){var ae,V=O.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new p.Buf8(V.wsize)),z>=V.wsize?(p.arraySet(V.window,U,E-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):((ae=V.wsize-V.wnext)>z&&(ae=z),p.arraySet(V.window,U,E-z,ae,V.wnext),(z-=ae)?(p.arraySet(V.window,U,E-z,z,0),V.wnext=z,V.whave=V.wsize):(V.wnext+=ae,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=ae))),0}var f,h,p=r(8),d=r(53),v=r(54),g=r(55),y=r(56),m=0,S=1,_=2,A=4,k=5,w=6,I=0,N=1,x=2,M=-2,b=-3,T=-4,C=-5,D=8,P=1,B=2,$=3,F=4,K=5,Y=6,G=7,H=8,Q=9,J=10,ne=11,ie=12,se=13,X=14,ce=15,he=16,ye=17,Ee=18,Te=19,_e=20,Se=21,Oe=22,xe=23,De=24,Re=25,Le=26,ke=27,Ne=28,Me=29,q=30,Pe=31,Fe=32,Ue=852,Ve=592,Ge=15,$e=!0;u.inflateReset=n,u.inflateReset2=s,u.inflateResetKeep=i,u.inflateInit=function(O){return a(O,Ge)},u.inflateInit2=a,u.inflate=function(O,U){var E,z,ae,V,pe,j,re,L,R,be,ee,W,Ae,Ie,Z,ue,de,fe,Ce,we,te,ve,me,ge,le=0,oe=new p.Buf8(4),Be=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return M;(E=O.state).mode===ie&&(E.mode=se),pe=O.next_out,ae=O.output,re=O.avail_out,V=O.next_in,z=O.input,j=O.avail_in,L=E.hold,R=E.bits,be=j,ee=re,ve=I;e:for(;;)switch(E.mode){case P:if(E.wrap===0){E.mode=se;break}for(;R<16;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(2&E.wrap&&L===35615){E.check=0,oe[0]=255&L,oe[1]=L>>>8&255,E.check=v(E.check,oe,2,0),L=0,R=0,E.mode=B;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&L)<<8)+(L>>8))%31){O.msg="incorrect header check",E.mode=q;break}if((15&L)!==D){O.msg="unknown compression method",E.mode=q;break}if(R-=4,te=8+(15&(L>>>=4)),E.wbits===0)E.wbits=te;else if(te>E.wbits){O.msg="invalid window size",E.mode=q;break}E.dmax=1<<te,O.adler=E.check=1,E.mode=512&L?J:ie,L=0,R=0;break;case B:for(;R<16;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(E.flags=L,(255&E.flags)!==D){O.msg="unknown compression method",E.mode=q;break}if(57344&E.flags){O.msg="unknown header flags set",E.mode=q;break}E.head&&(E.head.text=L>>8&1),512&E.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,E.check=v(E.check,oe,2,0)),L=0,R=0,E.mode=$;case $:for(;R<32;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}E.head&&(E.head.time=L),512&E.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,oe[2]=L>>>16&255,oe[3]=L>>>24&255,E.check=v(E.check,oe,4,0)),L=0,R=0,E.mode=F;case F:for(;R<16;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}E.head&&(E.head.xflags=255&L,E.head.os=L>>8),512&E.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,E.check=v(E.check,oe,2,0)),L=0,R=0,E.mode=K;case K:if(1024&E.flags){for(;R<16;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}E.length=L,E.head&&(E.head.extra_len=L),512&E.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,E.check=v(E.check,oe,2,0)),L=0,R=0}else E.head&&(E.head.extra=null);E.mode=Y;case Y:if(1024&E.flags&&((W=E.length)>j&&(W=j),W&&(E.head&&(te=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),p.arraySet(E.head.extra,z,V,W,te)),512&E.flags&&(E.check=v(E.check,z,W,V)),j-=W,V+=W,E.length-=W),E.length))break e;E.length=0,E.mode=G;case G:if(2048&E.flags){if(j===0)break e;W=0;do te=z[V+W++],E.head&&te&&E.length<65536&&(E.head.name+=String.fromCharCode(te));while(te&&W<j);if(512&E.flags&&(E.check=v(E.check,z,W,V)),j-=W,V+=W,te)break e}else E.head&&(E.head.name=null);E.length=0,E.mode=H;case H:if(4096&E.flags){if(j===0)break e;W=0;do te=z[V+W++],E.head&&te&&E.length<65536&&(E.head.comment+=String.fromCharCode(te));while(te&&W<j);if(512&E.flags&&(E.check=v(E.check,z,W,V)),j-=W,V+=W,te)break e}else E.head&&(E.head.comment=null);E.mode=Q;case Q:if(512&E.flags){for(;R<16;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(L!==(65535&E.check)){O.msg="header crc mismatch",E.mode=q;break}L=0,R=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),O.adler=E.check=0,E.mode=ie;break;case J:for(;R<32;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}O.adler=E.check=t(L),L=0,R=0,E.mode=ne;case ne:if(E.havedict===0)return O.next_out=pe,O.avail_out=re,O.next_in=V,O.avail_in=j,E.hold=L,E.bits=R,x;O.adler=E.check=1,E.mode=ie;case ie:if(U===k||U===w)break e;case se:if(E.last){L>>>=7&R,R-=7&R,E.mode=ke;break}for(;R<3;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}switch(E.last=1&L,R-=1,3&(L>>>=1)){case 0:E.mode=X;break;case 1:if(l(E),E.mode=_e,U===w){L>>>=2,R-=2;break e}break;case 2:E.mode=ye;break;case 3:O.msg="invalid block type",E.mode=q}L>>>=2,R-=2;break;case X:for(L>>>=7&R,R-=7&R;R<32;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if((65535&L)!=(L>>>16^65535)){O.msg="invalid stored block lengths",E.mode=q;break}if(E.length=65535&L,L=0,R=0,E.mode=ce,U===w)break e;case ce:E.mode=he;case he:if(W=E.length){if(W>j&&(W=j),W>re&&(W=re),W===0)break e;p.arraySet(ae,z,V,W,pe),j-=W,V+=W,re-=W,pe+=W,E.length-=W;break}E.mode=ie;break;case ye:for(;R<14;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(E.nlen=257+(31&L),L>>>=5,R-=5,E.ndist=1+(31&L),L>>>=5,R-=5,E.ncode=4+(15&L),L>>>=4,R-=4,E.nlen>286||E.ndist>30){O.msg="too many length or distance symbols",E.mode=q;break}E.have=0,E.mode=Ee;case Ee:for(;E.have<E.ncode;){for(;R<3;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}E.lens[Be[E.have++]]=7&L,L>>>=3,R-=3}for(;E.have<19;)E.lens[Be[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,me={bits:E.lenbits},ve=y(m,E.lens,0,19,E.lencode,0,E.work,me),E.lenbits=me.bits,ve){O.msg="invalid code lengths set",E.mode=q;break}E.have=0,E.mode=Te;case Te:for(;E.have<E.nlen+E.ndist;){for(;ue=(le=E.lencode[L&(1<<E.lenbits)-1])>>>16&255,de=65535&le,!((Z=le>>>24)<=R);){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(de<16)L>>>=Z,R-=Z,E.lens[E.have++]=de;else{if(de===16){for(ge=Z+2;R<ge;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(L>>>=Z,R-=Z,E.have===0){O.msg="invalid bit length repeat",E.mode=q;break}te=E.lens[E.have-1],W=3+(3&L),L>>>=2,R-=2}else if(de===17){for(ge=Z+3;R<ge;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}R-=Z,te=0,W=3+(7&(L>>>=Z)),L>>>=3,R-=3}else{for(ge=Z+7;R<ge;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}R-=Z,te=0,W=11+(127&(L>>>=Z)),L>>>=7,R-=7}if(E.have+W>E.nlen+E.ndist){O.msg="invalid bit length repeat",E.mode=q;break}for(;W--;)E.lens[E.have++]=te}}if(E.mode===q)break;if(E.lens[256]===0){O.msg="invalid code -- missing end-of-block",E.mode=q;break}if(E.lenbits=9,me={bits:E.lenbits},ve=y(S,E.lens,0,E.nlen,E.lencode,0,E.work,me),E.lenbits=me.bits,ve){O.msg="invalid literal/lengths set",E.mode=q;break}if(E.distbits=6,E.distcode=E.distdyn,me={bits:E.distbits},ve=y(_,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,me),E.distbits=me.bits,ve){O.msg="invalid distances set",E.mode=q;break}if(E.mode=_e,U===w)break e;case _e:E.mode=Se;case Se:if(j>=6&&re>=258){O.next_out=pe,O.avail_out=re,O.next_in=V,O.avail_in=j,E.hold=L,E.bits=R,g(O,ee),pe=O.next_out,ae=O.output,re=O.avail_out,V=O.next_in,z=O.input,j=O.avail_in,L=E.hold,R=E.bits,E.mode===ie&&(E.back=-1);break}for(E.back=0;ue=(le=E.lencode[L&(1<<E.lenbits)-1])>>>16&255,de=65535&le,!((Z=le>>>24)<=R);){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(ue&&!(240&ue)){for(fe=Z,Ce=ue,we=de;ue=(le=E.lencode[we+((L&(1<<fe+Ce)-1)>>fe)])>>>16&255,de=65535&le,!(fe+(Z=le>>>24)<=R);){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}L>>>=fe,R-=fe,E.back+=fe}if(L>>>=Z,R-=Z,E.back+=Z,E.length=de,ue===0){E.mode=Le;break}if(32&ue){E.back=-1,E.mode=ie;break}if(64&ue){O.msg="invalid literal/length code",E.mode=q;break}E.extra=15&ue,E.mode=Oe;case Oe:if(E.extra){for(ge=E.extra;R<ge;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}E.length+=L&(1<<E.extra)-1,L>>>=E.extra,R-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=xe;case xe:for(;ue=(le=E.distcode[L&(1<<E.distbits)-1])>>>16&255,de=65535&le,!((Z=le>>>24)<=R);){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(!(240&ue)){for(fe=Z,Ce=ue,we=de;ue=(le=E.distcode[we+((L&(1<<fe+Ce)-1)>>fe)])>>>16&255,de=65535&le,!(fe+(Z=le>>>24)<=R);){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}L>>>=fe,R-=fe,E.back+=fe}if(L>>>=Z,R-=Z,E.back+=Z,64&ue){O.msg="invalid distance code",E.mode=q;break}E.offset=de,E.extra=15&ue,E.mode=De;case De:if(E.extra){for(ge=E.extra;R<ge;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}E.offset+=L&(1<<E.extra)-1,L>>>=E.extra,R-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){O.msg="invalid distance too far back",E.mode=q;break}E.mode=Re;case Re:if(re===0)break e;if(W=ee-re,E.offset>W){if((W=E.offset-W)>E.whave&&E.sane){O.msg="invalid distance too far back",E.mode=q;break}W>E.wnext?(W-=E.wnext,Ae=E.wsize-W):Ae=E.wnext-W,W>E.length&&(W=E.length),Ie=E.window}else Ie=ae,Ae=pe-E.offset,W=E.length;W>re&&(W=re),re-=W,E.length-=W;do ae[pe++]=Ie[Ae++];while(--W);E.length===0&&(E.mode=Se);break;case Le:if(re===0)break e;ae[pe++]=E.length,re--,E.mode=Se;break;case ke:if(E.wrap){for(;R<32;){if(j===0)break e;j--,L|=z[V++]<<R,R+=8}if(ee-=re,O.total_out+=ee,E.total+=ee,ee&&(O.adler=E.check=E.flags?v(E.check,ae,ee,pe-ee):d(E.check,ae,ee,pe-ee)),ee=re,(E.flags?L:t(L))!==E.check){O.msg="incorrect data check",E.mode=q;break}L=0,R=0}E.mode=Ne;case Ne:if(E.wrap&&E.flags){for(;R<32;){if(j===0)break e;j--,L+=z[V++]<<R,R+=8}if(L!==(4294967295&E.total)){O.msg="incorrect length check",E.mode=q;break}L=0,R=0}E.mode=Me;case Me:ve=N;break e;case q:ve=b;break e;case Pe:return T;case Fe:default:return M}return O.next_out=pe,O.avail_out=re,O.next_in=V,O.avail_in=j,E.hold=L,E.bits=R,(E.wsize||ee!==O.avail_out&&E.mode<q&&(E.mode<ke||U!==A))&&c(O,O.output,O.next_out,ee-O.avail_out)?(E.mode=Pe,T):(be-=O.avail_in,ee-=O.avail_out,O.total_in+=be,O.total_out+=ee,E.total+=ee,E.wrap&&ee&&(O.adler=E.check=E.flags?v(E.check,ae,ee,O.next_out-ee):d(E.check,ae,ee,O.next_out-ee)),O.data_type=E.bits+(E.last?64:0)+(E.mode===ie?128:0)+(E.mode===_e||E.mode===ce?256:0),(be===0&&ee===0||U===A)&&ve===I&&(ve=C),ve)},u.inflateEnd=function(O){if(!O||!O.state)return M;var U=O.state;return U.window&&(U.window=null),O.state=null,I},u.inflateGetHeader=function(O,U){var E;return O&&O.state&&2&(E=O.state).wrap?(E.head=U,U.done=!1,I):M},u.inflateSetDictionary=function(O,U){var E,z=U.length;return O&&O.state?(E=O.state).wrap!==0&&E.mode!==ne?M:E.mode===ne&&d(1,U,z,0)!==E.check?b:c(O,U,z,z)?(E.mode=Pe,T):(E.havedict=1,I):M},u.inflateInfo="pako inflate (from Nodeca project)"},function(o,u,r){o.exports=function(t,e,i,n){for(var s=65535&t|0,a=t>>>16&65535|0,l=0;i!==0;){i-=l=i>2e3?2e3:i;do a=a+(s=s+e[n++]|0)|0;while(--l);s%=65521,a%=65521}return s|a<<16|0}},function(o,u,r){var t=function(){for(var e,i=[],n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;i[n]=e}return i}();o.exports=function(e,i,n,s){var a=t,l=s+n;e^=-1;for(var c=s;c<l;c++)e=e>>>8^a[255&(e^i[c])];return-1^e}},function(o,u,r){o.exports=function(t,e){var i,n,s,a,l,c,f,h,p,d,v,g,y,m,S,_,A,k,w,I,N,x,M,b,T;i=t.state,n=t.next_in,b=t.input,s=n+(t.avail_in-5),a=t.next_out,T=t.output,l=a-(e-t.avail_out),c=a+(t.avail_out-257),f=i.dmax,h=i.wsize,p=i.whave,d=i.wnext,v=i.window,g=i.hold,y=i.bits,m=i.lencode,S=i.distcode,_=(1<<i.lenbits)-1,A=(1<<i.distbits)-1;e:do{y<15&&(g+=b[n++]<<y,y+=8,g+=b[n++]<<y,y+=8),k=m[g&_];t:for(;;){if(g>>>=w=k>>>24,y-=w,(w=k>>>16&255)==0)T[a++]=65535&k;else{if(!(16&w)){if(!(64&w)){k=m[(65535&k)+(g&(1<<w)-1)];continue t}if(32&w){i.mode=12;break e}t.msg="invalid literal/length code",i.mode=30;break e}I=65535&k,(w&=15)&&(y<w&&(g+=b[n++]<<y,y+=8),I+=g&(1<<w)-1,g>>>=w,y-=w),y<15&&(g+=b[n++]<<y,y+=8,g+=b[n++]<<y,y+=8),k=S[g&A];i:for(;;){if(g>>>=w=k>>>24,y-=w,!(16&(w=k>>>16&255))){if(!(64&w)){k=S[(65535&k)+(g&(1<<w)-1)];continue i}t.msg="invalid distance code",i.mode=30;break e}if(N=65535&k,y<(w&=15)&&(g+=b[n++]<<y,(y+=8)<w&&(g+=b[n++]<<y,y+=8)),(N+=g&(1<<w)-1)>f){t.msg="invalid distance too far back",i.mode=30;break e}if(g>>>=w,y-=w,N>(w=a-l)){if((w=N-w)>p&&i.sane){t.msg="invalid distance too far back",i.mode=30;break e}if(x=0,M=v,d===0){if(x+=h-w,w<I){I-=w;do T[a++]=v[x++];while(--w);x=a-N,M=T}}else if(d<w){if(x+=h+d-w,(w-=d)<I){I-=w;do T[a++]=v[x++];while(--w);if(x=0,d<I){I-=w=d;do T[a++]=v[x++];while(--w);x=a-N,M=T}}}else if(x+=d-w,w<I){I-=w;do T[a++]=v[x++];while(--w);x=a-N,M=T}for(;I>2;)T[a++]=M[x++],T[a++]=M[x++],T[a++]=M[x++],I-=3;I&&(T[a++]=M[x++],I>1&&(T[a++]=M[x++]))}else{x=a-N;do T[a++]=T[x++],T[a++]=T[x++],T[a++]=T[x++],I-=3;while(I>2);I&&(T[a++]=T[x++],I>1&&(T[a++]=T[x++]))}break}}break}}while(n<s&&a<c);n-=I=y>>3,g&=(1<<(y-=I<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<s?s-n+5:5-(n-s),t.avail_out=a<c?c-a+257:257-(a-c),i.hold=g,i.bits=y}},function(o,u,r){var t=r(8),e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(a,l,c,f,h,p,d,v){var g,y,m,S,_,A,k,w,I,N=v.bits,x=0,M=0,b=0,T=0,C=0,D=0,P=0,B=0,$=0,F=0,K=null,Y=0,G=new t.Buf16(16),H=new t.Buf16(16),Q=null,J=0;for(x=0;x<=15;x++)G[x]=0;for(M=0;M<f;M++)G[l[c+M]]++;for(C=N,T=15;T>=1&&G[T]===0;T--);if(C>T&&(C=T),T===0)return h[p++]=20971520,h[p++]=20971520,v.bits=1,0;for(b=1;b<T&&G[b]===0;b++);for(C<b&&(C=b),B=1,x=1;x<=15;x++)if(B<<=1,(B-=G[x])<0)return-1;if(B>0&&(a===0||T!==1))return-1;for(H[1]=0,x=1;x<15;x++)H[x+1]=H[x]+G[x];for(M=0;M<f;M++)l[c+M]!==0&&(d[H[l[c+M]]++]=M);if(a===0?(K=Q=d,A=19):a===1?(K=e,Y-=257,Q=i,J-=257,A=256):(K=n,Q=s,A=-1),F=0,M=0,x=b,_=p,D=C,P=0,m=-1,S=($=1<<C)-1,a===1&&$>852||a===2&&$>592)return 1;for(;;){k=x-P,d[M]<A?(w=0,I=d[M]):d[M]>A?(w=Q[J+d[M]],I=K[Y+d[M]]):(w=96,I=0),g=1<<x-P,b=y=1<<D;do h[_+(F>>P)+(y-=g)]=k<<24|w<<16|I|0;while(y!==0);for(g=1<<x-1;F&g;)g>>=1;if(g!==0?(F&=g-1,F+=g):F=0,M++,--G[x]==0){if(x===T)break;x=l[c+d[M]]}if(x>C&&(F&S)!==m){for(P===0&&(P=C),_+=b,B=1<<(D=x-P);D+P<T&&!((B-=G[D+P])<=0);)D++,B<<=1;if($+=1<<D,a===1&&$>852||a===2&&$>592)return 1;h[m=F&S]=C<<24|D<<16|_-p|0}}return F!==0&&(h[_+F]=x-P<<24|64<<16|0),v.bits=C,0}},function(o,u,r){function t(l,c){if(c<65534&&(l.subarray&&n||!l.subarray&&i))return String.fromCharCode.apply(null,e.shrinkBuf(l,c));for(var f="",h=0;h<c;h++)f+=String.fromCharCode(l[h]);return f}var e=r(8),i=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var s=new e.Buf8(256),a=0;a<256;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;s[254]=s[254]=1,u.string2buf=function(l){var c,f,h,p,d,v=l.length,g=0;for(p=0;p<v;p++)(64512&(f=l.charCodeAt(p)))==55296&&p+1<v&&(64512&(h=l.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(h-56320),p++),g+=f<128?1:f<2048?2:f<65536?3:4;for(c=new e.Buf8(g),d=0,p=0;d<g;p++)(64512&(f=l.charCodeAt(p)))==55296&&p+1<v&&(64512&(h=l.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(h-56320),p++),f<128?c[d++]=f:f<2048?(c[d++]=192|f>>>6,c[d++]=128|63&f):f<65536?(c[d++]=224|f>>>12,c[d++]=128|f>>>6&63,c[d++]=128|63&f):(c[d++]=240|f>>>18,c[d++]=128|f>>>12&63,c[d++]=128|f>>>6&63,c[d++]=128|63&f);return c},u.buf2binstring=function(l){return t(l,l.length)},u.binstring2buf=function(l){for(var c=new e.Buf8(l.length),f=0,h=c.length;f<h;f++)c[f]=l.charCodeAt(f);return c},u.buf2string=function(l,c){var f,h,p,d,v=c||l.length,g=new Array(2*v);for(h=0,f=0;f<v;)if((p=l[f++])<128)g[h++]=p;else if((d=s[p])>4)g[h++]=65533,f+=d-1;else{for(p&=d===2?31:d===3?15:7;d>1&&f<v;)p=p<<6|63&l[f++],d--;d>1?g[h++]=65533:p<65536?g[h++]=p:(p-=65536,g[h++]=55296|p>>10&1023,g[h++]=56320|1023&p)}return t(g,h)},u.utf8border=function(l,c){var f;for((c=c||l.length)>l.length&&(c=l.length),f=c-1;f>=0&&(192&l[f])==128;)f--;return f<0||f===0?c:f+s[l[f]]>c?f:c}},function(o,u,r){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(o,u,r){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(o,u,r){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(o,u,r){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(o,u,r){o.exports=function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(n,s,a){e.o(n,s)||Object.defineProperty(n,s,{configurable:!1,enumerable:!0,get:a})},e.n=function(n){var s=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(s,"a",s),s},e.o=function(n,s){return Object.prototype.hasOwnProperty.call(n,s)},e.p="",e(e.s=0)}([function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(1);t.exports=n.ValueAnimator},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function s(){this.startValue=0,this.endValue=0,this.duration=0,this.loops=1,this.fillRule=0,this.onStart=function(){},this.onUpdate=function(){},this.onEnd=function(){},this.mRunning=!1,this.mStartTime=0,this.mCurrentFrication=0,this.mReverse=!1}return s.prototype.start=function(a){a===void 0&&(a=void 0),this.doStart(!1,a)},s.prototype.reverse=function(a){a===void 0&&(a=void 0),this.doStart(!0,a)},s.prototype.stop=function(){this.doStop()},Object.defineProperty(s.prototype,"animatedValue",{get:function(){return(this.endValue-this.startValue)*this.mCurrentFrication+this.startValue},enumerable:!0,configurable:!0}),s.prototype.doStart=function(a,l){a===void 0&&(a=!1),l===void 0&&(l=void 0),this.mReverse=a,this.mRunning=!0,this.mStartTime=s.currentTimeMillsecond(),l&&(this.mStartTime-=a?(1-l/(this.endValue-this.startValue))*this.duration:l/(this.endValue-this.startValue)*this.duration),this.mCurrentFrication=0,this.onStart(),this.doFrame()},s.prototype.doStop=function(){this.mRunning=!1},s.prototype.doFrame=function(){this.mRunning&&(this.doDeltaTime(s.currentTimeMillsecond()-this.mStartTime),this.mRunning&&s.requestAnimationFrame(this.doFrame.bind(this)))},s.prototype.doDeltaTime=function(a){a>=this.duration*this.loops?(this.mCurrentFrication=this.fillRule===1?0:1,this.mRunning=!1):(this.mCurrentFrication=a%this.duration/this.duration,this.mReverse&&(this.mCurrentFrication=1-this.mCurrentFrication)),this.onUpdate(this.animatedValue),this.mRunning===!1&&this.onEnd()},s.currentTimeMillsecond=function(){return typeof performance>"u"?new Date().getTime():performance.now()},s.requestAnimationFrame=function(a){return typeof requestAnimationFrame>"u"?setTimeout(a,16):window.requestAnimationFrame(a)},s}();e.ValueAnimator=n}])},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.Player=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},e=function(){function s(a,l){for(var c=0;c<l.length;c++){var f=l[c];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(a,f.key,f)}}return function(a,l,c){return l&&s(a.prototype,l),c&&s(a,c),a}}(),i=r(65),n=r(62);u.Player=function(){function s(a){(function(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")})(this,s),this.loops=0,this.clearsAfterStop=!0,this.fillMode="Forward",this._asChild=!1,this._container=void 0,this._renderer=void 0,this._animator=void 0,this._drawingCanvas=void 0,this._contentMode="AspectFit",this._videoItem=void 0,this._forwardAnimating=!1,this._currentFrame=0,this._dynamicImage={},this._dynamicImageTransform={},this._dynamicText={},this._onFinished=void 0,this._onFrame=void 0,this._onPercentage=void 0,this._container=typeof a=="string"?document.querySelector(a):a,this._asChild=a===void 0,this._init()}return e(s,[{key:"setVideoItem",value:function(a){this._currentFrame=0,this._videoItem=a,this._renderer.prepare(),this.clear(),this._update()}},{key:"setContentMode",value:function(a){this._contentMode=a,this._update()}},{key:"setClipsToBounds",value:function(a){this._container instanceof HTMLDivElement&&(this._container.style.overflowX=this._container.style.overflowY=a?"hidden":void 0)}},{key:"startAnimation",value:function(a){this.stopAnimation(!1),this._doStart(void 0,a,void 0)}},{key:"startAnimationWithRange",value:function(a,l){this.stopAnimation(!1),this._doStart(a,l,void 0)}},{key:"pauseAnimation",value:function(){this.stopAnimation(!1)}},{key:"stopAnimation",value:function(a){this._forwardAnimating=!1,this._animator!==void 0&&this._animator.stop(),a===void 0&&(a=this.clearsAfterStop),a&&this.clear()}},{key:"clear",value:function(){this._renderer.clear(),this._renderer.clearAudios()}},{key:"stepToFrame",value:function(a,l){a>=this._videoItem.frames||a<0||(this.pauseAnimation(),this._currentFrame=a,this._update(),l&&this._doStart(void 0,!1,this._currentFrame))}},{key:"stepToPercentage",value:function(a,l){var c=parseInt(a*this._videoItem.frames);c>=this._videoItem.frames&&c>0&&(c=this._videoItem.frames-1),this.stepToFrame(c,l)}},{key:"setImage",value:function(a,l,c){this._dynamicImage[l]=a,c!==void 0&&c instanceof Array&&c.length==6&&(this._dynamicImageTransform[l]=c)}},{key:"setText",value:function(a,l){var c=typeof a=="string"?a:a.text,f=((a===void 0?"undefined":t(a))==="object"?a.size:"14px")||"14px",h=((a===void 0?"undefined":t(a))==="object"?a.family:"Arial")||"Arial",p=((a===void 0?"undefined":t(a))==="object"?a.color:"#000000")||"#000000",d=((a===void 0?"undefined":t(a))==="object"?a.offset:{x:0,y:0})||{x:0,y:0};this._dynamicText[l]={text:c,style:f+" "+h,color:p,offset:d}}},{key:"clearDynamicObjects",value:function(){this._dynamicImage={},this._dynamicImageTransform={},this._dynamicText={}}},{key:"onFinished",value:function(a){this._onFinished=a}},{key:"onFrame",value:function(a){this._onFrame=a}},{key:"onPercentage",value:function(a){this._onPercentage=a}},{key:"drawOnContext",value:function(a,l,c,f,h){this._drawingCanvas&&this._videoItem&&a.drawImage(this._drawingCanvas,l,c,f||this._videoItem.videoSize.width,h||this._videoItem.videoSize.height)}},{key:"_init",value:function(){if(this._container instanceof HTMLDivElement||this._asChild){if(this._container)for(var a=this._container.querySelectorAll("canvas"),l=0;l<a.length;l++){var c=a[l];c!==void 0&&c.__isPlayer&&this._container.removeChild(c)}this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.__isPlayer=!0,this._drawingCanvas.style.backgroundColor="transparent",this._container&&(this._container.appendChild(this._drawingCanvas),this._container.style.textAlign="left")}this._renderer=new i.Renderer(this)}},{key:"_doStart",value:function(a,l,c){var f=this;this._animator=new n,a!==void 0?(this._animator.startValue=Math.max(0,a.location),this._animator.endValue=Math.min(this._videoItem.frames-1,a.location+a.length),this._animator.duration=(this._animator.endValue-this._animator.startValue+1)*(1/this._videoItem.FPS)*1e3):(this._animator.startValue=0,this._animator.endValue=this._videoItem.frames-1,this._animator.duration=this._videoItem.frames*(1/this._videoItem.FPS)*1e3),this._animator.loops=this.loops<=0?1/0:this.loops,this._animator.fillRule=this.fillMode==="Backward"?1:0,this._animator.onUpdate=function(h){f._currentFrame!==Math.floor(h)&&(f._forwardAnimating&&f._currentFrame>Math.floor(h)&&f._renderer.clearAudios(),f._currentFrame=Math.floor(h),f._update(),typeof f._onFrame=="function"&&f._onFrame(f._currentFrame),typeof f._onPercentage=="function"&&f._onPercentage(parseFloat(f._currentFrame+1)/parseFloat(f._videoItem.frames)))},this._animator.onEnd=function(){f._forwardAnimating=!1,f.clearsAfterStop===!0&&f.clear(),typeof f._onFinished=="function"&&f._onFinished()},l===!0?(this._animator.reverse(c),this._forwardAnimating=!1):(this._animator.start(c),this._forwardAnimating=!0),this._currentFrame=this._animator.startValue,this._update()}},{key:"_resize",value:function(){var a=!1;if(this._drawingCanvas){var l;l=this._drawingCanvas.parentNode?{width:this._drawingCanvas.parentNode.clientWidth,height:this._drawingCanvas.parentNode.clientHeight}:this._videoItem.videoSize;var c=this._videoItem.videoSize;if(l.width>=c.width&&l.height>=c.height)this._drawingCanvas.width=l.width,this._drawingCanvas.height=l.height,this._drawingCanvas.style.webkitTransform=this._drawingCanvas.style.transform="",a=!0;else{if(this._drawingCanvas.width=c.width,this._drawingCanvas.height=c.height,this._contentMode==="Fill"){var f=l.width/c.width,h=l.height/c.height,p=(c.width*f-c.width)/2,d=(c.height*h-c.height)/2;this._drawingCanvas.style.webkitTransform=this._drawingCanvas.style.transform="matrix("+f+", 0.0, 0.0, "+h+", "+p+", "+d+")"}else if(this._contentMode==="AspectFit"||this._contentMode==="AspectFill"){var v=c.width/c.height,g=l.width/l.height;if(v>=g&&this._contentMode==="AspectFit"||v<=g&&this._contentMode==="AspectFill"){var y=l.width/c.width,m=(c.width*y-c.width)/2,S=(c.height*y-c.height)/2+(l.height-c.height*y)/2;this._drawingCanvas.style.webkitTransform=this._drawingCanvas.style.transform="matrix("+y+", 0.0, 0.0, "+y+", "+m+", "+S+")"}else if(v<g&&this._contentMode==="AspectFit"||v>g&&this._contentMode==="AspectFill"){var _=l.height/c.height,A=(c.width*_-c.width)/2+(l.width-c.width*_)/2,k=(c.height*_-c.height)/2;this._drawingCanvas.style.webkitTransform=this._drawingCanvas.style.transform="matrix("+_+", 0.0, 0.0, "+_+", "+A+", "+k+")"}}this._globalTransform=void 0}}if(this._drawingCanvas===void 0||a===!0){var w=1,I=1,N=0,x=0,M={width:this._container!==void 0?this._container.clientWidth:0,height:this._container!==void 0?this._container.clientHeight:0},b=this._videoItem.videoSize;if(this._contentMode==="Fill")w=M.width/b.width,I=M.height/b.height;else if(this._contentMode==="AspectFit"||this._contentMode==="AspectFill"){var T=b.width/b.height,C=M.width/M.height;T>=C&&this._contentMode==="AspectFit"||T<=C&&this._contentMode==="AspectFill"?(w=I=M.width/b.width,x=(M.height-b.height*I)/2):(T<C&&this._contentMode==="AspectFit"||T>C&&this._contentMode==="AspectFill")&&(w=I=M.height/b.height,N=(M.width-b.width*w)/2)}this._globalTransform={a:w,b:0,c:0,d:I,tx:N,ty:x}}}},{key:"_update",value:function(){this._videoItem!==void 0&&(this._resize(),this._renderer.drawFrame(this._currentFrame),this._renderer.playAudio(this._currentFrame))}}]),s}()},function(o,u,r){var t=r(13),e=r(63),i=r(66);o.exports={Parser:t.Parser,Player:e.Player,autoload:i.AutoLoader.autoload},i.AutoLoader.autoload()},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.Renderer=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(l,c){for(var f=0;f<c.length;f++){var h=c[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(l,h.key,h)}}return function(l,c,f){return c&&a(l.prototype,c),f&&a(l,f),l}}(),i=r(5),n=r(15),s=r(14);u.Renderer=function(){function a(l){(function(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")})(this,a),this._owner=void 0,this._prepared=!1,this._undrawFrame=void 0,this._bitmapCache=void 0,this._soundsQueue=[],this._owner=l}return e(a,[{key:"dataURLtoBlob",value:function(l){for(var c=l.split(","),f=c[0].match(/:(.*?);/)[1],h=atob(c[1]),p=h.length,d=new Uint8Array(p);p--;)d[p]=h.charCodeAt(p);return new Blob([d],{type:f})}},{key:"prepare",value:function(){var l,c,f=this;if(this._prepared=!1,this._bitmapCache=void 0,this._owner._videoItem.images===void 0||Object.keys(this._owner._videoItem.images).length==0)return this._bitmapCache={},void(this._prepared=!0);this._bitmapCache===void 0&&function(){f._bitmapCache={};var h=0,p=0;for(l in f._owner._videoItem.images){var d=f._owner._videoItem.images[l];if(d.indexOf("iVBO")===0||d.indexOf("/9j/2w")===0){h++;var v=document.createElement("img");v.onload=(function(){++p==h&&(this._prepared=!0,typeof this._undrawFrame=="number"&&(this.drawFrame(this._undrawFrame),this._undrawFrame=void 0))}).bind(f),v.src="data:image/png;base64,"+d;var g=l.replace(".matte","");f._bitmapCache[g]=v}else d.indexOf("SUQz")===0&&window.Howl!==void 0&&(h++,(c=new Howl({src:[navigator.vendor==="Google Inc."?URL.createObjectURL(f.dataURLtoBlob("data:audio/x-mpeg;base64,"+d)):"data:audio/x-mpeg;base64,"+d],html5:navigator.vendor==="Google Inc."||void 0,preload:navigator.vendor==="Google Inc."||void 0,format:navigator.vendor==="Google Inc."?["mp3"]:void 0})).once("load",(function(){++p==h&&(this._prepared=!0,typeof this._undrawFrame=="number"&&(this.drawFrame(this._undrawFrame),this._undrawFrame=void 0))}).bind(f)),c.on("loaderror",function(y){console.error(y)}),f._bitmapCache[l]=c)}}()}},{key:"clear",value:function(){var l=(this._owner._drawingCanvas||this._owner._container).getContext("2d"),c={x:0,y:0,width:(this._owner._drawingCanvas||this._owner._container).width,height:(this._owner._drawingCanvas||this._owner._container).height};l.clearRect(c.x,c.y,c.width,c.height)}},{key:"clearAudios",value:function(){this._soundsQueue.forEach(function(l){l.player.stop(l.playID)}),this._soundsQueue=[]}},{key:"drawFrame",value:function(l){var c=this;if(this._prepared){var f=(this._owner._drawingCanvas||this._owner._container).getContext("2d"),h={x:0,y:0,width:(this._owner._drawingCanvas||this._owner._container).width,height:(this._owner._drawingCanvas||this._owner._container).height};f.clearRect(h.x,h.y,h.width,h.height);var p=new Map,d=!1,v=this._owner._videoItem.sprites;v.forEach(function(g,y){if(v[0].imageKey.indexOf(".matte")!=-1)if(g.imageKey.indexOf(".matte")==-1){var m=v[y-1];if(d&&(g.matteKey==null||g.matteKey.length==0||g.matteKey!=m.matteKey)){d=!1;var S=p.get(g.matteKey);f.globalCompositeOperation="destination-in",c.drawSprite(S,f,l),f.globalCompositeOperation="source-over",f.restore()}g.matteKey==null||m.matteKey!=null&&m.matteKey.length!=0&&m.matteKey==g.matteKey||(d=!0,f.save()),c.drawSprite(g,f,l),d&&y==v.length-1&&(S=p.get(g.matteKey),f.globalCompositeOperation="destination-in",c.drawSprite(S,f,l),f.globalCompositeOperation="source-over",f.restore())}else p.set(g.imageKey,g);else c.drawSprite(g,f,l)})}else this._undrawFrame=l}},{key:"drawSprite",value:function(l,c,f){var h=this,p=l.frames[this._owner._currentFrame];if(!(p.alpha<.05)){c.save(),this._owner._globalTransform&&c.transform(this._owner._globalTransform.a,this._owner._globalTransform.b,this._owner._globalTransform.c,this._owner._globalTransform.d,this._owner._globalTransform.tx,this._owner._globalTransform.ty),c.globalAlpha=p.alpha,c.transform(p.transform.a,p.transform.b,p.transform.c,p.transform.d,p.transform.tx,p.transform.ty);var d=l.imageKey.replace(".matte",""),v=this._owner._dynamicImage[d]||this._bitmapCache[d]||this._owner._videoItem.images[d];if(typeof v=="string"){var g=this._bitmapCache[l.imageKey]||document.createElement("img"),y=void 0,m=void 0;if(v.indexOf("iVBO")===0||v.indexOf("/9j/2w")===0?g.src="data:image/png;base64,"+v:(g._svgaSrc!==v&&(g._svgaSrc=v,g.src=v),y=p.layout.width,m=p.layout.height),this._bitmapCache[l.imageKey]=g,p.maskPath!==void 0&&p.maskPath!==null&&(this.drawBezier(c,p.maskPath),c.clip()),this._owner._dynamicImageTransform[l.imageKey]!==void 0){c.save();var S=this._owner._dynamicImageTransform[l.imageKey];c.transform(S[0],S[1],S[2],S[3],S[4],S[5])}y&&m?c.drawImage(g,0,0,y,m):c.drawImage(g,0,0),this._owner._dynamicImageTransform[l.imageKey]!==void 0&&c.restore()}else if((v===void 0?"undefined":t(v))==="object"){if(p.maskPath!==void 0&&p.maskPath!==null&&(p.maskPath._styles=void 0,this.drawBezier(c,p.maskPath),c.clip()),this._owner._dynamicImageTransform[l.imageKey]!==void 0){c.save();var _=this._owner._dynamicImageTransform[l.imageKey];c.transform(_[0],_[1],_[2],_[3],_[4],_[5])}c.drawImage(v,0,0),this._owner._dynamicImageTransform[l.imageKey]!==void 0&&c.restore()}p.shapes&&p.shapes.forEach(function(N){N.type==="shape"&&N.pathArgs&&N.pathArgs.d&&h.drawBezier(c,new i.BezierPath(N.pathArgs.d,N.transform,N.styles)),N.type==="ellipse"&&N.pathArgs&&h.drawEllipse(c,new n.EllipsePath(parseFloat(N.pathArgs.x)||0,parseFloat(N.pathArgs.y)||0,parseFloat(N.pathArgs.radiusX)||0,parseFloat(N.pathArgs.radiusY)||0,N.transform,N.styles)),N.type==="rect"&&N.pathArgs&&h.drawRect(c,new s.RectPath(parseFloat(N.pathArgs.x)||0,parseFloat(N.pathArgs.y)||0,parseFloat(N.pathArgs.width)||0,parseFloat(N.pathArgs.height)||0,parseFloat(N.pathArgs.cornerRadius)||0,N.transform,N.styles))});var A=this._owner._dynamicText[l.imageKey];if(A!==void 0){c.textBaseline="middle",c.font=A.style;var k=c.measureText(A.text).width;c.fillStyle=A.color;var w=A.offset!==void 0&&A.offset.x!==void 0?isNaN(parseFloat(A.offset.x))?0:parseFloat(A.offset.x):0,I=A.offset!==void 0&&A.offset.y!==void 0?isNaN(parseFloat(A.offset.y))?0:parseFloat(A.offset.y):0;c.fillText(A.text,(p.layout.width-k)/2+w,p.layout.height/2+I)}c.restore()}}},{key:"playAudio",value:function(l){var c=this;if(this._owner._forwardAnimating&&this._owner._videoItem.audios instanceof Array){this._owner._videoItem.audios.forEach(function(h){if(h.startFrame===l&&c._bitmapCache[h.audioKey]!==void 0&&typeof c._bitmapCache[h.audioKey].play=="function"){var p={playID:c._bitmapCache[h.audioKey].play(),player:c._bitmapCache[h.audioKey],endFrame:h.endFrame};p.player.seek(h.startTime/1e3,p.playID),c._soundsQueue.push(p)}});var f=!1;this._soundsQueue.forEach(function(h){l>=h.endFrame&&(f=!0,h.player.stop(h.playID))}),f&&(this._soundsQueue=this._soundsQueue.filter(function(h){return l<h.endFrame}))}}},{key:"resetShapeStyles",value:function(l,c){var f=c._styles;f!==void 0&&(f&&f.stroke?l.strokeStyle="rgba("+parseInt(255*f.stroke[0])+", "+parseInt(255*f.stroke[1])+", "+parseInt(255*f.stroke[2])+", "+f.stroke[3]+")":l.strokeStyle="transparent",f&&(l.lineWidth=f.strokeWidth||void 0,l.lineCap=f.lineCap||void 0,l.lineJoin=f.lineJoin||void 0,l.miterLimit=f.miterLimit||void 0),f&&f.fill?l.fillStyle="rgba("+parseInt(255*f.fill[0])+", "+parseInt(255*f.fill[1])+", "+parseInt(255*f.fill[2])+", "+f.fill[3]+")":l.fillStyle="transparent",f&&f.lineDash&&l.setLineDash(f.lineDash))}},{key:"drawBezier",value:function(l,c){var f=this;l.save(),this.resetShapeStyles(l,c),c._transform!==void 0&&c._transform!==null&&l.transform(c._transform.a,c._transform.b,c._transform.c,c._transform.d,c._transform.tx,c._transform.ty);var h={x:0,y:0,x1:0,y1:0,x2:0,y2:0};l.beginPath(),c._d.replace(/([a-zA-Z])/g,"|||$1 ").replace(/,/g," ").split("|||").forEach(function(p){if(p.length!=0){var d=p.substr(0,1);if("MLHVCSQRZmlhvcsqrz".indexOf(d)>=0){var v=p.substr(1).trim().split(" ");f.drawBezierElement(l,h,d,v)}}}),c._styles&&c._styles.fill&&l.fill(),c._styles&&c._styles.stroke&&l.stroke(),l.restore()}},{key:"drawBezierElement",value:function(l,c,f,h){switch(f){case"M":c.x=Number(h[0]),c.y=Number(h[1]),l.moveTo(c.x,c.y);break;case"m":c.x+=Number(h[0]),c.y+=Number(h[1]),l.moveTo(c.x,c.y);break;case"L":c.x=Number(h[0]),c.y=Number(h[1]),l.lineTo(c.x,c.y);break;case"l":c.x+=Number(h[0]),c.y+=Number(h[1]),l.lineTo(c.x,c.y);break;case"H":c.x=Number(h[0]),l.lineTo(c.x,c.y);break;case"h":c.x+=Number(h[0]),l.lineTo(c.x,c.y);break;case"V":c.y=Number(h[0]),l.lineTo(c.x,c.y);break;case"v":c.y+=Number(h[0]),l.lineTo(c.x,c.y);break;case"C":c.x1=Number(h[0]),c.y1=Number(h[1]),c.x2=Number(h[2]),c.y2=Number(h[3]),c.x=Number(h[4]),c.y=Number(h[5]),l.bezierCurveTo(c.x1,c.y1,c.x2,c.y2,c.x,c.y);break;case"c":c.x1=c.x+Number(h[0]),c.y1=c.y+Number(h[1]),c.x2=c.x+Number(h[2]),c.y2=c.y+Number(h[3]),c.x+=Number(h[4]),c.y+=Number(h[5]),l.bezierCurveTo(c.x1,c.y1,c.x2,c.y2,c.x,c.y);break;case"S":c.x1&&c.y1&&c.x2&&c.y2?(c.x1=c.x-c.x2+c.x,c.y1=c.y-c.y2+c.y,c.x2=Number(h[0]),c.y2=Number(h[1]),c.x=Number(h[2]),c.y=Number(h[3]),l.bezierCurveTo(c.x1,c.y1,c.x2,c.y2,c.x,c.y)):(c.x1=Number(h[0]),c.y1=Number(h[1]),c.x=Number(h[2]),c.y=Number(h[3]),l.quadraticCurveTo(c.x1,c.y1,c.x,c.y));break;case"s":c.x1&&c.y1&&c.x2&&c.y2?(c.x1=c.x-c.x2+c.x,c.y1=c.y-c.y2+c.y,c.x2=c.x+Number(h[0]),c.y2=c.y+Number(h[1]),c.x+=Number(h[2]),c.y+=Number(h[3]),l.bezierCurveTo(c.x1,c.y1,c.x2,c.y2,c.x,c.y)):(c.x1=c.x+Number(h[0]),c.y1=c.y+Number(h[1]),c.x+=Number(h[2]),c.y+=Number(h[3]),l.quadraticCurveTo(c.x1,c.y1,c.x,c.y));break;case"Q":c.x1=Number(h[0]),c.y1=Number(h[1]),c.x=Number(h[2]),c.y=Number(h[3]),l.quadraticCurveTo(c.x1,c.y1,c.x,c.y);break;case"q":c.x1=c.x+Number(h[0]),c.y1=c.y+Number(h[1]),c.x+=Number(h[2]),c.y+=Number(h[3]),l.quadraticCurveTo(c.x1,c.y1,c.x,c.y);break;case"A":case"a":break;case"Z":case"z":l.closePath()}}},{key:"drawEllipse",value:function(l,c){l.save(),this.resetShapeStyles(l,c),c._transform!==void 0&&c._transform!==null&&l.transform(c._transform.a,c._transform.b,c._transform.c,c._transform.d,c._transform.tx,c._transform.ty);var f=c._x-c._radiusX,h=c._y-c._radiusY,p=2*c._radiusX,d=2*c._radiusY,v=p/2*.5522848,g=d/2*.5522848,y=f+p,m=h+d,S=f+p/2,_=h+d/2;l.beginPath(),l.moveTo(f,_),l.bezierCurveTo(f,_-g,S-v,h,S,h),l.bezierCurveTo(S+v,h,y,_-g,y,_),l.bezierCurveTo(y,_+g,S+v,m,S,m),l.bezierCurveTo(S-v,m,f,_+g,f,_),c._styles&&c._styles.fill&&l.fill(),c._styles&&c._styles.stroke&&l.stroke(),l.restore()}},{key:"drawRect",value:function(l,c){l.save(),this.resetShapeStyles(l,c),c._transform!==void 0&&c._transform!==null&&l.transform(c._transform.a,c._transform.b,c._transform.c,c._transform.d,c._transform.tx,c._transform.ty);var f=c._x,h=c._y,p=c._width,d=c._height,v=c._cornerRadius;p<2*v&&(v=p/2),d<2*v&&(v=d/2),l.beginPath(),l.moveTo(f+v,h),l.arcTo(f+p,h,f+p,h+d,v),l.arcTo(f+p,h+d,f,h+d,v),l.arcTo(f,h+d,f,h,v),l.arcTo(f,h,f+p,h,v),l.closePath(),c._styles&&c._styles.fill&&l.fill(),c._styles&&c._styles.stroke&&l.stroke(),l.restore()}}]),a}()},function(o,u,r){Object.defineProperty(u,"__esModule",{value:!0}),u.AutoLoader=void 0;var t=r(13),e=r(63),i=u.AutoLoader=function n(){(function(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")})(this,n)};i.sharedParser=new t.Parser,i.autoload=function(n,s){if(typeof window<"u"&&typeof document<"u"){var a=s||i.sharedParser;if(n){if((n.tagName==="CANVAS"||n.tagName==="DIV")&&n.attributes.src&&n.attributes.src.value.indexOf(".svga")===n.attributes.src.value.length-5){var l=n.attributes.src.value,c=new e.Player(n);a.load(l,function(p){if(n.attributes.loops){var d=parseFloat(n.attributes.loops.value)||0;c.loops=d}if(n.attributes.clearsAfterStop){var v=n.attributes.clearsAfterStop.value!=="false";c.clearsAfterStop=v}c.setVideoItem(p),c.startAnimation()}),n.player=c}}else for(var f=document.querySelectorAll('[src$=".svga"]'),h=0;h<f.length;h++)n=f[h],i.autoload(n)}}}])})})(svga_min);var svga_minExports=svga_min.exports;const SVGA=getDefaultExportFromCjs(svga_minExports),SvgaPlayer_vue_vue_type_style_index_0_scoped_79771305_lang="",_sfc_main$2={__name:"SvgaPlayer",setup(o,{expose:u}){const r=ref(null);let t=null,e=null;return onMounted(()=>{t=new SVGA.Player(r.value),e=new SVGA.Parser(r.value),t.onFinished(()=>{})}),onUnmounted(()=>{var n;(n=r.value)==null||n.remove()}),u({setData:n=>{e.load(n,function(s){t.setVideoItem(s),t.loops=2,t.startAnimation()},s=>{console.error("Failed to load SVGA file:",s)})}}),(n,s)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("div",{ref_key:"svgaContainer",ref:r,class:"svga-container"},null,512)]))}},__unplugin_components_2=_export_sfc(_sfc_main$2,[["__scopeId","data-v-79771305"]]);function ownKeys$2(o,u){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);u&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),r.push.apply(r,t)}return r}function _objectSpread2$2(o){for(var u=1;u<arguments.length;u++){var r=arguments[u]!=null?arguments[u]:{};u%2?ownKeys$2(Object(r),!0).forEach(function(t){_defineProperty$3(o,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(r,t))})}return o}function _typeof$2(o){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$2(o)}function _classCallCheck$3(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties$3(o,u){for(var r=0;r<u.length;r++){var t=u[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(o,_toPropertyKey$3(t.key),t)}}function _createClass$3(o,u,r){return u&&_defineProperties$3(o.prototype,u),r&&_defineProperties$3(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}function _defineProperty$3(o,u,r){return u=_toPropertyKey$3(u),u in o?Object.defineProperty(o,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[u]=r,o}function _inherits$3(o,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(u&&u.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),u&&_setPrototypeOf$3(o,u)}function _getPrototypeOf$3(o){return _getPrototypeOf$3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf$3(o)}function _setPrototypeOf$3(o,u){return _setPrototypeOf$3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf$3(o,u)}function _isNativeReflectConstruct$3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _assertThisInitialized$3(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function _possibleConstructorReturn$3(o,u){if(u&&(typeof u=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$3(o)}function _createSuper$3(o){var u=_isNativeReflectConstruct$3();return function(){var t=_getPrototypeOf$3(o),e;if(u){var i=_getPrototypeOf$3(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn$3(this,e)}}function _superPropBase$1(o,u){for(;!Object.prototype.hasOwnProperty.call(o,u)&&(o=_getPrototypeOf$3(o),o!==null););return o}function _get$1(){return typeof Reflect<"u"&&Reflect.get?_get$1=Reflect.get.bind():_get$1=function(u,r,t){var e=_superPropBase$1(u,r);if(e){var i=Object.getOwnPropertyDescriptor(e,r);return i.get?i.get.call(arguments.length<3?u:t):i.value}},_get$1.apply(this,arguments)}function _toConsumableArray$1(o){return _arrayWithoutHoles$1(o)||_iterableToArray$1(o)||_unsupportedIterableToArray$2(o)||_nonIterableSpread$1()}function _arrayWithoutHoles$1(o){if(Array.isArray(o))return _arrayLikeToArray$2(o)}function _iterableToArray$1(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)}function _unsupportedIterableToArray$2(o,u){if(o){if(typeof o=="string")return _arrayLikeToArray$2(o,u);var r=Object.prototype.toString.call(o).slice(8,-1);if(r==="Object"&&o.constructor&&(r=o.constructor.name),r==="Map"||r==="Set")return Array.from(o);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray$2(o,u)}}function _arrayLikeToArray$2(o,u){(u==null||u>o.length)&&(u=o.length);for(var r=0,t=new Array(u);r<u;r++)t[r]=o[r];return t}function _nonIterableSpread$1(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _toPrimitive$3(o,u){if(typeof o!="object"||o===null)return o;var r=o[Symbol.toPrimitive];if(r!==void 0){var t=r.call(o,u||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(o)}function _toPropertyKey$3(o){var u=_toPrimitive$3(o,"string");return typeof u=="symbol"?u:String(u)}var eventemitter3={exports:{}};(function(o){var u=Object.prototype.hasOwnProperty,r="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(r=!1));function e(a,l,c){this.fn=a,this.context=l,this.once=c||!1}function i(a,l,c,f,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new e(c,f||a,h),d=r?r+l:l;return a._events[d]?a._events[d].fn?a._events[d]=[a._events[d],p]:a._events[d].push(p):(a._events[d]=p,a._eventsCount++),a}function n(a,l){--a._eventsCount===0?a._events=new t:delete a._events[l]}function s(){this._events=new t,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],c,f;if(this._eventsCount===0)return l;for(f in c=this._events)u.call(c,f)&&l.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},s.prototype.listeners=function(l){var c=r?r+l:l,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,p=f.length,d=new Array(p);h<p;h++)d[h]=f[h].fn;return d},s.prototype.listenerCount=function(l){var c=r?r+l:l,f=this._events[c];return f?f.fn?1:f.length:0},s.prototype.emit=function(l,c,f,h,p,d){var v=r?r+l:l;if(!this._events[v])return!1;var g=this._events[v],y=arguments.length,m,S;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,f),!0;case 4:return g.fn.call(g.context,c,f,h),!0;case 5:return g.fn.call(g.context,c,f,h,p),!0;case 6:return g.fn.call(g.context,c,f,h,p,d),!0}for(S=1,m=new Array(y-1);S<y;S++)m[S-1]=arguments[S];g.fn.apply(g.context,m)}else{var _=g.length,A;for(S=0;S<_;S++)switch(g[S].once&&this.removeListener(l,g[S].fn,void 0,!0),y){case 1:g[S].fn.call(g[S].context);break;case 2:g[S].fn.call(g[S].context,c);break;case 3:g[S].fn.call(g[S].context,c,f);break;case 4:g[S].fn.call(g[S].context,c,f,h);break;default:if(!m)for(A=1,m=new Array(y-1);A<y;A++)m[A-1]=arguments[A];g[S].fn.apply(g[S].context,m)}}return!0},s.prototype.on=function(l,c,f){return i(this,l,c,f,!1)},s.prototype.once=function(l,c,f){return i(this,l,c,f,!0)},s.prototype.removeListener=function(l,c,f,h){var p=r?r+l:l;if(!this._events[p])return this;if(!c)return n(this,p),this;var d=this._events[p];if(d.fn)d.fn===c&&(!h||d.once)&&(!f||d.context===f)&&n(this,p);else{for(var v=0,g=[],y=d.length;v<y;v++)(d[v].fn!==c||h&&!d[v].once||f&&d[v].context!==f)&&g.push(d[v]);g.length?this._events[p]=g.length===1?g[0]:g:n(this,p)}return this},s.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&n(this,c)):(this._events=new t,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,o.exports=s})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);var XG_DEBUG_OPEN=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,STYLE={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},XGTAG="%c[xgplayer]",XG_DEBUG={config:{debug:XG_DEBUG_OPEN?3:0},logInfo:function o(u){for(var r,t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];this.config.debug>=3&&(r=console).log.apply(r,[XGTAG,STYLE.info,u].concat(e))},logWarn:function o(u){for(var r,t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];this.config.debug>=1&&(r=console).warn.apply(r,[XGTAG,STYLE.warn,u].concat(e))},logError:function o(u){var r;if(!(this.config.debug<1)){for(var t=this.config.debug>=2?"trace":"error",e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];(r=console)[t].apply(r,[XGTAG,STYLE.error,u].concat(i))}}};function bindDebug(o){o.logInfo=XG_DEBUG.logInfo.bind(o),o.logWarn=XG_DEBUG.logWarn.bind(o),o.logError=XG_DEBUG.logError.bind(o)}var XgplayerTimeRange=function(){function o(u){_classCallCheck$3(this,o),this.bufferedList=u}return _createClass$3(o,[{key:"start",value:function(r){return this.bufferedList[r].start}},{key:"end",value:function(r){return this.bufferedList[r].end}},{key:"length",get:function(){return this.bufferedList.length}}]),o}(),util={};util.createDom=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(o);return e.className=t,e.innerHTML=u,Object.keys(r).forEach(function(i){var n=i,s=r[i];o==="video"||o==="audio"||o==="live-video"?s&&e.setAttribute(n,s):e.setAttribute(n,s)}),e};util.createDomFromHtml=function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";try{var t=document.createElement("div");t.innerHTML=o;var e=t.children;return t=null,e.length>0?(e=e[0],r&&util.addClass(e,r),u&&Object.keys(u).forEach(function(i){e.setAttribute(i,u[i])}),e):null}catch(i){return XG_DEBUG.logError("util.createDomFromHtml",i),null}};util.hasClass=function(o,u){if(!o||!u)return!1;try{return Array.prototype.some.call(o.classList,function(t){return t===u})}catch{var r=o.className&&_typeof$2(o.className)==="object"?o.getAttribute("class"):o.className;return r&&!!r.match(new RegExp("(\\s|^)"+u+"(\\s|$)"))}};util.addClass=function(o,u){if(!(!o||!u))try{u.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(r){r&&o.classList.add(r)})}catch{util.hasClass(o,u)||(o.className&&_typeof$2(o.className)==="object"?o.setAttribute("class",o.getAttribute("class")+" "+u):o.className+=" "+u)}};util.removeClass=function(o,u){if(!(!o||!u))try{u.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(r){r&&o.classList.remove(r)})}catch{util.hasClass(o,u)&&u.split(/\s+/g).forEach(function(t){var e=new RegExp("(\\s|^)"+t+"(\\s|$)");o.className&&_typeof$2(o.className)==="object"?o.setAttribute("class",o.getAttribute("class").replace(e," ")):o.className=o.className.replace(e," ")})}};util.toggleClass=function(o,u){o&&u.split(/\s+/g).forEach(function(r){util.hasClass(o,r)?util.removeClass(o,r):util.addClass(o,r)})};util.classNames=function(){for(var o=arguments,u=[],r=function(i){util.typeOf(o[i])==="String"?u.push(o[i]):util.typeOf(o[i])==="Object"&&Object.keys(o[i]).map(function(n){o[i][n]&&u.push(n)})},t=0;t<arguments.length;t++)r(t);return u.join(" ")};util.findDom=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,u=arguments.length>1?arguments[1]:void 0,r;try{r=o.querySelector(u)}catch(t){XG_DEBUG.logError("util.findDom",t),u.indexOf("#")===0&&(r=o.getElementById(u.slice(1)))}return r};util.getCss=function(o,u){return o.currentStyle?o.currentStyle[u]:document.defaultView.getComputedStyle(o,!1)[u]};util.padStart=function(o,u,r){for(var t=String(r),e=u>>0,i=Math.ceil(e/t.length),n=[],s=String(o);i--;)n.push(t);return n.join("").substring(0,e-s.length)+s};util.format=function(o){if(window.isNaN(o))return"";o=Math.round(o);var u=util.padStart(Math.floor(o/3600),2,0),r=util.padStart(Math.floor((o-u*3600)/60),2,0),t=util.padStart(Math.floor(o-u*3600-r*60),2,0);return(u==="00"?[r,t]:[u,r,t]).join(":")};util.event=function(o){if(o.touches){var u=o.touches[0]||o.changedTouches[0];o.clientX=u.clientX||0,o.clientY=u.clientY||0,o.offsetX=u.pageX-u.target.offsetLeft,o.offsetY=u.pageY-u.target.offsetTop}o._target=o.target||o.srcElement};util.typeOf=function(o){return Object.prototype.toString.call(o).match(/([^\s.*]+)(?=]$)/g)[0]};util.deepCopy=function(o,u){if(util.typeOf(u)==="Object"&&util.typeOf(o)==="Object")return Object.keys(u).forEach(function(r){util.typeOf(u[r])==="Object"&&!(u[r]instanceof Node)?o[r]===void 0||o[r]===void 0?o[r]=u[r]:util.deepCopy(o[r],u[r]):util.typeOf(u[r])==="Array"?o[r]=util.typeOf(o[r])==="Array"?o[r].concat(u[r]):u[r]:o[r]=u[r]}),o};util.deepMerge=function(o,u){return Object.keys(u).map(function(r){if(util.typeOf(u[r])==="Array"&&util.typeOf(o[r])==="Array"){if(util.typeOf(o[r])==="Array"){var t;(t=o[r]).push.apply(t,_toConsumableArray$1(u[r]))}}else util.typeOf(o[r])===util.typeOf(u[r])&&o[r]!==null&&util.typeOf(o[r])==="Object"&&!(u[r]instanceof window.Node)?util.deepMerge(o[r],u[r]):u[r]!==null&&(o[r]=u[r])}),o};util.getBgImage=function(o){var u=(o.currentStyle||window.getComputedStyle(o,null)).backgroundImage;if(!u||u==="none")return"";var r=document.createElement("a");return r.href=u.replace(/url\("|"\)/g,""),r.href};util.copyDom=function(o){if(o&&o.nodeType===1){var u=document.createElement(o.tagName);return Array.prototype.forEach.call(o.attributes,function(r){u.setAttribute(r.name,r.value)}),o.innerHTML&&(u.innerHTML=o.innerHTML),u}else return""};util.setInterval=function(o,u,r,t){o._interval[u]||(o._interval[u]=window.setInterval(r.bind(o),t))};util.clearInterval=function(o,u){clearInterval(o._interval[u]),o._interval[u]=null};util.setTimeout=function(o,u,r){o._timers||(o._timers=[]);var t=setTimeout(function(){u(),util.clearTimeout(o,t)},r);return o._timers.push(t),t};util.clearTimeout=function(o,u){var r=o._timers;if(util.typeOf(r)==="Array"){for(var t=0;t<r.length;t++)if(r[t]===u){r.splice(t,1),clearTimeout(u);break}}else clearTimeout(u)};util.clearAllTimers=function(o){var u=o._timers;util.typeOf(u)==="Array"&&(u.map(function(r){clearTimeout(r)}),o._timerIds=[])};util.createImgBtn=function(o,u,r,t){var e=util.createDom("xg-".concat(o),"",{},"xgplayer-".concat(o,"-img"));if(e.style.backgroundImage='url("'.concat(u,'")'),r&&t){var i,n,s;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(a){return r.indexOf(a)>-1&&t.indexOf(a)>-1?(i=parseFloat(r.slice(0,r.indexOf(a)).trim()),n=parseFloat(t.slice(0,t.indexOf(a)).trim()),s=a,!1):!0}),e.style.width="".concat(i).concat(s),e.style.height="".concat(n).concat(s),e.style.backgroundSize="".concat(i).concat(s," ").concat(n).concat(s),o==="start"?e.style.margin="-".concat(n/2).concat(s," auto auto -").concat(i/2).concat(s):e.style.margin="auto 5px auto 5px"}return e};util.Hex2RGBA=function(o,u){var r=[];if(/^\#[0-9A-F]{3}$/i.test(o)){var t="#";o.replace(/[0-9A-F]/ig,function(e){t+=e+e}),o=t}return/^#[0-9A-F]{6}$/i.test(o)?(o.replace(/[0-9A-F]{2}/ig,function(e){r.push(parseInt(e,16))}),"rgba(".concat(r.join(","),", ").concat(u,")")):"rgba(255, 255, 255, 0.1)"};util.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement};util.checkIsFunction=function(o){return o&&typeof o=="function"};util.checkIsObject=function(o){return o!==null&&_typeof$2(o)==="object"};util.hide=function(o){o.style.display="none"};util.show=function(o,u){o.style.display=u||"block"};util.isUndefined=function(o){if(typeof o>"u"||o===null)return!0};util.isNotNull=function(o){return o!=null};util.setStyleFromCsstext=function(o,u){if(u)if(util.typeOf(u)==="String"){var r=u.replace(/\s+/g,"").split(";");r.map(function(t){if(t){var e=t.split(":");e.length>1&&(o.style[e[0]]=e[1])}})}else Object.keys(u).map(function(t){o.style[t]=u[t]})};function checkIsIn(o,u){for(var r=0,t=u.length;r<t;r++)if(o.indexOf(u[r])>-1)return!0;return!1}util.filterStyleFromText=function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],r=o.style.cssText;if(!r)return{};var t=r.replace(/\s+/g,"").split(";"),e={},i={};return t.map(function(n){if(n){var s=n.split(":");s.length>1&&(checkIsIn(s[0],u)?e[s[0]]=s[1]:i[s[0]]=s[1])}}),o.setAttribute("style",""),Object.keys(i).map(function(n){o.style[n]=i[n]}),e};util.getStyleFromCsstext=function(o){var u=o.style.cssText;if(!u)return{};var r=u.replace(/\s+/g,"").split(";"),t={};return r.map(function(e){if(e){var i=e.split(":");i.length>1&&(t[i[0]]=i[1])}}),t};util.preloadImg=function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(o){var t=new window.Image;t.onload=function(e){t=null,u&&u(e)},t.onerror=function(e){t=null,r&&r(e)},t.src=o}};util.stopPropagation=function(o){o&&o.stopPropagation()};util.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0};util.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0};util.checkTouchSupport=function(){return"ontouchstart"in window};util.getBuffered2=function(o){for(var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,r=[],t=0;t<o.length;t++)r.push({start:o.start(t)<.5?0:o.start(t),end:o.end(t)});r.sort(function(a,l){var c=a.start-l.start;return c||l.end-a.end});var e=[];if(u)for(var i=0;i<r.length;i++){var n=e.length;if(n){var s=e[n-1].end;r[i].start-s<u?r[i].end>s&&(e[n-1].end=r[i].end):e.push(r[i])}else e.push(r[i])}else e=r;return new XgplayerTimeRange(e)};util.getEventPos=function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return o.touches&&o.touches.length>0&&(o=o.touches[0]),{x:o.x/u,y:o.y/u,clientX:o.clientX/u,clientY:o.clientY/u,offsetX:o.offsetX/u,offsetY:o.offsetY/u,pageX:o.pageX/u,pageY:o.pageY/u}};util.requestAnimationFrame=function(o){var u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(u)return u(o)};util.getHostFromUrl=function(o){if(util.typeOf(o)!=="String")return"";var u=o.split("/"),r="";return u.length>3&&u[2]&&(r=u[2]),r};util.cancelAnimationFrame=function(o){var u=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;u&&u(o)};util.isMSE=function(o){return o.media&&(o=o.media),!o||!(o instanceof HTMLMediaElement)?!1:/^blob/.test(o.currentSrc)||/^blob/.test(o.src)};util.isBlob=function(o){return typeof o=="string"&&/^blob/.test(o)};util.generateSessionId=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,u=new Date().getTime();try{o=parseInt(o)}catch{o=0}u+=o,window.performance&&typeof window.performance.now=="function"&&(u+=parseInt(window.performance.now()));var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(u+Math.random()*16)%16|0;return u=Math.floor(u/16),(t==="x"?e:e&3|8).toString(16)});return r};util.createEvent=function(o){var u;return typeof window.Event=="function"?u=new Event(o):(u=document.createEvent("Event"),u.initEvent(o,!0,!0)),u};util.adjustTimeByDuration=function(o,u,r){return!u||!o?o:o>u||r&&o<u?u:o};util.createPositionBar=function(o,u){var r=util.createDom("xg-bar","",{"data-index":-1},o);return u.appendChild(r),r};util.getTransformStyle=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{x:0,y:0,scale:1,rotate:0},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r={scale:"".concat(o.scale||1),translate:"".concat(o.x||0,"%, ").concat(o.y||0,"%"),rotate:"".concat(o.rotate||0,"deg")},t=Object.keys(r);return t.forEach(function(e){var i=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),n="".concat(e,"(").concat(r[e],")");i.test(u)?(i.lastIndex=-1,u=u.replace(i,n)):u+="".concat(n," ")}),u};util.convertDeg=function(o){return Math.abs(o)<=1?o*360:o%360};util.getIndexByTime=function(o,u){var r=u.length,t=-1;if(r<1)return t;if(o<=u[0].end||r<2)t=0;else if(o>u[r-1].end)t=r-1;else for(var e=1;e<r;e++)if(o>u[e-1].end&&o<=u[e].end){t=e;break}return t};util.getOffsetCurrentTime=function(o,u){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,t=-1;if(r>=0&&r<u.length?t=r:t=util.getIndexByTime(o,u),t<0)return-1;var e=u.length,i=u[t],n=i.start,s=i.end,a=i.cTime,l=i.offset;return o<n?a:o>=n&&o<=s?o-l:o>s&&t>=e-1?s:-1};util.getCurrentTimeByOffset=function(o,u){var r=-1;if(!u||u.length<0)return o;for(var t=0;t<u.length;t++)if(o<=u[t].duration){r=t;break}if(r!==-1){var e=u[r].start;return r-1<0?e+o:e+(o-u[r-1].duration)}return o};function isObject$1(o){var u=_typeof$2(o);return o!==null&&(u==="object"||u==="function")}function debounce(o,u,r){var t,e,i,n,s,a,l=0,c=!1,f=!1,h=!0,p=!u&&u!==0&&typeof window.requestAnimationFrame=="function";if(typeof o!="function")throw new TypeError("Expected a function");u=+u||0,isObject$1(r)&&(c=!!r.leading,f="maxWait"in r,i=f?Math.max(+r.maxWait||0,u):i,h="trailing"in r?!!r.trailing:h);function d(x){var M=t,b=e;return t=e=void 0,l=x,n=o.apply(b,M),n}function v(x,M){return p?(window.cancelAnimationFrame(s),window.requestAnimationFrame(x)):setTimeout(x,M)}function g(x){if(p)return window.cancelAnimationFrame(x);clearTimeout(x)}function y(x){return l=x,s=v(_,u),c?d(x):n}function m(x){var M=x-a,b=x-l,T=u-M;return f?Math.min(T,i-b):T}function S(x){var M=x-a,b=x-l;return a===void 0||M>=u||M<0||f&&b>=i}function _(){var x=Date.now();if(S(x))return A(x);s=v(_,m(x))}function A(x){return s=void 0,h&&t?d(x):(t=e=void 0,n)}function k(){s!==void 0&&g(s),l=0,t=a=e=s=void 0}function w(){return s===void 0?n:A(Date.now())}function I(){return s!==void 0}function N(){for(var x=Date.now(),M=S(x),b=arguments.length,T=new Array(b),C=0;C<b;C++)T[C]=arguments[C];if(t=T,e=this,a=x,M){if(s===void 0)return y(a);if(f)return s=v(_,u),d(a)}return s===void 0&&(s=v(_,u)),n}return N.cancel=k,N.flush=w,N.pending=I,N}function throttle(o,u,r){var t=!0,e=!0;if(typeof o!="function")throw new TypeError("Expected a function");return isObject$1(r)&&(t="leading"in r?!!r.leading:t,e="trailing"in r?!!r.trailing:e),debounce(o,u,{leading:t,trailing:e,maxWait:u})}function getLang(){var o=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return o==="zh-cn"&&(o="zh"),o}function checkIsCurrentVideo(o,u,r){if(o){var t=o.getAttribute(r);return!!(t&&t===u&&(o.tagName==="VIDEO"||o.tagName==="AUDIO"))}}var VERSION_REG={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},H264_MIMETYPES=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],sniffer={get device(){var o=sniffer.os;return o.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var o=navigator.userAgent.toLowerCase(),u={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(u).filter(function(r){return u[r].test(o)}))[0]},get os(){if(typeof navigator>"u")return{};var o=navigator.userAgent,u=/(?:Windows Phone)/.test(o),r=/(?:SymbianOS)/.test(o)||u,t=/(?:Android)/.test(o),e=/(?:Firefox)/.test(o),i=/(?:iPad|PlayBook)/.test(o)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,n=i||t&&!/(?:Mobile)/.test(o)||e&&/(?:Tablet)/.test(o),s=/(?:iPhone)/.test(o)&&!n,a=!s&&!t&&!r&&!n;return{isTablet:n,isPhone:s,isIpad:i,isIos:s||i,isAndroid:t,isPc:a,isSymbian:r,isWindowsPhone:u,isFireFox:e}},get osVersion(){if(typeof navigator>"u")return 0;var o=navigator.userAgent,u="";/(?:iPhone)|(?:iPad|PlayBook)/.test(o)?u=VERSION_REG.ios:u=VERSION_REG.android;var r=u?u.exec(o):[];if(r&&r.length>=3){var t=r[2].split(".");return t.length>0?parseInt(t[0]):0}return 0},get isWeixin(){if(typeof navigator>"u")return!1;var o=/(micromessenger)\/([\d.]+)/,u=o.exec(navigator.userAgent.toLocaleLowerCase());return!!u},isSupportMP4:function o(){var u={isSupport:!1,mime:""};if(typeof document>"u")return u;if(this.supportResult)return this.supportResult;var r=document.createElement("video");return typeof r.canPlayType=="function"&&H264_MIMETYPES.map(function(t){r.canPlayType('video/mp4; codecs="'.concat(t,'"'))==="probably"&&(u.isSupport=!0,u.mime+="||".concat(t))}),this.supportResult=u,r=null,u},isMSESupport:function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(u)}catch(r){return this._logger.error(u,r),!1}},isHevcSupported:function o(){return typeof MediaSource>"u"||!MediaSource.isTypeSupported?!1:MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function o(u){var r={supported:!1,smooth:!1,powerEfficient:!1};if(!u||typeof navigator>"u")return Promise.resolve(r);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(u);var t=u.video||{},e=u.audio||{};try{var i=MediaSource.isTypeSupported(t.contentType),n=MediaSource.isTypeSupported(e.contentType);return Promise.resolve({supported:i&&n,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(r)}}},version="3.0.20",ERROR_TYPE_MAP={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},ERROR_MAP={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},Errors=_createClass$3(function o(u){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};_classCallCheck$3(this,o);var t=u&&u.i18n?u.i18n.ERROR_TYPES:null;if(u.media){var e=r.mediaError?r.mediaError:u.media.error||{},i=u.duration,n=u.currentTime,s=u.ended,a=u.src,l=u.currentSrc,c=u.media,f=c.readyState,h=c.networkState,p=r.errorCode||e.code;ERROR_MAP[p]&&(p=ERROR_MAP[p]);var d={playerVersion:version,currentTime:n,duration:i,ended:s,readyState:f,networkState:h,src:a||l,errorType:r.errorType,errorCode:p,message:r.errorMessage||e.message,mediaError:e,originError:r.originError?r.originError.stack:"",host:util.getHostFromUrl(a||l)};return r.ext&&Object.keys(r.ext).map(function(m){d[m]=r.ext[m]}),d}else if(arguments.length>1){for(var v={playerVersion:version,domain:document.domain},g=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],y=0;y<arguments.length;y++)v[g[y]]=arguments[y];return v.ex=t?(t[arguments[0]]||{}).msg:"",v}}),PLAY="play",PLAYING="playing",ENDED="ended",PAUSE="pause",ERROR="error",SEEKING="seeking",SEEKED="seeked",TIME_UPDATE="timeupdate",WAITING="waiting",CANPLAY="canplay",CANPLAY_THROUGH="canplaythrough",DURATION_CHANGE="durationchange",VOLUME_CHANGE="volumechange",LOADED_DATA="loadeddata",LOADED_METADATA="loadedmetadata",RATE_CHANGE="ratechange",PROGRESS="progress",LOAD_START="loadstart",EMPTIED="emptied",STALLED="stalled",SUSPEND="suspend",ABORT="abort",BUFFER_CHANGE="bufferedChange",PLAYER_FOCUS="focus",PLAYER_BLUR="blur",READY="ready",URL_NULL="urlNull",AUTOPLAY_STARTED="autoplay_started",AUTOPLAY_PREVENTED="autoplay_was_prevented",COMPLETE="complete",REPLAY="replay",DESTROY="destroy",URL_CHANGE="urlchange",DOWNLOAD_SPEED_CHANGE="download_speed_change",LEAVE_PLAYER="leaveplayer",ENTER_PLAYER="enterplayer",LOADING="loading",FULLSCREEN_CHANGE="fullscreen_change",CSS_FULLSCREEN_CHANGE="cssFullscreen_change",MINI_STATE_CHANGE="mini_state_change",DEFINITION_CHANGE="definition_change",BEFORE_DEFINITION_CHANGE="before_definition_change",AFTER_DEFINITION_CHANGE="after_definition_change",SEI_PARSED="SEI_PARSED",RETRY="retry",VIDEO_RESIZE="video_resize",PIP_CHANGE="pip_change",ROTATE="rotate",SCREEN_SHOT="screenShot",PLAYNEXT="playnext",SHORTCUT="shortcut",XGLOG="xglog",USER_ACTION="user_action",RESET="reset",SOURCE_ERROR="source_error",SOURCE_SUCCESS="source_success",SWITCH_SUBTITLE="switch_subtitle",VIDEO_EVENTS=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],STATS_EVENTS$1={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},FPS_STUCK="fps_stuck";const events=Object.freeze(Object.defineProperty({__proto__:null,ABORT,AFTER_DEFINITION_CHANGE,AUTOPLAY_PREVENTED,AUTOPLAY_STARTED,BEFORE_DEFINITION_CHANGE,BUFFER_CHANGE,CANPLAY,CANPLAY_THROUGH,COMPLETE,CSS_FULLSCREEN_CHANGE,DEFINITION_CHANGE,DESTROY,DOWNLOAD_SPEED_CHANGE,DURATION_CHANGE,EMPTIED,ENDED,ENTER_PLAYER,ERROR,FPS_STUCK,FULLSCREEN_CHANGE,LEAVE_PLAYER,LOADED_DATA,LOADED_METADATA,LOADING,LOAD_START,MINI_STATE_CHANGE,PAUSE,PIP_CHANGE,PLAY,PLAYER_BLUR,PLAYER_FOCUS,PLAYING,PLAYNEXT,PROGRESS,RATE_CHANGE,READY,REPLAY,RESET,RETRY,ROTATE,SCREEN_SHOT,SEEKED,SEEKING,SEI_PARSED,SHORTCUT,SOURCE_ERROR,SOURCE_SUCCESS,STALLED,STATS_EVENTS:STATS_EVENTS$1,SUSPEND,SWITCH_SUBTITLE,TIME_UPDATE,URL_CHANGE,URL_NULL,USER_ACTION,VIDEO_EVENTS,VIDEO_RESIZE,VOLUME_CHANGE,WAITING,XGLOG},Symbol.toStringTag,{value:"Module"}));function emitVideoEvent(o,u){!this||!this.emit||(o==="error"?this.errorHandler(o,u.error):this.emit(o,u))}function getVideoEventHandler(o,u){return function(r,t){var e={player:u,eventName:o,originalEvent:r,detail:r.detail||{},timeStamp:r.timeStamp,currentTime:u.currentTime,duration:u.duration,paused:u.paused,ended:u.ended,isInternalOp:!!u._internalOp[r.type],muted:u.muted,volume:u.volume,host:util.getHostFromUrl(u.currentSrc),vtype:u.vtype};if(u.removeInnerOP(r.type),o==="timeupdate"&&(u._currentTime=u.media&&u.media.currentTime),o==="ratechange"){var i=u.media?u.media.playbackRate:0;if(i&&u._rate===i)return;u._rate=u.media&&u.media.playbackRate}if(o==="durationchange"&&(u._duration=u.media.duration),o==="volumechange"&&(e.isMutedChange=u._lastMuted!==u.muted,u._lastMuted=u.muted),o==="error"&&(e.error=t||u.video.error),u.mediaEventMiddleware[o]){var n=emitVideoEvent.bind(u,o,e);try{u.mediaEventMiddleware[o].call(u,e,n)}catch(s){throw emitVideoEvent.call(u,o,e),s}}else emitVideoEvent.call(u,o,e)}}var MediaProxy=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;_classCallCheck$3(this,r),e=u.call(this,t),e._hasStart=!1,e._currentTime=0,e._duration=0,e._internalOp={},e._lastMuted=!1,e.vtype="MP4",e._rate=-1,e.mediaConfig=Object.assign({},{controls:!1,autoplay:t.autoplay,playsinline:t.playsinline,"x5-playsinline":t.playsinline,"webkit-playsinline":t.playsinline,"x5-video-player-fullscreen":t["x5-video-player-fullscreen"]||t.x5VideoPlayerFullscreen,"x5-video-orientation":t["x5-video-orientation"]||t.x5VideoOrientation,airplay:t.airplay,"webkit-airplay":t.airplay,tabindex:t.tabindex|0,mediaType:t.mediaType||"video","data-index":-1},t.videoConfig,t.videoAttributes);var i=t["x5-video-player-type"]||t.x5VideoPlayerType;return sniffer.isWeixin&&sniffer.os.isAndroid&&i&&(e.mediaConfig["x5-video-player-type"]=i,delete e.mediaConfig.playsinline,delete e.mediaConfig["webkit-playsinline"],delete e.mediaConfig["x5-playsinline"]),t.loop&&(e.mediaConfig.loop="loop"),t.autoplayMuted&&!Object.prototype.hasOwnProperty.call(e.mediaConfig,"muted")&&(e.mediaConfig.muted=!0),e.media=util.createDom(e.mediaConfig.mediaType,"",e.mediaConfig,""),t.defaultPlaybackRate&&(e.media.defaultPlaybackRate=e.media.playbackRate=t.defaultPlaybackRate),util.typeOf(t.volume)==="Number"&&(e.volume=t.volume),t.autoplayMuted&&(e.media.muted=!0,e._lastMuted=!0),t.autoplay&&(e.media.autoplay=!0),e._interval={},e.mediaEventMiddleware={},e.attachVideoEvents(),e}return _createClass$3(r,[{key:"setEventsMiddleware",value:function(e){var i=this;Object.keys(e).map(function(n){i.mediaEventMiddleware[n]=e[n]})}},{key:"removeEventsMiddleware",value:function(e){var i=this;Object.keys(e).map(function(n){delete i.mediaEventMiddleware[n]})}},{key:"attachVideoEvents",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers||(this._evHandlers=VIDEO_EVENTS.map(function(n){var s="on".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));return typeof e[s]=="function"&&e.on(n,e[s]),_defineProperty$3({},n,getVideoEventHandler(n,e))})),this._evHandlers.forEach(function(n){var s=Object.keys(n)[0];i.addEventListener(s,n[s],!1)})}},{key:"detachVideoEvents",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers.forEach(function(n){var s=Object.keys(n)[0];i.removeEventListener(s,n[s],!1)}),this._evHandlers.forEach(function(n){var s=Object.keys(n)[0],a="on".concat(s.charAt(0).toUpperCase()).concat(s.slice(1));typeof e[a]=="function"&&e.off(s,e[a])}),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,i){var n=this;e.removeAttribute("src"),e.load(),i.forEach(function(f,h){n.media.appendChild(util.createDom("source","",{src:"".concat(f.src),type:"".concat(f.type||""),"data-index":h+1}))});var s=e.children;if(s){this._videoSourceCount=s.length,this._videoSourceIndex=s.length,this._vLoadeddata=function(f){n.emit(SOURCE_SUCCESS,{src:f.target.currentSrc,host:util.getHostFromUrl(f.target.currentSrc)})};for(var a=null,l=0;l<this._evHandlers.length;l++)if(Object.keys(this._evHandlers[l])[0]==="error"){a=this._evHandlers[l];break}!this._sourceError&&(this._sourceError=function(f){var h=parseInt(f.target.getAttribute("data-index"),10);if(n._videoSourceIndex--,n._videoSourceIndex===0||h>=n._videoSourceCount){var p={code:4,message:"sources_load_error"};a?a.error(f,p):n.errorHandler("error",p)}var d=ERROR_TYPE_MAP[4];n.emit(SOURCE_ERROR,new Errors(n,{errorType:d,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:f.target.src}))});for(var c=0;c<s.length;c++)s[c].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var i=e.children;if(!(!i||i.length===0||!this._sourceError)){for(var n=0;n<i.length;n++)i[n].removeEventListener("error",this._sourceError);for(;i.length>0;)e.removeChild(i[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.media&&(this.media.error||i)){var n=this.media.error||i,s=n.code?ERROR_TYPE_MAP[n.code]:"other",a=n.message;this.media.currentSrc||(a="empty_src",n={code:6,message:a}),this.emit(e,new Errors(this,{errorType:s,errorCode:n.code,errorMessage:n.message||"",mediaError:n}))}}},{key:"destroy",value:function(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(var e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return this.media?this.media.canPlayType(e):!1}},{key:"getBufferedRange",value:function(e){var i=[0,0];if(!this.media)return i;e||(e=this.media.buffered);var n=this.media.currentTime;if(e)for(var s=0,a=e.length;s<a&&(i[0]=e.start(s),i[1]=e.end(s),!(i[0]<=n&&n<=i[1]));s++);return i[0]-n<=0&&n-i[1]<=0?i:[0,0]}},{key:"autoplay",get:function(){return this.media?this.media.autoplay:!1},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?util.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var i=this.media.buffered;if(!i||i.length===0)return e;for(var n=0;n<i.length;n++)if((i.start(n)<=this.currentTime||i.start(n)<.1)&&i.end(n)>=this.currentTime)return{start:i.start(n),end:i.end(n)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?this.media.currentTime!==void 0?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return this.media?this.media.defaultMuted:!1},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return this.media?this.media.ended:!1}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var i=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return i[this.media.error.code-1]}},{key:"loop",get:function(){return this.media?this.media.loop:!1},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return this.media?this.media.muted:!1},set:function(e){!this.media||this.media.muted===e||(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return this.media?this.media.paused:!0}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){!this.media||e===1/0||(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return this.media?this.media.preload:!1},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return this.media?this.media.seekable:!1}},{key:"seeking",get:function(){return this.media?this.media.seeking:!1}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){if(this.media){if(this.emit(URL_CHANGE,e),this.emit(WAITING),this._currentTime=0,this._duration=0,util.isMSE(this.media)){this.onWaiting();return}this._detachSourceEvents(this.media),util.typeOf(e)==="Array"?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()}}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e===1/0||!this.media||(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,i){for(var n,s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];(n=_get$1(_getPrototypeOf$3(r.prototype),"emit",this)).call.apply(n,[this,e,i].concat(a))}},{key:"on",value:function(e,i){for(var n,s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];(n=_get$1(_getPrototypeOf$3(r.prototype),"on",this)).call.apply(n,[this,e,i].concat(a))}},{key:"once",value:function(e,i){for(var n,s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];(n=_get$1(_getPrototypeOf$3(r.prototype),"once",this)).call.apply(n,[this,e,i].concat(a))}},{key:"off",value:function(e,i){for(var n,s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];(n=_get$1(_getPrototypeOf$3(r.prototype),"off",this)).call.apply(n,[this,e,i].concat(a))}},{key:"offAll",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"removeAllListeners",this).call(this)}}]),r}(EventEmitter),INDEXDB=function(){function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};_classCallCheck$3(this,o),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=u}return _createClass$3(o,[{key:"openDB",value:function(r){var t=this,e=this,i=this.myDB.version||1,n=e.indexedDB.open(e.myDB.name,i);n.onerror=function(s){},n.onsuccess=function(s){t.myDB.db=s.target.result,r.call(e)},n.onupgradeneeded=function(s){var a=s.target.result;s.target.transaction,a.objectStoreNames.contains(e.myDB.ojstore.name)||a.createObjectStore(e.myDB.ojstore.name,{keyPath:e.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var r=this;r.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(r,t){for(var e=this.myDB.db.transaction(r,"readwrite").objectStore(r),i,n=0;n<t.length;n++)i=e.add(t[n]),i.onerror=function(){},i.onsuccess=function(){}}},{key:"putData",value:function(r,t){for(var e=this.myDB.db.transaction(r,"readwrite").objectStore(r),i,n=0;n<t.length;n++)i=e.put(t[n]),i.onerror=function(){},i.onsuccess=function(){}}},{key:"getDataByKey",value:function(r,t,e){var i=this,n=this.myDB.db.transaction(r,"readwrite").objectStore(r),s=n.get(t);s.onerror=function(){e.call(i,null)},s.onsuccess=function(a){var l=a.target.result;e.call(i,l)}}},{key:"deleteData",value:function(r,t){var e=this.myDB.db.transaction(r,"readwrite").objectStore(r);e.delete(t)}},{key:"clearData",value:function(r){var t=this.myDB.db.transaction(r,"readwrite").objectStore(r);t.clear()}}]),o}(),FULLSCREEN_EVENTS=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],GET_FULLSCREEN_API=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],EXIT_FULLSCREEN_API=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],PLATER_ID="data-xgplayerid";function callHandler(o,u,r){for(var t=arguments.length,e=new Array(t>3?t-3:0),i=3;i<t;i++)e[i-3]=arguments[i];var n=u.call.apply(u,[o].concat(e));!r||typeof r!="function"||(n&&n.then?n.then(function(){for(var s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];r.call.apply(r,[o].concat(a))}):r.call.apply(r,[o].concat(e)))}function hook(o,u){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[o]&&(this.__hooks[o]=null),(function(){var t=arguments,e=this;if(r.pre)try{var i;(i=r.pre).call.apply(i,[this].concat(Array.prototype.slice.call(arguments)))}catch(s){throw s.message="[pluginName: ".concat(this.pluginName,":").concat(o,":pre error] >> ").concat(s.message),s}if(this.__hooks&&this.__hooks[o])try{var n=runHooks(this,o,u);n?n.then?n.then(function(s){s!==!1&&callHandler.apply(void 0,[e,u,r.next].concat(_toConsumableArray$1(t)))}).catch(function(s){throw s}):callHandler.apply(void 0,[this,u,r.next].concat(Array.prototype.slice.call(arguments))):n===void 0&&callHandler.apply(void 0,[this,u,r.next].concat(Array.prototype.slice.call(arguments)))}catch(s){throw s.message="[pluginName: ".concat(this.pluginName,":").concat(o,"] >> ").concat(s.message),s}else callHandler.apply(void 0,[this,u,r.next].concat(Array.prototype.slice.call(arguments)))}).bind(this)}function findHookIndex(o,u){var r=this.__hooks;if(!r||!Array.isArray(r[o]))return-1;for(var t=r[o],e=0;e<t.length;e++)if(t[e]===u)return e;return-1}function useHooks(o,u){var r=this.__hooks;if(r)return r.hasOwnProperty(o)?(Array.isArray(r[o])||(r[o]=[]),findHookIndex.call(this,o,u)===-1&&r[o].push(u),!0):(console.warn("has no supported hook which name [".concat(o,"]")),!1)}function removeHooks(o,u){var r=this.__hooks;if(r){if(Array.isArray(r[o])){var t=r[o],e=findHookIndex.call(this,o,u);e!==-1&&t.splice(e,1)}delete r[o]}}function usePluginHooks(o){if(!(!this.plugins||!this.plugins[o.toLowerCase()])){for(var u=this.plugins[o.toLowerCase()],r=arguments.length,t=new Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];return u.useHooks&&u.useHooks.apply(u,t)}}function removePluginHooks(o){if(!(!this.plugins||!this.plugins[o.toLowerCase()])){var u=this.plugins[o.toLowerCase()];if(u){for(var r=arguments.length,t=new Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];return u.removeHooks&&u.removeHooks.apply(u,t)}}}function hooksDescriptor(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];o.__hooks={},u&&u.map(function(r){o.__hooks[r]=null}),Object.defineProperty(o,"hooks",{get:function(){return o.__hooks&&Object.keys(o.__hooks).map(function(t){if(o.__hooks[t])return t})}})}function delHooksDescriptor(o){o.__hooks=null}function runHooks(o,u,r){for(var t=arguments.length,e=new Array(t>3?t-3:0),i=3;i<t;i++)e[i-3]=arguments[i];if(o.__hooks&&Array.isArray(o.__hooks[u])){var n=o.__hooks[u],s=-1,a=function l(c,f,h){for(var p=arguments.length,d=new Array(p>3?p-3:0),v=3;v<p;v++)d[v-3]=arguments[v];if(s++,n.length===0||s===n.length)return h.call.apply(h,[c,c].concat(d));var g=n[s],y=g.call.apply(g,[c,c].concat(d));if(y&&y.then)return y.then(function(m){return m===!1?null:l.apply(void 0,[c,f,h].concat(d))}).catch(function(m){console.warn("[runHooks]".concat(f," reject"),m.message)});if(y!==!1)return l.apply(void 0,[c,f,h].concat(d))};return a.apply(void 0,[o,u,r].concat(e))}else return r.call.apply(r,[o,o].concat(e))}function showErrorMsg(o,u){XG_DEBUG.logError("[".concat(o,"] event or callback cant be undefined or null when call ").concat(u))}var BasePlugin=function(){function o(u){_classCallCheck$3(this,o),util.checkIsFunction(this.beforeCreate)&&this.beforeCreate(u),hooksDescriptor(this),this.__args=u,this.__events={},this.__onceEvents={},this.config=u.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(u)}return _createClass$3(o,[{key:"beforeCreate",value:function(r){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(r){this.player=r.player,this.playerConfig=r.player&&r.player.config,this.pluginName=r.pluginName?r.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=r.player&&r.player.logger}},{key:"updateLang",value:function(r){r||(r=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var r=util.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&(this.playerConfig.domEventType==="touch"||this.playerConfig.domEventType==="mouse")&&(r=this.playerConfig.domEventType),r}},{key:"on",value:function(r,t){var e=this;if(!r||!t||!this.player){showErrorMsg(this.pluginName,"plugin.on(event, callback)");return}typeof r=="string"?(this.__events[r]=t,this.player.on(r,t)):Array.isArray(r)&&r.forEach(function(i){e.__events[i]=t,e.player.on(i,t)})}},{key:"once",value:function(r,t){var e=this;if(!r||!t||!this.player){showErrorMsg(this.pluginName,"plugin.once(event, callback)");return}typeof r=="string"?(this.__onceEvents[r]=t,this.player.once(r,t)):Array.isArray(r)&&r.forEach(function(i){e.__onceEvents[i]=t,e.player.once(r,t)})}},{key:"off",value:function(r,t){var e=this;if(!r||!t||!this.player){showErrorMsg(this.pluginName,"plugin.off(event, callback)");return}typeof r=="string"?(delete this.__events[r],this.player.off(r,t)):Array.isArray(r)&&r.forEach(function(i){delete e.__events[r],e.player.off(i,t)})}},{key:"offAll",value:function(){var r=this;["__events","__onceEvents"].forEach(function(t){Object.keys(r[t]).forEach(function(e){r[t][e]&&r.off(e,r[t][e]),e&&delete r[t][e]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(r){var t;if(this.player){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];(t=this.player).emit.apply(t,[r].concat(i))}}},{key:"emitUserAction",value:function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.player){var i=_objectSpread2$2(_objectSpread2$2({},e),{},{pluginName:this.pluginName});this.player.emitUserAction(r,t,i)}}},{key:"hook",value:function(r,t){return hook.call.apply(hook,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(r,t){for(var e=arguments.length,i=new Array(e>2?e-2:0),n=2;n<e;n++)i[n-2]=arguments[n];return useHooks.call.apply(useHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(r,t){for(var e=arguments.length,i=new Array(e>2?e-2:0),n=2;n<e;n++)i[n-2]=arguments[n];return removeHooks.call.apply(removeHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(this.player)return e&&(t.pluginName=e),this.player.registerPlugin({plugin:r,options:t})}},{key:"getPlugin",value:function(r){return this.player?this.player.getPlugin(r):null}},{key:"__destroy",value:function(){var r=this,t=this.player,e=this.pluginName;this.offAll(),util.clearAllTimers(this),util.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(i){r[i]=null}),t.unRegisterPlugin(e),delHooksDescriptor(this)}}],[{key:"defineGetterOrSetter",value:function(r,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(r,e,t[e])}},{key:"defineMethod",value:function(r,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&typeof t[e]=="function"&&Object.defineProperty(r,e,{configurable:!0,value:t[e]})}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),o}(),DOCUMENT_NODE_TYPE=9;if(typeof Element<"u"&&!Element.prototype.matches){var proto=Element.prototype;proto.matches=proto.matchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector||proto.webkitMatchesSelector}function closest$1(o,u){for(;o&&o.nodeType!==DOCUMENT_NODE_TYPE;){if(typeof o.matches=="function"&&o.matches(u))return o;o=o.parentNode}}var closest_1=closest$1,closest=closest_1;function _delegate(o,u,r,t,e){var i=listener.apply(this,arguments);return o.addEventListener(r,i,e),{destroy:function(){o.removeEventListener(r,i,e)}}}function delegate(o,u,r,t,e){return typeof o.addEventListener=="function"?_delegate.apply(null,arguments):typeof r=="function"?_delegate.bind(null,document).apply(null,arguments):(typeof o=="string"&&(o=document.querySelectorAll(o)),Array.prototype.map.call(o,function(i){return _delegate(i,u,r,t,e)}))}function listener(o,u,r,t){return function(e){e.delegateTarget=closest(e.target,u),e.delegateTarget&&t.call(o,e)}}var delegate_1=delegate;const _delegate$1=getDefaultExportFromCjs(delegate_1);var ROOT_TYPES={CONTROLS:"controls",ROOT:"root"},POSITIONS={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},PLUGIN_STATE_CLASS={ICON_DISABLE:"xg-icon-disable",ICON_HIDE:"xg-icon-hide"};function isUrl(o){return o?o.indexOf&&/^(?:http|data:|\/)/.test(o):!1}function mergeIconClass(o,u){return _typeof$2(o)==="object"&&o.class&&typeof o.class=="string"?"".concat(u," ").concat(o.class):u}function mergeIconAttr(o,u){return _typeof$2(o)==="object"&&o.attr&&_typeof$2(o.attr)==="object"&&Object.keys(o.attr).map(function(r){u[r]=o.attr[r]}),u}function createIcon(o,u){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",i=null;if(o instanceof window.Element)return util.addClass(o,r),Object.keys(t).map(function(n){o.setAttribute(n,t[n])}),o;if(isUrl(o)||isUrl(o.url))return t.src=isUrl(o)?o:o.url||"",i=util.createDom(o.tag||"img","",t,"xg-img ".concat(r)),i;if(typeof o=="function")try{return i=o(),i instanceof window.Element?(util.addClass(i,r),Object.keys(t).map(function(n){i.setAttribute(n,t[n])}),i):(XG_DEBUG.logWarn("warn>>icons.".concat(u," in config of plugin named [").concat(e,"] is a function mast return an Element Object")),null)}catch(n){return XG_DEBUG.logError("Plugin named [".concat(e,"]:createIcon"),n),null}return typeof o=="string"?util.createDomFromHtml(o,t,r):(XG_DEBUG.logWarn("warn>>icons.".concat(u," in config of plugin named [").concat(e,"] is invalid")),null)}function registerIconsObj(o,u){var r=u.config.icons||u.playerConfig.icons;Object.keys(o).map(function(t){var e=o[t],i=e&&e.class?e.class:"",n=e&&e.attr?e.attr:{},s=null;r&&r[t]&&(i=mergeIconClass(r[t],i),n=mergeIconAttr(r[t],n),s=createIcon(r[t],t,i,n,u.pluginName)),!s&&e&&(s=createIcon(e.icon?e.icon:e,n,i,{},u.pluginName)),u.icons[t]=s})}function registerTextObj(o,u){Object.keys(o).map(function(r){Object.defineProperty(u.langText,r,{get:function(){var e=u.lang,i=u.i18n;return i[r]?i[r]:o[r]&&o[r][e]||""}})})}var Plugin=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _classCallCheck$3(this,r),t=u.call(this,e),t.__delegates=[],t}return _createClass$3(r,[{key:"__init",value:function(e){if(_get$1(_getPrototypeOf$3(r.prototype),"__init",this).call(this,e),!!e.root){var i=e.root,n=null;this.icons={},this.root=null,this.parent=null;var s=this.registerIcons()||{};registerIconsObj(s,this),this.langText={};var a=this.registerLanguageTexts()||{};registerTextObj(a,this);var l="";try{l=this.render()}catch(h){throw XG_DEBUG.logError("Plugin:".concat(this.pluginName,":render"),h),new Error("Plugin:".concat(this.pluginName,":render:").concat(h.message))}if(l)n=r.insert(l,i,e.index),n.setAttribute("data-index",e.index);else if(e.tag)n=util.createDom(e.tag,"",e.attr,e.name),n.setAttribute("data-index",e.index),i.appendChild(n);else return;this.root=n,this.parent=i;var c=this.config.attr||{},f=this.config.style||{};this.setAttr(c),this.setStyle(f),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var i=this.children();i&&_typeof$2(i)==="object"&&Object.keys(i).length>0&&Object.keys(i).map(function(n){var s=n,a=i[s],l={root:e.root},c,f;typeof a=="function"?(c=e.config[s]||{},f=a):_typeof$2(a)==="object"&&typeof a.plugin=="function"&&(c=a.options?util.deepCopy(e.config[s]||{},a.options):e.config[s]||{},f=a.plugin),l.config=c,c.index!==void 0&&(l.index=c.index),c.root&&(l.root=c.root),e.registerPlugin(f,l,s)})}}},{key:"updateLang",value:function(e){e||(e=this.lang);function i(l,c){for(var f=0;f<l.children.length;f++)l.children[f].children.length>0?i(l.children[f],c):c(l.children[f])}var n=this.root,s=this.i18n,a=this.langText;n&&i(n,function(l){var c=l.getAttribute&&l.getAttribute("lang-key");if(c){var f=s[c.toUpperCase()]||a[c];f&&(l.innerHTML=typeof f=="function"?f(e):f)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=this.i18n||{},s=this.langText;e.setAttribute&&e.setAttribute("lang-key",i);var a=n[i]||s[i]||"";a&&(e.innerHTML=a)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,util.addClass(this.find(".xgplayer-icon"),PLUGIN_STATE_CLASS.ICON_DISABLE)}},{key:"enable",value:function(){this.config.disable=!1,util.removeClass(this.find(".xgplayer-icon"),PLUGIN_STATE_CLASS.ICON_DISABLE)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";i.root=i.root||this.root;var s=_get$1(_getPrototypeOf$3(r.prototype),"registerPlugin",this).call(this,e,i,n);return this._children.push(s),s}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,i,n){var s=this;if(arguments.length<3&&typeof i=="function")Array.isArray(e)?e.forEach(function(l){s.bindEL(l,i)}):this.bindEL(e,i);else{var a=r.delegate.call(this,this.root,e,i,n);this.__delegates=this.__delegates.concat(a)}}},{key:"unbind",value:function(e,i){var n=this;if(arguments.length<3&&typeof i=="function")Array.isArray(e)?e.forEach(function(l){n.unbindEL(l,i)}):this.unbindEL(e,i);else for(var s="".concat(e,"_").concat(i),a=0;a<this.__delegates.length;a++)if(this.__delegates[a].key===s){this.__delegates[a].destroy(),this.__delegates.splice(a,1);break}}},{key:"setStyle",value:function(e,i){var n=this;if(this.root){if(util.typeOf(e)==="String")return this.root.style[e]=i;util.typeOf(e)==="Object"&&Object.keys(e).map(function(s){n.root.style[s]=e[s]})}}},{key:"setAttr",value:function(e,i){var n=this;if(this.root){if(util.typeOf(e)==="String")return this.root.setAttribute(e,i);util.typeOf(e)==="Object"&&Object.keys(e).map(function(s){n.root.setAttribute(s,e[s])})}}},{key:"setHtml",value:function(e,i){this.root&&(this.root.innerHTML=e,typeof i=="function"&&i())}},{key:"bindEL",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof i=="function"&&this.root.addEventListener(e,i,n)}},{key:"unbindEL",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof i=="function"&&this.root.removeEventListener(e,i,n)}},{key:"show",value:function(e){if(this.root){this.root.style.display=e!==void 0?e:"block";var i=window.getComputedStyle(this.root,null),n=i.getPropertyValue("display");if(n==="none")return this.root.style.display="block"}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,i){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!i||!(i instanceof window.Element))return null;try{return typeof e=="string"?this.find(e).appendChild(i):e.appendChild(i)}catch(n){return XG_DEBUG.logError("Plugin:appendChild",n),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,i=this.player;this.__delegates.map(function(n){n.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(n){i.unRegisterPlugin(n.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),_get$1(_getPrototypeOf$3(r.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(n){e[n]=null})}}],[{key:"insert",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=i.children.length,a=Number(n),l=e instanceof window.Node;if(s){for(var c=0,f=null,h="";c<s;c++){f=i.children[c];var p=Number(f.getAttribute("data-index"));if(p>=a){h="beforebegin";break}else p<a&&(h="afterend")}return l?h==="afterend"?i.appendChild(e):i.insertBefore(e,f):f.insertAdjacentHTML(h,e),h==="afterend"?i.children[i.children.length-1]:i.children[c]}else return l?i.appendChild(e):i.insertAdjacentHTML("beforeend",e),i.children[i.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,i,n,s){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,l=[];if(e instanceof window.Node&&typeof s=="function")if(Array.isArray(n))n.forEach(function(f){var h=_delegate$1(e,i,f,s,a);h.key="".concat(i,"_").concat(f),l.push(h)});else{var c=_delegate$1(e,i,n,s,a);c.key="".concat(i,"_").concat(n),l.push(c)}return l}},{key:"ROOT_TYPES",get:function(){return ROOT_TYPES}},{key:"POSITIONS",get:function(){return POSITIONS}}]),r}(BasePlugin),ResizeObserver=function(){function o(){var u=this;if(_classCallCheck$3(this,o),_defineProperty$3(this,"__trigger",function(r){var t=new Date().getTime();u.timeStamp=t;for(var e=0;e<r.length;e++)u.__runHandler(r[e].target)}),this.__handlers=[],this.timeStamp=0,this.observer=null,!!window.ResizeObserver)try{this.observer=new window.ResizeObserver(throttle(this.__trigger,100,{trailing:!0})),this.timeStamp=new Date().getTime()}catch(r){console.error(r)}}return _createClass$3(o,[{key:"addObserver",value:function(r,t){if(this.observer){this.observer.observe(r);for(var e=r.getAttribute(PLATER_ID),i=this.__handlers,n=-1,s=0;s<i.length;s++)i[s]&&r===i[s].target&&(n=s);n>-1?this.__handlers[n].handler=t:this.__handlers.push({target:r,handler:t,playerId:e})}}},{key:"unObserver",value:function(r){var t=-1;this.__handlers.map(function(i,n){r===i.target&&(t=n)});try{var e;(e=this.observer)===null||e===void 0||e.unobserve(r)}catch{}t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){var r;(r=this.observer)===null||r===void 0||r.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(r){for(var t=this.__handlers,e=0;e<t.length;e++)if(t[e]&&r===t[e].target){try{t[e].handler(r)}catch(i){console.error(i)}return!0}return!1}}]),o}(),resizeObserver=null;function addObserver(o,u){return resizeObserver||(resizeObserver=new ResizeObserver),resizeObserver.addObserver(o,u),resizeObserver}function unObserver(o,u){var r;(r=resizeObserver)===null||r===void 0||r.unObserver(o,u)}var pluginsManager={pluginGroup:{},init:function o(u){var r=u._pluginInfoId;r||(r=new Date().getTime(),u._pluginInfoId=r),!u.config.closeResizeObserver&&addObserver(u.root,function(){u.resize()}),this.pluginGroup[r]={_originalOptions:u.config||{},_plugins:{}}},formatPluginInfo:function o(u,r){var t=null,e=null;return u.plugin&&typeof u.plugin=="function"?(t=u.plugin,e=u.options):(t=u,e={}),r&&(e.config=r||{}),{PLUFGIN:t,options:e}},checkPluginIfExits:function o(u,r){for(var t=0;t<r.length;t++)if(u.toLowerCase()===r[t].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function o(u,r){for(var t=Object.keys(r),e=null,i=0;i<t.length;i++)if(u.toLowerCase()===t[i].toLowerCase()){e=r[t[i]];break}return util.typeOf(e)==="Object"?{root:e.root,position:e.position}:{}},lazyRegister:function o(u,r){var t=this,e=r.timeout||1500;return Promise.race([r.loader().then(function(i){var n;i&&i.__esModule?n=i.default:n=i,t.register(u,n,i.options)}),new Promise(function(i,n){setTimeout(function(){n(new Error("timeout"))},e)})])},register:function o(u,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!u||!r||typeof r!="function"||r.prototype===void 0)){var e=u._pluginInfoId;if(!(!e||!this.pluginGroup[e])){this.pluginGroup[e]._plugins||(this.pluginGroup[e]._plugins={});var i=this.pluginGroup[e]._plugins,n=this.pluginGroup[e]._originalOptions;t.player=u;var s=t.pluginName||r.pluginName;if(!s)throw new Error("The property pluginName is necessary");if(r.isSupported&&!r.isSupported(u.config.mediaType,u.config.codecType)){console.warn("not supported plugin [".concat(s,"]"));return}t.config||(t.config={});for(var a=Object.keys(n),l=0;l<a.length;l++)if(s.toLowerCase()===a[l].toLowerCase()){var c=n[a[l]];util.typeOf(c)==="Object"?t.config=Object.assign({},t.config,n[a[l]]):util.typeOf(c)==="Boolean"&&(t.config.disable=!c);break}r.defaultConfig&&Object.keys(r.defaultConfig).forEach(function(h){typeof t.config[h]>"u"&&(t.config[h]=r.defaultConfig[h])}),t.root?typeof t.root=="string"&&(t.root=u[t.root]):t.root=u.root,t.index=t.config.index||0;try{i[s.toLowerCase()]&&(this.unRegister(e,s.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(s,"] exist, destroy the old instance")));var f=new r(t);return i[s.toLowerCase()]=f,i[s.toLowerCase()].func=r,f&&typeof f.afterCreate=="function"&&f.afterCreate(),f}catch(h){throw console.error(h),h}}}},unRegister:function o(u,r){u._pluginInfoId&&(u=u._pluginInfoId),r=r.toLowerCase();try{var t=this.pluginGroup[u]._plugins[r];t&&(t.pluginName&&t.__destroy(),delete this.pluginGroup[u]._plugins[r])}catch(e){console.error("[unRegister:".concat(r,"] cgid:[").concat(u,"] error"),e)}},deletePlugin:function o(u,r){var t=u._pluginInfoId;t&&this.pluginGroup[t]&&this.pluginGroup[t]._plugins&&delete this.pluginGroup[t]._plugins[r]},getPlugins:function o(u){var r=u._pluginInfoId;return r&&this.pluginGroup[r]?this.pluginGroup[r]._plugins:{}},findPlugin:function o(u,r){var t=u._pluginInfoId;if(!t||!this.pluginGroup[t])return null;var e=r.toLowerCase();return this.pluginGroup[t]._plugins[e]},beforeInit:function o(u){var r=this;function t(e){return!e||!e.then?new Promise(function(i){i()}):e}return new Promise(function(e){if(r.pluginGroup){var i;return u._loadingPlugins&&u._loadingPlugins.length?i=Promise.all(u._loadingPlugins):i=Promise.resolve(),i.then(function(){var n=u._pluginInfoId;if(!r.pluginGroup[n]){e();return}var s=r.pluginGroup[n]._plugins,a=[];Object.keys(s).forEach(function(l){if(s[l]&&s[l].beforePlayerInit)try{var c=s[l].beforePlayerInit();a.push(t(c))}catch(f){throw a.push(t(null)),f}}),Promise.all([].concat(a)).then(function(){e()}).catch(function(l){console.error(l),e()})})}})},afterInit:function o(u){var r=u._pluginInfoId;if(!(!r||!this.pluginGroup[r])){var t=this.pluginGroup[r]._plugins;Object.keys(t).forEach(function(e){t[e]&&t[e].afterPlayerInit&&t[e].afterPlayerInit()})}},setLang:function o(u,r){var t=r._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=this.pluginGroup[t]._plugins;Object.keys(e).forEach(function(i){if(e[i].updateLang)e[i].updateLang(u);else try{e[i].lang=u}catch{console.warn("".concat(i," setLang"))}})}},reRender:function o(u){var r=this,t=u._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=[],i=this.pluginGroup[t]._plugins;Object.keys(i).forEach(function(n){n!=="controls"&&i[n]&&(e.push({plugin:i[n].func,options:i[n].__args}),r.unRegister(t,n))}),e.forEach(function(n){r.register(u,n.plugin,n.options)})}},onPluginsReady:function o(u){var r=u._pluginInfoId;if(!(!r||!this.pluginGroup[r])){var t=this.pluginGroup[r]._plugins||{};Object.keys(t).forEach(function(e){t[e].onPluginsReady&&typeof t[e].onPluginsReady=="function"&&t[e].onPluginsReady()})}},destroy:function o(u){var r=u._pluginInfoId;if(this.pluginGroup[r]){unObserver(u.root);for(var t=this.pluginGroup[r]._plugins,e=0,i=Object.keys(t);e<i.length;e++){var n=i[e];this.unRegister(r,n)}delete this.pluginGroup[r],delete u._pluginInfoId}}},STATE_CLASS={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function getDefaultConfig$1(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:getLang(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var usePreset=function o(u,r){var t,e,i;r.preset&&r.options?i=new r.preset(r.options,u.config):i=new r({},u.config);var n=i,s=n.plugins,a=s===void 0?[]:s,l=n.ignores,c=l===void 0?[]:l,f=n.icons,h=f===void 0?{}:f,p=n.i18n,d=p===void 0?[]:p;u.config.plugins||(u.config.plugins=[]),u.config.ignores||(u.config.ignores=[]),(t=u.config.plugins).push.apply(t,_toConsumableArray$1(a)),(e=u.config.ignores).push.apply(e,_toConsumableArray$1(c)),Object.keys(h).map(function(g){u.config.icons[g]||(u.config.icons[g]=h[g])});var v=u.config.i18n||[];d.push.apply(d,_toConsumableArray$1(v)),u.config.i18n=d},Controls=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onMouseEnter",function(s){var a=_assertThisInitialized$3(t),l=a.player,c=a.playerConfig;c.closeControlsBlur&&l.focus({autoHide:!1})}),_defineProperty$3(_assertThisInitialized$3(t),"onMouseLeave",function(s){var a=_assertThisInitialized$3(t),l=a.player;l.focus()}),t}return _createClass$3(r,[{key:"beforeCreate",value:function(e){!e.config.mode&&sniffer.device==="mobile"&&(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,i=this.config,n=i.disable,s=i.height,a=i.mode;if(!n){a==="flex"&&this.player.addClass(STATE_CLASS.FLEX_CONTROLS);var l={height:"".concat(s,"px")};Object.keys(l).map(function(f){e.root.style[f]=l[f]}),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(MINI_STATE_CHANGE,function(f){f?util.addClass(e.root,"mini-controls"):util.removeClass(e.root,"mini-controls")});var c=this.playerConfig.isMobileSimulateMode;sniffer.device!=="mobile"&&c!=="mobile"&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&util.addClass(this.root,STATE_CLASS.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){util.removeClass(this.root,STATE_CLASS.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(this.root){var s=e.defaultConfig||{};if(!i.root){var a=i.position?i.position:i.config&&i.config.position?i.config.position:s.position;switch(a){case POSITIONS.CONTROLS_LEFT:i.root=this.left;break;case POSITIONS.CONTROLS_RIGHT:i.root=this.right;break;case POSITIONS.CONTROLS_CENTER:i.root=this.center;break;case POSITIONS.CONTROLS:i.root=this.root;break;default:i.root=this.left}return _get$1(_getPrototypeOf$3(r.prototype),"registerPlugin",this).call(this,e,i,n)}}}},{key:"destroy",value:function(){sniffer.device!=="mobile"&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,i=e.mode,n=e.autoHide,s=e.initShow,a=e.disable;if(!a){var l=util.classNames({"xgplayer-controls":!0},{"flex-controls":i==="flex"},{"bottom-controls":i==="bottom"},_defineProperty$3({},STATE_CLASS.CONTROLS_AUTOHIDE,n),{"xgplayer-controls-initshow":s||!n});return'<xg-controls class="'.concat(l,`" unselectable="on">
    <xg-inner-controls class="xg-inner-controls xg-pos">
      <xg-left-grid class="xg-left-grid">
      </xg-left-grid>
      <xg-center-grid class="xg-center-grid"></xg-center-grid>
      <xg-right-grid class="xg-right-grid">
      </xg-right-grid>
    </xg-inner-controls>
    </xg-controls>`)}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),r}(Plugin),EN={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},XGI18nLang={lang:{},langKeys:[],textKeys:[]};function deepMerge(o,u){return Object.keys(u).forEach(function(r){var t=util.typeOf(u[r]),e=util.typeOf(o[r]);if(t==="Array"){var i;e!=="Array"&&(o[r]=[]),(i=o[r]).push.apply(i,_toConsumableArray$1(u[r]))}else t==="Object"?(e!=="Object"&&(o[r]={}),deepMerge(o[r],u[r])):o[r]=u[r]}),o}function updateKeys(){Object.keys(XGI18nLang.lang.en).map(function(o){XGI18nLang.textKeys[o]=o})}function extend(o,u){var r=[];if(u||(u=XGI18nLang),!!u.lang){util.typeOf(o)!=="Array"?r=Object.keys(o).map(function(i){var n=i==="zh"?"zh-cn":i;return{LANG:n,TEXT:o[i]}}):r=o;var t=u,e=t.lang;r.map(function(i){i.LANG==="zh"&&(i.LANG="zh-cn"),e[i.LANG]?deepMerge(e[i.LANG]||{},i.TEXT||{}):use(i,u)}),updateKeys()}}function use(o,u){var r=o.LANG;if(u||(u=XGI18nLang),!!u.lang){var t=o.TEXT||{};r==="zh"&&(r="zh-cn"),u.lang[r]?deepMerge(u.lang[r],t):(u.langKeys.push(r),u.lang[r]=t),updateKeys()}}function init(o){var u,r={lang:{},langKeys:[],textKeys:{},pId:o};return deepMerge(r.lang,XGI18nLang.lang),(u=r.langKeys).push.apply(u,_toConsumableArray$1(XGI18nLang.langKeys)),deepMerge(r.textKeys,XGI18nLang.textKeys),r}use(EN);var I18N={get textKeys(){return XGI18nLang.textKeys},get langKeys(){return XGI18nLang.langKeys},get lang(){var o={};return XGI18nLang.langKeys.map(function(u){o[u]=XGI18nLang.lang[u]}),XGI18nLang.lang["zh-cn"]&&(o.zh=XGI18nLang.lang["zh-cn"]||{}),o},extend,use,init},STATES={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},STATE_ARRAY=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],store={},instance=null,InstManager=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"add",value:function(e){e&&(store[e.playerId]=e,Object.keys(store).length===1&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete store[e.playerId])}},{key:"_iterate",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var n in store)if(Object.prototype.hasOwnProperty.call(store,n)){var s=store[n];if(i){if(e(s))break}else e(s)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var i=null;return this._iterate(function(n){var s=e(n);return s&&(i=n),s},!0),i}},{key:"findAll",value:function(e){var i=[];return this._iterate(function(n){e(n)&&i.push(n)}),i}},{key:"setActive",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(store[e])return i?this.forEach(function(n){e===n.playerId?(n.isUserActive=!0,n.isInstNext=!1):n.isUserActive=!1}):store[e].isUserActive=i,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(store),i=0;i<e.length;i++){var n=store[e[i]];if(n&&n.isUserActive)return e[i]}return null}},{key:"setNext",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(store[e])return i?this.forEach(function(n){e===n.playerId?(n.isUserActive=!1,n.isInstNext=!0):n.isInstNext=!1}):store[e].isInstNext=i,e}}],[{key:"getInstance",value:function(){return instance||(instance=new r),instance}}]),r}(eventemitter3Exports.EventEmitter);function checkPlayerRoot(o){for(var u=Object.keys(store),r=0;r<u.length;r++){var t=store[u[r]];if(t.root===o)return t}return null}var PlAYER_HOOKS=["play","pause","replay","retry"],REAL_TIME_SPEED=0,AVG_SPEED=0,instManager=null,Player=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;_classCallCheck$3(this,r);var i=util.deepMerge(getDefaultConfig$1(),t);e=u.call(this,i),_defineProperty$3(_assertThisInitialized$3(e),"canPlayFunc",function(){if(e.config){var d=e.config,v=d.autoplay,g=d.defaultPlaybackRate;XG_DEBUG.logInfo("player","canPlayFunc, startTime",e.__startTime),e._seekToStartTime(),e.playbackRate=g,(v||e._useAutoplay)&&e.mediaPlay(),e.off(CANPLAY,e.canPlayFunc),e.removeClass(STATE_CLASS.ENTER)}}),_defineProperty$3(_assertThisInitialized$3(e),"onFullscreenChange",function(d,v){var g=function(){util.setTimeout(_assertThisInitialized$3(e),function(){e.resize()},100)},y=util.getFullScreenEl();e._fullActionFrom?e._fullActionFrom="":e.emit(USER_ACTION,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var m=checkIsCurrentVideo(y,e.playerId,PLATER_ID);if(v||y&&(y===e._fullscreenEl||m))g(),!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,y,STATE_CLASS.FULLSCREEN),e.emit(FULLSCREEN_CHANGE,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){g();var S=_assertThisInitialized$3(e),_=S._fullScreenOffset,A=S.config;if(A.needFullscreenScroll?(window.scrollTo(_.left,_.top),util.setTimeout(_assertThisInitialized$3(e),function(){e.fullscreen=!1,e._fullScreenOffset=null},100)):(!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen)e.removeClass(STATE_CLASS.FULLSCREEN);else{var k=e._fullscreenEl;!k&&(e.root.contains(d.target)||d.target===e.root)&&(k=d.target),e.recoverFullStyle(e.root,k,STATE_CLASS.FULLSCREEN)}e._fullscreenEl=null,e.emit(FULLSCREEN_CHANGE,!1)}}),_defineProperty$3(_assertThisInitialized$3(e),"_onWebkitbeginfullscreen",function(d){e._fullscreenEl=e.media,e.onFullscreenChange(d,!0)}),_defineProperty$3(_assertThisInitialized$3(e),"_onWebkitendfullscreen",function(d){e.onFullscreenChange(d,!1)}),hooksDescriptor(_assertThisInitialized$3(e),PlAYER_HOOKS),e.config=i,e._pluginInfoId=util.generateSessionId(),bindDebug(_assertThisInitialized$3(e));var n=e.constructor.defaultPreset;if(e.config.presets.length){var s=e.config.presets.indexOf("default");s>=0&&n&&(e.config.presets[s]=n)}else n&&e.config.presets.push(n);e.userTimer=null,e.waitTimer=null,e.handleSource=!0,e._state=STATES.INITIAL,e.isAd=!1,e.isError=!1,e._hasStart=!1,e.isSeeking=!1,e.isCanplay=!1,e._useAutoplay=!1,e.__startTime=-1,e.rotateDeg=0,e.isActive=!1,e.fullscreen=!1,e.cssfullscreen=!1,e.isRotateFullscreen=!1,e._fullscreenEl=null,e.timeSegments=[],e._cssfullscreenEl=null,e.curDefinition=null,e._orgCss="",e._fullScreenOffset=null,e._videoHeight=0,e._videoWidth=0,e.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},e.sizeInfo={width:0,height:0,left:0,top:0},e._accPlayed={t:0,acc:0,loopAcc:0},e._offsetInfo={currentTime:-1,duration:0},e.innerContainer=null,e.controls=null,e.topBar=null,e.root=null,e.__i18n=I18N.init(e._pluginInfoId),sniffer.os.isAndroid&&sniffer.osVersion>0&&sniffer.osVersion<6&&(e.config.autoplay=!1),e.database=new INDEXDB,e.isUserActive=!1,e._onceSeekCanplay=null,e._isPauseBeforeSeek=0,e.innerStates={isActiveLocked:!1},e.instManager=instManager;var a=e._initDOM();if(!a)return console.error(new Error("can't find the dom which id is ".concat(e.config.id," or this.config.el does not exist"))),_possibleConstructorReturn$3(e);var l=e.config,c=l.definition,f=c===void 0?{}:c,h=l.url;if(!h&&f.list&&f.list.length>0){var p=f.list.find(function(d){return d.definition&&d.definition===f.defaultDefinition});p||(f.defaultDefinition=f.list[0].definition,p=f.list[0]),e.config.url=p.url,e.curDefinition=p}return e._bindEvents(),e._registerPresets(),e._registerPlugins(),pluginsManager.onPluginsReady(_assertThisInitialized$3(e)),e.getInitDefinition(),e.setState(STATES.READY),util.setTimeout(_assertThisInitialized$3(e),function(){e.emit(READY)},0),e.onReady&&e.onReady(),(e.config.videoInit||e.config.autoplay)&&(!e.hasStart||e.state<STATES.ATTACHED)&&e.start(),e}return _createClass$3(r,[{key:"_initDOM",value:function(){var e,i=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var n=this.config.el;if(n&&n.nodeType===1)this.root=n;else return this.emit(ERROR,new Errors("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1}var s=checkPlayerRoot(this.root);s&&(XG_DEBUG.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),s.destroy()),this.root.setAttribute(PLATER_ID,this.playerId),(e=instManager)===null||e===void 0||e.add(this),pluginsManager.init(this),this._initBaseDoms();var a=this.constructor.XgVideoProxy;if(a&&this.mediaConfig.mediaType===a.mediaType){var l=this.innerContainer||this.root;this.detachVideoEvents(this.media);var c=new a(l,this.config,this.mediaConfig);this.attachVideoEvents(c),this.media=c}if(this.media.setAttribute(PLATER_ID,this.playerId),this.config.controls){var f=this.config.controls.root||null,h=pluginsManager.register(this,Controls,{root:f});this.controls=h}var p=this.config.isMobileSimulateMode==="mobile"?"mobile":sniffer.device;if(this.addClass("".concat(STATE_CLASS.DEFAULT," ").concat(STATE_CLASS.INACTIVE," xgplayer-").concat(p," ").concat(this.config.controls?"":STATE_CLASS.NO_CONTROLS)),this.config.autoplay?this.addClass(STATE_CLASS.ENTER):this.addClass(STATE_CLASS.NO_START),this.config.fluid){var d=this.config,v=d.width,g=d.height;(typeof v!="number"||typeof g!="number")&&(v=600,g=337.5);var y={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(g*100/v,"%")};Object.keys(y).forEach(function(w){i.root.style[w]=y[w]})}else["width","height"].forEach(function(w){i.config[w]&&(typeof i.config[w]!="number"?i.root.style[w]=i.config[w]:i.root.style[w]="".concat(i.config[w],"px"))});var m=this.root.getBoundingClientRect(),S=m.width,_=m.height,A=m.left,k=m.top;return this.sizeInfo.width=S,this.sizeInfo.height=_,this.sizeInfo.left=A,this.sizeInfo.top=k,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=util.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach(function(i){e.on(i,e["on"+i.charAt(0).toUpperCase()+i.slice(1)])}),FULLSCREEN_EVENTS.forEach(function(i){document&&document.addEventListener(i,e.onFullscreenChange)}),sniffer.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(LOADED_DATA,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(PLAY,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),FULLSCREEN_EVENTS.forEach(function(i){document.removeEventListener(i,e.onFullscreenChange)}),this.playFunc&&this.off(PLAY,this.playFunc),this.off(CANPLAY,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(util.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var i=this;if(this.media&&!((!e||e===""||util.typeOf(e)==="Array"&&e.length===0)&&(e="",this.emit(URL_NULL),XG_DEBUG.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),util.typeOf(e)==="Array"&&e.length>0?this._attachSourceEvents(this.media,e):!this.media.src||this.media.src!==e?this.media.src=e:e||this.media.removeAttribute("src")),util.typeOf(this.config.volume)==="Number"&&(this.volume=this.config.volume);var n=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!n.contains(this.media)&&n.insertBefore(this.media,n.firstChild);var s=this.media.readyState;XG_DEBUG.logInfo("_startInit readyState",s),this.config.autoplay&&(!util.isMSE(this.media)&&this.load(),(sniffer.os.isIpad||sniffer.os.isPhone)&&this.mediaPlay());var a=this.config.startTime;this.__startTime=a>0?a:-1,this.config.startTime=0,s>=2&&this.duration>0?this.canPlayFunc():this.on(CANPLAY,this.canPlayFunc),(!this.hasStart||this.state<STATES.ATTACHED)&&pluginsManager.afterInit(this),this.hasStart=!0,this.setState(STATES.ATTACHED),util.setTimeout(this,function(){i.emit(COMPLETE)},0)}}},{key:"_registerPlugins",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._loadingPlugins=[];var n=this.config.ignores||[],s=this.config.plugins||[],a=this.config.i18n||[];i&&I18N.extend(a,this.__i18n);var l=n.join("||").toLowerCase().split("||"),c=this.plugins;s.forEach(function(f){try{var h=f.plugin?f.plugin.pluginName:f.pluginName;if(h&&l.indexOf(h.toLowerCase())>-1)return null;if(!i&&c[h.toLowerCase()])return;if(f.lazy&&f.loader){var p=pluginsManager.lazyRegister(e,f);f.forceBeforeInit&&(p.then(function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(p),1)}).catch(function(d){XG_DEBUG.logError("_registerPlugins:loadingPlugin",d),e._loadingPlugins.splice(e._loadingPlugins.indexOf(p),1)}),e._loadingPlugins.push(p));return}return e.registerPlugin(f)}catch(d){XG_DEBUG.logError("_registerPlugins:",d)}})}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach(function(i){usePreset(e,i)})}},{key:"_getRootByPosition",value:function(e){var i=null;switch(e){case POSITIONS.ROOT_RIGHT:this.rightBar||(this.rightBar=util.createPositionBar("xg-right-bar",this.root)),i=this.rightBar;break;case POSITIONS.ROOT_LEFT:this.leftBar||(this.leftBar=util.createPositionBar("xg-left-bar",this.root)),i=this.leftBar;break;case POSITIONS.ROOT_TOP:this.topBar||(this.topBar=util.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&util.addClass(this.topBar,STATE_CLASS.TOP_BAR_AUTOHIDE)),i=this.topBar;break;default:i=this.innerContainer||this.root;break}return i}},{key:"registerPlugin",value:function(e,i){var n=pluginsManager.formatPluginInfo(e,i),s=n.PLUFGIN,a=n.options,l=this.config.plugins,c=pluginsManager.checkPluginIfExits(s.pluginName,l);!c&&l.push(s);var f=pluginsManager.getRootByConfig(s.pluginName,this.config);f.root&&(a.root=f.root),f.position&&(a.position=f.position);var h=a.position?a.position:a.config&&a.config.position||s.defaultConfig&&s.defaultConfig.position;if(!a.root&&typeof h=="string"&&h.indexOf("controls")>-1){var p;return(p=this.controls)===null||p===void 0?void 0:p.registerPlugin(s,a,s.pluginName)}return a.root||(a.root=this._getRootByPosition(h)),pluginsManager.register(this,s,a)}},{key:"deregister",value:function(e){typeof e=="string"?pluginsManager.unRegister(this,e):e instanceof BasePlugin&&pluginsManager.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.deregister(e),i&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var i;if(typeof e=="string"?i=e:e instanceof BasePlugin&&(i=e.pluginName),!!i)for(var n=this.config.plugins.length-1;n>-1;n--){var s=this.config.plugins[n];if(s.pluginName.toLowerCase()===i.toLowerCase()){this.config.plugins.splice(n,1);break}}}},{key:"plugins",get:function(){return pluginsManager.getPlugins(this)}},{key:"getPlugin",value:function(e){var i=pluginsManager.findPlugin(this,e);return i&&i.pluginName?i:null}},{key:"addClass",value:function(e){this.root&&(util.hasClass(this.root,e)||util.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&util.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return util.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,i){this.root&&this.root.setAttribute(e,i)}},{key:"removeAttribute",value:function(e,i){this.root&&this.root.removeAttribute(e,i)}},{key:"start",value:function(e){var i=this;if(!(this.state>STATES.ATTACHING))return!e&&!this.config.url&&this.getInitDefinition(),this.hasStart=!0,this.setState(STATES.ATTACHING),this._registerPlugins(!1),pluginsManager.beforeInit(this).then(function(){if(i.config){e||(e=i.url||i.config.url);var n=i._preProcessUrl(e),s=i._startInit(n.url);return s}}).catch(function(n){throw n.fileName="player",n.lineNumber="236",XG_DEBUG.logError("start:beforeInit:",n),n})}},{key:"switchURL",value:function(e,i){var n=this,s=e;util.typeOf(e)==="Object"&&(s=e.url),s=this._preProcessUrl(s).url;var a=this.currentTime;this.__startTime=a;var l=this.paused&&!this.isError;return this.src=s,new Promise(function(c,f){var h=function(v){n.off("timeupdate",p),n.off("canplay",p),f(v)},p=function(){n._seekToStartTime(),l&&n.pause(),n.off("error",h),c(!0)};if(n.once("error",h),!s){n.errorHandler("error",{code:6,message:"empty_src"});return}sniffer.os.isAndroid?n.once("timeupdate",p):n.once("canplay",p),n.play()})}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<STATES.ATTACHED){this.removeClass(STATE_CLASS.NO_START),this.addClass(STATE_CLASS.ENTER),this.start(),this._useAutoplay=!0;return}this.state<STATES.RUNNING&&(this.removeClass(STATE_CLASS.NO_START),!this.isCanplay&&this.addClass(STATE_CLASS.ENTER));var i=_get$1(_getPrototypeOf$3(r.prototype),"play",this).call(this);return i!==void 0&&i&&i.then?i.then(function(){e.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),e.addClass(STATE_CLASS.PLAYING),e.state<STATES.RUNNING&&(XG_DEBUG.logInfo(">>>>playPromise.then"),e.setState(STATES.RUNNING),e.emit(AUTOPLAY_STARTED))}).catch(function(n){if(XG_DEBUG.logWarn(">>>>playPromise.catch",n.name),e.media&&e.media.error){e.onError(),e.removeClass(STATE_CLASS.ENTER);return}n.name==="NotAllowedError"&&(e._errorTimer=util.setTimeout(e,function(){e._errorTimer=null,e.emit(AUTOPLAY_PREVENTED),e.addClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),e.removeClass(STATE_CLASS.ENTER),e.pause(),e.setState(STATES.NOTALLOW)},0))}):(XG_DEBUG.logWarn("video.play not return promise"),this.state<STATES.RUNNING&&(this.setState(STATES.RUNNING),this.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),this.removeClass(STATE_CLASS.NO_START),this.removeClass(STATE_CLASS.ENTER),this.addClass(STATE_CLASS.PLAYING),this.emit(AUTOPLAY_STARTED))),i}},{key:"mediaPause",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(STATE_CLASS.PAUSED),runHooks(this,"play",function(){return e.mediaPlay()})}},{key:"pause",value:function(){var e=this;runHooks(this,"pause",function(){_get$1(_getPrototypeOf$3(r.prototype),"pause",e).call(e)})}},{key:"seek",value:function(e,i){var n=this;if(!(!this.media||Number.isNaN(Number(e))||!this.hasStart)){var s=this.config,a=s.isSeekedPlay,l=s.seekedStatus,c=i||(a?"play":l);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(SEEKED,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(n.removeClass(STATE_CLASS.ENTER),n.isSeeking=!1,c){case"play":n.play();break;case"pause":n.pause();break;default:n._isPauseBeforeSeek>1||n.paused?n.pause():n.play()}n._isPauseBeforeSeek=0,n._onceSeekCanplay=null},this.once(SEEKED,this._onceSeekCanplay),this.state<STATES.RUNNING?(this.removeClass(STATE_CLASS.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,i=this.config,n=i.definition,s=i.url;!s&&n&&n.list&&n.list.length>0&&n.defaultDefinition&&n.list.map(function(a){a.definition===n.defaultDefinition&&(e.config.url=a.url,e.curDefinition=a)})}},{key:"changeDefinition",value:function(e,i){var n=this,s=this.config.definition;if(Array.isArray(s==null?void 0:s.list)&&s.list.forEach(function(l){(e==null?void 0:e.definition)===l.definition&&(n.curDefinition=l)}),e!=null&&e.bitrate&&typeof e.bitrate!="number"&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(DEFINITION_CHANGE,{from:i,to:e}),!this.hasStart){this.config.url=e.url;return}var a=this.switchURL(e.url,_objectSpread2$2({seamless:s.seamless!==!1&&typeof MediaSource<"u"&&typeof MediaSource.isTypeSupported=="function"},e));a&&a.then?a.then(function(){n.emit(AFTER_DEFINITION_CHANGE,{from:i,to:e})}):this.emit(AFTER_DEFINITION_CHANGE,{from:i,to:e})}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(LOADED_DATA,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,i=STATE_CLASS.NOT_ALLOW_AUTOPLAY,n=STATE_CLASS.PLAYING,s=STATE_CLASS.NO_START,a=STATE_CLASS.PAUSED,l=STATE_CLASS.REPLAY,c=STATE_CLASS.ENTER,f=STATE_CLASS.ENDED,h=STATE_CLASS.ERROR,p=STATE_CLASS.LOADING,d=[i,n,s,a,l,c,f,h,p];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,d.forEach(function(v){e.removeClass(v)}),this.addClass(STATE_CLASS.NO_START),this.emit(RESET)}},{key:"reset",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;this.resetState();var s=this.plugins;if(s&&(i.map(function(l){e.deregister(l)}),n)){var a=getDefaultConfig$1();Object.keys(this.config).keys(function(l){e.config[l]!=="undefined"&&(l==="plugins"||l==="presets"||l==="el"||l==="id")&&(e.config[l]=a[l])})}}},{key:"destroy",value:function(){var e,i=this,n=this.innerContainer,s=this.root,a=this.media;if(!(!s||!a)){if(this.hasStart=!1,this._useAutoplay=!1,s.removeAttribute(PLATER_ID),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),util.clearAllTimers(this),this.emit(DESTROY),(e=instManager)===null||e===void 0||e.remove(this),pluginsManager.destroy(this),delHooksDescriptor(this),_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),n)for(var l=n.children,c=0;c<l.length;c++)n.removeChild(l[c]);!n&&a instanceof window.Node&&s.contains(a)&&s.removeChild(a),["topBar","leftBar","rightBar","innerContainer"].map(function(h){i[h]&&s.removeChild(i[h]),i[h]=null});var f=s.className.split(" ");f.length>0?s.className=f.filter(function(h){return h.indexOf("xgplayer")<0}).join(" "):s.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach(function(h){i[h]=!1})}}},{key:"replay",value:function(){var e=this;this.removeClass(STATE_CLASS.ENDED),this.currentTime=0,this.isSeeking=!1,runHooks(this,"replay",function(){e.once(SEEKED,function(){var i=e.mediaPlay();i&&i.catch&&i.catch(function(n){console.log(n)})}),e.emit(REPLAY),e.onPlay()})}},{key:"retry",value:function(){var e=this;this.removeClass(STATE_CLASS.ERROR),this.addClass(STATE_CLASS.LOADING),runHooks(this,"retry",function(){var i=e.currentTime,n=e.config.url,s=util.isMSE(e.media)?{url:n}:e._preProcessUrl(n);e.src=s.url,!e.config.isLive&&(e.currentTime=i),e.once(CANPLAY,function(){e.mediaPlay()})})}},{key:"changeFullStyle",value:function(e,i,n,s){e&&(s||(s=STATE_CLASS.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=util.filterStyleFromText(e)),util.addClass(e,n),i&&i!==e&&!this._orgPCss&&(this._orgPCss=util.filterStyleFromText(i),util.addClass(i,s),i.setAttribute(PLATER_ID,this.playerId)))}},{key:"recoverFullStyle",value:function(e,i,n,s){s||(s=STATE_CLASS.PARENT_FULLSCREEN),this._orgCss&&(util.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),util.removeClass(e,n),i&&i!==e&&this._orgPCss&&(util.setStyleFromCsstext(i,this._orgPCss),this._orgPCss="",util.removeClass(i,s),i.removeAttribute(PLATER_ID))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget,i=this.root,n=this.media;(e==="video"||e==="media")&&(e=this[e]),e||(e=i),this._fullScreenOffset={top:util.scrollTop(),left:util.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var s=util.getFullScreenEl();if(s===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var a=0;a<GET_FULLSCREEN_API.length;a++){var l=GET_FULLSCREEN_API[a];if(e[l]){var c=l==="webkitRequestFullscreen"?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[l]();return c&&c.then?c:Promise.resolve()}}return n.fullscreenEnabled||n.webkitSupportsFullscreen?(n.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch{return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!(!this._fullscreenEl&&!util.getFullScreenEl())){this.root;var i=this.media;this._fullActionFrom="exit";try{for(var n=0;n<EXIT_FULLSCREEN_API.length;n++){var s=EXIT_FULLSCREEN_API[n];if(document[s]){var a=document[s]();return a&&a.then?a:Promise.resolve()}}return i&&i.webkitSupportsFullscreen?(i.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch{return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var i=e?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.CSS_FULLSCREEN):STATE_CLASS.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,i);var n=this.config.fullscreen,s=n===void 0?{}:n,a=s.useCssFullscreen===!0||typeof s.useCssFullscreen=="function"&&s.useCssFullscreen();a&&(this.fullscreen=!0,this.emit(FULLSCREEN_CHANGE,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(CSS_FULLSCREEN_CHANGE,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.CSS_FULLSCREEN):STATE_CLASS.CSS_FULLSCREEN;if(!this.fullscreen)this.recoverFullStyle(this.root,this._cssfullscreenEl,e);else{var i=this.config.fullscreen,n=i===void 0?{}:i,s=n.useCssFullscreen===!0||typeof n.useCssFullscreen=="function"&&n.useCssFullscreen();s?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(FULLSCREEN_CHANGE,!1)):this.removeClass(e)}this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(CSS_FULLSCREEN_CHANGE,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var i=e?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.ROTATE_FULLSCREEN):STATE_CLASS.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,i,STATE_CLASS.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(FULLSCREEN_CHANGE,!0)}},{key:"exitRotateFullscreen",value:function(e){var i=this._fullscreenEl!==this.root?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.ROTATE_FULLSCREEN):STATE_CLASS.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,i,STATE_CLASS.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(FULLSCREEN_CHANGE,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){window.orientation===90||window.orientation===-90?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};if(this.isActive){this.onFocus(e);return}this.emit(PLAYER_FOCUS,_objectSpread2$2({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{ignorePaused:!1};if(!this.isActive){this.onBlur(e);return}this._clearUserTimer(),this.emit(PLAYER_BLUR,_objectSpread2$2({paused:this.paused,ended:this.ended},e))}},{key:"onFocus",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!0,delay:3e3},n=this.innerStates;if(this.isActive=!0,this.removeClass(STATE_CLASS.INACTIVE),this._clearUserTimer(),i.isLock!==void 0&&(n.isActiveLocked=i.isLock),i.autoHide===!1||i.isLock===!0||n.isActiveLocked){this._clearUserTimer();return}var s=i&&i.delay?i.delay:this.config.inactive;this.userTimer=util.setTimeout(this,function(){e.userTimer=null,e.blur()},s)}},{key:"onBlur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=e.ignorePaused,n=i===void 0?!1:i;if(!this.innerStates.isActiveLocked){var s=this.config.closePauseVideoFocus;this.isActive=!1,(n||s||!this.paused&&!this.ended)&&this.addClass(STATE_CLASS.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(STATE_CLASS.ENTER),this.removeClass(STATE_CLASS.ERROR),this.removeClass(STATE_CLASS.LOADING),this.isCanplay=!0,this.waitTimer&&util.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var e=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once(DURATION_CHANGE,function(){e._seekToStartTime()}))}},{key:"onLoadstart",value:function(){this.removeClass(STATE_CLASS.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===STATES.ENDED&&this.setState(STATES.RUNNING),this.removeClass(STATE_CLASS.PAUSED),this.ended&&this.removeClass(STATE_CLASS.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(STATE_CLASS.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(STATE_CLASS.ENDED),this.setState(STATES.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),this.removeClass(STATE_CLASS.NO_START),this.removeClass(STATE_CLASS.ENTER),this.removeClass(STATE_CLASS.LOADING),this.addClass(STATE_CLASS.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(STATE_CLASS.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&util.clearTimeout(this,this.waitTimer),this.removeClass(STATE_CLASS.LOADING),this.removeClass(STATE_CLASS.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&util.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=util.setTimeout(this,function(){e.addClass(STATE_CLASS.LOADING),e.emit(LOADING),util.clearTimeout(e,e.waitTimer),e.waitTimer=null},this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var i=STATE_CLASS.NO_START,n=STATE_CLASS.PAUSED,s=STATE_CLASS.ENDED,a=STATE_CLASS.ERROR,l=STATE_CLASS.REPLAY,c=STATE_CLASS.LOADING,f=[i,n,s,a,l,c];f.forEach(function(h){e.removeClass(h)}),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(STATE_CLASS.LOADING))&&this.media.readyState>2&&(this.removeClass(STATE_CLASS.LOADING),util.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===STATES.NOTALLOW&&this.duration&&(this.setState(STATES.RUNNING),this.emit(AUTOPLAY_STARTED)),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onVolumechange",value:function(){util.typeOf(this.config.volume)==="Number"&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,i,n){if(!(!this.media||!i||!e)){var s=util.typeOf(e)==="String"?e:e.type||"";n.props&&util.typeOf(n.props)!=="Array"&&(n.props=[n.props]),this.emit(USER_ACTION,_objectSpread2$2({eventType:s,action:i,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},n))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var i=new Date().getTime()-this._accPlayed.t;this._accPlayed.acc+=i,this._accPlayed.t=0,(e==="ended"||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{startDiff:0,endDiff:0},n=i||{},s=n.startDiff,a=s===void 0?0:s,l=n.endDiff,c=l===void 0?0:l,f=this.media.buffered;if(!f||f.length===0||!this.duration)return!0;for(var h=e||this.media.currentTime||.2,p=f.length,d=0;d<p;d++)if(f.start(d)+a<=h&&f.end(d)-c>h)return!0;return!1}},{key:"resizePosition",value:function(){var e=this.videoPos,i=e.vy,n=e.vx,s=e.h,a=e.w,l=this.videoPos.rotate;if(!(l<0&&s<0&&a<0)){var c=this.videoPos._pi;if(!c&&this.media.videoHeight&&(c=this.media.videoWidth/this.media.videoHeight*100),!!c){this.videoPos.pi=c,l=l<0?0:l;var f={rotate:l},h=0,p=0,d=1,v=Math.abs(l/90),g=this.root,y=this.innerContainer,m=g.offsetWidth,S=y?y.offsetHeight:g.offsetHeight,_=S,A=m;if(v%2===0)d=s>0?100/s:a>0?100/a:1,f.scale=d,h=i>0?(100-s)/2-i:0,f.y=v===2?0-h:h,p=n>0?(100-a)/2-n:0,f.x=v===2?0-p:p,this.media.style.width="".concat(A,"px"),this.media.style.height="".concat(_,"px");else if(v%2===1){A=S,_=m;var k=S-m;p=-k/2/A*100,f.x=v===3?p+i/2:p-i/2,h=k/2/_*100,f.y=v===3?h+n/2:h-n/2,f.scale=d,this.media.style.width="".concat(A,"px"),this.media.style.height="".concat(_,"px")}var w=util.getTransformStyle(f,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=w,this.media.style.webkitTransform=w}}}},{key:"position",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{h:0,y:0,x:0,w:0};if(!(!this.media||!e||!e.h)){var i=this.videoPos;i.h=e.h*100||0,i.w=e.w*100||0,i.vx=e.x*100||0,i.vy=e.y*100||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var i=this;e&&Object.keys(e).map(function(n){if(n!=="plugins"){i.config[n]=e[n];var s=i.plugins[n.toLowerCase()];s&&util.typeOf(s.setConfig)==="Function"&&s.setConfig(e[n])}})}},{key:"playNext",value:function(e){var i=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,runHooks(this,"playnext",function(){i.start(),i.emit(PLAYNEXT,e)})}},{key:"resize",value:function(){var e=this;if(this.media){var i=this.root.getBoundingClientRect();this.sizeInfo.width=i.width,this.sizeInfo.height=i.height,this.sizeInfo.left=i.left,this.sizeInfo.top=i.top;var n=this.media,s=n.videoWidth,a=n.videoHeight,l=this.config,c=l.fitVideoSize,f=l.videoFillMode;if((f==="fill"||f==="cover"||f==="contain")&&this.setAttribute("data-xgfill",f),!(!a||!s)){this._videoHeight=a,this._videoWidth=s;var h=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,p=i.width,d=i.height-h,v=parseInt(s/a*1e3,10),g=parseInt(p/d*1e3,10),y=p,m=d,S={};c==="auto"&&g>v||c==="fixWidth"?(m=p/v*1e3,this.config.fluid?S.paddingTop="".concat(m*100/y,"%"):S.height="".concat(m+h,"px")):(c==="auto"&&g<v||c==="fixHeight")&&(y=v*d/1e3,S.width="".concat(y,"px")),!this.fullscreen&&!this.cssfullscreen&&Object.keys(S).forEach(function(A){e.root.style[A]=S[A]}),(f==="fillHeight"&&g<v||f==="fillWidth"&&g>v)&&this.setAttribute("data-xgfill","cover");var _={videoScale:v,vWidth:y,vHeight:m,cWidth:y,cHeight:m+h};this.resizePosition(),this.emit(VIDEO_RESIZE,_)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this.media.updateObjectPosition){this.media.updateObjectPosition(e,i);return}this.media.style.objectPosition="".concat(e*100,"% ").concat(i*100,"%")}},{key:"setState",value:function(e){XG_DEBUG.logInfo("setState","state from:".concat(STATE_ARRAY[this.state]," to:").concat(STATE_ARRAY[e])),this._state=e}},{key:"_preProcessUrl",value:function(e,i){var n=this.config,s=n.preProcessUrl,a=n.preProcessUrlOptions,l=Object.assign({},a,i);return!util.isBlob(e)&&typeof s=="function"?s(e,l):{url:e}}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){typeof e=="boolean"&&(this._hasStart=e,e===!1&&this.setState(STATES.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===STATES.RUNNING||this._state===STATES.ENDED},set:function(e){e?this.setState(STATES.RUNNING):this._state>=STATES.RUNNING&&this.setState(STATES.ATTACHED)}},{key:"definitionList",get:function(){return!this.config||!this.config.definition?[]:this.config.definition.list||[]},set:function(e){var i=this,n=this.config.definition,s=null,a=null;n.list=e,this.emit("resourceReady",e),e.forEach(function(l){var c;((c=i.curDefinition)===null||c===void 0?void 0:c.definition)===l.definition&&(s=l),n.defaultDefinition===l.definition&&(a=l)}),!a&&e.length>0&&(a=e[0]),s?this.changeDefinition(s):a&&this.changeDefinition(a)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var i=this.media.getVideoPlaybackQuality();return e.dropped=i.droppedVideoFrames||0,e.total=i.totalVideoFrames||0,e.corrupted=i.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var i=I18N.langKeys.filter(function(n){return n===e});if(i.length===0&&e!=="zh"){console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(I18N.langKeys.join(),"] "));return}this.config.lang=e,pluginsManager.setLang(e,this)}},{key:"i18n",get:function(){var e=this.config.lang;return e==="zh"&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return version}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return _get$1(_getPrototypeOf$3(r.prototype),"readyState",this)}},{key:"error",get:function(){var e=_get$1(_getPrototypeOf$3(r.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return _get$1(_getPrototypeOf$3(r.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return this._fullScreenOffset!==null}},{key:"cumulateTime",get:function(){var e=this._accPlayed,i=e.acc,n=e.t;return n?new Date().getTime()-n+i:i}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=util.convertDeg(e),!(e%90!==0||e===this.videoPos.rotate)&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return AVG_SPEED},set:function(e){AVG_SPEED=e}},{key:"realTimeSpeed",get:function(){return REAL_TIME_SPEED},set:function(e){REAL_TIME_SPEED=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,i){return hook.call.apply(hook,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,i){return useHooks.call.apply(useHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,i){return removeHooks.call.apply(removeHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,i,n){for(var s=arguments.length,a=new Array(s>3?s-3:0),l=3;l<s;l++)a[l-3]=arguments[l];return usePluginHooks.call.apply(usePluginHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,i,n){for(var s=arguments.length,a=new Array(s>3?s-3:0),l=3;l<s;l++)a[l-3]=arguments[l];return removePluginHooks.call.apply(removePluginHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,i){var n;typeof i=="boolean"&&i!==this.muted&&(this.addInnerOP("volumechange"),util.typeOf(i)===Boolean&&(this.muted=i)),(n=instManager)===null||n===void 0||n.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return XG_DEBUG.config.debug},set:function(e){XG_DEBUG.config.debug=e}},{key:"instManager",get:function(){return instManager},set:function(e){instManager=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return(e=instManager)===null||e===void 0?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,i){var n;(n=instManager)===null||n===void 0||n.setActive(e,i)}},{key:"isHevcSupported",value:function(){return sniffer.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return sniffer.probeConfigSupported(e)}},{key:"install",value:function(e,i){r.plugins||(r.plugins={}),r.plugins[e]||(r.plugins[e]=i)}},{key:"use",value:function(e,i){r.plugins||(r.plugins={}),r.plugins[e]=i}}]),r}(MediaProxy);_defineProperty$3(Player,"defaultPreset",null);_defineProperty$3(Player,"XgVideoProxy",null);Player.instManager=InstManager.getInstance();function now(){return new Date().getTime()}var LOG_TYPES={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},XGLogger=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"_onTimeupdate",function(){t._state.isTimeUpdate=!0,t._state.autoplayStart&&(XG_DEBUG.logInfo("[xgLogger]".concat(t.player.playerId," _onTimeupdate")),t._sendFF("onTimeupdate"))}),_defineProperty$3(_assertThisInitialized$3(t),"_onAutoplayStart",function(){XG_DEBUG.logInfo("[xgLogger]".concat(t.player.playerId," _onAutoplayStart")),t._state.autoplayStart=!0,t.vt&&t._sendFF("onAutoplayStart")}),_defineProperty$3(_assertThisInitialized$3(t),"_onReset",function(){t._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},t.vt=0,t.pt=0,t.fvt=0,t.newPointTime=now(),t.loadedCostTime=0,t.startCostTime=0,t._isSeeking=!1,t.seekingStart=0,t.waitingStart=0,t.fixedWaitingStart=0,t._isWaiting=!1,t._waitTimer&&util.clearTimeout(_assertThisInitialized$3(t),t._waitTimer),t._waittTimer&&util.clearTimeout(_assertThisInitialized$3(t),t._waittTimer),t._waitTimer=null,t._waittTimer=null,t._waitType=0}),_defineProperty$3(_assertThisInitialized$3(t),"_onSeeking",function(){t.seekingStart||(t.suspendWaitingStatus("seek"),t.seekingStart=now(),t.emitLog(LOG_TYPES.SEEK_START,{start:now()}))}),_defineProperty$3(_assertThisInitialized$3(t),"_onSeeked",function(){t.suspendSeekingStatus("seeked")}),_defineProperty$3(_assertThisInitialized$3(t),"_onWaitingLoadStart",function(){t._isWaiting||t.vt||(t._isWaiting=!0,t.waitingStart=now(),t.fixedWaitingStart=now(),t._waitType=1,t.emitLog(LOG_TYPES.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:1,endType:"loadstart"}))}),_defineProperty$3(_assertThisInitialized$3(t),"_onWaiting",function(){t._isWaiting||!t.vt||(t._isWaiting=!0,t.vt?t.seekingStart?t._waitType=2:t._waitType=0:t._waitType=1,t.fixedWaitingStart=now(),t._waitTimer=util.setTimeout(_assertThisInitialized$3(t),function(){t._isWaiting&&(t.waitingStart=now(),util.clearTimeout(_assertThisInitialized$3(t),t._waitTimer),t._waitTimer=null,t._startWaitTimeout(),t.emitLog(LOG_TYPES.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:t._waitType,endType:t._waitType===2?"seek":"playing"}))},200))}),_defineProperty$3(_assertThisInitialized$3(t),"_onError",function(){t.suspendSeekingStatus("error"),t.suspendWaitingStatus("error")}),_defineProperty$3(_assertThisInitialized$3(t),"_onPlaying",function(){t._isWaiting&&t.suspendWaitingStatus("playing")}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=now(),this.loadedCostTime=0,this.startCostTime=0,this.on(LOAD_START,function(){var i=e._state,n=i.autoplayStart,s=i.isFFSend;e.startCostTime=now()-e.newPointTime,XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(n," isFFSend:").concat(s," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),!s&&(!i.isLs&&e.emitLog(LOG_TYPES.LOAD_START,{}),i.isLs=!0,i.isTimeUpdate=!1,i.isFFLoading=!0,e.pt=now(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())}),this.on(LOADED_DATA,function(){e.vt=now(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var i=e._state,n=i.isTimeUpdate,s=i.isFFSend,a=i.autoplayStart;XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(n||a)&&e._sendFF("loadedData"),s||e.emitLog(LOG_TYPES.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")}),this.on(SEEKING,this._onSeeking),this.on(SEEKED,this._onSeeked),this.on(DESTROY,function(){e.endState("destroy")}),this.on(URL_CHANGE,function(){e.endState("urlChange"),XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()}),this.on([PLAYING,CANPLAY],this._onPlaying),this.on(WAITING,this._onWaiting),this.on(ERROR,this._onError),this.on(RESET,function(){XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()})}},{key:"_initOnceEvents",value:function(){this.off(AUTOPLAY_STARTED,this._onAutoplayStart),this.off(TIME_UPDATE,this._onTimeupdate),this.once(AUTOPLAY_STARTED,this._onAutoplayStart),this.once(TIME_UPDATE,this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=now();var i=this._state,n=i.isFFLoading,s=i.isFFSend;XG_DEBUG.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(n," !isFFSend:").concat(!s)),this.vt>0&&n&&!s&&(XG_DEBUG.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(LOG_TYPES.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&util.clearTimeout(this,this._waittTimer),this._waittTimer=util.setTimeout(this,function(){e.suspendWaitingStatus("timeout"),util.clearTimeout(e,e._waittTimer),e._waittTimer=null},this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var i=now(),n=i-this.seekingStart;this.seekingStart=0,this.emitLog(LOG_TYPES.SEEK_END,{end:i,costTime:n,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(util.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(util.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,!!this.waitingStart){var i=now(),n=i-this.waitingStart,s=i-this.fixedWaitingStart,a=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(LOG_TYPES.WAIT_END,{fixedCostTime:s>a?a:s,costTime:n>a?a:n,type:e==="loadeddata"?1:this._waitType,endType:this._waitType===2?"seek":e})}}},{key:"emitLog",value:function(e,i){var n=this.player;this.emit(XGLOG,_objectSpread2$2({t:now(),host:util.getHostFromUrl(n.currentSrc),vtype:n.vtype,eventType:e,currentTime:this.player.currentTime,readyState:n.video.readyState,networkState:n.video.networkState},i))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),r}(Plugin);function ReplaySvg(){return new DOMParser().parseFromString(`<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">
  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>
</svg>
`,"image/svg+xml").firstChild}var Replay=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"registerIcons",value:function(){return{replay:ReplaySvg}}},{key:"afterCreate",value:function(){var e=this;Plugin.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",function(){e.player.replay()},{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(ENDED,function(){if(e.playerConfig.loop||util.addClass(e.player.root,"replay"),!e.config.disable){e.show();var i=e.root.querySelector("path");if(i){var n=window.getComputedStyle(i).getPropertyValue("transform");if(typeof n=="string"&&n.indexOf("none")>-1)return null;i.setAttribute("transform",n)}}}),this.on(PLAY,function(){e.hide()})}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),util.removeClass(this.player.root,"replay")}},{key:"show",value:function(e){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return`<xg-replay class="xgplayer-replay">
      <xg-replay-txt class="xgplayer-replay-txt" lang-key="`.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,`</xg-replay-txt>
    </xg-replay>`)}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),r}(Plugin),Poster=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){util.addClass(this.root,"hide")}},{key:"show",value:function(e){util.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){typeof e.player.config.poster=="string"&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(ENDED,function(){e.isEndedShow&&util.removeClass(e.root,"hide")}),this.config.hideCanplay?(this.once(TIME_UPDATE,function(){e.onTimeUpdate()}),this.on(URL_CHANGE,function(){util.removeClass(e.root,"hide"),util.addClass(e.root,"xg-showplay"),e.once(TIME_UPDATE,function(){e.onTimeUpdate()})})):this.on(PLAY,function(){util.addClass(e.root,"hide")})}},{key:"setConfig",value:function(e){var i=this;Object.keys(e).forEach(function(s){i.config[s]=e[s]});var n=this.config.poster;this.update(n)}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?util.removeClass(this.root,"xg-showplay"):this.once(TIME_UPDATE,function(){e.onTimeUpdate()})}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"getBgSize",value:function(e){var i="";switch(e){case"cover":i="cover";break;case"contain":i="contain";break;case"fixHeight":i="auto 100%";break;default:i=""}return i?"background-size: ".concat(i,";"):""}},{key:"render",value:function(){var e=this.config,i=e.poster,n=e.hideCanplay,s=e.fillMode,a=e.notHidden,l=this.getBgSize(s),c=i?"background-image:url(".concat(i,");").concat(l):l,f=a?"xg-not-hidden":n?"xg-showplay":"";return'<xg-poster class="xgplayer-poster '.concat(f,'" style="').concat(c,`">
    </xg-poster>`)}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),r}(Plugin);function PlaySvg(){return new DOMParser().parseFromString(`<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>
</svg>
`,"image/svg+xml").firstChild}function PauseSvg(){return new DOMParser().parseFromString(`<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>
</svg>
`,"image/svg+xml").firstChild}var AnimateMap={};function addAnimate(o,u){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{start:null,end:null};return AnimateMap[o]&&window.clearTimeout(AnimateMap[o].id),AnimateMap[o]={},r.start&&r.start(),AnimateMap[o].id=window.setTimeout(function(){r.end&&r.end(),window.clearTimeout(AnimateMap[o].id),delete AnimateMap[o]},u),AnimateMap[o].id}function clearAnimation(o){if(o){window.clearTimeout(o);return}Object.keys(AnimateMap).map(function(u){window.clearTimeout(AnimateMap[u].id),delete AnimateMap[u]})}var Start=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"onPlayerReset",function(){e.autoPlayStart=!1;var i=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),util.removeClass(e.root,i),e.show()}),_defineProperty$3(_assertThisInitialized$3(e),"onAutoplayStart",function(){if(!e.autoPlayStart){var i=e.config.mode==="auto"?"auto-hide":"hide";util.addClass(e.root,i),e.autoPlayStart=!0,e.toggleTo("play")}}),e.autoPlayStart=!1,e}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this.playerConfig;this.initIcons(),this.listenEvents(),this.bindClickEvents(),e.autoplay||this.show()}},{key:"listenEvents",value:function(){var e=this,i=this.player,n=this.playerConfig;this.once(READY,function(){n&&(n.lang&&n.lang==="en"?util.addClass(i.root,"lang-is-en"):n.lang==="jp"&&util.addClass(i.root,"lang-is-jp"))}),this.on(AUTOPLAY_STARTED,this.onAutoplayStart),this.on(AUTOPLAY_PREVENTED,function(){var s=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),util.removeClass(e.root,s),e.show()}),this.on(PLAY,function(){e.toggleTo("play")}),this.on(PAUSE,function(){e.toggleTo("pause")}),this.on(RESET,function(){e.onPlayerReset()})}},{key:"bindClickEvents",value:function(){var e=this;this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(n){n.cancelable&&n.preventDefault(),n.stopPropagation();var s=e.player.paused;e.emitUserAction(n,"switch_play_pause",{props:"paused",from:s,to:!s})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:PlaySvg,class:"xg-icon-play"},startPause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){util.addClass(this.root,"hide")}},{key:"show",value:function(e){util.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){util.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){util.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var i=this;this._animateId=addAnimate("pauseplay",400,{start:function(){util.addClass(i.root,"interact"),i.show(),i.switchStatus(!0)},end:function(){util.removeClass(i.root,"interact"),!e&&i.hide(),i._animateId=null}})}},{key:"endAnimate",value:function(){util.removeClass(this.root,"interact"),clearAnimation(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(e){var i=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(i.state<STATES.READY)){var n=this.player.paused;!n&&i.state===STATES.RUNNING?i.pause():i.play()}}},{key:"onPlayPause",value:function(e){this.toggleTo(e)}},{key:"toggleTo",value:function(e){var i=this.config,n=this.player;if(!(!n||n.state<STATES.RUNNING||!this.autoPlayStart)){if(i.mode==="show"){this.switchStatus(),this.show();return}if(i.mode==="auto"){this.switchStatus();return}if(i.isShowPause&&n.paused&&!n.ended||i.isShowEnd&&n.ended){this.switchStatus(),this.show(),this.endAnimate();return}if(i.disableAnimate){this.switchStatus(),this.hide();return}if(e==="play")this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||n.ended)return;this.animate()}}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),clearAnimation(this._animateId)}},{key:"render",value:function(){var e=this.playerConfig.autoplay?this.config.mode==="auto"?"auto-hide":"hide":"";return`
    <xg-start class="xgplayer-start `.concat(e,`">
    <xg-start-inner></xg-start-inner>
    </xg-start>`)}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),r}(Plugin),Enter=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"render",value:function(){var e=this.config.innerHtml,i=util.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)i.appendChild(e);else if(e&&typeof e=="string")i.innerHTML=e;else{for(var n="",s=1;s<=12;s++)n+='<div class="xgplayer-enter-bar'.concat(s,'"></div>');i.innerHTML='<div class="xgplayer-enter-spinner">'.concat(n,"</div>")}return i}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),r}(Plugin);function xgIconTips(o,u,r){try{return' <div class="xg-tips '.concat(r?"hide":" ",'" lang-key="').concat(o.i18nKeys[u],`">
    `).concat(o.i18n[u],`
    </div>`)}catch{return'<div class="xg-tips hide"></div>'}}var MiniScreenIcon=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return`
      <xg-icon class="xgplayer-miniicon">
      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="`.concat(this.i18nKeys[e],'">').concat(this.i18n[e],`</span></div>
      </xg-icon>`)}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:10}}}]),r}(Plugin);function getStyleSize(o){var u=parseFloat(o),r=o.indexOf("%")===-1&&!Number.isNaN(u);return r&&u}var measurements=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],measurementsLength=measurements.length;function getZeroSize(){for(var o={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},u=0;u<measurementsLength;u++){var r=measurements[u];o[r]=0}return o}function getStyle(o){var u=window.getComputedStyle(o);return u}function getSize(o){if(typeof o=="string"&&(o=document.querySelector(o)),!(!o||_typeof$2(o)!=="object"||!o.nodeType)){var u=getStyle(o);if(u.display==="none")return getZeroSize();var r={};r.width=o.offsetWidth,r.height=o.offsetHeight;for(var t=r.isBorderBox=u.boxSizing==="border-box",e=0;e<measurementsLength;e++){var i=measurements[e],n=u[i],s=parseFloat(n);r[i]=Number.isNaN(s)?0:s}var a=r.paddingLeft+r.paddingRight,l=r.paddingTop+r.paddingBottom,c=r.marginLeft+r.marginRight,f=r.marginTop+r.marginBottom,h=r.borderLeftWidth+r.borderRightWidth,p=r.borderTopWidth+r.borderBottomWidth,d=t,v=getStyleSize(u.width);v!==!1&&(r.width=v+(d?0:a+h));var g=getStyleSize(u.height);return g!==!1&&(r.height=g+(d?0:l+p)),r.innerWidth=r.width-(a+h),r.innerHeight=r.height-(l+p),r.outerWidth=r.width+c,r.outerHeight=r.height+f,r}}function getTouch$1(o,u){for(var r=0;r<o.length;r++){var t=o[r];if(t.identifier===u)return t}}var EVENTS$1={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},POST_START_EVENTS={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Draggabilly=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _classCallCheck$3(this,r),e=u.call(this),e.isEnabled=!0,e.isDragging=!1,e.isDown=!1,e.position={},e.downPoint={},e.dragPoint={x:0,y:0},e.startPos={x:0,y:0},e._root=t instanceof Element?t:document.querySelector(t),e._handlerDom=i.handle instanceof Element?i.handle:document.querySelector(i.handle),!e._root||!e._handlerDom?_possibleConstructorReturn$3(e):(e._bindStartEvent(),e)}return _createClass$3(r,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),POST_START_EVENTS[this._startKey].map(function(i){e["on".concat(i)]=e["on".concat(i)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var i=this;if(e){var n=POST_START_EVENTS[this._startKey];n.map(function(s){window.addEventListener(s,i["on".concat(s)])}),this._boundPointerEvents=n}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map(function(i){window.removeEventListener(i,e["on".concat(i)])}),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame(function(){e.animate()}))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var i=e.changedTouches[0];this.dragStart(e,i),this.touchIdentifier=i.pointerId!==void 0?i.pointerId:i.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var i=getTouch$1(e.changedTouches,this.touchIdentifier);i&&this.dragMove(e,i)}},{key:"ontouchend",value:function(e){var i=getTouch$1(e.changedTouches,this.touchIdentifier);i&&this.dragEnd(e,i),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var i=getTouch$1(e.changedTouches,this.touchIdentifier);i&&this.dragCancel(e,i)}},{key:"dragStart",value:function(e,i){if(!(!this._root||this.isDown||!this.isEnabled)){this.downPoint=i,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var n=getSize(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-n.height,this.startPos.maxX=window.innerWidth-n.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,i){this.isDragging=!0,this.animate(),this.emit(EVENTS$1.START,this.startPos)}},{key:"dragEnd",value:function(e,i){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(EVENTS$1.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,i){var n={x:i.pageX-this.downPoint.pageX,y:i.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this.dragRealStart(e,i),n}},{key:"dragMove",value:function(e,i){if(e=e||window.event,!!this.isDown){var n=this.startPos,s=n.x,a=n.y,l=this._dragPointerMove(e,i),c=l.x,f=l.y;c=this.checkContain("x",c,s),f=this.checkContain("y",f,a),this.position.x=s+c,this.position.y=a+f,this.dragPoint.x=c,this.dragPoint.y=f,this.emit(EVENTS$1.MOVE,this.position)}}},{key:"dragCancel",value:function(e,i){this.dragEnd(e,i)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,i,n){return i+n<0?0-n:e==="x"&&i+n>this.startPos.maxX?this.startPos.maxX-n:e==="y"&&i+n>this.startPos.maxY?this.startPos.maxY-n:i}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),i=this._getPositionCoord(e.left,"width"),n=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(i)?0:i,this.position.y=Number.isNaN(n)?0:n,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var i=e.transform;if(i.indexOf("matrix")===0){var n=i.split(","),s=i.indexOf("matrix3d")===0?12:4,a=parseInt(n[s],10),l=parseInt(n[s+1],10);this.position.x+=a,this.position.y+=l}}},{key:"_getPositionCoord",value:function(e,i){if(e.indexOf("%")!==-1){var n=getSize(this._root.parentNode);return n?parseFloat(e)/100*n[i]:0}return parseInt(e,10)}}]),r}(EventEmitter),MiniScreen=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;_classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"onCancelClick",function(s){e.exitMini(),e.isClose=!0}),_defineProperty$3(_assertThisInitialized$3(e),"onCenterClick",function(s){var a=_assertThisInitialized$3(e),l=a.player;l.paused?l.play():l.pause()}),_defineProperty$3(_assertThisInitialized$3(e),"onScroll",function(s){if(!(!window.scrollY&&window.scrollY!==0||Math.abs(window.scrollY-e.pos.scrollY)<50)){var a=parseInt(util.getCss(e.player.root,"height"));a+=e.config.scrollTop,e.pos.scrollY=window.scrollY,window.scrollY>a+5?!e.isMini&&!e.isClose&&e.getMini():window.scrollY<=a&&(e.isMini&&e.exitMini(),e.isClose=!1)}}),e.isMini=!1,e.isClose=!1;var i=_assertThisInitialized$3(e),n=i.config;return e.pos={left:n.left<0?window.innerWidth-n.width-20:n.left,top:n.top<0?window.innerHeight-n.height-20:n.top,height:e.config.height,width:e.config.width,scrollY:window.scrollY||0},e.lastStyle=null,e}return _createClass$3(r,[{key:"beforeCreate",value:function(e){typeof e.player.config.mini=="boolean"&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(PAUSE,function(){e.setAttr("data-state","pause")}),this.on(PLAY,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,i=this.player,n=this.config;if(!n.disable){if(this.config.isShowIcon){var s={config:{onClick:function(){e.getMini()}}};i.controls.registerPlugin(MiniScreenIcon,s,MiniScreenIcon.pluginName)}var a=util.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",a,this.onCancelClick),this.bind(".play-icon",a,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Draggabilly(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:PlaySvg,class:"xg-icon-play"},pause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var i=this.player,n=this.playerConfig,s=this.config.target||this.player.root;this.lastStyle={},util.addClass(i.root,"xgplayer-mini"),["width","height","top","left"].map(function(a){e.lastStyle[a]=s.style[a],s.style[a]="".concat(e.pos[a],"px")}),n.fluid&&(s.style["padding-top"]=""),this.emit(MINI_STATE_CHANGE,!0),i.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var i=this.player,n=this.playerConfig,s=this.config.target||this.player.root;util.removeClass(i.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(a){s.style[a]=e.lastStyle[a]}),this.lastStyle=null,n.fluid&&(i.root.style.width="100%",i.root.style.height="0",i.root.style["padding-top"]="".concat(n.height*100/n.width,"%")),this.emit(MINI_STATE_CHANGE,!1),this.isMini=i.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=util.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return`
      <xg-mini-layer class="xg-mini-layer">
      <xg-mini-header class="xgplayer-mini-header">
      `.concat(xgIconTips(this,"MINI_DRAG",this.playerConfig.isHideTips),`
      </xg-mini-header>
      <div class="mini-cancel-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>
        </svg>
      </div>
      <div class="play-icon">
      </div>
      </xg-mini-layer>`)}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),r}(Plugin),MOUSE_EVENTS={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},HOOKS$1=["videoClick","videoDbClick"],PCPlugin=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onMouseMove",function(s){var a=_assertThisInitialized$3(t),l=a.player,c=a.playerConfig;l.isActive||(l.focus({autoHide:!c.closeDelayBlur}),!c.closeFocusVideoFocus&&l.media.focus())}),_defineProperty$3(_assertThisInitialized$3(t),"onMouseEnter",function(s){var a=_assertThisInitialized$3(t),l=a.playerConfig,c=a.player;!l.closeFocusVideoFocus&&c.media.focus(),l.closeDelayBlur?c.focus({autoHide:!1}):c.focus(),t.emit(ENTER_PLAYER)}),_defineProperty$3(_assertThisInitialized$3(t),"onMouseLeave",function(s){var a=t.playerConfig,l=a.closePlayerBlur,c=a.leavePlayerTime,f=a.closeDelayBlur;!l&&!f&&(c?t.player.focus({autoHide:!0,delay:c}):t.player.blur({ignorePaused:!0})),t.emit(LEAVE_PLAYER)}),_defineProperty$3(_assertThisInitialized$3(t),"onVideoClick",function(s){var a=_assertThisInitialized$3(t),l=a.player,c=a.playerConfig;s.target&&c.closeVideoClick||(s.target===l.root||s.target===l.media||s.target===l.innerContainer||s.target===l.media.__canvas)&&(s.preventDefault(),c.closeVideoStopPropagation||s.stopPropagation(),t._clickCount++,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),t.clickTimer=setTimeout(function(){t._clickCount&&(t._clickCount--,runHooks(_assertThisInitialized$3(t),HOOKS$1[0],function(f,h){t.switchPlayPause(h.e)},{e:s,paused:l.paused}),clearTimeout(t.clickTimer),t.clickTimer=null)},300))}),_defineProperty$3(_assertThisInitialized$3(t),"onVideoDblClick",function(s){var a=_assertThisInitialized$3(t),l=a.player,c=a.playerConfig;if(!(c.closeVideoDblclick||!s.target||s.target!==l.media&&s.target!==l.media.__canvas)){if(!c.closeVideoClick&&t._clickCount<2){t._clickCount=0;return}t._clickCount=0,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),s.preventDefault(),s.stopPropagation(),runHooks(_assertThisInitialized$3(t),HOOKS$1[1],function(f,h){t.emitUserAction(h.e,"switch_fullscreen",{props:"fullscreen",from:l.fullscreen,to:!l.fullscreen}),l.fullscreen?l.exitFullscreen():l.getFullscreen()},{e:s,fullscreen:l.fullscreen})}}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,HOOKS$1.map(function(n){e.__hooks[n]=null});var i=this.playerConfig.isMobileSimulateMode;i==="mobile"||sniffer.device==="mobile"&&!sniffer.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,i=this.player,n=i.media,s=i.root,a=this.playerConfig.enableContextmenu;s&&s.addEventListener("click",this.onVideoClick,!1),s&&s.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(MOUSE_EVENTS).map(function(l){s.addEventListener(l,e[MOUSE_EVENTS[l]],!1)}),!a&&n&&n.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var i=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:i.paused,to:!i.paused}),i.ended?i.duration!==1/0&&i.duration>0&&i.replay():i.paused?i.play():i.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,i=this.player,n=i.video,s=i.root;this.clickTimer&&clearTimeout(this.clickTimer),s.removeEventListener("click",this.onVideoClick,!1),s.removeEventListener("dblclick",this.onVideoDblClick,!1),n.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(MOUSE_EVENTS).map(function(a){s.removeEventListener(a,e[MOUSE_EVENTS[a]],!1)})}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),r}(BasePlugin),EVENTS={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},TOUCHS={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},MOUSES={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function getTouch(o){return o&&o.length>0?o[o.length-1]:null}function getDefaultConfig(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var Touche=function(){function o(u){var r=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{eventType:"touch"};_classCallCheck$3(this,o),_defineProperty$3(this,"onTouchStart",function(e){var i=r._pos,n=r.root,s=getTouch(e.touches);i.x=s?parseInt(s.pageX,10):e.pageX,i.y=s?parseInt(s.pageX,10):e.pageX,i.start=!0,r.__setPress(e),n.addEventListener(r.events.end,r.onTouchEnd),n.addEventListener(r.events.cancel,r.onTouchCancel),n.addEventListener(r.events.move,r.onTouchMove),r.trigger(EVENTS.TOUCH_START,e)}),_defineProperty$3(this,"onTouchCancel",function(e){r.onTouchEnd(e)}),_defineProperty$3(this,"onTouchEnd",function(e){var i=r._pos,n=r.root;r.__clearPress(),n.removeEventListener(r.events.cancel,r.onTouchCancel),n.removeEventListener(r.events.end,r.onTouchEnd),n.removeEventListener(r.events.move,r.onTouchMove),e.moving=i.moving,e.press=i.press,i.press&&r.trigger(EVENTS.PRESS_END,e),r.trigger(EVENTS.TOUCH_END,e),!i.press&&!i.moving&&r.__setDb(e),i.press=!1,i.start=!1,i.moving=!1}),_defineProperty$3(this,"onTouchMove",function(e){var i=r._pos,n=r.config,s=getTouch(e.touches),a=s?parseInt(s.pageX,10):e.pageX,l=s?parseInt(s.pageY,10):e.pageX,c=a-i.x,f=l-i.y;Math.abs(f)<n.miniStep&&Math.abs(c)<n.miniStep||(r.__clearPress(),i.press&&r.trigger(EVENTS.PRESS_END,e),i.press=!1,i.moving=!0,r.trigger(EVENTS.TOUCH_MOVE,e))}),this._pos={moving:!1,start:!1,x:0,y:0},this.config=getDefaultConfig(),Object.keys(t).map(function(e){r.config[e]=t[e]}),this.root=u,this.events=t.eventType==="mouse"?MOUSES:TOUCHS,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return _createClass$3(o,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(r){var t=this,e=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout(function(){t.trigger(EVENTS.PRESS,r),t._pos.press=!0,t.__clearPress()},e.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(r){var t=this,e=this.config;if(this.dbIntrvalId){this.__clearDb(),this.trigger(EVENTS.DOUBlE_CLICK,r);return}this.dbIntrvalId=setTimeout(function(){t.__clearDb(),!t._pos.start&&!t._pos.press&&!t._pos.moving&&t.trigger(EVENTS.CLICK,r)},e.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(r,t){this.__handlers[r]||(this.__handlers[r]=[]),this.__handlers[r].push(t)}},{key:"off",value:function(r,t){if(this.__handlers[r]){for(var e=this.__handlers[r],i=-1,n=0;n<e.length;n++)if(e[n]===t){i=n;break}i>=0&&this.__handlers[r].splice(i,1)}}},{key:"trigger",value:function(r,t){this.__handlers[r]&&this.__handlers[r].map(function(e){try{e(t)}catch(i){console.error("trigger>>:".concat(r),i)}})}},{key:"destroy",value:function(){var r=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).forEach(function(e){r.root.removeEventListener(e,r[t[e]])})}}]),o}();function SeekTipIcon(){return new DOMParser().parseFromString(`<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path opacity="0.54"
    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"
    fill="white" />
  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>
</svg>`,"image/svg+xml").firstChild}var ACTIONS={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},HOOKS=["videoClick","videoDbClick"],MobilePlugin=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"onTouchStart",function(i){var n=_assertThisInitialized$3(e),s=n.player,a=n.config,l=n.pos,c=n.playerConfig,f=e.getTouche(i);if(f&&!a.disableGesture&&e.duration>0&&!s.ended){l.isStart=!0,e.timer&&clearTimeout(e.timer),util.checkIsFunction(c.disableSwipeHandler)&&c.disableSwipeHandler(),e.find(".xg-dur").innerHTML=util.format(e.duration);var h=e.root.getBoundingClientRect();s.rotateDeg===90?(l.top=h.left,l.left=h.top,l.width=h.height,l.height=h.width):(l.top=h.top,l.left=h.left,l.width=h.width,l.height=h.height);var p=parseInt(f.pageX-l.left,10),d=parseInt(f.pageY-l.top,10);l.x=s.rotateDeg===90?d:p,l.y=s.rotateDeg===90?p:d,l.scopeL=a.scopeL*l.width,l.scopeR=(1-a.scopeR)*l.width,l.scopeM1=l.width*(1-a.scopeM)/2,l.scopeM2=l.width-l.scopeM1}}),_defineProperty$3(_assertThisInitialized$3(e),"onTouchMove",function(i){var n=e.getTouche(i),s=_assertThisInitialized$3(e),a=s.pos,l=s.config,c=s.player;if(!(!n||l.disableGesture||!e.duration||!a.isStart)){var f=l.miniMoveStep,h=l.hideControlsActive,p=parseInt(n.pageX-a.left,10),d=parseInt(n.pageY-a.top,10),v=c.rotateDeg===90?d:p,g=c.rotateDeg===90?p:d;if(Math.abs(v-a.x)>f||Math.abs(g-a.y)>f){var y=v-a.x,m=g-a.y,S=a.scope;if(S===-1&&(S=e.checkScope(v,g,y,m,a),S===0&&(h?c.blur():c.focus({autoHide:!1}),!a.time&&(a.time=parseInt(c.currentTime*1e3,10)+e.timeOffset*1e3)),a.scope=S),S===-1||S>0&&!l.gestureY||S===0&&!l.gestureX)return;e.executeMove(y,m,S,a.width,a.height),a.x=v,a.y=g}}}),_defineProperty$3(_assertThisInitialized$3(e),"onTouchEnd",function(i){var n=_assertThisInitialized$3(e),s=n.player,a=n.pos,l=n.playerConfig;if(setTimeout(function(){s.getPlugin("progress")&&s.getPlugin("progress").resetSeekState()},10),!!a.isStart){a.scope>-1&&i.cancelable&&i.preventDefault();var c=e.config,f=c.disableGesture,h=c.gestureX;!f&&h?e.endLastMove(a.scope):a.time=0,a.scope=-1,e.resetPos(),util.checkIsFunction(l.enableSwipeHandler)&&l.enableSwipeHandler(),e.changeAction(ACTIONS.AUTO)}}),_defineProperty$3(_assertThisInitialized$3(e),"onRootTouchMove",function(i){e.config.disableGesture||!e.config.gestureX||e.checkIsRootTarget(i)&&(i.stopPropagation(),e.pos.isStart?e.onTouchMove(i):e.onTouchStart(i))}),_defineProperty$3(_assertThisInitialized$3(e),"onRootTouchEnd",function(i){e.pos.scope>-1&&e.onTouchEnd(i)}),e.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},e.timer=null,e}return _createClass$3(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:SeekTipIcon,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;HOOKS.map(function(h){e.__hooks[h]=null});var i=this.playerConfig,n=this.config,s=this.player;i.closeVideoDblclick===!0&&(n.closedbClick=!0),this.resetPos(),util.isUndefined(i.disableGesture)||(n.disableGesture=!!i.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=util.createDom("xg-mask","",{},"xgmask"),s.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var a=this.domEventType==="mouse"?"mouse":"touch";this.touch=new Touche(this.root,{eventType:a,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",function(h){h.preventDefault()}),s.root.addEventListener("touchmove",this.onRootTouchMove,!0),s.root.addEventListener("touchend",this.onRootTouchEnd,!0),s.root.addEventListener("touchcancel",this.onRootTouchEnd,!0);var l=this.player.controls;l&&l.center&&(l.center.addEventListener("touchmove",this.onRootTouchMove,!0),l.center.addEventListener("touchend",this.onRootTouchEnd,!0),l.center.addEventListener("touchcancel",this.onRootTouchEnd,!0)),this.on(DURATION_CHANGE,function(){var h=e.player,p=e.config;h.duration>0&&h.duration*1e3<p.moveDuration&&(p.moveDuration=h.duration*1e3)}),this.on([CANPLAY,ENDED],function(){var h=e.pos,p=h.time,d=h.isStart;!d&&p>0&&(e.pos.time=0)});var c={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(c).map(function(h){e.touch.on(h,function(p){e[c[h]](p)})}),!n.disableActive){var f=s.plugins.progress;f&&(f.addCallBack("dragmove",function(h){e.activeSeekNote(h.currentTime,h.forward)}),["dragend","click"].forEach(function(h){f.addCallBack(h,function(){e.changeAction(ACTIONS.AUTO)})}))}}},{key:"registerThumbnail",value:function(){var e=this.player,i=e.plugins.thumbnail;if(i&&i.usable){this.thumbnail=i.createThumbnail(null,"mobile-thumbnail");var n=this.find(".time-preview");n.insertBefore(this.thumbnail,n.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},i=e.commonStyle,n=i.playedColor,s=i.progressColor,a=i.timePreviewStyle,l=i.curTimeColor,c=i.durationColor;if(n&&(this.find(".xg-curbar").style.backgroundColor=n),s&&(this.find(".xg-bar").style.backgroundColor=s),a){var f=this.find(".time-preview");Object.keys(a).forEach(function(d){f.style[d]=a[d]})}var h=l||n,p=c;h&&(this.find(".xg-cur").style.color=h),p&&(this.find(".xg-dur").style.color=p),this.config.disableTimeProgress&&util.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map(function(i){e.pos[i]=0})):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var i=this.player,n=this.root;n.setAttribute("data-xg-action",e);var s=i.plugins.start;s&&s.recover()}},{key:"getTouche",value:function(e){var i=this.player.rotateDeg,n=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return i===0?{pageX:n.pageX,pageY:n.pageY}:{pageX:n.pageX,pageY:n.pageY}}},{key:"checkScope",value:function(e,i,n,s,a){var l=a.width,c=-1;if(e<0||e>l)return c;var f=Math.abs(s===0?n:n/s);return Math.abs(n)>0&&f>=1.73&&e>a.scopeM1&&e<a.scopeM2?c=0:(Math.abs(n)===0||f<=.57)&&(c=e<a.scopeL?1:e>a.scopeR?2:3),c}},{key:"executeMove",value:function(e,i,n,s,a){switch(n){case 0:this.updateTime(e/s*this.config.scopeM);break;case 1:this.updateBrightness(i/a);break;case 2:sniffer.os.isIos||this.updateVolume(i/a);break}}},{key:"endLastMove",value:function(e){var i=this,n=this.pos,s=this.player,a=this.config,l=(n.time-this.timeOffset)/1e3;switch(e){case 0:s.seek(Number(l).toFixed(1)),a.hideControlsEnd?s.blur():s.focus(),this.timer=setTimeout(function(){i.pos.time=0},500);break}this.changeAction(ACTIONS.AUTO)}},{key:"checkIsRootTarget",value:function(e){var i=this.player.plugins||{};return i.progress&&i.progress.root.contains(e.target)?!1:i.start&&i.start.root.contains(e.target)||i.controls&&i.controls.root.contains(e.target)}},{key:"sendUseAction",value:function(e){var i=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:i,to:!i})}},{key:"clickHandler",value:function(e){var i=this.player,n=this.config,s=this.playerConfig;if(i.state<STATES.RUNNING){s.closeVideoClick||(this.sendUseAction(util.createEvent("click")),i.play());return}!n.closedbClick||s.closeVideoClick?i.isActive?i.blur():i.focus():s.closeVideoClick||((i.isActive||n.focusVideoClick)&&(this.sendUseAction(util.createEvent("click")),this.switchPlayPause()),i.focus())}},{key:"dbClickHandler",value:function(e){var i=this.config,n=this.player;!i.closedbClick&&n.state>=STATES.RUNNING&&(this.sendUseAction(util.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var i=this,n=this.player;runHooks(this,HOOKS[0],function(s,a){i.clickHandler(a.e)},{e,paused:n.paused})}},{key:"onDbClick",value:function(e){var i=this,n=this.player;runHooks(this,HOOKS[1],function(s,a){i.dbClickHandler(a.e)},{e,paused:n.paused})}},{key:"onPress",value:function(e){var i=this.pos,n=this.config,s=this.player;n.disablePress||(i.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:s.playbackRate,to:n.pressRate}),s.playbackRate=n.pressRate,this.changeAction(ACTIONS.PLAYBACK))}},{key:"onPressEnd",value:function(e){var i=this.pos,n=this.config,s=this.player;n.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:s.playbackRate,to:i.rate}),s.playbackRate=i.rate,i.rate=1,this.changeAction(ACTIONS.AUTO))}},{key:"updateTime",value:function(e){var i=this.player,n=this.config,s=this.player.duration;e=Number(e.toFixed(4));var a=parseInt(e*n.moveDuration,10)+this.timeOffset;a+=this.pos.time,a=a<0?0:a>s*1e3?s*1e3-200:a,i.getPlugin("time")&&i.getPlugin("time").updateTime(a/1e3),i.getPlugin("progress")&&i.getPlugin("progress").updatePercent(a/1e3/this.duration,!0),this.activeSeekNote(a/1e3,e>0),n.isTouchingSeek&&i.seek(Number((a-this.timeOffset)/1e3).toFixed(1)),this.pos.time=a}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var i=this.player,n=this.pos;if(e=parseInt(e*100,10),n.volume+=e,!(Math.abs(n.volume)<10)){var s=parseInt(i.volume*10,10)-parseInt(n.volume/10,10);s=s>10?10:s<1?0:s,i.volume=s/10,n.volume=0}}},{key:"updateBrightness",value:function(e){var i=this.pos,n=this.config,s=this.xgMask;if(n.darkness){this.player.rotateDeg&&(e=-e);var a=i.light+.8*e;a=a>n.maxDarkness?n.maxDarkness:a<0?0:a,s&&(s.style.backgroundColor="rgba(0,0,0,".concat(a,")")),i.light=a}}},{key:"activeSeekNote",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this.player,s=this.config,a=!(this.duration!==1/0&&this.duration>0);if(!(!e||typeof e!="number"||a||s.disableActive)){e<0?e=0:e>n.duration&&(e=n.duration-.2),this.changeAction(ACTIONS.SEEKING);var l=n.plugins.start;l&&l.focusHide(),this.find(".xg-dur").innerHTML=util.format(this.duration),this.find(".xg-cur").innerHTML=util.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),i?util.removeClass(this.find(".xg-seek-show"),"xg-back"):util.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var i=this.player,n=i.plugins.thumbnail;n&&n.usable&&this.thumbnail&&n.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<STATES.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!0}},{key:"enableGesture",value:function(){this.config.disableGesture=!1}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0),e.root.removeEventListener("touchcancel",this.onRootTouchEnd,!0);var i=this.player.controls;i&&i.center&&(i.center.removeEventListener("touchmove",this.onRootTouchMove,!0),i.center.removeEventListener("touchend",this.onRootTouchEnd,!0),i.center.removeEventListener("touchcancel",this.onRootTouchEnd,!0))}},{key:"render",value:function(){var e=this.config.gradient!=="normal"?"gradient ".concat(this.config.gradient):"gradient";return`
     <xg-trigger class="trigger">
     <div class="`.concat(e,`"></div>
        <div class="time-preview">
            <div class="xg-seek-show `).concat(this.config.disableSeekIcon?" hide-seek-icon":"",`">
              <i class="xg-seek-icon"></i>
              <span class="xg-cur">00:00</span>
              <span class="xg-separator">/</span>
              <span class="xg-dur">00:00</span>
            </div>
              <div class="xg-bar xg-timebar">
                <div class="xg-curbar"></div>
              </div>
        </div>
        <div class="xg-playbackrate xg-top-note">
            <span><i>`).concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,`</span>
        </div>
     </xg-trigger>
    `)}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:60*6*1e3,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),r}(Plugin);function preventDefault(o){o.preventDefault(),o.returnValue=!1}function isDisableTag(o){var u=o.tagName;return!!(u==="INPUT"||u==="TEXTAREA"||o.isContentEditable)}var Keyboard=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onBodyKeyDown",function(s){if(t.player){var a=s||window.event,l=a.keyCode,c=_assertThisInitialized$3(t),f=c._keyState,h=c.player,p=t.config,d=p.disable,v=p.disableBodyTrigger,g=p.isIgnoreUserActive;if(d||v||!(h.isUserActive||g)||isDisableTag(a.target)||!t.checkIsVisible()||a.metaKey||a.altKey||a.ctrlKey){f.isBodyKeyDown=!1;return}!s.repeat&&!f.isKeyDown&&((a.target===document.body||t.config.isGlobalTrigger&&!isDisableTag(a.target))&&t.checkCode(l,!0)&&(f.isBodyKeyDown=!0),document.addEventListener("keyup",t.onBodyKeyUp)),f.isBodyKeyDown&&t.handleKeyDown(a)}}),_defineProperty$3(_assertThisInitialized$3(t),"onBodyKeyUp",function(s){t.player&&(document.removeEventListener("keyup",t.onBodyKeyUp),t.handleKeyUp(s))}),_defineProperty$3(_assertThisInitialized$3(t),"onKeydown",function(s){if(t.player){var a=s||window.event,l=_assertThisInitialized$3(t),c=l._keyState;if(!a.repeat){if(t.config.disable||t.config.disableRootTrigger||a.metaKey||a.altKey||a.ctrlKey)return;a&&(a.keyCode===37||t.checkCode(a.keyCode))&&(a.target===t.player.root||a.target===t.player.video||a.target===t.player.controls.el)&&(c.isKeyDown=!0),t.player.root.addEventListener("keyup",t.onKeyup)}c.isKeyDown&&t.handleKeyDown(a)}}),_defineProperty$3(_assertThisInitialized$3(t),"onKeyup",function(s){t.player&&(t.player.root.removeEventListener("keyup",t.onKeyup),t.handleKeyUp(s))}),t}return _createClass$3(r,[{key:"mergekeyCodeMap",value:function(){var e=this,i=this.config.keyCodeMap;i&&Object.keys(i).map(function(n){e.keyCodeMap[n]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map(function(s){i[n][s]&&(e.keyCodeMap[n][s]=i[n][s])}):e.keyCodeMap[n]=i[n]})}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e=typeof this.config.seekStep=="function"?this.config.seekStep(this.player):this.config.seekStep;!e||typeof e!="number"||(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(e){var i=this;Object.keys(e).forEach(function(n){i.config[n]=e[n]})}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),i=e.height,n=e.top,s=e.bottom,a=window.innerHeight;return!(n<0&&n<0-i*.9||s>0&&s-a>i*.9)}},{key:"checkCode",value:function(e,i){var n=this,s=!1;return Object.keys(this.keyCodeMap).map(function(a){n.keyCodeMap[a]&&e===n.keyCodeMap[a].keyCode&&!n.keyCodeMap[a].disable&&(s=!i||i&&!n.keyCodeMap[a].noBodyTarget)}),s}},{key:"downVolume",value:function(e){var i=this.player;if(!(i.volume<=0)){var n=parseFloat((i.volume-.1).toFixed(1)),s={volume:{from:i.volume,to:n}};this.emitUserAction(e,"change_volume",{props:s}),n>=0?i.volume=n:i.volume=0}}},{key:"upVolume",value:function(e){var i=this.player;if(!(i.volume>=1)){var n=parseFloat((i.volume+.1).toFixed(1)),s={volume:{from:i.volume,to:n}};this.emitUserAction(e,"change_volume",{props:s}),n<=1?i.volume=n:i.volume=1}}},{key:"seek",value:function(e){var i=this.player,n=i.currentTime,s=i.offsetCurrentTime,a=i.duration,l=i.offsetDuration,c=i.timeSegments,f=s>-1?s:n,h=l||a,p=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;f+p<=h?f=f+p:f=h;var d=util.getCurrentTimeByOffset(f,c),v={currentTime:{from:n,to:d}};this.emitUserAction(e,"seek",{props:v}),this.player.currentTime=d}},{key:"seekBack",value:function(e){var i=this.player,n=i.currentTime,s=i.offsetCurrentTime,a=i.timeSegments,l=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,c=s>-1?s:n,f=c-l;f<0&&(f=0),f=util.getCurrentTimeByOffset(f,a);var h={currentTime:{from:n,to:f}};this.emitUserAction(e,"seek",{props:h}),this.player.currentTime=f}},{key:"changePlaybackRate",value:function(e){var i=this._keyState,n=this.config,s=this.player;i.playbackRate===0&&(i.playbackRate=s.playbackRate,s.playbackRate=n.playbackRate)}},{key:"playPause",value:function(e){var i=this.player;i&&(this.emitUserAction(e,"switch_play_pause"),i.paused?i.play():i.pause())}},{key:"exitFullscreen",value:function(e){var i=this.player,n=i.fullscreen,s=i.cssfullscreen;n&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:n,to:!n}),i.exitFullscreen()),s&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:s,to:!s}),i.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var i=this._keyState;if(e.repeat){i.isPress=!0;var n=Date.now();if(n-i.tt<200)return;i.tt=n}this.handleKeyCode(e.keyCode,e,i.isPress)}},{key:"handleKeyUp",value:function(e){var i=this._keyState;i.playbackRate>0&&(this.player.playbackRate=i.playbackRate,i.playbackRate=0),i.isKeyDown=!1,i.isPress=!1,i.tt=0}},{key:"handleKeyCode",value:function(e,i,n){for(var s=Object.keys(this.keyCodeMap),a=0;a<s.length;a++){var l=this.keyCodeMap[s[a]],c=l.action,f=l.keyCode,h=l.disable,p=l.pressAction,d=l.disablePress;if(f===e){if(!h&&!(n&&d)){var v=n&&p||c;typeof v=="function"?c(i,this.player,n):typeof v=="string"&&typeof this[v]=="function"&&this[v](i,this.player,n),this.emit(SHORTCUT,_objectSpread2$2({key:s[a],target:i.target,isPress:n},this.keyCodeMap[s[a]]))}preventDefault(i),i.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),r}(BasePlugin);function loadingIcon(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">
  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>
</svg>
`,"image/svg+xml").firstChild}var Loading=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"registerIcons",value:function(){return{loadingIcon}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return`
    <xg-loading class="xgplayer-loading">
      <xg-loading-inner></xg-loading-inner>
    </xg-loading>`}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.ROOT}}}]),r}(Plugin),TPL=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],InnerList=function(){function o(u){_classCallCheck$3(this,o),this.fragments=u.fragments||[],this.fragments.length===0&&this.fragments.push({percent:1}),this._callBack=u.actionCallback,this.fragConfig={fragFocusClass:u.fragFocusClass||"inner-focus-point",fragAutoFocus:!!u.fragAutoFocus,fragClass:u.fragClass||""},this.style=u.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return _createClass$3(o,[{key:"updateDuration",value:function(r){var t=this;this.duration=r;var e=0,i=this.fragments;this.fragments=i.map(function(n){return n.start=parseInt(e,10),n.end=parseInt(e+n.percent*t.duration,10),n.duration=parseInt(n.percent*t.duration,10),e+=n.percent*t.duration,n})}},{key:"updateProgress",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"played",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},e=this.progressList,i=this.fragments;if(!(e.length<1)){var n=t.newIndex,s=t.curIndex,a=t.millisecond;n!==s&&e.map(function(f,h){h<n?f[r].style.width="100%":h>n&&(f[r].style.width=0)});var l=i[n],c=a===0?0:(a-l.start)/l.duration;e[n][r].style.width=c<0?0:"".concat(c*100,"%")}}},{key:"updateFocus",value:function(r){if(!(!this.fragConfig.fragAutoFocus||this.fragments.length<2)){if(!r){if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var t={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(t),this.focusIndex=-1}return}var e=this.findIndex(r.currentTime*1e3,this.focusIndex);if(e>=0&&e!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(e);var i={index:e,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=e,this._callBack&&this._callBack(i)}}}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(t*1e3,10)!==this.duration){if(!t&&t!==0)return;this.updateDuration(parseInt(t*1e3,10))}var e=this.playedIndex,i=this.cachedIndex;if(util.typeOf(r.played)!=="Undefined"){var n=this.findIndex(r.played*1e3,e);if(n<0)return;this.updateProgress("played",{newIndex:n,curIndex:e,millisecond:parseInt(r.played*1e3,10)}),this.playedIndex=n}if(util.typeOf(r.cached)!=="Undefined"){var s=this.findIndex(r.cached*1e3,i);if(s<0)return;this.updateProgress("cached",{newIndex:s,curIndex:i,millisecond:parseInt(r.cached*1e3,10)}),this.cachedIndex=s}}},{key:"findIndex",value:function(r,t){var e=this.fragments;if(!e||e.length===0)return-1;if(e.length===1)return 0;if(t>-1&&t<e.length&&r>e[t].start&&r<e[t].end)return t;if(r>e[e.length-1].start)return e.length-1;for(var i=0;i<e.length;i++)if(r>e[i].start&&r<=e[i].end){t=i;break}return t}},{key:"findHightLight",value:function(){for(var r=this.root.children,t=0;t<r.length;t++)if(util.hasClass(r[t],this.fragConfig.fragFocusClass))return{dom:r[t],pos:r[t].getBoundingClientRect()}}},{key:"findFragment",value:function(r){var t=this.root.children;return r<0||r>=t.length?null:{dom:t[r],pos:t[r].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var r=this.root.children,t=0;t<r.length;t++)util.removeClass(r[t],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(r){var t=this.root.children;if(r<t.length)return util.addClass(t[r],this.fragConfig.fragFocusClass),{dom:t[r],pos:t[r].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(r){var t=this;if(Object.keys(this.fragConfig).forEach(function(i){r[i]!==void 0&&(t.fragConfig[i]=r[i])}),r.fragments){if(this.fragments=r.fragments.length===0?[{percent:1}]:r.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root)for(var e=this.root.children;e.length>0;)this.root.removeChild(e[0]);this.render()}}},{key:"render",value:function(){var r=this,t=this.style.progressColor;if(this.root||(this.root=util.createDom("xg-inners","",{},"progress-list")),this.fragments){var e=this.fragConfig,i=e.fragClass,n=e.fragFocusClass;this.progressList=this.fragments.map(function(s){var a=util.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(s.percent):"flex: ".concat(s.percent)},"".concat(s.isFocus?n:""," xgplayer-progress-inner ").concat(i));return r.root.appendChild(a),TPL.forEach(function(l){a.appendChild(util.createDom(l.tag,"",{style:l.styleKey?"background: ".concat(r.style[l.styleKey],"; width:0;"):"width:0;"},l.className))}),{cached:a.children[0],played:a.children[1]}})}return this.root}}]),o}(),FRAGMENT_FOCUS_CLASS={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},Progress=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"onMoveOnly",function(i,n){var s=_assertThisInitialized$3(e),a=s.pos,l=s.config,c=s.player,f=n;if(i){util.event(i);var h=util.getEventPos(i,c.zoom),p=c.rotateDeg===90?h.clientY:h.clientX;if(a.moving&&Math.abs(a.x-p)<l.miniMoveStep)return;a.moving=!0,a.x=p,f=e.computeTime(i,p)}e.triggerCallbacks("dragmove",f,i),e._updateInnerFocus(f)}),_defineProperty$3(_assertThisInitialized$3(e),"onBodyClick",function(i){e.pos.isLocked&&(e.pos.isLocked=!1,i.preventDefault(),i.stopPropagation())}),_defineProperty$3(_assertThisInitialized$3(e),"_mouseDownHandler",function(i,n){e._state.time=n.currentTime,e.updateWidth(n.currentTime,n.seekTime,n.percent,0),e._updateInnerFocus(n)}),_defineProperty$3(_assertThisInitialized$3(e),"_mouseUpHandler",function(i,n){var s=_assertThisInitialized$3(e),a=s.pos;a.moving&&e.updateWidth(n.currentTime,n.seekTime,n.percent,2)}),_defineProperty$3(_assertThisInitialized$3(e),"_mouseMoveHandler",function(i,n){var s=_assertThisInitialized$3(e),a=s._state,l=s.pos,c=s.config,f=s.player;a.time<n.currentTime?n.forward=!0:n.forward=!1,a.time=n.currentTime,l.isDown&&!l.moving&&(l.moving=!0,c.isPauseMoving&&f.pause(),e.triggerCallbacks("dragstart",n,i),e.emitUserAction("drag","dragstart",n)),e.updateWidth(n.currentTime,n.seekTime,n.percent,1),e.triggerCallbacks("dragmove",n,i),e._updateInnerFocus(n)}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseDown",function(i){var n=_assertThisInitialized$3(e),s=n._state,a=n.player,l=n.pos,c=n.config,f=n.playerConfig,h=util.getEventPos(i,a.zoom),p=a.rotateDeg===90?h.clientY:h.clientX;if(!(a.isMini||c.closeMoveSeek||!f.allowSeekAfterEnded&&a.ended)){if(!a.duration&&!a.isPlaying){a.play();return}i.stopPropagation(),e.focus(),util.checkIsFunction(f.disableSwipeHandler)&&f.disableSwipeHandler(),util.checkIsFunction(c.onMoveStart)&&c.onMoveStart(),util.event(i),l.x=p,l.isDown=!0,l.moving=!1,s.prePlayTime=a.currentTime,a.focus({autoHide:!1}),e.isProgressMoving=!0,util.addClass(e.progressBtn,"active");var d=e.computeTime(i,p);d.prePlayTime=s.prePlayTime,e._mouseDownHandlerHook(i,d);var v=i.type;return v==="touchstart"?(e.root.addEventListener("touchmove",e.onMouseMove),e.root.addEventListener("touchend",e.onMouseUp),e.root.addEventListener("touchcancel",e.onMouseUp)):(e.unbind("mousemove",e.onMoveOnly),document.addEventListener("mousemove",e.onMouseMove,!1),document.addEventListener("mouseup",e.onMouseUp,!1)),!0}}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseUp",function(i){var n=_assertThisInitialized$3(e),s=n.player,a=n.config,l=n.pos,c=n.playerConfig,f=n._state;i.stopPropagation(),i.preventDefault(),util.checkIsFunction(c.enableSwipeHandler)&&c.enableSwipeHandler(),util.checkIsFunction(a.onMoveEnd)&&a.onMoveEnd(),util.event(i),util.removeClass(e.progressBtn,"active");var h=e.computeTime(i,l.x);h.prePlayTime=f.prePlayTime,l.moving?(e.triggerCallbacks("dragend",h,i),e.emitUserAction("drag","dragend",h)):(e.triggerCallbacks("click",h,i),e.emitUserAction("click","click",h)),e._mouseUpHandlerHook(i,h),l.moving=!1,l.isDown=!1,l.x=0,l.y=0,l.isLocked=!0,f.prePlayTime=0,f.time=0;var p=i.type;p==="touchend"||p==="touchcancel"?(e.root.removeEventListener("touchmove",e.onMouseMove),e.root.removeEventListener("touchend",e.onMouseUp),e.root.removeEventListener("touchcancel",e.onMouseUp),e.blur()):(document.removeEventListener("mousemove",e.onMouseMove,!1),document.removeEventListener("mouseup",e.onMouseUp,!1),l.isEnter?c.isMobileSimulateMode!=="mobile"&&e.bind("mousemove",e.onMoveOnly):e.onMouseLeave(i)),util.setTimeout(_assertThisInitialized$3(e),function(){e.resetSeekState()},1),s.focus()}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseMove",function(i){var n=_assertThisInitialized$3(e),s=n._state,a=n.pos,l=n.player,c=n.config;util.checkTouchSupport()&&i.preventDefault(),util.event(i);var f=util.getEventPos(i,l.zoom),h=l.rotateDeg===90?f.clientY:f.clientX,p=Math.abs(a.x-h);if(!(a.moving&&p<c.miniMoveStep||!a.moving&&p<c.miniStartStep)){a.x=h;var d=e.computeTime(i,h);d.prePlayTime=s.prePlayTime,e._mouseMoveHandlerHook(i,d)}}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseOut",function(i){e.triggerCallbacks("mouseout",null,i)}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseOver",function(i){e.triggerCallbacks("mouseover",null,i)}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseEnter",function(i){var n=_assertThisInitialized$3(e),s=n.player,a=n.pos;if(!(a.isDown||a.isEnter||s.isMini||!s.config.allowSeekAfterEnded&&s.ended)){a.isEnter=!0,e.bind("mousemove",e.onMoveOnly),e.bind("mouseleave",e.onMouseLeave),util.event(i);var l=util.getEventPos(i,s.zoom),c=s.rotateDeg===90?l.clientY:l.clientX,f=e.computeTime(i,c);e.triggerCallbacks("mouseenter",f,i),e.focus()}}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseLeave",function(i){e.triggerCallbacks("mouseleave",null,i),e.unlock(),e._updateInnerFocus(null)}),_defineProperty$3(_assertThisInitialized$3(e),"onVideoResize",function(){var i=e.pos,n=i.x,s=i.isDown,a=i.isEnter;if(a&&!s){var l=e.computeTime(null,n);e.onMoveOnly(null,l)}}),e.useable=!1,e.isProgressMoving=!1,e.__dragCallBacks=[],e._state={now:-1,direc:0,time:0,prePlayTime:-1},e._disableBlur=!1,typeof e.config.isDragingSeek=="boolean"&&(console.warn("[XGPLAYER] 'isDragingSeek' is deprecated, please use 'isDraggingSeek' instead"),e.config.isDraggingSeek=e.config.isDragingSeek),e}return _createClass$3(r,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var e=this.player,i=e.offsetCurrentTime,n=e.currentTime;return i>=0?i:n+this.timeOffset}},{key:"changeState",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.useable=e}},{key:"show",value:function(e){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!i||i.length===0)&&(i=[{percent:1}]);var s=_objectSpread2$2(_objectSpread2$2({fragments:i},n),{},{actionCallback:function(l){e.emitUserAction("fragment_focus","fragment_focus",l)}});this.innerList?this.innerList.reset(s):(this.innerList=new InnerList(s),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(function(a){e[a]=e.innerList[a].bind(e.innerList)}))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var e=this.config,i=e.fragFocusClass,n=e.fragAutoFocus,s=e.fragClass;this._initInner(this.config.fragments,{fragFocusClass:i,fragAutoFocus:n,fragClass:s,style:this.playerConfig.commonStyle||{}}),sniffer.device==="mobile"&&(this.config.isDraggingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.listenEvents(),this.bindDomEvents(),this.initCustomStyle()}}},{key:"listenEvents",value:function(){var e=this;this.on(DURATION_CHANGE,function(){e.onMouseLeave()}),this.on(TIME_UPDATE,function(){e.onTimeupdate()}),this.on(SEEKED,function(){e.onTimeupdate(),e.onCacheUpdate()}),this.on(PROGRESS,function(){e.onCacheUpdate()}),this.on(ENDED,function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0}),this.on(EMPTIED,function(){e.onReset()}),this.on(VIDEO_RESIZE,function(){e.onVideoResize()})}},{key:"setConfig",value:function(e){var i=this,n=null;Object.keys(e).forEach(function(s){i.config[s]=e[s],s==="fragments"&&(n=e[s])}),n&&this._initInner(n,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},i=e.commonStyle,n=i.sliderBtnStyle,s=this.progressBtn;n&&(typeof n=="string"?s.style.boxShadow=n:_typeof$2(n)==="object"&&Object.keys(n).map(function(a){s.style[a]=n[a]}))}},{key:"triggerCallbacks",value:function(e,i,n){this.__dragCallBacks.length>0&&this.__dragCallBacks.map(function(s){if(s&&s.handler&&s.type===e)try{s.handler(i,n)}catch(a){console.error("[XGPLAYER][triggerCallbacks] ".concat(s," error"),a)}})}},{key:"addCallBack",value:function(e,i){i&&typeof i=="function"&&this.__dragCallBacks.push({type:e,handler:i})}},{key:"removeCallBack",value:function(e,i){var n=this.__dragCallBacks,s=-1;n.map(function(a,l){a&&a.type===e&&a.handler===i&&(s=l)}),s>-1&&n.splice(s,1)}},{key:"unlock",value:function(){var e=this.player,i=this.pos;if(i.isEnter=!1,i.isLocked=!1,!e.isMini){if(this.unbind("mousemove",this.onMoveOnly),i.isDown){this.unbind("mouseleave",this.onMouseLeave);return}this.blur()}}},{key:"bindDomEvents",value:function(){var e=this.player.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),(this.domEventType==="touch"||this.domEventType==="compatible")&&this.root.addEventListener("touchstart",this.onMouseDown),(this.domEventType==="mouse"||this.domEventType==="compatible")&&(this.bind("mousedown",this.onMouseDown),e.isMobileSimulateMode!=="mobile"&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),util.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),util.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,i,n,s){var a=this.config,l=this.player;if(!(a.isCloseClickSeek&&s===0)){var c=i=i>=l.duration?l.duration-a.endedDiff:Number(i).toFixed(1);this.updatePercent(n),this.updateTime(e),!(s===1&&(!a.isDraggingSeek||l.config.mediaType==="audio"))&&(this._state.now=c,this._state.direc=c>l.currentTime?0:1,l.seek(c))}}},{key:"computeTime",value:function(e,i){var n=this.player,s=this.root.getBoundingClientRect(),a=s.width,l=s.height,c=s.top,f=s.left,h,p,d=i;n.rotateDeg===90?(h=l,p=c):(h=a,p=f);var v=d-p;v=v>h?h:v<0?0:v;var g=v/h;g=g<0?0:g>1?1:g;var y=parseInt(g*this.offsetDuration*1e3,10)/1e3,m=util.getCurrentTimeByOffset(y,n.timeSegments);return{percent:g,currentTime:y,seekTime:m,offset:v,width:h,left:p,e}}},{key:"updateTime",value:function(e){var i=this.player,n=this.duration;e>n?e=n:e<0&&(e=0);var s=i.plugins.time;s&&s.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,i){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(e*100,"%"),this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);var n=this.player.plugins.miniprogress;n&&n.update({played:e*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(e){var i=this.player,n=this._state,s=this.offsetDuration;if(!(i.isSeeking&&i.media.seeking||this.isProgressMoving||!i.hasStart)){if(n.now>-1){var a=parseInt(n.now*1e3,10)-parseInt(i.currentTime*1e3,10);if(n.direc===0&&a>300||n.direc===1&&a>-300){n.now=-1;return}else n.now=-1}var l=this.currentTime;l=util.adjustTimeByDuration(l,s,e),this.innerList.update({played:l},s),this.progressBtn.style.left="".concat(l/s*100,"%")}}},{key:"onCacheUpdate",value:function(e){var i=this.player,n=this.duration;if(i){var s=i.bufferedPoint.end;s=util.adjustTimeByDuration(s,n,e),this.innerList.update({cached:s},n)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var e=this.player;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var i=this.domEventType;(i==="touch"||i==="compatible")&&(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp)),(i==="mouse"||i==="compatible")&&(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){var e=this.player.controls?this.player.controls.config.mode:"",i=e==="bottom"?"xgplayer-progress-bottom":"";return`
    <xg-progress class="xgplayer-progress `.concat(i,`">
      <xg-outer class="xgplayer-progress-outer">
        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>
      </xg-outer>
    </xg-progress>
    `)}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_CENTER,index:0,disable:!1,isDraggingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:FRAGMENT_FOCUS_CLASS.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return FRAGMENT_FOCUS_CLASS}}]),r}(Plugin),Icon=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"_onMouseenter",function(s){t.emit("icon_mouseenter",{pluginName:t.pluginName})}),_defineProperty$3(_assertThisInitialized$3(t),"_onMouseLeave",function(s){t.emit("icon_mouseleave",{pluginName:t.pluginName})}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),r}(Plugin),Play=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"btnClick",function(s){s.preventDefault(),s.stopPropagation();var a=_assertThisInitialized$3(t),l=a.player;return t.emitUserAction(s,"switch_play_pause",{prop:"paused",from:l.paused,to:!l.paused}),l.ended?l.replay():l.paused?(l.play(),t.animate(!1)):(l.pause(),t.animate(!0)),!1}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this);var e=this.config;e.disable||(this.initIcons(),this.bind(["touchend","click"],this.btnClick),this.listenEvents(),this.animate(!0))}},{key:"listenEvents",value:function(){var e=this,i=this.player;this.on([PLAY,PAUSE,ERROR,EMPTIED],function(){e.animate(i.paused)})}},{key:"registerIcons",value:function(){return{play:{icon:PlaySvg,class:"xg-icon-play"},pause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var i=this.i18nKeys,n=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),n&&this.changeLangTextKey(n,i.PLAY_TIPS)):(this.setAttr("data-state","play"),n&&this.changeLangTextKey(n,i.PAUSE_TIPS))}}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-play">
    <div class="xgplayer-icon">
    </div>
    `.concat(xgIconTips(this,"PLAY_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_LEFT,index:0,disable:!1}}}]),r}(Icon);function BackSVG(){return new DOMParser().parseFromString(`<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>
    </g>
</svg>`,"image/svg+xml").firstChild}var TopBackIcon=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(i){i.preventDefault(),i.stopPropagation(),e.config.onClick(i)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:BackSVG,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){util.addClass(this.root,"show")}},{key:"hide",value:function(){util.removeClass(this.root,"show")}},{key:"render",value:function(){return`<xg-icon class="xgplayer-back">
    </xg-icon>`}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.ROOT_TOP,index:0}}}]),r}(Plugin);function FullScreenSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>
</svg>
`,"image/svg+xml").firstChild}function ExitFullScreenSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>
</svg>
`,"image/svg+xml").firstChild}var Fullscreen=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"_onOrientationChange",function(s){t.player.fullscreen&&t.config.rotateFullscreen&&(window.orientation===90||window.orientation===-90?t.player.setRotateDeg(0):t.player.setRotateDeg(90))}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this);var i=this.config,n=this.playerConfig;if(!i.disable){i.target&&(this.playerConfig.fullscreenTarget=this.config.target);var s=util.getFullScreenEl();n.fullscreenTarget===s&&this.player.getFullscreen().catch(function(a){}),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(l){var c=e.player.fullscreen;e.emitUserAction(l,"switch_fullscreen",{prop:"fullscreen",from:c,to:!c})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(FULLSCREEN_CHANGE,function(a){var l=e.find(".xg-tips");l&&e.changeLangTextKey(l,a?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(a)}),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:TopBackIcon,options:{config:{onClick:function(l){e.handleFullscreen(l)}}}})),sniffer.device==="mobile"&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:FullScreenSvg,class:"xg-get-fullscreen"},exitFullscreen:{icon:ExitFullScreenSvg,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",sniffer.device==="mobile"?"touchend":"click",this.handleFullscreen),sniffer.device==="mobile"&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var i=this.player,n=this.config,s=n.useCssFullscreen===!0||typeof n.useCssFullscreen=="function"&&n.useCssFullscreen();s?(i.fullscreen?i.exitCssFullscreen():i.getCssFullscreen(),this.animate(i.fullscreen)):n.rotateFullscreen?(i.fullscreen?i.exitRotateFullscreen():i.getRotateFullscreen(),this.animate(i.fullscreen)):n.switchCallback&&typeof n.switchCallback=="function"?n.switchCallback(i.fullscreen):i.fullscreen?(i.exitFullscreen(),n.useScreenOrientation&&this.unlockScreen()):(i.getFullscreen().catch(function(a){}),n.useScreenOrientation&&i.aspectRatio>1&&this.lockScreen(n.lockOrientationType))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return`<xg-icon class="xgplayer-fullscreen">
    <div class="xgplayer-icon">
    </div>
    `.concat(xgIconTips(this,e,this.playerConfig.isHideTips),`
    </xg-icon>`)}}},{key:"lockScreen",value:function(e){try{screen.orientation.lock(e).catch(function(i){})}catch{}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch(function(e){})}catch{}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),r}(Icon),Time=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),e.isActiving=!1,e}return _createClass$3(r,[{key:"duration",get:function(){var e=this.player,i=e.offsetDuration,n=e.duration;return this.playerConfig.customDuration||i||n}},{key:"currentTime",get:function(){var e=this.player,i=e.offsetCurrentTime,n=e.currentTime;return i>=0?i:n}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this.player.controls.config.mode;this.mode=e==="flex"?"flex":"normal",!this.config.disable&&(this.mode==="flex"&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;this.on([DURATION_CHANGE,SEEKED,TIME_UPDATE],function(i){i.eventName==="durationchange"&&(e.isActiving=!1),e.onTimeUpdate()}),this.on(ENDED,function(){e.onTimeUpdate(!0)}),this.on(EMPTIED,function(){e.onReset()})}},{key:"show",value:function(e){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="block"),this.centerDurDom&&(this.centerDurDom.style.display="block");return}this.root.style.display="block"}},{key:"hide",value:function(){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="none"),this.centerDurDom&&(this.centerDurDom.style.display="none");return}this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var i=this.player,n=this.config,s=this.duration;if(!(n.disable||this.isActiving||!i.hasStart)){var a=this.currentTime+this.timeOffset;a=util.adjustTimeByDuration(a,s,e),this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(util.format(a)),s!==1/0&&s>0&&(this.centerDurDom.innerHTML=util.format(s))):(this.timeDom.innerHTML=this.minWidthTime(util.format(a)),s!==1/0&&s>0&&(this.durationDom.innerHTML=util.format(s)))}}},{key:"onReset",value:function(){this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(util.format(0)),this.centerDurDom.innerHTML=util.format(0)):(this.timeDom.innerHTML=this.minWidthTime(util.format(0)),this.durationDom.innerHTML=util.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(!(!e.controls||!e.controls.center)){var i=e.controls.center;this.centerCurDom=util.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=util.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),i.children.length>0?i.insertBefore(this.centerCurDom,i.children[0]):i.appendChild(this.centerCurDom),i.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;if(this.duration===1/0||this.playerConfig.isLive?(util.hide(this.durationDom),util.hide(this.timeDom),util.hide(this.find(".time-separator")),util.show(this.find(".time-live-tag"))):util.hide(this.find(".time-live-tag")),e.hide){this.hide();return}this.show()}},{key:"changeLiveState",value:function(e){e?(util.hide(this.durationDom),util.hide(this.timeDom),util.hide(this.find(".time-separator")),util.show(this.find(".time-live-tag"))):(util.hide(this.find(".time-live-tag")),util.show(this.find(".time-separator")),util.show(this.durationDom),util.show(this.timeDom))}},{key:"updateTime",value:function(e){if(this.isActiving=!0,!(!e&&e!==0||e>this.duration)){if(this.mode==="flex"){this.centerCurDom.innerHTML=this.minWidthTime(util.format(e));return}this.timeDom.innerHTML=this.minWidthTime(util.format(e))}}},{key:"minWidthTime",value:function(e){return e.split(":").map(function(i){return'<span class="time-min-width">'.concat(i,"</span>")}).join(":")}},{key:"resetActive",value:function(){var e=this,i=this.player,n=function(){e.isActiving=!1};this.off(SEEKED,n),i.isSeeking&&i.media.seeking?this.once(SEEKED,n):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-time">
    <span class="time-current">00:00</span>
    <span class="time-separator">/</span>
    <span class="time-duration">00:00</span>
    <span class="time-live-tag">`.concat(this.i18n.LIVE_TIP,`</span>
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_LEFT,index:2,disable:!1}}}]),r}(Plugin),TimeSegmentsControls=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"_onDurationChange",function(){t.updateSegments();var s=t.player,a=s.currentTime,l=s.timeSegments;if(t._checkIfEnabled(l)){var c=util.getIndexByTime(a,l),f=util.getOffsetCurrentTime(a,l,c);t.player.offsetCurrentTime=f,t.changeIndex(c,l)}}),_defineProperty$3(_assertThisInitialized$3(t),"_onLoadedData",function(){var s=t.player.timeSegments;if(t._checkIfEnabled(s)){var a=util.getOffsetCurrentTime(0,s);t.player.offsetCurrentTime=a,t.changeIndex(0,s),t.curPos.start>0&&(t.player.currentTime=t.curPos.start)}}),_defineProperty$3(_assertThisInitialized$3(t),"_onTimeupdate",function(){var s=t.player,a=s.currentTime,l=s.timeSegments;if(t._checkIfEnabled(l)){var c=l.length;t.lastCurrentTime=a;var f=util.getIndexByTime(a,l);f!==t.curIndex&&t.changeIndex(f,l);var h=util.getOffsetCurrentTime(a,l,f);if(t.player.offsetCurrentTime=h,!!t.curPos){var p=t.curPos,d=p.start,v=p.end;a<d?t.player.currentTime=d:a>v&&f>=c-1&&t.player.pause()}}}),_defineProperty$3(_assertThisInitialized$3(t),"_onSeeking",function(){var s=t.player,a=s.currentTime,l=s.timeSegments;if(t._checkIfEnabled(l))if(a<l[0].start)t.player.currentTime=l[0].start;else if(a>l[l.length-1].end)t.player.currentTime=l[l.length-1].end;else{var c=util.getIndexByTime(a,l);if(c>=0){var f=t.getSeekTime(a,t.lastCurrentTime,c,l);f>=0&&(t.player.currentTime=f)}}}),_defineProperty$3(_assertThisInitialized$3(t),"_onPlay",function(){var s=t.player,a=s.currentTime,l=s.timeSegments;t._checkIfEnabled(l)&&a>=l[l.length-1].end&&(t.player.currentTime=l[0].start)}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(DURATION_CHANGE,this._onDurationChange),this.on(LOADED_DATA,this._onLoadedData),this.on(TIME_UPDATE,this._onTimeupdate),this.on(SEEKING,this._onSeeking),this.on(PLAY,this._onPlay)}},{key:"setConfig",value:function(e){var i=this;if(e){var n=Object.keys(e);n.length<1||(n.forEach(function(s){i.config[s]=e[s]}),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,i=e.disable,n=e.segments,s=this.player;if(i||!n||n.length===0)s.timeSegments=[],s.offsetDuration=0,s.offsetCurrentTime=-1;else{var a=this.formatTimeSegments(n,s.duration);s.timeSegments=a,s.offsetDuration=a.length>0?a[a.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,i){var n=[];return e?(e.sort(function(s,a){return s.start-a.start}),e.forEach(function(s,a){var l={};if(l.start=s.start<0?0:s.start,l.end=i>0&&s.end>i?i:s.end,!(i>0&&l.start>i)){n.push(l);var c=l.end-l.start;if(a===0)l.offset=s.start,l.cTime=0,l.segDuration=c,l.duration=c;else{var f=n[a-1];l.offset=f.offset+(l.start-f.end),l.cTime=f.duration+f.cTime,l.segDuration=c,l.duration=f.duration+c}}}),n):[]}},{key:"getSeekTime",value:function(e,i,n,s){var a=-1,l=s[n],c=l.start,f=l.end;if(e>=c&&e<=f)return a;var h=e-i;if(h<0&&e<c){var p=i>c?i-c:0;return a=n-1>=0?s[n-1].end+h+p:0,a}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,i){this.curIndex=e,e>=0&&i.length>0?this.curPos=i[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),r}(BasePlugin);function volumeLargeSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function volumeSmallSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function volumeMutedSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>
</svg>
`,"image/svg+xml").firstChild}var Volume=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onBarMousedown",function(s){var a=_assertThisInitialized$3(t),l=a.player,c=t.find(".xgplayer-bar");util.event(s);var f=c.getBoundingClientRect(),h=util.getEventPos(s,l.zoom),p=f.height-(h.clientY-f.top);if(h.h=p,h.barH=f.height,t.pos=h,!(p<-2))return t.updateVolumePos(p,s),document.addEventListener("mouseup",t.onBarMouseUp),t._d.isStart=!0,!1}),_defineProperty$3(_assertThisInitialized$3(t),"onBarMouseMove",function(s){var a=_assertThisInitialized$3(t),l=a._d;if(l.isStart){var c=_assertThisInitialized$3(t),f=c.pos,h=c.player;s.preventDefault(),s.stopPropagation(),util.event(s);var p=util.getEventPos(s,h.zoom);l.isMoving=!0;var d=f.h-p.clientY+f.clientY;d>f.barH||t.updateVolumePos(d,s)}}),_defineProperty$3(_assertThisInitialized$3(t),"onBarMouseUp",function(s){util.event(s),document.removeEventListener("mouseup",t.onBarMouseUp);var a=_assertThisInitialized$3(t),l=a._d;l.isStart=!1,l.isMoving=!1}),_defineProperty$3(_assertThisInitialized$3(t),"onMouseenter",function(s){t._d.isActive=!0,t.focus(),t.emit("icon_mouseenter",{pluginName:t.pluginName})}),_defineProperty$3(_assertThisInitialized$3(t),"onMouseleave",function(s){t._d.isActive=!1,t.unFocus(100,!1,s),t.emit("icon_mouseleave",{pluginName:t.pluginName})}),_defineProperty$3(_assertThisInitialized$3(t),"onVolumeChange",function(s){if(t.player){var a=t.player,l=a.muted,c=a.volume;t._d.isMoving||(t.find(".xgplayer-drag").style.height=l||c===0?"4px":"".concat(c*100,"%"),t.config.showValueLabel&&t.updateVolumeValue()),t.animate(l,c)}}),t}return _createClass$3(r,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:volumeSmallSvg,class:"xg-volume-small"},volumeLarge:{icon:volumeLargeSvg,class:"xg-volume"},volumeMuted:{icon:volumeMutedSvg,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var i=this.playerConfig,n=i.commonStyle,s=i.volume;n.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=n.volumeColor),this.changeMutedHandler=this.hook("mutedChange",function(a){e.changeMuted(a)},{pre:function(l){l.preventDefault(),l.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),sniffer.device!=="mobile"&&this.playerConfig.isMobileSimulateMode!=="mobile"&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(VOLUME_CHANGE,this.onVolumeChange),this.once(LOADED_DATA,this.onVolumeChange),util.typeOf(s)!=="Number"&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,i){var n=this.player,s=this.find(".xgplayer-drag"),a=this.find(".xgplayer-bar");if(!(!a||!s)){var l=parseInt(e/a.getBoundingClientRect().height*1e3,10);s.style.height="".concat(e,"px");var c=Math.max(Math.min(l/1e3,1),0),f={volume:{from:n.volume,to:c}};n.muted&&(f.muted={from:!0,to:!1}),this.emitUserAction(i,"change_volume",{muted:n.muted,volume:n.volume,props:f}),n.volume=Math.max(Math.min(l/1e3,1),0),n.muted&&(n.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,i=e.volume,n=e.muted,s=this.find(".xgplayer-value-label"),a=Math.max(Math.min(i,1),0);s.innerText=n?0:Math.round(a*100)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(util.clearTimeout(this,this._timerId),this._timerId=null),util.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=arguments.length>2?arguments[2]:void 0,a=this._d,l=this.player;a.isActive||(this._timerId&&(util.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=util.setTimeout(this,function(){a.isActive||(n?l.blur():l.focus(),util.removeClass(e.root,"slide-show"),a.isStart&&e.onBarMouseUp(s)),e._timerId=null},i))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var i=this.player,n=this._d;n.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:i.muted,volume:i.volume,props:{muted:{from:i.muted,to:!i.muted}}}),i.volume>0&&(i.muted=!i.muted),i.volume<.01&&(i.volume=this.config.miniVolume)}},{key:"animate",value:function(e,i){e||i===0?this.setAttr("data-state","mute"):i<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(util.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon",sniffer.device==="mobile"?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,i=this.config.showValueLabel;return`
    <xg-icon class="xgplayer-volume" data-state="normal">
      <div class="xgplayer-icon">
      </div>
      <xg-slider class="xgplayer-slider">
        `.concat(i?'<div class="xgplayer-value-label">'.concat(e*100,"</div>"):"",`
        <div class="xgplayer-bar">
          <xg-drag class="xgplayer-drag" style="height: `).concat(e*100,`%"></xg-drag>
        </div>
      </xg-slider>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),r}(Plugin);function RotateSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">
  <g>
    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>
    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>
  </g>
  <defs>
    <clipPath>
      <rect width="40" height="40" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,"image/svg+xml").firstChild}var Rotate=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),e.rotateDeg=e.config.rotateDeg||0,e}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(VIDEO_RESIZE,function(){e.rotateDeg&&e.config.innerRotate&&util.setTimeout(e,function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)},100)});var i=this.player.root;this.rootWidth=i.style.width||i.offsetWidth||i.clientWidth,this.rootHeight=i.style.height||i.offsetHeight||i.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,i){if(e||(e=0),i){this.player.videoRotateDeg=e;return}var n=this.player,s=this.rootWidth,a=this.rootHeight,l=n.root,c=n.innerContainer,f=n.media,h=l.offsetWidth,p=c&&i?c.offsetHeight:l.offsetHeight,d=s,v=a,g=0,y=0;(e===.75||e===.25)&&(d="".concat(p,"px"),v="".concat(h,"px"),g=-(p-h)/2,y=-(h-p)/2);var m="translate(".concat(g,"px,").concat(y,"px) rotate(").concat(e,"turn)"),S={transformOrigin:"center center",transform:m,webKitTransform:m,height:v,width:d},_=i?f:l,A=i?n.getPlugin("poster"):null;Object.keys(S).map(function(k){_.style[k]=S[k],A&&A.root&&(A.root.style[k]=S[k])})}},{key:"rotate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=this.player;this.rotateDeg||(this.rotateDeg=0);var a=e?1:-1;this.rotateDeg=(this.rotateDeg+1+a*.25*n)%1,this.updateRotateDeg(this.rotateDeg,i),s.emit(ROTATE,this.rotateDeg*360)}},{key:"registerIcons",value:function(){return{rotate:RotateSvg}}},{key:"render",value:function(){if(!this.config.disable)return`
    <xg-icon class="xgplayer-rotate">
      <div class="xgplayer-icon">
      </div>
      `.concat(xgIconTips(this,"ROTATE_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),r}(Icon);function PipIcon(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}function PipIconExit(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}var PresentationMode={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},PIP=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"switchPIP",function(s){if(!t.isPIPAvailable())return!1;s.stopPropagation&&s.stopPropagation(),t.isPip?(t.exitPIP(),t.emitUserAction(s,"change_pip",{props:"pip",from:!0,to:!1}),t.setAttr("data-state","normal")):t.player.media.readyState===4&&(t.requestPIP(),t.emitUserAction(s,"change_pip",{props:"pip",from:!1,to:!0}),t.setAttr("data-state","pip"))}),t}return _createClass$3(r,[{key:"beforeCreate",value:function(e){typeof e.player.config.pip=="boolean"&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),this.pMode=PresentationMode.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(COMPLETE,function(){e.config.showIcon&&(util.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))}))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:PipIcon,class:"xg-get-pip"},pipIconExit:{icon:PipIconExit,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,i=this.player;this.leavePIPCallback=function(){var n=i.paused;util.setTimeout(e,function(){!n&&i.mediaPlay()},0),!n&&i.mediaPlay(),e.setAttr("data-state","normal"),e.pipWindow=null,i.emit(PIP_CHANGE,!1)},this.enterPIPCallback=function(n){i.emit(PIP_CHANGE,!0),n!=null&&n.pictureInPictureWindow&&(e.pipWindow=n.pictureInPictureWindow),e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(n){var s=i.media.webkitPresentationMode;e.pMode===PresentationMode.FULLSCREEN&&s!==PresentationMode.FULLSCREEN&&i.onFullscreenChange(null,!1),e.pMode=s,s===PresentationMode.PIP?e.enterPIPCallback(n):s===PresentationMode.INLINE&&e.leavePIPCallback(n)},i.media&&(i.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),i.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),r.checkWebkitSetPresentationMode(i.media)&&i.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(e){var i=_toConsumableArray$1(document.styleSheets).map(function(s){try{return _toConsumableArray$1(s.cssRules).map(function(l){return l.cssText}).join("")}catch{var a=document.createElement("link");a.rel="stylesheet",a.type=s.type,a.media=s.media,a.href=s.href,e.document.head.appendChild(a)}return""}).filter(Boolean).join(`
`),n=document.createElement("style");n.textContent=i,e.document.head.appendChild(n)}},{key:"requestPIP",value:function(){var e=this,i=this.player,n=this.playerConfig,s=this.config;if(!(!this.isPIPAvailable()||this.isPip))try{var a=n.poster;if(a&&(i.media.poster=util.typeOf(a)==="String"?a:a.poster),s.preferDocument&&this.isDocPIPAvailable()){var l={};if(s.width&&s.height)l.width=s.width,l.height=s.height;else{var c=i.root.getBoundingClientRect();l.width=c.width,l.height=c.height}documentPictureInPicture.requestWindow(l).then(function(f){var h=s.docPiPNode,p=s.docPiPStyle;e.enterPIPCallback();var d=h||i.root,v=d.parentElement,g=d.previousSibling,y=d.nextSibling;e.copyStyleIntoPiPWindow(f);var m=document.createElement("style");if(m.append("body{padding:0; margin:0;}"),p){var S="";typeof p=="string"?S=p:typeof p=="function"&&(S=p.call(s)),S&&m.append(S)}else d===i.root&&m.append(`
              .xgplayer{width: 100%!important; height: 100%!important;}
            `);f.document.head.append(m),f.document.body.append(d),f.addEventListener("pagehide",function(_){v&&(y?v.insertBefore(d,y):g?v.insertBefore(d,g.nextSibling):v.appendChild(d)),e.leavePIPCallback()},{once:!0})})}else r.checkWebkitSetPresentationMode(i.media)?i.media.webkitSetPresentationMode("picture-in-picture"):i.media.requestPictureInPicture();return!0}catch(f){return console.error("requestPiP",f),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{if(this.isPIPAvailable()&&this.isPip){var i;this.isDocPIPAvailable()&&(i=documentPictureInPicture)!==null&&i!==void 0&&i.window?documentPictureInPicture.window.close():r.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()}return!0}catch(n){return console.error("exitPIP",n),!1}}},{key:"isPip",get:function(){var e,i=this.player;return!!(this.isDocPIPAvailable()&&(e=documentPictureInPicture)!==null&&e!==void 0&&e.window)||document.pictureInPictureElement&&document.pictureInPictureElement===i.media||i.media.webkitPresentationMode===PresentationMode.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,i=util.typeOf(document.pictureInPictureEnabled)==="Boolean"?document.pictureInPictureEnabled:!1;return i&&(util.typeOf(e.disablePictureInPicture)==="Boolean"&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&util.typeOf(e.webkitSetPresentationMode)==="Function")||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),r.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(!(!this.config.showIcon||!this.isPIPAvailable()))return`<xg-icon class="xgplayer-pip">
      <div class="xgplayer-icon xg-icon-disable">
      </div>
      `.concat(xgIconTips(this,"PIP",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(e){return typeof e.webkitSetPresentationMode=="function"}}]),r}(Icon);function Next(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">
  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>
</svg>
`,"image/svg+xml").firstChild}var PlayNextIcon=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"playNext",function(i){var n=_assertThisInitialized$3(e),s=n.player;i.preventDefault(),i.stopPropagation(),e.idx+1<e.config.urlList.length?(e.idx++,e.nextHandler(e.config.urlList[e.idx],e.idx),s.emit(PLAYNEXT,e.idx+1)):(e.nextHandler(),s.emit(PLAYNEXT))}),e.idx=-1,e}return _createClass$3(r,[{key:"afterCreate",value:function(){!this.config.urlList||this.config.urlList.length===0||(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Next}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e=sniffer.device==="mobile"?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var i=this.player;e&&(i.pause(),i.currentTime=0,i.switchURL?i.switchURL(e):i.src=e,i.config.url=e,i.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(!(!this.config.urlList||this.config.urlList.length===0))return`
     <xg-icon class="xgplayer-playnext">
      <div class="xgplayer-icon">
      </div>
      `.concat(xgIconTips(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),`
     </xg-icon>
    `)}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),r}(Plugin),download={exports:{}};(function(o,u){(function(r,t){o.exports=t()})(commonjsGlobal,function(){return function r(t,e,i){var n=window,s="application/octet-stream",a=i||s,l=t,c=!e&&!i&&l,f=document.createElement("a"),h=function(w){return String(w)},p=n.Blob||n.MozBlob||n.WebKitBlob||h,d=e||"download",v,g;if(p=p.call?p.bind(n):Blob,String(this)==="true"&&(l=[l,a],a=l[0],l=l[1]),c&&c.length<2048&&(d=c.split("/").pop().split("?")[0],f.href=c,f.href.indexOf(c)!==-1)){var y=new XMLHttpRequest;return y.open("GET",c,!0),y.responseType="blob",y.onload=function(w){r(w.target.response,d,s)},setTimeout(function(){y.send()},0),y}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(l))if(l.length>1024*1024*1.999&&p!==h)l=A(l),a=l.type||s;else return navigator.msSaveBlob?navigator.msSaveBlob(A(l),d):k(l);else if(/([\x80-\xff])/.test(l)){var m=0,S=new Uint8Array(l.length),_=S.length;for(m;m<_;++m)S[m]=l.charCodeAt(m);l=new p([S],{type:a})}v=l instanceof p?l:new p([l],{type:a});function A(w){var I=w.split(/[:;,]/),N=I[1],x=I[2]=="base64"?atob:decodeURIComponent,M=x(I.pop()),b=M.length,T=0,C=new Uint8Array(b);for(T;T<b;++T)C[T]=M.charCodeAt(T);return new p([C],{type:N})}function k(w,I){if("download"in f)return f.href=w,f.setAttribute("download",d),f.className="download-js-link",f.innerHTML="downloading...",f.style.display="none",document.body.appendChild(f),setTimeout(function(){f.click(),document.body.removeChild(f),I===!0&&setTimeout(function(){n.URL.revokeObjectURL(f.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(w)&&(w="data:"+w.replace(/^data:([\w\/\-\+]+)/,s)),window.open(w)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=w),!0;var N=document.createElement("iframe");document.body.appendChild(N),!I&&/^data:/.test(w)&&(w="data:"+w.replace(/^data:([\w\/\-\+]+)/,s)),N.src=w,setTimeout(function(){document.body.removeChild(N)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(v,d);if(n.URL)k(n.URL.createObjectURL(v),!0);else{if(typeof v=="string"||v.constructor===h)try{return k("data:"+a+";base64,"+n.btoa(v))}catch{return k("data:"+a+","+encodeURIComponent(v))}g=new FileReader,g.onload=function(w){k(this.result)},g.readAsDataURL(v)}return!0}})})(download);var downloadExports=download.exports;const downloadUtil=getDefaultExportFromCjs(downloadExports);function DownloadSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">
      <g id="Group-2">
        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">
          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>
          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>
          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>
          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>
        </g>
      </g>
    </g>
  </g>
</svg>
`,"image/svg+xml").firstChild}var Download=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"download",function(i){if(!e.isLock){e.emitUserAction(i,"download");var n=e.playerConfig.url,s="";util.typeOf(n)==="String"?s=n:util.typeOf(n)==="Array"&&n.length>0&&(s=n[0].src);var a=e.getAbsoluteURL(s);downloadUtil(a),e.isLock=!0,e.timer=window.setTimeout(function(){e.isLock=!1,window.clearTimeout(e.timer),e.timer=null},300)}}),e.timer=null,e.isLock=!1,e}return _createClass$3(r,[{key:"afterCreate",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(i){i.preventDefault(),i.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:DownloadSvg}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var i=document.createElement("div");i.innerHTML='<a href="'.concat(e,'">x</a>'),e=i.firstChild.href}return e}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">
   <div class="xgplayer-icon">
   </div>
   `.concat(xgIconTips(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:3,disable:!0}}}]),r}(Icon),ScreenShot=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"beforeCreate",value:function(e){typeof e.player.config.screenShot=="boolean"&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(i){e.fitVideo&&(e.width=i.vWidth,e.height=i.vHeight)},this.once(VIDEO_RESIZE,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,i){var n=document.createElement("a");n.href=e,n.download=i;var s;try{typeof MouseEvent<"u"?s=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(s=document.createEvent("MouseEvents"),s.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null))}catch(a){console.error("MouseEvent unsupported",a)}s&&n.dispatchEvent(s)}},{key:"createCanvas",value:function(e,i){var n=document.createElement("canvas"),s=n.getContext("2d");this.canvasCtx=s,this.canvas=n,n.width=e||this.config.width,n.height=i||this.config.height,s.imageSmoothingEnabled=!0,s.imageSmoothingEnabled&&(s.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var i=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var n=this.config;this.shot(n.width,n.height).then(function(s){i.emit(SCREEN_SHOT,s),n.saveImg&&i.saveScreenShot(s,n.name+n.format)})}},{key:"shot",value:function(e,i){var n=this,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{quality:.92,type:"image/png"},a=this.config,l=this.player,c=s.quality||a.quality,f=s.type||a.type;return new Promise(function(h,p){var d=null,v;if(l.media.canvas)d=l.media.canvas;else{n.canvas?(n.canvas.width=e||a.width,n.canvas.height=i||a.height):n.createCanvas(e,i),d=n.canvas,v=n.canvasCtx;var g=l.media.videoWidth/l.media.videoHeight,y=d.width/d.height,m=0,S=0,_=l.media.videoWidth,A=l.media.videoHeight,k,w,I,N;g>y?(I=d.width,N=d.width/g,k=0,w=Math.round((d.height-N)/2)):g===y?(I=d.width,N=d.height,k=0,w=0):g<y&&(I=d.height*g,N=d.height,k=Math.round((d.width-I)/2),w=0),v.drawImage(l.media,m,S,_,A,k,w,I,N)}var x=d.toDataURL(f,c).replace(f,"image/octet-stream");x=x.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),h(x)})}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(VIDEO_RESIZE,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",i="SCREENSHOT";return`
      <xg-icon class="xgplayer-shot">
      <div class="`.concat(e,`">
      `).concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[i],'">').concat(this.i18n[i],"</span>"),`
      </div>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),r}(Icon),OptionList=function(){function o(u){_classCallCheck$3(this,o),this.config=u.config,this.parent=u.root,this.root=util.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),u.root.appendChild(this.root);var r=this.config.maxHeight;r&&this.setStyle({maxHeight:r}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var t=this.config.domEventType==="touch"?"touchend":"click";this._delegates=Plugin.delegate.call(this,this.root,"li",t,this.onItemClick)}return _createClass$3(o,[{key:"renderItemList",value:function(r){var t=this,e=this.config,i=this.root;r?e.data=r:r=e.data,e.style&&Object.keys(e.style).map(function(n){i.style[n]=e[n]}),r.length>0&&(this.attrKeys=Object.keys(r[0])),this.root.innerHTML="",r.map(function(n,s){var a=n.selected?"option-item selected":"option-item";n["data-index"]=s,t.root.appendChild(util.createDom("li","<span>".concat(n.showText,"</span>"),n,a))})}},{key:"onItemClick",value:function(r){r.delegateTarget||(r.delegateTarget=r.target);var t=r.delegateTarget;if(t&&util.hasClass(t,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,i=this.root.querySelector(".selected");util.addClass(t,"selected"),i&&util.removeClass(i,"selected"),e(r,{from:i?this.getAttrObj(i,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(r,t){if(!r||!t)return{};var e={};t.map(function(n){e[n]=r.getAttribute(n)});var i=r.getAttribute("data-index");return i&&(e.index=Number(i)),e}},{key:"show",value:function(){util.removeClass(this.root,"hide"),util.addClass(this.root,"active")}},{key:"hide",value:function(){util.removeClass(this.root,"active"),util.addClass(this.root,"hide")}},{key:"setStyle",value:function(r){var t=this;Object.keys(r).forEach(function(e){t.root.style[e]=r[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(r){r.destroy&&r.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),o}(),LIST_TYPES={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},TOGGLE_MODES={CLICK:"click",HOVER:"hover"};function getListClassName(o,u){return o===LIST_TYPES.SIDE?u===POSITIONS.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var IS_MOBILE=sniffer.device==="mobile",OptionsIcon=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"onEnter",function(i){i.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(i)}),_defineProperty$3(_assertThisInitialized$3(e),"switchActiveState",function(i){i.stopPropagation();var n=e.config.toggleMode;n===TOGGLE_MODES.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),_defineProperty$3(_assertThisInitialized$3(e),"onLeave",function(i){i.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==LIST_TYPES.SIDE&&e.isActive&&e.toggle(!1)}),_defineProperty$3(_assertThisInitialized$3(e),"onListEnter",function(i){e.enterType=2}),_defineProperty$3(_assertThisInitialized$3(e),"onListLeave",function(i){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return _createClass$3(r,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,i=this.config;this.initIcons(),IS_MOBILE=IS_MOBILE||this.domEventType==="touch",IS_MOBILE&&sniffer.device==="mobile"&&i.listType===LIST_TYPES.DEFAULT&&(i.listType=LIST_TYPES.SIDE),i.hidePortrait&&util.addClass(this.root,"portrait"),this.on([VIDEO_RESIZE,FULLSCREEN_CHANGE],function(){e._resizeList()}),this.once(CANPLAY,function(){i.list&&i.list.length>0&&(e.renderItemList(i.list),e.show())}),IS_MOBILE&&this.on(PLAYER_FOCUS,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),IS_MOBILE?(i.toggleMode=TOGGLE_MODES.CLICK,this.activeEvent="touchend"):this.activeEvent=i.toggleMode===TOGGLE_MODES.CLICK?"click":"mouseenter",i.toggleMode===TOGGLE_MODES.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,i=this.icons,n=Object.keys(i),s=!1;n.length>0&&(n.forEach(function(a){e.appendChild(".xgplayer-icon",i[a]),!s&&(s=i[a])}),this.isIcons=s),!s&&(this.appendChild(".xgplayer-icon",util.createDom("span","",{},"icon-text")),util.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||util.addClass(this.root,"show")}},{key:"hide",value:function(){util.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,i,n){if(e===void 0)return"";var s=this.config.list;!n&&(n=this.player.lang),i=!i||util.isUndefined(e[i])?"text":i,typeof e=="number"&&(e=s[e]);try{return _typeof$2(e[i])==="object"?e[i][n]||e[i].en:e[i]}catch(a){return console.warn(a),""}}},{key:"toggle",value:function(e){if(!(e===this.isActive||this.config.disable)){var i=this.player.controls,n=this.config.listType;e?(n===LIST_TYPES.SIDE?i.blur():i.focus(),this.optionsList&&this.optionsList.show()):(n===LIST_TYPES.SIDE?i.focus():i.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,i){e.stopPropagation();var n=this.config,s=n.listType,a=n.list;this.curIndex=i.to.index,this.curItem=a[this.curIndex],this.changeCurrentText();var l=this.config.isItemClickHide;(l||IS_MOBILE||s===LIST_TYPES.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,i=this.curIndex<e.length?this.curIndex:0,n=e[i];n&&(this.find(".icon-text").innerHTML=this.getTextByLang(n,"iconText"))}}},{key:"renderItemList",value:function(e,i){var n=this,s=this.config,a=this.optionsList,l=this.player;if(typeof i=="number"&&(this.curIndex=i,this.curItem=s.list[i]),a){a.renderItemList(e),this.changeCurrentText();return}var c={config:{data:e||[],className:getListClassName(s.listType,s.position),onItemClick:function(v,g){n.onItemClick(v,g)},domEventType:IS_MOBILE?"touch":"mouse"},root:s.listType===LIST_TYPES.SIDE?l.innerContainer||l.root:this.root};if(this.config.isShowIcon){var f=this.player.root.getBoundingClientRect(),h=f.height,p=s.listType===LIST_TYPES.MIDDLE?h-50:h;p&&s.heightLimit&&(c.config.maxHeight="".concat(p,"px")),this.optionsList=new OptionList(c),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),i=e.height,n=this.config.listType===LIST_TYPES.MIDDLE?i-50:i;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(n,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===TOGGLE_MODES.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:TOGGLE_MODES.HOVER,heightLimit:!0}}}]),r}(Plugin),DefinitionIcon=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),e.curTime=0,e.isPaused=!0,e}return _createClass$3(r,[{key:"beforeCreate",value:function(e){var i=e.config.list;Array.isArray(i)&&i.length>0&&(e.config.list=i.map(function(n){return!n.text&&n.name&&(n.text=n.name),n.text||(n.text=n.definition),n}))}},{key:"afterCreate",value:function(){var e=this;_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),this.on("resourceReady",function(i){e.changeDefinitionList(i)}),this.on(DEFINITION_CHANGE,function(i){e.renderItemList(e.config.list,i.to)}),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||util.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,i=e.list,n=e.defaultDefinition;if(i.length>0){var s=null;i.map(function(a){a.definition===n&&(s=a)}),s||(s=i[0]),this.changeDefinition(s)}}},{key:"renderItemList",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.list||[],n=arguments.length>1?arguments[1]:void 0,s=n&&n.definition?n.definition:this.config.defaultDefinition;n&&i.forEach(function(c){c.selected=!1});var a=0,l=i.map(function(c,f){var h=_objectSpread2$2(_objectSpread2$2({},c),{},{showText:e.getTextByLang(c)||c.definition,selected:!1});return(c.selected||c.definition&&c.definition==s)&&(h.selected=!0,a=f),h});_get$1(_getPrototypeOf$3(r.prototype),"renderItemList",this).call(this,l,a)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map(function(i){return!i.text&&i.name&&(i.text=i.name),i.text||(i.text=i.definition),i}),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,i){this.player.changeDefinition(e,i)}},{key:"onItemClick",value:function(e,i){var n=this.player.definitionList;_get$1(_getPrototypeOf$3(r.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:i.from,to:i.to});for(var s=0;s<n.length;s++)i.to&&n[s].definition===i.to.definition&&(i.to.url=n[s].url),i.from&&n[s].definition===i.from.definition&&(i.from.url=n[s].url);this.player.changeDefinition(i.to,i.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return _objectSpread2$2(_objectSpread2$2({},OptionsIcon.defaultConfig),{},{position:POSITIONS.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),r}(OptionsIcon),PlaybackRate=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),e.curRate=1,e}return _createClass$3(r,[{key:"beforeCreate",value:function(e){var i=e.player.config.playbackRate,n=i?Array.isArray(i)?i:e.config.list:[];Array.isArray(n)&&(e.config.list=n.map(function(s){return typeof s=="number"?s={rate:s,text:"".concat(s,"x")}:!s.text&&s.rate&&(s.text="".concat(s.rate,"x")),s}))}},{key:"afterCreate",value:function(){var e=this;_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),this.on(RATE_CHANGE,function(){e.curValue!==e.player.playbackRate&&e.renderItemList()}),this.renderItemList()}},{key:"show",value:function(e){!this.config.list||this.config.list.length===0||_get$1(_getPrototypeOf$3(r.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,i){_get$1(_getPrototypeOf$3(r.prototype),"onItemClick",this).call(this,e,i);var n=e.delegateTarget,s=Number(n.getAttribute("rate"));if(!s||s===this.curValue)return!1;var a={playbackRate:{from:this.player.playbackRate,to:s}};this.emitUserAction(e,"change_rate",{props:a}),this.curValue=s,this.player.playbackRate=s}},{key:"renderItemList",value:function(){var e=this,i=this.player.playbackRate||1;this.curValue=i;var n=-1,s=this.config.list.map(function(a,l){var c={rate:a.rate};return c.rate===i&&(c.selected=!0,n=l),c.showText=e.getTextByLang(a),c});_get$1(_getPrototypeOf$3(r.prototype),"renderItemList",this).call(this,s,n)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,i=this.curIndex<e.length?this.curIndex:0,n=e[i],s="";!n||this.curIndex<0?s="".concat(this.player.playbackRate,"x"):s=this.getTextByLang(n,"iconText"),this.find(".icon-text").innerHTML=s}}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return _objectSpread2$2(_objectSpread2$2({},OptionsIcon.defaultConfig),{},{position:POSITIONS.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),r}(OptionsIcon);function CssFullSceenSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" class='path_full' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}function ExitCssFullSceenSvg(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}var CssFullScreen=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"beforeCreate",value:function(e){typeof e.player.config.cssFullscreen=="boolean"&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;_get$1(_getPrototypeOf$3(r.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(CSS_FULLSCREEN_CHANGE,function(i){e.animate(i)}),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,i=this.find(".xgplayer-icon");i.appendChild(e.cssFullscreen),i.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var i=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:i}),i?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var i=this.i18nKeys,n=this.find(".xg-tips");n&&this.changeLangTextKey(n,e?i.EXITCSSFULLSCREEN_TIPS:i.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:CssFullSceenSvg,class:"xg-get-cssfull"},exitCssFullscreen:{icon:ExitCssFullSceenSvg,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){_get$1(_getPrototypeOf$3(r.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class='xgplayer-cssfullscreen'>
    <div class="xgplayer-icon">
    </div>
    `.concat(xgIconTips(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),r}(Icon),ErrorPlugin=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(ERROR,function(i){e.onError(i)})}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=this.player,n=e.errorType,s=i.errorNote?this.i18n[i.errorNote]:"";if(!s)switch(n){case"decoder":s=this.i18n.MEDIA_ERR_DECODE;break;case"network":s=this.i18n.MEDIA_ERR_NETWORK;break;default:s=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=s,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return`<xg-error class="xgplayer-error">
      <div class="xgplayer-errornote">
       <span class="xgplayer-error-text"></span>
       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>
      </div>
    </xg-error>`}}],[{key:"pluginName",get:function(){return"error"}}]),r}(Plugin),Prompt=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],function(i){(e.config.onClick||e.customOnClick)&&(i.preventDefault(),i.stopPropagation(),e.customOnClick?e.customOnClick(i):e.config.onClick(i))}),this.player.showPrompt=function(){e.showPrompt.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var i=this;Object.keys(e).map(function(n){i.root.style[n]=e[n]})}},{key:"showPrompt",value:function(e){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(e){this.customOnClick=s;var a=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),util.addClass(this.root,"show"),n.mode==="arrow"&&util.addClass(this.root,"arrow"),typeof e=="string"?this.find(".xgplayer-prompt-detail").innerHTML=e:this.find(".xgplayer-prompt-detail").innerHTML="".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),n.style&&this.setStyle(n.style);var l=typeof n.autoHide=="boolean"?n.autoHide:this.config.autoHide;if(l){var c=n.interval||a;this.intervalId=setTimeout(function(){i.hide()},c)}}}},{key:"hide",value:function(){util.removeClass(this.root,"show"),util.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(STATE_CLASS.CONTROLS_FOLLOW,`">
    <span class="xgplayer-prompt-detail"></span>
    </xg-prompt>`)}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),r}(Plugin),ISPOT={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function mergeISPOT(o){Object.keys(ISPOT).map(function(u){o[u]===void 0&&(o[u]=ISPOT[u])})}var APIS={_updateDotDom:function o(u,r){if(r){var t=this.calcuPosition(u.time,u.duration),e=u.style||{};e.left="".concat(t.left,"%"),e.width="".concat(t.width,"%"),r.setAttribute("data-text",u.text),r.setAttribute("data-time",u.time),t.isMini?util.addClass(r,"mini"):util.removeClass(r,"mini"),Object.keys(e).map(function(i){r.style[i]=e[i]})}},initDots:function o(){var u=this;this._ispots.map(function(r){u.createDot(r,!1)}),this.ispotsInit=!0},createDot:function o(u){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.player.plugins.progress;if(t&&(r&&(mergeISPOT(u),this._ispots.push(u)),!(!this.ispotsInit&&r))){var e=this.calcuPosition(u.time,u.duration),i=u.style||{};i.left="".concat(e.left,"%"),i.width="".concat(e.width,"%");var n="xgspot_".concat(u.id," xgplayer-spot");e.isMini&&(n+=" mini");var s=u.template?'<div class="xgplayer-spot-pop">'.concat(u.template,"</div>"):"",a=util.createDom("xg-spot",s,{"data-text":u.text,"data-time":u.time,"data-id":u.id},n);Object.keys(i).map(function(l){a.style[l]=i[l]}),t.outer&&t.outer.appendChild(a),this.positionDot(a,u.id)}},findDot:function o(u){if(this.player.plugins.progress){var r=this._ispots.filter(function(t,e){return t.id===u});return r.length>0?r[0]:null}},updateDot:function o(u){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=this.player.plugins.progress;if(t){var e=this.findDot(u.id);if(e&&Object.keys(u).map(function(n){e[n]=u[n]}),!!this.ispotsInit){var i=t.find('xg-spot[data-id="'.concat(u.id,'"]'));i&&(this._updateDotDom(u,i),r&&this.showDot(u.id))}}},deleteDot:function o(u){var r=this._ispots,t=this.player.plugins.progress;if(t){for(var e=[],i=0;i<r.length;i++)r[i].id===u&&e.push(i);for(var n=e.length,s=n-1;s>=0;s--)if(r.splice(e[s],1),this.ispotsInit){var a=t.find('xg-spot[data-id="'.concat(u,'"]'));a&&a.parentElement.removeChild(a)}}},deleteAllDots:function o(){var u=this.player.plugins.progress;if(u){if(!this.ispotsInit){this._ispots=[];return}for(var r=u.root.getElementsByTagName("xg-spot"),t=r.length-1;t>=0;t--)u.outer.removeChild(r[t]);this._ispots=[]}},updateAllDots:function o(){var u=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=this.player.plugins.progress;if(t){if(!this.ispotsInit){this._ispots=r;return}this._ispots=[];var e=t.root.getElementsByTagName("xg-spot"),i=e.length;if(i>r.length)for(var n=i-1;n>r.length-1;n--)t.outer.removeChild(e[n]);r.forEach(function(s,a){a<i?(e[a].setAttribute("data-id","".concat(s.id)),u._ispots.push(s),u.updateDot(s)):u.createDot(s)})}},positionDots:function o(){var u=this,r=this._ispots,t=this.playerSize,e=this.player.sizeInfo,i=this.player.plugins.progress;!i||e.width===t.width||(t.width=e.width,t.left=e.left,r.forEach(function(n){var s=i.find('xg-spot[data-id="'.concat(n.id,'"]'));s&&u.positionDot(s,n.id)}))},positionDot:function o(u,r){var t=util.findDom(u,".xgplayer-spot-pop");if(t){var e=this.playerSize,i=u.getBoundingClientRect(),n=t.getBoundingClientRect(),s=i.left-e.left,a=e.width-s-i.width/2;if(s<n.width/2||e.width<n.width){var l=n.width/2-s;t.style.left="".concat(l,"px")}else if(a<n.width/2){var c=a-n.width/2+i.width/2;t.style.left="".concat(c,"px")}else t.style.left="50%"}},updateDuration:function o(){var u=this,r=this.player.plugins.progress;if(r){var t=this._ispots;t.forEach(function(e){var i=r.find('xg-spot[data-id="'.concat(e.id,'"]'));u._updateDotDom(e,i)})}},getAllDotsDom:function o(){var u=this.player.plugins.progress;if(!u)return[];var r=u.root.getElementsByTagName("xg-spot");return r},getDotDom:function o(u){var r=this.player.plugins.progress;if(r)return r.find('xg-spot[data-id="'.concat(u,'"]'))}};function initDotsAPI(o){var u=o.config,r=o.player;Object.keys(APIS).map(function(e){o[e]=APIS[e].bind(o)});var t=r.config.progressDot||u.ispots||[];o._ispots=t.map(function(e){return mergeISPOT(e),e}),o.ispotsInit=!1,o.playerSize={left:r.sizeInfo.left,width:r.sizeInfo.width},o.on(DURATION_CHANGE,function(){o.ispotsInit?o.updateDuration():o.initDots()}),o.on(VIDEO_RESIZE,function(){o.positionDots()})}var CALLBACK_MAP={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},ProgressPreview=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),_defineProperty$3(_assertThisInitialized$3(e),"onMousemove",function(i){if(!e.config.disable){if(util.hasClass(i.target,"xg-spot-content")&&e.config.isHideThumbnailHover){e.player.plugins.progress.onMouseLeave(i);return}(e._state.f||util.hasClass(i.target,"xg-spot-content"))&&(util.event(i),i.stopPropagation())}}),_defineProperty$3(_assertThisInitialized$3(e),"onMousedown",function(i){e.config.disable||(e._state.f||util.hasClass(i.target,"xg-spot-content"))&&(util.event(i),i.stopPropagation())}),_defineProperty$3(_assertThisInitialized$3(e),"onMouseup",function(i){if(e.isDrag){var n=e.player.plugins.progress;n&&n.pos&&(n.onMouseUp(i),!n.pos.isEnter&&n.onMouseLeave(i))}}),_defineProperty$3(_assertThisInitialized$3(e),"onDotMouseLeave",function(i){if(!e.config.disable){e._curDot.removeEventListener("mouseleave",e.onDotMouseLeave),e.blurDot(i.target),e._curDot=null;var n=e.player.plugins.progress;n&&n.enableBlur(),e.show()}}),_defineProperty$3(_assertThisInitialized$3(e),"onProgressMouseOver",function(i,n){if(!e.config.disable&&util.hasClass(n.target,"xgplayer-spot")&&!e._curDot){e._curDot=n.target,e.focusDot(n.target),e._curDot.children.length>0&&e.hide();var s=e.player.plugins.progress;s&&s.disableBlur(),e._curDot.addEventListener("mouseleave",e.onDotMouseLeave)}}),e._ispots=[],e.videoPreview=null,e.videothumbnail=null,e.thumbnail=null,e.timeStr="",e._state={now:0,f:!1},e}return _createClass$3(r,[{key:"beforeCreate",value:function(e){var i=e.player.plugins.progress;i&&(e.root=i.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",function(i,n){n.seekTime&&e.player.seek(n.seekTime)}),this.transformTimeHook=this.hook("transformTime",function(i){e.setTimeContent(util.format(i))}),initDotsAPI(this),this.on(DURATION_CHANGE,function(){e.show()}),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var i=this;e&&Object.keys(e).map(function(n){i.config[n]=e[n]})}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,i=this.player.plugins.progress;if(i&&(Object.keys(CALLBACK_MAP).map(function(s){e[CALLBACK_MAP[s]]=e[CALLBACK_MAP[s]].bind(e),i.addCallBack(s,e[CALLBACK_MAP[s]])}),sniffer.device!=="mobile")){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var n=this.hook("previewClick",function(){});this.handlerPreviewClick=function(s){s.stopPropagation(),n(parseInt(e._state.now*1e3,10)/1e3,s)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,i){this.config.disable||!this.player.duration||this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!0,this.videoPreview&&util.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!1,this.videoPreview&&util.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,i){this.config.disable||util.hasClass(i.target,"xgplayer-spot")&&(i.stopPropagation(),i.preventDefault(),["time","id","text"].map(function(n){e[n]=i.target.getAttribute("data-".concat(n))}),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(i,e))}},{key:"updateLinePos",value:function(e,i){var n=this.root,s=this.previewLine,a=this.player,l=this.config,c=a.controls.mode,f=c==="flex",h=n.getBoundingClientRect().width;if(!(!h&&this._hasThumnail)){h=this._hasThumnail&&h<l.width?l.width:h;var p=e-h/2,d;p<0&&!f?(p=0,d=e-h/2):p>i-h&&!f?(d=p-(i-h),p=i-h):d=0,d!==void 0&&(s.style.transform="translateX(".concat(d.toFixed(2),"px)")),n.style.transform="translateX(".concat(p.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var i=this.timeText,n=this.timePoint;i.innerHTML=e,!this.thumbnail&&(n.innerHTML=e)}},{key:"updatePosition",value:function(e,i,n,s){var a=this.root,l=this.config,c=this._state;if(a){c.now=n,this.transformTimeHook(n);var f=this.timeStr;s&&s.target&&util.hasClass(s.target,"xgplayer-spot")?(this.showTips(s.target.getAttribute("data-text"),!1,f),this.focusDot(s.target),c.f=!0,l.isFocusDots&&c.f&&(c.now=parseInt(s.target.getAttribute("data-time"),10))):l.defaultText?(c.f=!1,this.showTips(l.defaultText,!0,f)):(c.f=!1,this.hideTips("")),this.updateTimeText(f),this.updateThumbnails(c.now),this.updateLinePos(e,i)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var i=this.player,n=this.videoPreview,s=this.config,a=i.plugins.thumbnail;if(a&&a.usable){this.thumbnail&&a.update(this.thumbnail,e,s.width,s.height);var l=n&&n.getBoundingClientRect();this.videothumbnail&&a.update(this.videothumbnail,e,l.width,l.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(sniffer.device!=="mobile"){var i=this.player,n=this.config,s=i.getPlugin("thumbnail");if(s&&s.setConfig(e),!s||!s.usable||!n.isShowThumbnail){util.addClass(this.root,"short-line no-thumbnail");return}else util.removeClass(this.root,"short-line no-thumbnail");n.mode==="short"&&util.addClass(this.root,"short-line"),this._hasThumnail=!0;var a=this.find(".xg-spot-thumbnail");this.thumbnail=s.createThumbnail(a,"progress-thumbnail"),n.isShowCoverPreview&&(this.videoPreview=util.createDom("xg-video-preview","",{},"xgvideo-preview"),i.root.appendChild(this.videoPreview),this.videothumbnail=s.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}}},{key:"calcuPosition",value:function(e,i){var n=this.player.plugins.progress,s=this.player,a=n.root.getBoundingClientRect().width,l=s.duration/a*6;return e+i>s.duration&&(i=s.duration-e),e/s.duration*100,i/s.duration,{left:e/s.duration*100,width:i/s.duration*100,isMini:i<l}}},{key:"showDot",value:function(e){var i=this.findDot(e);if(i){var n=this.root.getBoundingClientRect(),s=n.width,a=i.time/this.player.duration*s;this.updatePosition(a,s,i.time)}}},{key:"focusDot",value:function(e,i){e&&(i||(i=e.getAttribute("data-id")),util.addClass(e,"active"),this._activeDotId=i)}},{key:"blurDot",value:function(e){if(!e){var i=this._activeDotId;e=this.getDotDom(i)}e&&(util.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";util.addClass(this.root,"no-timepoint"),e&&(util.addClass(this.find(".xg-spot-content"),"show-text"),i&&this.config.mode==="production"?(util.addClass(this.root,"product"),this.tipText.textContent=e):(util.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(n," ").concat(e)))}},{key:"hideTips",value:function(){util.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",util.removeClass(this.find(".xg-spot-content"),"show-text"),util.removeClass(this.root,"product")}},{key:"hide",value:function(){util.addClass(this.root,"hide")}},{key:"show",value:function(e){util.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,i=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(i.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,i=this.player.plugins.progress;i&&Object.keys(CALLBACK_MAP).map(function(n){i.removeCallBack(n,e[CALLBACK_MAP[n]])}),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return sniffer.device==="mobile"||this.playerConfig.isMobileSimulateMode==="mobile"?"":'<div class="xg-spot-info hide '.concat(this.config.mode==="short"?"short-line":"",`">
      <div class="xg-spot-content">
        <div class="xg-spot-thumbnail">
          <span class="xg-spot-time"></span>
        </div>
        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>
      </div>
      <div class="xgplayer-progress-point">00:00</div>
      <div class="xg-spot-ext-text"></div>
      <div class="xg-spot-line"></div>
    </div>`)}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),r}(Plugin),Thumbnail=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(t){var e;return _classCallCheck$3(this,r),e=u.call(this,t),e.ratio=1,e.interval=null,e._preloadMark={},e}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([DURATION_CHANGE],function(){var i=e.config,n=i.pic_num,s=i.interval;e.usable&&(e.interval=s>0?s:Math.round(e.player.duration*1e3/n)/1e3)})}},{key:"setConfig",value:function(e){var i=this;if(e){var n=Object.keys(e);n.length<1||(n.forEach(function(s){i.config[s]=e[s]}),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,i=e.urls,n=e.pic_num;return i&&i.length>0&&n>0}},{key:"initThumbnail",value:function(){var e=this.config,i=e.width,n=e.height,s=e.pic_num,a=e.interval;this.ratio=i/n*100,this.interval=a||Math.round(this.player.duration/s),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var i=this;if(!this._preloadMark[e]){var n=this.config.urls,s=n.length,a=[];e>0&&a.push(e-1),a.push(e),e>0&&e<s-1&&a.push(e+1),a.map(function(l){!i._preloadMark[l]&&l>=0&&l<s&&(i._preloadMark[l]=1,util.preloadImg(n[l],function(){i._preloadMark[l]=2}))})}}},{key:"getPosition",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=this.config,a=s.pic_num,l=s.row,c=s.col,f=s.width,h=s.height;this.interval=Math.round(this.player.duration/a);var p=Math.ceil(e/this.interval);p=p>a?a:p;var d=p<l*c?0:Math.ceil(p/(l*c))-1,v=p-d*(c*l),g=v>0?Math.ceil(v/c)-1:0,y=v>0?v-g*c-1:0,m=0,S=0;if(i&&n){var _=i/n;_<f/h?(S=n,m=S*(f/h)):(m=i,S=m/(f/h))}else n?i||(S=n||h,m=S*(f/h)):(m=i||f,S=m/(f/h));var A=this.getUrlByIndex(d);return{urlIndex:d,rowIndex:g,colIndex:y,url:A,height:S,width:m,style:{backgroundImage:"url(".concat(A,")"),backgroundSize:"".concat(m*c,"px auto"),backgroundPosition:"-".concat(y*m,"px -").concat(g*S,"px"),width:"".concat(m,"px"),height:"".concat(S,"px")}}}},{key:"update",value:function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",l=this.config,c=l.pic_num,f=l.urls;if(!(c<=0||!f||f.length===0)){var h=this.getPosition(i,n,s);this.preload(h.urlIndex),Object.keys(h.style).map(function(p){e.style[p]=h.style[p]}),Object.keys(a).map(function(p){e.style[p]=a[p]})}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,i){var n=util.createDom("xg-thumbnail","",{},"thumbnail ".concat(i));return e&&e.appendChild(n),n}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),r}(Plugin);function getBgColor(o){return o?"background:".concat(o,";"):""}var MiniProgress=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onTimeupdate",function(){var s=t.player.ended,a=_assertThisInitialized$3(t),l=a.offsetDuration,c=t.currentTime;c=util.adjustTimeByDuration(c,l,s),t.update({played:c},l)}),t}return _createClass$3(r,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var e=this.player,i=e.offsetCurrentTime,n=e.currentTime;return i>=0?i:n}},{key:"afterCreate",value:function(){var e=this;this.root&&(this.on(TIME_UPDATE,this.onTimeupdate),this.on(EMPTIED,function(){e.reset()}))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},i=arguments.length>1?arguments[1]:void 0;!i||!this.root||(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/i*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/i*100,"%")))}},{key:"render",value:function(){var e=this.playerConfig,i=e.commonStyle,n=e.miniprogress;if(n){var s=this.config,a=s.mode,l=s.height,c={cached:getBgColor(i.cachedColor),played:getBgColor(i.playedColor),progress:getBgColor(i.progressColor),height:l>0&&l!==2?"height: ".concat(l,"px;"):""},f=a==="show"?"xg-mini-progress-show":"";return'<xg-mini-progress class="xg-mini-progress '.concat(f,'" style="').concat(c.progress," ").concat(c.height,`">
    <xg-mini-progress-cache class="xg-mini-progress-cache" style="`).concat(c.cached,`"></xg-mini-progress-cache>
    <xg-mini-progress-played class="xg-mini-progress-played" style="`).concat(c.played,`"></xg-mini-progress-played>
    </xg-mini-progress>`)}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),r}(Plugin),MODES={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function nowTime$2(){try{return parseInt(window.performance.now(),10)}catch{return new Date().getTime()}}function checkIsSupportCanvas(){try{var o=document.createElement("canvas").getContext;return!!o}catch{return!1}}var isSupportCanvas=null,DynamicBg=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onLoadedData",function(s){t.player&&(t._frameCount=t.config.startFrameCount,t.stop(),t.renderOnTimeupdate(s),t.off(TIME_UPDATE,t.renderOnTimeupdate),t.on(TIME_UPDATE,t.renderOnTimeupdate))}),_defineProperty$3(_assertThisInitialized$3(t),"onVisibilitychange",function(s){document.visibilityState==="visible"?t._checkIfCanStart()&&t.start():document.visibilityState==="hidden"&&t.stop()}),_defineProperty$3(_assertThisInitialized$3(t),"renderOnTimeupdate",function(s){if(t._frameCount>0)t.renderOnce(),t._frameCount--;else{t._isLoaded=!0,t.off(TIME_UPDATE,t.renderOnTimeupdate);var a=t.config.startInterval;!t.player.paused&&t._checkIfCanStart()&&t.start(0,a)}}),_defineProperty$3(_assertThisInitialized$3(t),"start",function(s,a){var l=t.player.video,c=nowTime$2(),f=t.checkVideoIsSupport(l);!f||!t.canvasCtx||(a||(a=t.interval),t.stop(),l.videoWidth&&l.videoHeight&&(t.videoPI=l.videoHeight>0?parseInt(l.videoWidth/l.videoHeight*100,10):0,(t.config.mode===MODES.REAL_TIME||c-t.preTime>=a)&&(l&&l.videoWidth&&t.update(f,t.videoPI),t.preTime=c)),t.frameId=t._loopType==="timer"?util.setTimeout(_assertThisInitialized$3(t),t.start,a):util.requestAnimationFrame(t.start))}),_defineProperty$3(_assertThisInitialized$3(t),"stop",function(){t.frameId&&(t._loopType==="timer"?util.clearTimeout(_assertThisInitialized$3(t),t.frameId):util.cancelAnimationFrame(t.frameId),t.frameId=null)}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.dynamicBg===!0&&(this.config.disable=!1),r.isSupport||(this.config.disable=!0);var i=this.config,n=i.disable,s=i.mode,a=i.frameRate;n||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/a,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==MODES.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(COMPLETE,function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())}),s!==MODES.POSTER&&(s!==MODES.FIRST_FRAME&&(this.on(EMPTIED,function(){e.stop()}),this.on(PLAY,function(){var l=e.config.startInterval;e._checkIfCanStart()&&e.start(0,l)}),this.on(PAUSE,function(){e.stop()})),this.on(LOADED_DATA,this.onLoadedData),this.on(LOAD_START,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var i=this;Object.keys(e).forEach(function(n){n==="root"&&e[n]!==i.config[n]?i.reRender(e[n]):n==="frameRate"?i.interval=parseInt(1e3/e[n],10):n==="disable"&&e[n]&&i.stop(),i.config[n]=e[n]})}},{key:"init",value:function(e){var i=this.player,n=this.config;this.canvasFilter=r.supportCanvasFilter();try{var s=e||n.root;s||(s=n.isInnerRender&&i.innerContainer||i.root),s.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(n.index,`"><canvas>
        </canvas><xgmask></xgmask></div>`)),this.root=s.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=n.filter,this.canvas.style.webkitFilter=n.filter),this.mask=this.find("xgmask"),n.addMask&&(this.mask.style.background=n.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(a){XG_DEBUG.logError("plugin:DynamicBg",a)}}},{key:"reRender",value:function(e){var i=this.config.disable;if(!(!i&&!this.root)){this.stop();var n=this.root?this.root.parentElement:null;if(n!==e&&n.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var s=this.config.startInterval;this._checkIfCanStart()&&this.start(0,s)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var i=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(i&&!(sniffer.browser==="safari"&&util.isMSE(i)))return i;var n=i?i.tagName.toLowerCase():"";return n==="canvas"||n==="img"?i:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var i=util.typeOf(e)==="String"?e:util.typeOf(e.poster)==="String"?e.poster:null;this.updateImg(i)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==MODES.FIRST_FRAME&&e!==MODES.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!(!e.videoWidth||!e.videoHeight)){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var i=this.checkVideoIsSupport(e);i&&this.update(i,this.videoPI)}}},{key:"updateImg",value:function(e){var i=this;if(e){var n=this.canvas.getBoundingClientRect(),s=n.width,a=n.height,l=new window.Image;l.onload=function(){if(!(!i.canvas||i.frameId||i.isStart)){i.canvas.height=a,i.canvas.width=s;var c=parseInt(s/a*100,10);i.update(l,c),l=null}},l.src=e}}},{key:"update",value:function(e,i){if(!(!this.canvas||!this.canvasCtx||!i))try{var n=this._pos,s=this.config,a=this.canvas.getBoundingClientRect(),l=a.width,c=a.height;if(l!==n.width||c!==n.height||n.pi!==i){var f=parseInt(l/c*100,10);n.pi=i,n.width!==l&&(n.width=this.canvas.width=l),n.height!==c&&(n.height=this.canvas.height=c);var h=c,p=l;f<i?p=parseInt(c*i/100,10):f>i&&(h=parseInt(l*100/i,10)),n.rwidth=p*s.multiple,n.rheight=h*s.multiple,n.x=(l-n.rwidth)/2,n.y=(c-n.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=s.filter),this.canvasCtx.drawImage(e,n.x,n.y,n.rwidth,n.rheight)}catch(d){XG_DEBUG.logError("plugin:DynamicBg",d)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return typeof isSupportCanvas=="boolean"||(isSupportCanvas=checkIsSupportCanvas()),isSupportCanvas}},{key:"supportCanvasFilter",value:function(){return!(sniffer.browser==="safari"||sniffer.browser==="firefox")}}]),r}(Plugin),ZH={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}},INFO="info",STATS_EVENTS=STATS_EVENTS$1,Stats$1=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"_recordUserActions",function(s){var a=t._getTime(),l=Object.assign({},s,{msg:s.msg||s.action});t._stats[INFO].push(_objectSpread2$2(_objectSpread2$2({type:"userAction"},a),{},{payload:l}))}),_defineProperty$3(_assertThisInitialized$3(t),"_onReset",function(){t.reset()}),_defineProperty$3(_assertThisInitialized$3(t),"_recordInfo",function(s){t.info(s)}),_defineProperty$3(_assertThisInitialized$3(t),"_downloadStats",function(){var s=t.getStats(),a=new Blob([JSON.stringify(s)],{type:"application/json"}),l=window.URL.createObjectURL(a),c=document.createElement("a");c.style.display="none",c.href=l,c.download="player.txt",c.disabled=!1,c.click()}),t}return _createClass$3(r,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:new Date().toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(USER_ACTION,this._recordUserActions),this.on(STATS_EVENTS.STATS_INFO,this._recordInfo),this.on(STATS_EVENTS.STATS_DOWNLOAD,this._downloadStats),this.on(STATS_EVENTS.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var i=this._getTime();this._stats[INFO].push(_objectSpread2$2(_objectSpread2$2({},i),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var i=Date.now(),n=i-e.startMs,s=_objectSpread2$2({cat:"function",dur:n,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(s)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(e={},_defineProperty$3(e,INFO,[]),_defineProperty$3(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,i=e.media,n=[],s=0;s<i.buffered.length;s++)n.push({start:i.buffered.start(s),end:i.buffered.end(s)});var a={currentTime:i.currentTime,readyState:i.readyState,buffered:n,paused:i.paused,ended:i.ended};return this._stats.media=a,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[INFO],i=e.map(function(n){var s=n.payload.data,a="";try{s instanceof Error?a=s.msg:s!==void 0&&(a=JSON.stringify(s))}catch(l){console.log("err",l)}return"[".concat(n.timeFormat,"] : ").concat(n.payload.msg," ").concat(a," ")});return i}},{key:"_getProfile",value:function(){var e={traceEvents:[]},i=this._stats[INFO];return i.forEach(function(n){n.payload.profile&&e.traceEvents.push(n.payload)}),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),r}(BasePlugin),GapJump=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onGapJump",function(){var s=_assertThisInitialized$3(t),a=s.player,l=s.config;if(a.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(a.media.seeking){if(!t.seekingEventReceived)return}else t.seekingEventReceived=!1;if(!(a.media.paused&&a.media.currentTime!==0&&t.hasPlayed)){var c=a.media.buffered,f=l.smallGapLimit||.5,h=l.gapDetectionThreshold||.3,p=a.media.currentTime,d=t._getIndex(c,p,h);if(!(d===null||d===0)){console.log("GapJump  bufferRange ",c.start(d),c.end(d));var v=c.start(d)+.1,g=a.media.duration;if(!(v>g)){var y=v-p,m=y<=f;y<r.BROWSER_GAP_TOLERANCE||m&&(l.useGapJump!==!1&&(a.media.currentTime=t.isSafari?v+.1:v),t.player&&t.player.emit("detectGap"),console.log("gapJump gapIndex",d," isGapSamll:",m," currentTime:",a.media.currentTime," jumpSize:",p-a.media.currentTime),v!==.08&&a&&a.emit("log",{type:"oneevent",end_type:"gap",vid:a.config.vid,ext:{video_postion:Math.floor(v*1e3)}}))}}}}}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this,i=this.config.useGapJump;i!==!1&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(WAITING,this.onGapJump),this.on(PLAY,function(){e.hasPlayed=!0}),this.on(SEEKING,function(){e.seekingEventReceived=!0}))}},{key:"_getIndex",value:function(e,i,n){if(!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6)return null;for(var s=this._getBuffered(e),a=null,l=0;l<s.length;l++){var c=s[l];if(c.start>i&&(l===0||s[l-1].end-i<=n)){a=l;break}}return a}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var i=[],n=0;n<e.length;n++)i.push({start:e.start(n),end:e.end(n)});return i}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),r}(Plugin);GapJump.BROWSER_GAP_TOLERANCE=.001;var WaitingTimeoutJump=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"onWaiting",function(){var s=_assertThisInitialized$3(t),a=s.config;t.jumpCnt>a.jumpCntMax||t.timer||a.useWaitingTimeoutJump===!1||(t.timer=setTimeout(t.onJump,a.waitingTime*1e3))}),_defineProperty$3(_assertThisInitialized$3(t),"onJump",function(){var s=_assertThisInitialized$3(t),a=s.player,l=s.config;if(clearTimeout(t.timer),t.timer=null,!(t.jumpCnt>l.jumpCntMax||l.useWaitingTimeoutJump===!1)&&!(a.media.paused&&a.media.currentTime!==0&&t.hasPlayed)){t.jumpSize=l.jumpSize*(t.jumpCnt+1),t.jumpCnt===l.jumpSize&&t.jumpSize<6&&(t.jumpSize=6);var c=a.currentTime+t.jumpSize,f=a.media.duration;c>f||(t.jumpCnt++,a.currentTime=c)}}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this,i=this.config,n=i.useWaitingTimeoutJump,s=i.jumpSize;n!==!1&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=s,this.on(WAITING,this.onWaiting),this.on([PLAYING,CANPLAY],function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize}),this.on(PLAY,function(){e.hasPlayed=!0}))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),r}(Plugin),DEFAULT_SPEED_TYPE="cdn",SPEED_TYPE=["cdn"],TestSpeed=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){var t;_classCallCheck$3(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$3(_assertThisInitialized$3(t),"getSpeed",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_SPEED_TYPE;if(!t.speedListCache||!t.speedListCache[s]||t.speedListCache[s].length<=0)return 0;var a=0;return t.speedListCache[s].map(function(l){a+=l}),Math.floor(a/t.speedListCache[s].length)}),_defineProperty$3(_assertThisInitialized$3(t),"startTimer",function(){util.isMSE(t.player.video)||(t.initSpeedList(),t.cnt=0,t.timer=setTimeout(t.testSpeed,t.config.testTimeStep))}),_defineProperty$3(_assertThisInitialized$3(t),"initSpeedList",function(){t.speedListCache={},SPEED_TYPE.forEach(function(s){t.speedListCache[s]=[]})}),_defineProperty$3(_assertThisInitialized$3(t),"_onRealSpeedChange",function(s){s.speed&&t.appendList(s.speed,s.type||DEFAULT_SPEED_TYPE)}),_defineProperty$3(_assertThisInitialized$3(t),"testSpeed",function(){if(clearTimeout(t.timer),t.timer=null,!(!t.player||!t.config.openSpeed)){var s=t.config,a=s.url,l=s.loadSize,c=s.testCnt,f=s.testTimeStep,h=a+(a.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(t.cnt>=c)){t.cnt++;try{var p=new Date().getTime(),d=null,v=new XMLHttpRequest;t.xhr=v,v.open("GET",h);var g={},y=Math.floor(Math.random()*10);g.Range="bytes="+y+"-"+(l+y),g&&Object.keys(g).forEach(function(m){v.setRequestHeader(m,g[m])}),v.onreadystatechange=function(){if(v.readyState===4){t.xhr=null,d=new Date().getTime();var m=v.getResponseHeader("Content-Length")/1024*8,S=Math.round(m*1e3/(d-p));t.appendList(S),t.timer=setTimeout(t.testSpeed,f)}},v.send()}catch(m){console.error(m)}}}}),_defineProperty$3(_assertThisInitialized$3(t),"appendList",function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:DEFAULT_SPEED_TYPE;if(!(!t.speedListCache||!t.speedListCache[a])){var l=t.config.saveSpeedMax;t.speedListCache[a].length>=l&&t.speedListCache[a].shift(),t.speedListCache[a].push(s);var c=_assertThisInitialized$3(t),f=c.player;f&&(a===DEFAULT_SPEED_TYPE?f.realTimeSpeed=s:f[t.getSpeedName("realTime",a)]=s),t.updateSpeed(a)}}),_defineProperty$3(_assertThisInitialized$3(t),"updateSpeed",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_SPEED_TYPE,a=t.getSpeed(s),l=_assertThisInitialized$3(t),c=l.player;if(c)if(s===DEFAULT_SPEED_TYPE)(!c.avgSpeed||a!==c.avgSpeed)&&(c.avgSpeed=a,c.emit(DOWNLOAD_SPEED_CHANGE,{speed:a,realTimeSpeed:c.realTimeSpeed}));else{var f=t.getSpeedName("avg",s);(!c[f]||a!==c[f])&&(c[f]=a,c.emit(DOWNLOAD_SPEED_CHANGE,{speed:a,realTimeSpeed:c.realTimeSpeed}))}}),t}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this.config,i=e.openSpeed,n=e.addSpeedTypeList;(n==null?void 0:n.length)>0&&SPEED_TYPE.push.apply(SPEED_TYPE,_toConsumableArray$1(n)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,i&&this.on([LOADED_DATA,REPLAY],this.startTimer)}},{key:"getSpeedName",value:function(e,i){return e+"Speed"+i.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer){clearTimeout(this.timer),this.timer=null;return}if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var e=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([LOADED_DATA,REPLAY],this.startTimer),SPEED_TYPE.forEach(function(i){e.speedListCache&&e.speedListCache[i]&&(e.speedListCache[i]=[])}),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&this.xhr.readyState!==4&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:200*1024,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),r}(Plugin),FpsDetect=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r,[{key:"afterCreate",value:function(){var e=this,i=this.player,n=this.config,s=i.media||i.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!n.disabled){var a=s.getVideoPlaybackQuality;a&&(this.on(PLAY,function(){e._startTick()}),this.on(PAUSE,function(){e._stopTick()}),this.on(ENDED,function(){e._stopTick()}),this.on(EMPTIED,function(){e._stopTick()}))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout(function(){e._checkDecodeFPS(),e._startTick()},this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,i){for(var n=!1,s=[],a=0;a<i.length;a++){var l=i.start(a),c=i.end(a);if(s.push({start:l,end:c}),l<=e&&e<=c-1){n=!0;break}}return{enoughBuffer:n,buffers:s}}},{key:"_checkStuck",value:function(e,i,n,s){var a=this.player.media||this.player.video,l=document.hidden,c=a.paused,f=a.readyState,h=a.currentTime,p=a.buffered;if(!(l||c||f<4)){var d=this._checkBuffer(h,p),v=d.enoughBuffer,g=d.buffers;v&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:h,buffers:g,curDecodedFrames:e,totalVideoFrames:i,droppedVideoFrames:n,checkInterval:s}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(FPS_STUCK,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var i=e.getVideoPlaybackQuality(),n=i.totalVideoFrames,s=i.droppedVideoFrames,a=performance.now();if(n&&this._lastCheckPoint){var l=n-this._lastDecodedFrames,c=a-this._lastCheckPoint;this._checkStuck(l,n,s,c)}this._lastDecodedFrames=n,this._lastCheckPoint=a}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),r}(Plugin);I18N.use(ZH);var DefaultPreset=_createClass$3(function o(u,r){var t,e,i;_classCallCheck$3(this,o);var n=r&&r.isMobileSimulateMode==="mobile",s=r.isLive,a=s?[]:[TimeSegmentsControls,Progress,MiniProgress,ProgressPreview,Time],l=[].concat(a,[Play,Fullscreen,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP]),c=[Replay,Poster,Start,Loading,Enter,ErrorPlugin,Prompt,Thumbnail,MiniScreen];this.plugins=[Stats$1,XGLogger].concat(_toConsumableArray$1(l),c,[GapJump,WaitingTimeoutJump]);var f=n?"mobile":sniffer.device;switch(f){case"pc":(t=this.plugins).push.apply(t,[Keyboard,PCPlugin,CssFullScreen,TestSpeed,FpsDetect]);break;case"mobile":(e=this.plugins).push.apply(e,[MobilePlugin]);break;default:(i=this.plugins).push.apply(i,[Keyboard,PCPlugin,CssFullScreen])}(sniffer.os.isIpad||f==="pc")&&this.plugins.push(DynamicBg),sniffer.os.isIpad&&this.plugins.push(PCPlugin),this.ignores=[],this.i18n=[]}),PresetPlayer=function(o){_inherits$3(r,o);var u=_createSuper$3(r);function r(){return _classCallCheck$3(this,r),u.apply(this,arguments)}return _createClass$3(r)}(Player);_defineProperty$3(PresetPlayer,"defaultPreset",DefaultPreset);_defineProperty$3(PresetPlayer,"Util",util);_defineProperty$3(PresetPlayer,"Sniffer",sniffer);_defineProperty$3(PresetPlayer,"Errors",Errors);_defineProperty$3(PresetPlayer,"Events",events);_defineProperty$3(PresetPlayer,"Plugin",Plugin);_defineProperty$3(PresetPlayer,"BasePlugin",BasePlugin);_defineProperty$3(PresetPlayer,"I18N",I18N);_defineProperty$3(PresetPlayer,"STATE_CLASS",STATE_CLASS);_defineProperty$3(PresetPlayer,"InstManager",InstManager);function ownKeys$1(o,u){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);u&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),r.push.apply(r,t)}return r}function _objectSpread2$1(o){for(var u=1;u<arguments.length;u++){var r=arguments[u]!=null?arguments[u]:{};u%2?ownKeys$1(Object(r),!0).forEach(function(t){_defineProperty$2(o,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(r,t))})}return o}function _regeneratorRuntime$1(){_regeneratorRuntime$1=function(){return o};var o={},u=Object.prototype,r=u.hasOwnProperty,t=Object.defineProperty||function(b,T,C){b[T]=C.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",s=e.toStringTag||"@@toStringTag";function a(b,T,C){return Object.defineProperty(b,T,{value:C,enumerable:!0,configurable:!0,writable:!0}),b[T]}try{a({},"")}catch{a=function(T,C,D){return T[C]=D}}function l(b,T,C,D){var P=T&&T.prototype instanceof h?T:h,B=Object.create(P.prototype),$=new N(D||[]);return t(B,"_invoke",{value:A(b,C,$)}),B}function c(b,T,C){try{return{type:"normal",arg:b.call(T,C)}}catch(D){return{type:"throw",arg:D}}}o.wrap=l;var f={};function h(){}function p(){}function d(){}var v={};a(v,i,function(){return this});var g=Object.getPrototypeOf,y=g&&g(g(x([])));y&&y!==u&&r.call(y,i)&&(v=y);var m=d.prototype=h.prototype=Object.create(v);function S(b){["next","throw","return"].forEach(function(T){a(b,T,function(C){return this._invoke(T,C)})})}function _(b,T){function C(P,B,$,F){var K=c(b[P],b,B);if(K.type!=="throw"){var Y=K.arg,G=Y.value;return G&&typeof G=="object"&&r.call(G,"__await")?T.resolve(G.__await).then(function(H){C("next",H,$,F)},function(H){C("throw",H,$,F)}):T.resolve(G).then(function(H){Y.value=H,$(Y)},function(H){return C("throw",H,$,F)})}F(K.arg)}var D;t(this,"_invoke",{value:function(P,B){function $(){return new T(function(F,K){C(P,B,F,K)})}return D=D?D.then($,$):$()}})}function A(b,T,C){var D="suspendedStart";return function(P,B){if(D==="executing")throw new Error("Generator is already running");if(D==="completed"){if(P==="throw")throw B;return M()}for(C.method=P,C.arg=B;;){var $=C.delegate;if($){var F=k($,C);if(F){if(F===f)continue;return F}}if(C.method==="next")C.sent=C._sent=C.arg;else if(C.method==="throw"){if(D==="suspendedStart")throw D="completed",C.arg;C.dispatchException(C.arg)}else C.method==="return"&&C.abrupt("return",C.arg);D="executing";var K=c(b,T,C);if(K.type==="normal"){if(D=C.done?"completed":"suspendedYield",K.arg===f)continue;return{value:K.arg,done:C.done}}K.type==="throw"&&(D="completed",C.method="throw",C.arg=K.arg)}}}function k(b,T){var C=T.method,D=b.iterator[C];if(D===void 0)return T.delegate=null,C==="throw"&&b.iterator.return&&(T.method="return",T.arg=void 0,k(b,T),T.method==="throw")||C!=="return"&&(T.method="throw",T.arg=new TypeError("The iterator does not provide a '"+C+"' method")),f;var P=c(D,b.iterator,T.arg);if(P.type==="throw")return T.method="throw",T.arg=P.arg,T.delegate=null,f;var B=P.arg;return B?B.done?(T[b.resultName]=B.value,T.next=b.nextLoc,T.method!=="return"&&(T.method="next",T.arg=void 0),T.delegate=null,f):B:(T.method="throw",T.arg=new TypeError("iterator result is not an object"),T.delegate=null,f)}function w(b){var T={tryLoc:b[0]};1 in b&&(T.catchLoc=b[1]),2 in b&&(T.finallyLoc=b[2],T.afterLoc=b[3]),this.tryEntries.push(T)}function I(b){var T=b.completion||{};T.type="normal",delete T.arg,b.completion=T}function N(b){this.tryEntries=[{tryLoc:"root"}],b.forEach(w,this),this.reset(!0)}function x(b){if(b){var T=b[i];if(T)return T.call(b);if(typeof b.next=="function")return b;if(!isNaN(b.length)){var C=-1,D=function P(){for(;++C<b.length;)if(r.call(b,C))return P.value=b[C],P.done=!1,P;return P.value=void 0,P.done=!0,P};return D.next=D}}return{next:M}}function M(){return{value:void 0,done:!0}}return p.prototype=d,t(m,"constructor",{value:d,configurable:!0}),t(d,"constructor",{value:p,configurable:!0}),p.displayName=a(d,s,"GeneratorFunction"),o.isGeneratorFunction=function(b){var T=typeof b=="function"&&b.constructor;return!!T&&(T===p||(T.displayName||T.name)==="GeneratorFunction")},o.mark=function(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,d):(b.__proto__=d,a(b,s,"GeneratorFunction")),b.prototype=Object.create(m),b},o.awrap=function(b){return{__await:b}},S(_.prototype),a(_.prototype,n,function(){return this}),o.AsyncIterator=_,o.async=function(b,T,C,D,P){P===void 0&&(P=Promise);var B=new _(l(b,T,C,D),P);return o.isGeneratorFunction(T)?B:B.next().then(function($){return $.done?$.value:B.next()})},S(m),a(m,s,"Generator"),a(m,i,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),o.keys=function(b){var T=Object(b),C=[];for(var D in T)C.push(D);return C.reverse(),function P(){for(;C.length;){var B=C.pop();if(B in T)return P.value=B,P.done=!1,P}return P.done=!0,P}},o.values=x,N.prototype={constructor:N,reset:function(b){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!b)for(var T in this)T.charAt(0)==="t"&&r.call(this,T)&&!isNaN(+T.slice(1))&&(this[T]=void 0)},stop:function(){this.done=!0;var b=this.tryEntries[0].completion;if(b.type==="throw")throw b.arg;return this.rval},dispatchException:function(b){if(this.done)throw b;var T=this;function C(K,Y){return B.type="throw",B.arg=b,T.next=K,Y&&(T.method="next",T.arg=void 0),!!Y}for(var D=this.tryEntries.length-1;D>=0;--D){var P=this.tryEntries[D],B=P.completion;if(P.tryLoc==="root")return C("end");if(P.tryLoc<=this.prev){var $=r.call(P,"catchLoc"),F=r.call(P,"finallyLoc");if($&&F){if(this.prev<P.catchLoc)return C(P.catchLoc,!0);if(this.prev<P.finallyLoc)return C(P.finallyLoc)}else if($){if(this.prev<P.catchLoc)return C(P.catchLoc,!0)}else{if(!F)throw new Error("try statement without catch or finally");if(this.prev<P.finallyLoc)return C(P.finallyLoc)}}}},abrupt:function(b,T){for(var C=this.tryEntries.length-1;C>=0;--C){var D=this.tryEntries[C];if(D.tryLoc<=this.prev&&r.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var P=D;break}}P&&(b==="break"||b==="continue")&&P.tryLoc<=T&&T<=P.finallyLoc&&(P=null);var B=P?P.completion:{};return B.type=b,B.arg=T,P?(this.method="next",this.next=P.finallyLoc,f):this.complete(B)},complete:function(b,T){if(b.type==="throw")throw b.arg;return b.type==="break"||b.type==="continue"?this.next=b.arg:b.type==="return"?(this.rval=this.arg=b.arg,this.method="return",this.next="end"):b.type==="normal"&&T&&(this.next=T),f},finish:function(b){for(var T=this.tryEntries.length-1;T>=0;--T){var C=this.tryEntries[T];if(C.finallyLoc===b)return this.complete(C.completion,C.afterLoc),I(C),f}},catch:function(b){for(var T=this.tryEntries.length-1;T>=0;--T){var C=this.tryEntries[T];if(C.tryLoc===b){var D=C.completion;if(D.type==="throw"){var P=D.arg;I(C)}return P}}throw new Error("illegal catch attempt")},delegateYield:function(b,T,C){return this.delegate={iterator:x(b),resultName:T,nextLoc:C},this.method==="next"&&(this.arg=void 0),f}},o}function _typeof$1(o){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof$1(o)}function asyncGeneratorStep$1(o,u,r,t,e,i,n){try{var s=o[i](n),a=s.value}catch(l){r(l);return}s.done?u(a):Promise.resolve(a).then(t,e)}function _asyncToGenerator$1(o){return function(){var u=this,r=arguments;return new Promise(function(t,e){var i=o.apply(u,r);function n(a){asyncGeneratorStep$1(i,t,e,n,s,"next",a)}function s(a){asyncGeneratorStep$1(i,t,e,n,s,"throw",a)}n(void 0)})}}function _classCallCheck$2(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(o,u){for(var r=0;r<u.length;r++){var t=u[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(o,_toPropertyKey$2(t.key),t)}}function _createClass$2(o,u,r){return u&&_defineProperties$2(o.prototype,u),r&&_defineProperties$2(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}function _defineProperty$2(o,u,r){return u=_toPropertyKey$2(u),u in o?Object.defineProperty(o,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[u]=r,o}function _inherits$2(o,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(u&&u.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),u&&_setPrototypeOf$2(o,u)}function _getPrototypeOf$2(o){return _getPrototypeOf$2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf$2(o)}function _setPrototypeOf$2(o,u){return _setPrototypeOf$2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf$2(o,u)}function _isNativeReflectConstruct$2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _assertThisInitialized$2(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function _possibleConstructorReturn$2(o,u){if(u&&(typeof u=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$2(o)}function _createSuper$2(o){var u=_isNativeReflectConstruct$2();return function(){var t=_getPrototypeOf$2(o),e;if(u){var i=_getPrototypeOf$2(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn$2(this,e)}}function _toPrimitive$2(o,u){if(typeof o!="object"||o===null)return o;var r=o[Symbol.toPrimitive];if(r!==void 0){var t=r.call(o,u||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(o)}function _toPropertyKey$2(o){var u=_toPrimitive$2(o,"string");return typeof u=="symbol"?u:String(u)}function ownKeys(o,u){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);u&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),r.push.apply(r,t)}return r}function _objectSpread2(o){for(var u=1;u<arguments.length;u++){var r=arguments[u]!=null?arguments[u]:{};u%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty$1(o,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(r,t))})}return o}function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var o={},u=Object.prototype,r=u.hasOwnProperty,t=Object.defineProperty||function(b,T,C){b[T]=C.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",s=e.toStringTag||"@@toStringTag";function a(b,T,C){return Object.defineProperty(b,T,{value:C,enumerable:!0,configurable:!0,writable:!0}),b[T]}try{a({},"")}catch{a=function(T,C,D){return T[C]=D}}function l(b,T,C,D){var P=T&&T.prototype instanceof h?T:h,B=Object.create(P.prototype),$=new N(D||[]);return t(B,"_invoke",{value:A(b,C,$)}),B}function c(b,T,C){try{return{type:"normal",arg:b.call(T,C)}}catch(D){return{type:"throw",arg:D}}}o.wrap=l;var f={};function h(){}function p(){}function d(){}var v={};a(v,i,function(){return this});var g=Object.getPrototypeOf,y=g&&g(g(x([])));y&&y!==u&&r.call(y,i)&&(v=y);var m=d.prototype=h.prototype=Object.create(v);function S(b){["next","throw","return"].forEach(function(T){a(b,T,function(C){return this._invoke(T,C)})})}function _(b,T){function C(P,B,$,F){var K=c(b[P],b,B);if(K.type!=="throw"){var Y=K.arg,G=Y.value;return G&&typeof G=="object"&&r.call(G,"__await")?T.resolve(G.__await).then(function(H){C("next",H,$,F)},function(H){C("throw",H,$,F)}):T.resolve(G).then(function(H){Y.value=H,$(Y)},function(H){return C("throw",H,$,F)})}F(K.arg)}var D;t(this,"_invoke",{value:function(P,B){function $(){return new T(function(F,K){C(P,B,F,K)})}return D=D?D.then($,$):$()}})}function A(b,T,C){var D="suspendedStart";return function(P,B){if(D==="executing")throw new Error("Generator is already running");if(D==="completed"){if(P==="throw")throw B;return M()}for(C.method=P,C.arg=B;;){var $=C.delegate;if($){var F=k($,C);if(F){if(F===f)continue;return F}}if(C.method==="next")C.sent=C._sent=C.arg;else if(C.method==="throw"){if(D==="suspendedStart")throw D="completed",C.arg;C.dispatchException(C.arg)}else C.method==="return"&&C.abrupt("return",C.arg);D="executing";var K=c(b,T,C);if(K.type==="normal"){if(D=C.done?"completed":"suspendedYield",K.arg===f)continue;return{value:K.arg,done:C.done}}K.type==="throw"&&(D="completed",C.method="throw",C.arg=K.arg)}}}function k(b,T){var C=T.method,D=b.iterator[C];if(D===void 0)return T.delegate=null,C==="throw"&&b.iterator.return&&(T.method="return",T.arg=void 0,k(b,T),T.method==="throw")||C!=="return"&&(T.method="throw",T.arg=new TypeError("The iterator does not provide a '"+C+"' method")),f;var P=c(D,b.iterator,T.arg);if(P.type==="throw")return T.method="throw",T.arg=P.arg,T.delegate=null,f;var B=P.arg;return B?B.done?(T[b.resultName]=B.value,T.next=b.nextLoc,T.method!=="return"&&(T.method="next",T.arg=void 0),T.delegate=null,f):B:(T.method="throw",T.arg=new TypeError("iterator result is not an object"),T.delegate=null,f)}function w(b){var T={tryLoc:b[0]};1 in b&&(T.catchLoc=b[1]),2 in b&&(T.finallyLoc=b[2],T.afterLoc=b[3]),this.tryEntries.push(T)}function I(b){var T=b.completion||{};T.type="normal",delete T.arg,b.completion=T}function N(b){this.tryEntries=[{tryLoc:"root"}],b.forEach(w,this),this.reset(!0)}function x(b){if(b){var T=b[i];if(T)return T.call(b);if(typeof b.next=="function")return b;if(!isNaN(b.length)){var C=-1,D=function P(){for(;++C<b.length;)if(r.call(b,C))return P.value=b[C],P.done=!1,P;return P.value=void 0,P.done=!0,P};return D.next=D}}return{next:M}}function M(){return{value:void 0,done:!0}}return p.prototype=d,t(m,"constructor",{value:d,configurable:!0}),t(d,"constructor",{value:p,configurable:!0}),p.displayName=a(d,s,"GeneratorFunction"),o.isGeneratorFunction=function(b){var T=typeof b=="function"&&b.constructor;return!!T&&(T===p||(T.displayName||T.name)==="GeneratorFunction")},o.mark=function(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,d):(b.__proto__=d,a(b,s,"GeneratorFunction")),b.prototype=Object.create(m),b},o.awrap=function(b){return{__await:b}},S(_.prototype),a(_.prototype,n,function(){return this}),o.AsyncIterator=_,o.async=function(b,T,C,D,P){P===void 0&&(P=Promise);var B=new _(l(b,T,C,D),P);return o.isGeneratorFunction(T)?B:B.next().then(function($){return $.done?$.value:B.next()})},S(m),a(m,s,"Generator"),a(m,i,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),o.keys=function(b){var T=Object(b),C=[];for(var D in T)C.push(D);return C.reverse(),function P(){for(;C.length;){var B=C.pop();if(B in T)return P.value=B,P.done=!1,P}return P.done=!0,P}},o.values=x,N.prototype={constructor:N,reset:function(b){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!b)for(var T in this)T.charAt(0)==="t"&&r.call(this,T)&&!isNaN(+T.slice(1))&&(this[T]=void 0)},stop:function(){this.done=!0;var b=this.tryEntries[0].completion;if(b.type==="throw")throw b.arg;return this.rval},dispatchException:function(b){if(this.done)throw b;var T=this;function C(K,Y){return B.type="throw",B.arg=b,T.next=K,Y&&(T.method="next",T.arg=void 0),!!Y}for(var D=this.tryEntries.length-1;D>=0;--D){var P=this.tryEntries[D],B=P.completion;if(P.tryLoc==="root")return C("end");if(P.tryLoc<=this.prev){var $=r.call(P,"catchLoc"),F=r.call(P,"finallyLoc");if($&&F){if(this.prev<P.catchLoc)return C(P.catchLoc,!0);if(this.prev<P.finallyLoc)return C(P.finallyLoc)}else if($){if(this.prev<P.catchLoc)return C(P.catchLoc,!0)}else{if(!F)throw new Error("try statement without catch or finally");if(this.prev<P.finallyLoc)return C(P.finallyLoc)}}}},abrupt:function(b,T){for(var C=this.tryEntries.length-1;C>=0;--C){var D=this.tryEntries[C];if(D.tryLoc<=this.prev&&r.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var P=D;break}}P&&(b==="break"||b==="continue")&&P.tryLoc<=T&&T<=P.finallyLoc&&(P=null);var B=P?P.completion:{};return B.type=b,B.arg=T,P?(this.method="next",this.next=P.finallyLoc,f):this.complete(B)},complete:function(b,T){if(b.type==="throw")throw b.arg;return b.type==="break"||b.type==="continue"?this.next=b.arg:b.type==="return"?(this.rval=this.arg=b.arg,this.method="return",this.next="end"):b.type==="normal"&&T&&(this.next=T),f},finish:function(b){for(var T=this.tryEntries.length-1;T>=0;--T){var C=this.tryEntries[T];if(C.finallyLoc===b)return this.complete(C.completion,C.afterLoc),I(C),f}},catch:function(b){for(var T=this.tryEntries.length-1;T>=0;--T){var C=this.tryEntries[T];if(C.tryLoc===b){var D=C.completion;if(D.type==="throw"){var P=D.arg;I(C)}return P}}throw new Error("illegal catch attempt")},delegateYield:function(b,T,C){return this.delegate={iterator:x(b),resultName:T,nextLoc:C},this.method==="next"&&(this.arg=void 0),f}},o}function _typeof(o){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},_typeof(o)}function asyncGeneratorStep(o,u,r,t,e,i,n){try{var s=o[i](n),a=s.value}catch(l){r(l);return}s.done?u(a):Promise.resolve(a).then(t,e)}function _asyncToGenerator(o){return function(){var u=this,r=arguments;return new Promise(function(t,e){var i=o.apply(u,r);function n(a){asyncGeneratorStep(i,t,e,n,s,"next",a)}function s(a){asyncGeneratorStep(i,t,e,n,s,"throw",a)}n(void 0)})}}function _classCallCheck$1(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(o,u){for(var r=0;r<u.length;r++){var t=u[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(o,_toPropertyKey$1(t.key),t)}}function _createClass$1(o,u,r){return u&&_defineProperties$1(o.prototype,u),r&&_defineProperties$1(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}function _defineProperty$1(o,u,r){return u=_toPropertyKey$1(u),u in o?Object.defineProperty(o,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[u]=r,o}function _inherits$1(o,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(u&&u.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),u&&_setPrototypeOf$1(o,u)}function _getPrototypeOf$1(o){return _getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf$1(o)}function _setPrototypeOf$1(o,u){return _setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf$1(o,u)}function _isNativeReflectConstruct$1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _construct(o,u,r){return _isNativeReflectConstruct$1()?_construct=Reflect.construct.bind():_construct=function(e,i,n){var s=[null];s.push.apply(s,i);var a=Function.bind.apply(e,s),l=new a;return n&&_setPrototypeOf$1(l,n.prototype),l},_construct.apply(null,arguments)}function _isNativeFunction(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function _wrapNativeSuper(o){var u=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(t){if(t===null||!_isNativeFunction(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u<"u"){if(u.has(t))return u.get(t);u.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf$1(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$1(e,t)},_wrapNativeSuper(o)}function _objectWithoutPropertiesLoose(o,u){if(o==null)return{};var r={},t=Object.keys(o),e,i;for(i=0;i<t.length;i++)e=t[i],!(u.indexOf(e)>=0)&&(r[e]=o[e]);return r}function _objectWithoutProperties(o,u){if(o==null)return{};var r=_objectWithoutPropertiesLoose(o,u),t,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);for(e=0;e<i.length;e++)t=i[e],!(u.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(o,t)&&(r[t]=o[t])}return r}function _assertThisInitialized$1(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function _possibleConstructorReturn$1(o,u){if(u&&(typeof u=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$1(o)}function _createSuper$1(o){var u=_isNativeReflectConstruct$1();return function(){var t=_getPrototypeOf$1(o),e;if(u){var i=_getPrototypeOf$1(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn$1(this,e)}}function _superPropBase(o,u){for(;!Object.prototype.hasOwnProperty.call(o,u)&&(o=_getPrototypeOf$1(o),o!==null););return o}function _get(){return typeof Reflect<"u"&&Reflect.get?_get=Reflect.get.bind():_get=function(u,r,t){var e=_superPropBase(u,r);if(e){var i=Object.getOwnPropertyDescriptor(e,r);return i.get?i.get.call(arguments.length<3?u:t):i.value}},_get.apply(this,arguments)}function _unsupportedIterableToArray$1(o,u){if(o){if(typeof o=="string")return _arrayLikeToArray$1(o,u);var r=Object.prototype.toString.call(o).slice(8,-1);if(r==="Object"&&o.constructor&&(r=o.constructor.name),r==="Map"||r==="Set")return Array.from(o);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray$1(o,u)}}function _arrayLikeToArray$1(o,u){(u==null||u>o.length)&&(u=o.length);for(var r=0,t=new Array(u);r<u;r++)t[r]=o[r];return t}function _createForOfIteratorHelper(o,u){var r=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!r){if(Array.isArray(o)||(r=_unsupportedIterableToArray$1(o))||u&&o&&typeof o.length=="number"){r&&(o=r);var t=0,e=function(){};return{s:e,n:function(){return t>=o.length?{done:!0}:{done:!1,value:o[t++]}},e:function(a){throw a},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,n=!1,s;return{s:function(){r=r.call(o)},n:function(){var a=r.next();return i=a.done,a},e:function(a){n=!0,s=a},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(n)throw s}}}}function _toPrimitive$1(o,u){if(typeof o!="object"||o===null)return o;var r=o[Symbol.toPrimitive];if(r!==void 0){var t=r.call(o,u||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(o)}function _toPropertyKey$1(o){var u=_toPrimitive$1(o,"string");return typeof u=="symbol"?u:String(u)}var Buffer$1=function(){function o(){_classCallCheck$1(this,o)}return _createClass$1(o,null,[{key:"start",value:function(r){return!r||!r.length||r.length===1&&r.end(0)-r.start(0)<1e-6||r.length===1&&r.start(0)<0?0:r.start(0)}},{key:"end",value:function(r){return!r||!r.length||r.length===1&&r.end(0)-r.start(0)<1e-6?0:r.end(r.length-1)}},{key:"get",value:function(r){if(r)try{return r.buffered}catch{}}},{key:"buffers",value:function(r,t){if(!r||!r.length)return[];for(var e=[],i=0,n=r.length;i<n;i++){var s=e.length;if(!s||!t)e.push([r.start(i),r.end(i)]);else{var a=e[s-1],l=a[1],c=r.start(i);if(c-l<=t){var f=r.end(i);f>l&&(a[1]=f)}else e.push([r.start(i),r.end(i)])}}return e}},{key:"totalLength",value:function(r){return!r||!r.length?0:r.reduce(function(t,e){return t+=e[1]-e[0]},0)}},{key:"info",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!r||!r.length)return{start:0,end:0,buffers:[]};for(var i=0,n=0,s=0,a=0,l=0,c=0,f=0,h=o.buffers(r,e),p=0,d=h.length;p<d;p++){var v=h[p];if(t+e>=v[0]&&t<=v[1])i=v[0],n=v[1],s=p;else if(t+e<v[0]){a=v[0],l=v[1];break}else t+e>v[1]&&(c=v[0],f=v[1])}return{start:i,end:n,index:s,buffers:h,nextStart:a,nextEnd:l,prevStart:c,prevEnd:f,currentTime:t,behind:t-i,remaining:n?n-t:0,length:o.totalLength&&o.totalLength(h)}}},{key:"isBuffered",value:function(r,t){if(r){var e=o.get(r);if(e!=null&&e.length){for(var i=0;i<e.length;i++)if(t>=e.start(i)&&t<=e.end(i))return!0}}return!1}}]),o}(),isBrowser$1=typeof window<"u",_ERR_CODE,ERR={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},ERR_CODE=(_ERR_CODE={},_defineProperty$1(_ERR_CODE,ERR.MANIFEST,{HLS:1100,DASH:1200}),_defineProperty$1(_ERR_CODE,ERR.NETWORK,2100),_defineProperty$1(_ERR_CODE,ERR.NETWORK_TIMEOUT,2101),_defineProperty$1(_ERR_CODE,ERR.NETWORK_FORBIDDEN,2103),_defineProperty$1(_ERR_CODE,ERR.NETWORK_NOTFOUND,2104),_defineProperty$1(_ERR_CODE,ERR.NETWROK_RANGE_NOT_SATISFIABLE,2116),_defineProperty$1(_ERR_CODE,ERR.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),_defineProperty$1(_ERR_CODE,ERR.REMUX,{FMP4:4100,MP4:4200}),_defineProperty$1(_ERR_CODE,ERR.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),_defineProperty$1(_ERR_CODE,ERR.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),_defineProperty$1(_ERR_CODE,ERR.OTHER,8e3),_defineProperty$1(_ERR_CODE,ERR.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),_ERR_CODE),StreamingError=function(o){_inherits$1(r,o);var u=_createSuper$1(r);function r(t,e,i,n,s){var a;return _classCallCheck$1(this,r),a=u.call(this,s||(i==null?void 0:i.message)),a.errorType=t===ERR.NETWORK_TIMEOUT?ERR.NETWORK:t,a.originError=i,a.ext=n,a.errorCode=ERR_CODE[t][e]||ERR_CODE[t],a.errorMessage=a.message,a.errorCode||(a.errorType=ERR.OTHER,a.errorCode=ERR_CODE[a.errorType]),a}return _createClass$1(r,null,[{key:"create",value:function(e,i,n,s,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=ERR.OTHER),new r(e,i,n,s,a))}},{key:"network",value:function(e){var i;return new r(e!=null&&e.isTimeout?ERR.NETWORK_TIMEOUT:ERR.NETWORK,null,e instanceof Error?e:null,{url:e==null?void 0:e.url,response:e==null?void 0:e.response,httpCode:e==null||(i=e.response)===null||i===void 0?void 0:i.status})}}]),r}(_wrapNativeSuper(Error)),LogCacheLevel={DEBUG:1,LOG:2,WARN:3,ERROR:4},LOG_MAX_SIZE=200*1024,SIMPLE_TYPE=["Boolean","Number","String","Undefined","Null","Date","Object"],Logger$2=function(){function o(u,r){_classCallCheck$1(this,o),this.name=u||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(r==null?void 0:r.logCacheLevel)||3,this.logMaxSize=(r==null?void 0:r.logMaxSize)||LOG_MAX_SIZE,this.logSize=0,this.logTextArray=[]}return _createClass$1(o,[{key:"debug",value:function(){for(var r,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logCache.apply(this,[LogCacheLevel.DEBUG].concat(e)),!o.disabled&&(r=console).debug.apply(r,["[".concat(nowTime$1(),"]"),this._prefix].concat(e))}},{key:"log",value:function(){for(var r,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logCache.apply(this,[LogCacheLevel.LOG].concat(e)),!o.disabled&&(r=console).log.apply(r,["[".concat(nowTime$1(),"]"),this._prefix].concat(e))}},{key:"warn",value:function(){for(var r,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logCache.apply(this,[LogCacheLevel.WARN].concat(e)),!o.disabled&&(r=console).warn.apply(r,["[".concat(nowTime$1(),"]"),this._prefix].concat(e))}},{key:"error",value:function(){for(var r,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logCache.apply(this,[LogCacheLevel.ERROR].concat(e)),!o.disabled&&(r=console).error.apply(r,["[".concat(nowTime$1(),"]"),this._prefix].concat(e))}},{key:"logCache",value:function(r){if(!(r<this.logCacheLevel)){var t="";try{for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var s=i.map(function(l){return logable(l)});t="[".concat(nowTime$1(),"]")+this._prefix+JSON.stringify(s)}catch{return}if(r>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var a=this.logTextArray.shift();this.logSize-=a.length}}}},{key:"getLogCache",value:function(){var r=this.logTextArray.join(`
`);return this.reset(),r}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var r;o.disabled||(console.group(this._prefix),(r=console).table.apply(r,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(r){this.logCacheLevel=r}}],[{key:"enable",value:function(){o.disabled=!1}},{key:"disable",value:function(){o.disabled=!0}}]),o}();_defineProperty$1(Logger$2,"disabled",!0);function nowTime$1(){return new Date().toLocaleString()}function reduceDepth(o){if(_typeof(o)!=="object")return o;var u=Object.prototype.toString.call(o).slice(8,-1);switch(u){case"Array":case"Uint8Array":case"ArrayBuffer":return u+"["+o.length+"]";case"Object":return"{}";default:return u}}function logable(o,u,r){r||(r=1),u||(u=2);var t={};if(!o||_typeof(o)!=="object")return o;var e=Object.prototype.toString.call(o).slice(8,-1);if(!SIMPLE_TYPE.includes(e))return e;if(!(r>u)){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r===u?t[i]=reduceDepth(o[i]):_typeof(o[i])==="object"?t[i]=logable(o[i],u,r+1):t[i]=o[i]);return t}}function createPublicPromise(){var o,u,r=new Promise(function(t,e){o=t,u=e});return r.used=!1,r.resolve=function(){return r.used=!0,o.apply(void 0,arguments)},r.reject=function(){return r.used=!0,u.apply(void 0,arguments)},r}function nowTime(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}}var SafeJSON={stringify:function o(u){try{return JSON.stringify(u)}catch{return""}},parse:function o(u){try{return JSON.parse(u)}catch{return}}};function getMediaSource(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return isBrowser$1?o&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch{}}function isMMS(o){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(o))}function getTimeRanges(o){var u=[];if(o instanceof TimeRanges)for(var r=0;r<o.length;r++)u.push({start:o.start(r),end:o.end(r)});return u}var OP_NAME={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},MSE=function(){function o(u,r){var t=this;_classCallCheck$1(this,o),_defineProperty$1(this,"media",null),_defineProperty$1(this,"mediaSource",null),_defineProperty$1(this,"_openPromise",createPublicPromise()),_defineProperty$1(this,"_queue",Object.create(null)),_defineProperty$1(this,"_sourceBuffer",Object.create(null)),_defineProperty$1(this,"_mseFullFlag",{}),_defineProperty$1(this,"_st",0),_defineProperty$1(this,"_opst",0),_defineProperty$1(this,"_logger",null),_defineProperty$1(this,"_config",null),_defineProperty$1(this,"_url",null),_defineProperty$1(this,"_onStartStreaming",function(){t._logger.debug("startstreaming")}),_defineProperty$1(this,"_onEndStreaming",function(){t._logger.debug("endstreaming")}),_defineProperty$1(this,"_onSBUpdateEnd",function(e){var i=t._queue[e];if(i){var n=i[0];if((n==null?void 0:n.opName)!==OP_NAME.UPDATE_DURATION&&i.shift(),n){var s,a,l=nowTime()-t._opst;t._logger.debug("UpdateEnd(".concat(e,"/").concat(n.opName,")"),SafeJSON.stringify(getTimeRanges((s=t._sourceBuffer[e])===null||s===void 0?void 0:s.buffered)),l,n.context),n.promise.resolve({name:n.opName,context:n.context,costtime:l});var c=(a=n.context)===null||a===void 0?void 0:a.callback;c&&typeof c=="function"&&c(n.context),t._startQueue(e)}}}),_defineProperty$1(this,"_onSBUpdateError",function(e,i){var n=t._queue[e];if(n){var s=n[0];s&&(t._logger.error("UpdateError",e,s.opName,s.context),s.promise.reject(new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_APPEND_BUFFER,i)))}}),this._config=Object.assign(o.getDefaultConfig(),r),u&&this.bindMedia(u),this._logger=new Logger$2("MSE"),this._config.openLog&&Logger$2.enable()}return _createClass$1(o,[{key:"isOpened",get:function(){var r;return((r=this.mediaSource)===null||r===void 0?void 0:r.readyState)==="open"}},{key:"hasOpTasks",get:function(){var r=this,t=!1;return Object.keys(this._queue).forEach(function(e){var i=r._queue[e];Array.isArray(i)&&(t||(t=i.length>0))}),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var r;return((r=this.mediaSource)===null||r===void 0?void 0:r.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return isMMS(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(r){return r?this._mseFullFlag[r]:this._mseFullFlag[o.VIDEO]}},{key:"updateDuration",value:function(r){var t=this,e=this.mediaSource&&this.mediaSource.duration>r;if(this.mediaSource&&this.mediaSource.duration>r){var i=0;if(Object.keys(this._sourceBuffer).forEach(function(n){try{i=Math.max(t.bufferEnd(n)||0,i)}catch{}}),r<i)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("setDuration but ended");return}t.mediaSource&&(t.mediaSource.duration=r,t._logger.debug("setDuration",r))},OP_NAME.UPDATE_DURATION,{isReduceDuration:e})}},{key:"open",value:function(){var r=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,e=function i(){var n=nowTime()-r._st;r._logger.debug("sourceopen",n),t.removeEventListener("sourceopen",i),r._openPromise.resolve({costtime:n})};t.addEventListener("sourceopen",e),this._openPromise=createPublicPromise()}return this._openPromise}},{key:"bindMedia",value:function(){var u=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var i=this,n,s,a,l;return _regeneratorRuntime().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.mediaSource||this.media)){f.next=3;break}return f.next=3,this.unbindMedia();case 3:if(n=getMediaSource(this._config.preferMMS),!(!e||!n)){f.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=e,s=this.mediaSource=new n,a=isMMS(s),this._st=nowTime(),l=function h(){var p=nowTime()-i._st;i._logger.debug("sourceopen"),s.removeEventListener("sourceopen",h),URL.revokeObjectURL(e.src),i._openPromise.resolve({costtime:p})},s.addEventListener("sourceopen",l),a&&(s.addEventListener("startstreaming",this._onStartStreaming),s.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(s),e.src=this._url,e.disableRemotePlayback=a,f.abrupt("return",this._openPromise);case 17:case"end":return f.stop()}},t,this)}));function r(t){return u.apply(this,arguments)}return r}()},{key:"unbindMedia",value:function(){var u=_asyncToGenerator(_regeneratorRuntime().mark(function t(){var e=this,i,n,s;return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),i=this.mediaSource,i){if(Object.keys(this._queue).forEach(function(c){var f=e._queue[c];f&&f.forEach(function(h){var p,d;return(p=h.promise)===null||p===void 0||(d=p.resolve)===null||d===void 0?void 0:d.call(p)})}),n=!!this.media&&this.media.readyState>=1,s=i.readyState==="open",n&&s)try{i.endOfStream()}catch{}Object.keys(this._sourceBuffer).forEach(function(c){try{i.removeSourceBuffer(e._sourceBuffer[c])}catch{}}),isMMS(i)&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch{}this.media=null}this.mediaSource=null,this._openPromise=createPublicPromise(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return l.stop()}},t,this)}));function r(){return u.apply(this,arguments)}return r}()},{key:"createSource",value:function(r,t){if(!(this._sourceBuffer[r]||!this.mediaSource)){var e;try{e=this._sourceBuffer[r]=this.mediaSource.addSourceBuffer(t)}catch(i){throw new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_ADD_SB,i)}e.mimeType=t,e.addEventListener("updateend",this._onSBUpdateEnd.bind(this,r)),e.addEventListener("error",this._onSBUpdateError.bind(this,r))}}},{key:"changeType",value:function(r,t){var e=this,i=this._sourceBuffer[r];return!this.mediaSource||!i||i.mimeType===t?Promise.resolve():typeof i.changeType!="function"?Promise.reject(new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(r,function(){try{i.changeType(t)}catch(n){throw new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_CHANGE_TYPE,n)}i.mimeType=t,e._onSBUpdateEnd(r)},"changeType",{mimeType:t})}},{key:"createOrChangeSource",value:function(r,t){return this.createSource(r,t),this.changeType(r,t)}},{key:"append",value:function(r,t,e){var i=this;return!t||!t.byteLength||!this._sourceBuffer[r]?Promise.resolve():this._enqueueOp(r,function(){var n;!i.mediaSource||i.media.error||(i._logger.debug("MSE APPEND START",e),i._opst=nowTime(),(n=i._sourceBuffer[r])===null||n===void 0||n.appendBuffer(t))},OP_NAME.APPEND,e)}},{key:"remove",value:function(r,t,e,i){var n=this,s=!1;return this._mseFullFlag[r]&&(s=!0),this._enqueueOp(r,function(){if(!(!n.mediaSource||n.media.error)){var a=n._sourceBuffer[r];if(t>=e||!a){n._onSBUpdateEnd(r);return}n._opst=nowTime(),n._logger.debug("MSE REMOVE START",r,t,e,i),a.remove(t,e)}},OP_NAME.REMOVE,i,s)}},{key:"clearBuffer",value:function(r,t){var e=this,i;return Object.keys(this._sourceBuffer).forEach(function(n){i=e.remove(n,r,t)}),i||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var r=this,t;return Object.keys(this._sourceBuffer).forEach(function(e){var i=r._sourceBuffer[e];t=r.remove(e,0,Buffer$1.end(Buffer$1.get(i)))}),t}},{key:"clearOpQueues",value:function(r,t){var e;this._logger.debug("MSE clearOpQueue START");var i=this._queue[r];if(t&&i){this._queue[r]=[];return}if(!(!i||!i[r]||i.length<5)){var n=[];i.forEach(function(s){s.context&&s.context.isinit&&n.push(s)}),this._queue[r]=i.slice(0,2),n.length>0&&(e=this._queue[r]).push.apply(e,n)}}},{key:"endOfStream",value:function(r){var t=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var e=t.mediaSource;!e||e.readyState!=="open"||(t._logger.debug("MSE endOfStream START"),r?e.endOfStream(r):e.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(r,t){var e=this.mediaSource;r<0||t<r||!(e!=null&&e.setLiveSeekableRange)||e.readyState!=="open"||e.setLiveSeekableRange(r,t)}},{key:"getSourceBuffer",value:function(r){return this._sourceBuffer[r]}},{key:"buffered",value:function(r){return Buffer$1.get(this._sourceBuffer[r])}},{key:"bufferStart",value:function(r){return Buffer$1.start(this.buffered(r))}},{key:"bufferEnd",value:function(r){return Buffer$1.end(this.buffered(r))}},{key:"_enqueueOp",value:function(r,t,e,i,n){var s=this;if(!this.mediaSource)return Promise.resolve();var a=this._queue[r]=this._queue[r]||[],l={exec:t,promise:createPublicPromise(),opName:e,context:i};return n?(a.splice(0,0,l),this._mseFullFlag[r]=!1,this._startQueue(r)):a.push(l),this.isOpened||this.isEnded?a.length===1&&this._startQueue(r):this._openPromise.then(function(){a.length===1&&s._startQueue(r)}),l.promise}},{key:"_enqueueBlockingOp",value:function(){var u=_asyncToGenerator(_regeneratorRuntime().mark(function t(e,i,n){var s=this,a,l;return _regeneratorRuntime().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.mediaSource){f.next=2;break}return f.abrupt("return",Promise.resolve());case 2:if(a=Object.keys(this._sourceBuffer),a.length){f.next=5;break}return f.abrupt("return",e());case 5:return l=[],a.forEach(function(h){var p=s._queue[h],d=createPublicPromise();l.push(d),p.push({exec:function(){d.resolve()},promise:d,opName:i,context:n}),p.length===1&&s._startQueue(h)}),f.abrupt("return",Promise.all(l).then(function(){try{return e()}finally{a.forEach(function(h){var p=s._queue[h],d=s._sourceBuffer[h];p==null||p.shift(),(!d||!d.updating)&&s._startQueue(h)})}}));case 8:case"end":return f.stop()}},t,this)}));function r(t,e,i){return u.apply(this,arguments)}return r}()},{key:"_startQueue",value:function(r){var t=this._queue[r];if(t){var e=t[0];if(e&&!this._mseFullFlag[r])try{e.exec()}catch(i){i&&i.message&&i.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[r]=!0,e.context&&_typeof(e.context)==="object"&&(e.context.isFull=!0),this._logger.error("[MSE error],  context,",e.context," ,name,",e.opName,",err,SourceBuffer is full"),e.promise.reject(new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_FULL,i))):(this._logger.error(i),e.promise.reject(i.constructor===StreamingError?i:new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_OTHER,i)),t.shift(),this._startQueue(r))}}}},{key:"setTimeoffset",value:function(r,t,e){var i=this;return this._enqueueOp(r,function(){t<0&&(t+=.001),i._sourceBuffer[r].timestampOffset=t,i._onSBUpdateEnd(r)},"setTimeoffset",e)}},{key:"abort",value:function(r,t){var e=this;return this.isOpened?this._enqueueOp(r,function(){e._sourceBuffer[r].abort(),e._onSBUpdateEnd(r)},"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=getMediaSource();if(!t)return!1;try{return t.isTypeSupported(r)}catch(e){return this._logger.error(r,e),!1}}},{key:"isMMSOnly",value:function(){return typeof ManagedMediaSource<"u"&&typeof MediaSource>"u"}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),o}();_defineProperty$1(MSE,"VIDEO","video");_defineProperty$1(MSE,"AUDIO","audio");var LoaderType={FETCH:"fetch",XHR:"xhr"},ResponseType={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError=function(o){_inherits$1(r,o);var u=_createSuper$1(r);function r(t,e,i,n){var s;return _classCallCheck$1(this,r),s=u.call(this,n),_defineProperty$1(_assertThisInitialized$1(s),"retryCount",0),_defineProperty$1(_assertThisInitialized$1(s),"isTimeout",!1),_defineProperty$1(_assertThisInitialized$1(s),"loaderType",LoaderType.FETCH),_defineProperty$1(_assertThisInitialized$1(s),"startTime",0),_defineProperty$1(_assertThisInitialized$1(s),"endTime",0),_defineProperty$1(_assertThisInitialized$1(s),"options",{}),s.url=t,s.request=e,s.response=i,s}return _createClass$1(r)}(_wrapNativeSuper(Error)),toString=Object.prototype.toString;function isObject(o){return o!==null&&_typeof(o)==="object"}function isPlainObject(o){if(toString.call(o)!=="[object Object]")return!1;var u=Object.getPrototypeOf(o);return u===null||u===Object.prototype}function isDate(o){return toString.call(o)==="[object Date]"}function getRangeValue(o){if(!(!o||o[0]===null||o[0]===void 0||o[0]===0&&(o[1]===null||o[1]===void 0))){var u="bytes="+o[0]+"-";return o[1]&&(u+=o[1]),u}}function encode(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams(o,u){if(o){if(!u)return o;var r,t=Object.keys(u).map(function(i){if(r=u[i],r!=null)return Array.isArray(r)?i=i+"[]":r=[r],r.map(function(n){return isDate(n)?n=n.toISOString():isObject(n)&&(n=JSON.stringify(n)),"".concat(encode(i),"=").concat(encode(n))}).join("&")}).filter(Boolean).join("&");if(t){var e=o.indexOf("#");e!==-1&&(o=o.slice(0,e)),o+=(o.indexOf("?")===-1?"?":"&")+t}return o}}function createResponse(o,u,r,t,e,i,n,s,a,l,c){e=e!=null?parseFloat(e):null,t=parseInt(t||"0",10),Number.isNaN(t)&&(t=0);var f={range:a,vid:l,index:s,contentLength:t,age:e,startTime:i,firstByteTime:n,endTime:Date.now(),priOptions:c};return{data:o,done:u,options:f,response:r}}function calculateSpeed(o,u){return Math.round(o*8*1e3/u/1024)}var EVENT={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",APPEND_BUFFER:"core.appendbuffer",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},CACHESIZE=2*1024*1024,FetchLoader=function(o){_inherits$1(r,o);var u=_createSuper$1(r);function r(){var t;return _classCallCheck$1(this,r),t=u.call(this),_defineProperty$1(_assertThisInitialized$1(t),"_abortController",null),_defineProperty$1(_assertThisInitialized$1(t),"_timeoutTimer",null),_defineProperty$1(_assertThisInitialized$1(t),"_reader",null),_defineProperty$1(_assertThisInitialized$1(t),"_response",null),_defineProperty$1(_assertThisInitialized$1(t),"_aborted",!1),_defineProperty$1(_assertThisInitialized$1(t),"_index",-1),_defineProperty$1(_assertThisInitialized$1(t),"_range",null),_defineProperty$1(_assertThisInitialized$1(t),"_receivedLength",0),_defineProperty$1(_assertThisInitialized$1(t),"_running",!1),_defineProperty$1(_assertThisInitialized$1(t),"_logger",null),_defineProperty$1(_assertThisInitialized$1(t),"_vid",""),_defineProperty$1(_assertThisInitialized$1(t),"_onProcessMinLen",0),_defineProperty$1(_assertThisInitialized$1(t),"_onCancel",null),_defineProperty$1(_assertThisInitialized$1(t),"_priOptions",null),t}return _createClass$1(r,[{key:"load",value:function(e){var i,n=this,s=e.url,a=e.vid,l=e.timeout,c=e.responseType,f=e.onProgress,h=e.index,p=e.onTimeout,d=e.onCancel,v=e.range,g=e.transformResponse,y=e.request,m=e.params,S=e.logger,_=e.method,A=e.headers,k=e.body,w=e.mode,I=e.credentials,N=e.cache,x=e.redirect,M=e.referrer,b=e.referrerPolicy,T=e.onProcessMinLen,C=e.priOptions;this._logger=S,this._aborted=!1,this._onProcessMinLen=T,this._onCancel=d,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=h,this._range=v||[0,0],this._vid=a||s,this._priOptions=C||{};var D={method:_,headers:A,body:k,mode:w,credentials:I,cache:N,redirect:x,referrer:M,referrerPolicy:b,signal:(i=this._abortController)===null||i===void 0?void 0:i.signal},P=!1;clearTimeout(this._timeoutTimer),s=setUrlParams(s,m);var B=getRangeValue(v);B&&(y?A=y.headers:A=D.headers=D.headers||(Headers?new Headers:{}),Headers&&A instanceof Headers?A.append("Range",B):A.Range=B),l&&(this._timeoutTimer=setTimeout(function(){if(P=!0,n.cancel(),p){var F=new NetError(s,D,null,"timeout");F.isTimeout=!0,p(F,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})}},l));var $=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",v),new Promise(function(F,K){fetch(y||s,y?void 0:D).then(function(){var Y=_asyncToGenerator(_regeneratorRuntime().mark(function G(H){var Q,J,ne,ie;return _regeneratorRuntime().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=H,!(n._aborted||!n._running)){X.next=4;break}return X.abrupt("return");case 4:if(g&&(H=g(H,s)||H),H.ok){X.next=7;break}throw new NetError(s,D,H,"bad network response");case 7:if(Q=Date.now(),c!==ResponseType.TEXT){X.next=15;break}return X.next=11,H.text();case 11:J=X.sent,n._running=!1,X.next=37;break;case 15:if(c!==ResponseType.JSON){X.next=22;break}return X.next=18,H.json();case 18:J=X.sent,n._running=!1,X.next=37;break;case 22:if(!f){X.next=29;break}return n.resolve=F,n.reject=K,n._loadChunk(H,f,$,Q),X.abrupt("return");case 29:return X.next=31,H.arrayBuffer();case 31:J=X.sent,J=new Uint8Array(J),n._running=!1,ne=Date.now()-$,ie=calculateSpeed(J.byteLength,ne),n.emit(EVENT.REAL_TIME_SPEED,{speed:ie,len:J.byteLength,time:ne,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",h,",range,",v),F(createResponse(J,!0,H,H.headers.get("Content-Length"),H.headers.get("age"),$,Q,h,v,n._vid,n._priOptions));case 39:case"end":return X.stop()}},G)}));return function(G){return Y.apply(this,arguments)}}()).catch(function(Y){var G;clearTimeout(n._timeoutTimer),n._running=!1,!(n._aborted&&!P)&&(Y=Y instanceof NetError?Y:new NetError(s,D,null,(G=Y)===null||G===void 0?void 0:G.message),Y.startTime=$,Y.endTime=Date.now(),Y.isTimeout=P,Y.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},K(Y))})})}},{key:"cancel",value:function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function i(){return _regeneratorRuntime().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this._aborted){s.next=2;break}return s.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){s.next=14;break}if(s.prev=5,!this._reader){s.next=9;break}return s.next=9,this._reader.cancel();case 9:s.next=13;break;case 11:s.prev=11,s.t0=s.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return s.stop()}},i,this,[[5,11]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadChunk",value:function(e,i,n,s){var a=this;if(!e.body||!e.body.getReader){this._running=!1;var l=new NetError(e.url,"",e,"onProgress of bad response.body.getReader");l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(l);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(CACHESIZE),this._writeIdx=0);var c=this._reader=e.body.getReader(),f,h,p,d=function(){var v=_asyncToGenerator(_regeneratorRuntime().mark(function g(){var y,m,S,_,A,k,w,I;return _regeneratorRuntime().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return h=Date.now(),x.prev=1,x.next=4,c.read();case 4:f=x.sent,p=Date.now(),x.next=13;break;case 8:return x.prev=8,x.t0=x.catch(1),p=Date.now(),a._aborted||(a._running=!1,x.t0.options={index:a._index,range:a._range,vid:a._vid,priOptions:a._priOptions},a.reject(x.t0)),x.abrupt("return");case 13:if(m=((y=a._range)===null||y===void 0?void 0:y.length)>0?a._range[0]:0,S=m+a._receivedLength,!a._aborted){x.next=19;break}return a._running=!1,i(void 0,!1,{range:[S,S],vid:a._vid,index:a._index,startTime:h,endTime:p,st:n,firstByteTime:s,priOptions:a._priOptions},e),x.abrupt("return");case 19:_=f.value?f.value.byteLength:0,a._receivedLength+=_,a._logger.debug("【fetchLoader,onProgress call】,task,",a._range,", start,",S,", end,",m+a._receivedLength,", done,",f.done),a._onProcessMinLen>0?a._writeIdx+_>=a._onProcessMinLen||f.done?(A=new Uint8Array(a._writeIdx+_),A.set(a._cache.slice(0,a._writeIdx),0),_>0&&A.set(f.value,a._writeIdx),a._writeIdx=0,a._logger.debug("【fetchLoader,onProgress enough】,done,",f.done,",len,",A.byteLength,", writeIdx,",a._writeIdx)):_>0&&a._writeIdx+_<CACHESIZE?(a._cache.set(f.value,a._writeIdx),a._writeIdx+=_,a._logger.debug("【fetchLoader,onProgress cache】,len,",_,", writeIdx,",a._writeIdx)):_>0&&(k=new Uint8Array(a._writeIdx+_+2048),a._logger.debug("【fetchLoader,onProgress extra start】,size,",a._writeIdx+_+2048,", datalen,",_,", writeIdx,",a._writeIdx),k.set(a._cache.slice(0,a._writeIdx),0),_>0&&k.set(f.value,a._writeIdx),a._writeIdx+=_,delete a._cache,a._cache=k,a._logger.debug("【fetchLoader,onProgress extra end】,len,",_,", writeIdx,",a._writeIdx)):A=f.value,(A&&A.byteLength>0||f.done)&&i(A,f.done,{range:[a._range[0]+a._receivedLength-(A?A.byteLength:0),a._range[0]+a._receivedLength],vid:a._vid,index:a._index,startTime:h,endTime:p,st:n,firstByteTime:s,priOptions:a._priOptions},e),f.done?(w=Date.now()-n,I=calculateSpeed(a._receivedLength,w),a.emit(EVENT.REAL_TIME_SPEED,{speed:I,len:a._receivedLength,time:w,vid:a._vid,index:a._index,range:a._range,priOptions:a._priOptions}),a._running=!1,a._logger.debug("[fetchLoader onProgress end],task,",a._range,",done,",f.done),a.resolve(createResponse(f,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,s,a._index,a._range,a._vid,a._priOptions))):d();case 25:case"end":return x.stop()}},g,null,[[1,8]])}));return function(){return v.apply(this,arguments)}}();d()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),r}(EventEmitter);function getConfig(o){return _objectSpread2({loaderType:LoaderType.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},o)}var XhrLoader=function(o){_inherits$1(r,o);var u=_createSuper$1(r);function r(){var t;return _classCallCheck$1(this,r),t=u.call(this),_defineProperty$1(_assertThisInitialized$1(t),"_xhr",null),_defineProperty$1(_assertThisInitialized$1(t),"_aborted",!1),_defineProperty$1(_assertThisInitialized$1(t),"_timeoutTimer",null),_defineProperty$1(_assertThisInitialized$1(t),"_range",null),_defineProperty$1(_assertThisInitialized$1(t),"_receivedLength",0),_defineProperty$1(_assertThisInitialized$1(t),"_url",null),_defineProperty$1(_assertThisInitialized$1(t),"_onProgress",null),_defineProperty$1(_assertThisInitialized$1(t),"_index",-1),_defineProperty$1(_assertThisInitialized$1(t),"_headers",null),_defineProperty$1(_assertThisInitialized$1(t),"_currentChunkSizeKB",384),_defineProperty$1(_assertThisInitialized$1(t),"_timeout",null),_defineProperty$1(_assertThisInitialized$1(t),"_xhr",null),_defineProperty$1(_assertThisInitialized$1(t),"_withCredentials",null),_defineProperty$1(_assertThisInitialized$1(t),"_startTime",-1),_defineProperty$1(_assertThisInitialized$1(t),"_loadCompleteResolve",null),_defineProperty$1(_assertThisInitialized$1(t),"_loadCompleteReject",null),_defineProperty$1(_assertThisInitialized$1(t),"_runing",!1),_defineProperty$1(_assertThisInitialized$1(t),"_logger",!1),_defineProperty$1(_assertThisInitialized$1(t),"_vid",""),_defineProperty$1(_assertThisInitialized$1(t),"_responseType",void 0),_defineProperty$1(_assertThisInitialized$1(t),"_credentials",void 0),_defineProperty$1(_assertThisInitialized$1(t),"_method",void 0),_defineProperty$1(_assertThisInitialized$1(t),"_transformResponse",void 0),_defineProperty$1(_assertThisInitialized$1(t),"_firstRtt",void 0),_defineProperty$1(_assertThisInitialized$1(t),"_onCancel",null),_defineProperty$1(_assertThisInitialized$1(t),"_priOptions",null),t}return _createClass$1(r,[{key:"load",value:function(e){var i=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=setUrlParams(e.url,e.params);var n=Date.now();return new Promise(function(s,a){i._loadCompleteResolve=s,i._loadCompleteReject=a,i._startLoad()}).catch(function(s){if(clearTimeout(i._timeoutTimer),i._runing=!1,!i._aborted)throw s=s instanceof NetError?s:new NetError(i._url,i._request),s.startTime=n,s.endTime=Date.now(),s.options={index:i._index,vid:i._vid,priOptions:i._priOptions},s})}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===ResponseType.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var i=this._currentChunkSizeKB*1024,n=this._range[0]+this._receivedLength,s=this._range[1];i<this._range[1]-n&&(s=n+i),e=[n,s],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var i=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(l){var c,f,h;i._running=!1;var p=new NetError(i._url,i._request,l==null||(c=l.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(l==null||(f=l.currentTarget)===null||f===void 0?void 0:f.status)+",statusText,"+(l==null||(h=l.currentTarget)===null||h===void 0?void 0:h.statusText));p.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(p)},n.ontimeout=function(l){i.cancel();var c=new NetError(i._url,i._request,{status:408},"timeout");i._onTimeout&&(c.isTimeout=!0,i._onTimeout(c,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})),c.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(c)};var s=this._headers||{},a=getRangeValue(e);a&&(s.Range=a),s&&Object.keys(s).forEach(function(l){n.setRequestHeader(l,s[l])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),n.send(this._body)}catch(l){l.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)}}},{key:"_onReadyStatechange",value:function(e){var i=e.target;i.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var i,n=e.target.status;if(n<200||n>299){var s=new NetError(this._url,null,_objectSpread2(_objectSpread2({},e.target.response),{},{status:n}),"bad response,status:"+n);return s.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(s)}var a=null,l=!1,c,f=((i=this._range)===null||i===void 0?void 0:i.length)>0?this._range[0]:0;if(this._responseType===ResponseType.ARRAY_BUFFER){var h,p=new Uint8Array(e.target.response);if(c=f+this._receivedLength,p&&p.byteLength>0){this._receivedLength+=p.byteLength;var d=Date.now()-this._startTime,v=calculateSpeed(this._receivedLength,d);this.emit(EVENT.REAL_TIME_SPEED,{speed:v,len:this._receivedLength,time:d,vid:this._vid,index:this._index,range:[c,f+this._receivedLength],priOptions:this._priOptions})}a=p,((h=this._range)===null||h===void 0?void 0:h.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?l=!1:l=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",f+this._receivedLength,",dataLen,",p?p.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",l)}else l=!0,a=e.target.response;var g={ok:n>=200&&n<300,status:n,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(g=this._transformResponse(g,this._url)||g),this._onProgress&&this._onProgress(a,l,{index:this._index,vid:this._vid,range:[c,f+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},g),l?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(createResponse(this._onProgress?null:a,l,g,g.headers["content-length"],g.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,_get(_getPrototypeOf$1(r.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var i=e.getAllResponseHeaders().trim().split(`\r
`),n={},s=_createForOfIteratorHelper(i),a;try{for(s.s();!(a=s.n()).done;){var l=a.value,c=l.split(": ");n[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(f){s.e(f)}finally{s.f()}return n}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),r}(EventEmitter),_excluded=["retry","retryDelay","onRetryError","transformError"],Task=function(){function o(u,r){_classCallCheck$1(this,o),this.promise=createPublicPromise(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new Logger$2("Loader")),this._loaderType=u,this._loader=u===LoaderType.FETCH&&typeof fetch<"u"?new FetchLoader:new XhrLoader,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=r.retryCheckFunc,this._logger=r.logger}return _createClass$1(o,[{key:"exec",value:function(){var r=this,t=this._config,e=t.retry,i=t.retryDelay,n=t.onRetryError,s=t.transformError,a=_objectWithoutProperties(t,_excluded),l=function(){var c=_asyncToGenerator(_regeneratorRuntime().mark(function f(){var h,p,d;return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,r._loader.load(a);case 3:h=g.sent,r.promise.resolve(h),g.next=27;break;case 7:if(g.prev=7,g.t0=g.catch(0),r._loader.running=!1,r._logger.debug("[task request catch err]",g.t0),!r._canceled){g.next=13;break}return g.abrupt("return");case 13:if(g.t0.loaderType=r._loaderType,g.t0.retryCount=r._retryCount,p=g.t0,s&&(p=s(p)||p),n&&r._retryCount>0&&n(p,r._retryCount,{index:a.index,vid:a.vid,range:a.range,priOptions:a.priOptions}),r._retryCount++,d=!0,r._retryCheckFunc&&(d=r._retryCheckFunc(g.t0)),!(d&&r._retryCount<=e)){g.next=26;break}return clearTimeout(r._retryTimer),r._logger.debug("[task request setTimeout],retry",r._retryCount,",retry range,",a.range),r._retryTimer=setTimeout(l,i),g.abrupt("return");case 26:r.promise.reject(p);case 27:case"end":return g.stop()}},f,null,[[0,7]])}));return function(){return c.apply(this,arguments)}}();return l(),this.promise}},{key:"cancel",value:function(){var u=_asyncToGenerator(_regeneratorRuntime().mark(function t(){return _regeneratorRuntime().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,i.abrupt("return",this._loader.cancel());case 4:case"end":return i.stop()}},t,this)}));function r(){return u.apply(this,arguments)}return r}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),o}();function isMediaPlaying(o){return o&&!o.paused&&!o.ended&&o.playbackRate!==0&&o.readyState!==0}function getVideoPlaybackQuality(o){if(!o)return{};if(typeof o.getVideoPlaybackQuality=="function"){var u=o.getVideoPlaybackQuality();return{droppedVideoFrames:u.droppedVideoFrames||u.corruptedVideoFrames,totalVideoFrames:u.totalVideoFrames,creationTime:u.creationTime}}return{droppedVideoFrames:o.webkitDroppedFrameCount,totalVideoFrames:o.webkitDecodedFrameCount,creationTime:performance.now()}}function concatUint8Array$1(){for(var o=arguments.length,u=new Array(o),r=0;r<o;r++)u[r]=arguments[r];if(u=u.filter(Boolean),u.length<2)return u[0];var t=new Uint8Array(u.reduce(function(i,n){return i+n.byteLength},0)),e=0;return u.forEach(function(i){t.set(i,e),e+=i.byteLength}),t}function sleep(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(u){return setTimeout(u,o)})}var NetLoader=function(o){_inherits$1(r,o);var u=_createSuper$1(r);function r(t){var e;return _classCallCheck$1(this,r),e=u.call(this,t),_defineProperty$1(_assertThisInitialized$1(e),"type",LoaderType.FETCH),_defineProperty$1(_assertThisInitialized$1(e),"_queue",[]),_defineProperty$1(_assertThisInitialized$1(e),"_alive",[]),_defineProperty$1(_assertThisInitialized$1(e),"_currentTask",null),_defineProperty$1(_assertThisInitialized$1(e),"_finnalUrl",""),_defineProperty$1(_assertThisInitialized$1(e),"_config",void 0),e._config=getConfig(t),(e._config.loaderType===LoaderType.XHR||!FetchLoader.isSupported())&&(e.type=LoaderType.XHR),e.log=t.logger,e}return _createClass$1(r,[{key:"isFetch",value:function(){return this.type===LoaderType.FETCH}},{key:"load",value:function(e){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof e=="string"||!e?n.url=e||n.url||this._config.url:n=e,n=Object.assign({},this._config,n),n.params&&(n.params=Object.assign({},n.params)),n.headers&&isPlainObject(n.headers)&&(n.headers=Object.assign({},n.headers)),n.body&&isPlainObject(n.body)&&(n.body=Object.assign({},n.body)),n.transformRequest&&(n=n.transformRequest(n)||n),n.logger=this.log;var s=new Task(this.type,n);return s.loader.on(EVENT.REAL_TIME_SPEED,function(a){i.emit(EVENT.REAL_TIME_SPEED,a)}),this._queue.push(s),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),s.promise}},{key:"cancel",value:function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function i(){var n;return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=this._queue.map(function(l){return l.cancel()}).concat(this._alive.map(function(l){return l.cancel()})),this._currentTask&&n.push(this._currentTask.cancel()),this._queue=[],this._alive=[],a.next=6,Promise.all(n);case 6:return a.next=8,sleep();case 8:case"end":return a.stop()}},i,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var i=this._currentTask.exec().catch(function(n){});i&&typeof i.finally=="function"&&i.finally(function(){var n,s;(n=e._currentTask)!==null&&n!==void 0&&n.alive&&((s=e._alive)===null||s===void 0?void 0:s.length)>0&&(e._alive=e._alive.filter(function(a){return a&&a!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return FetchLoader.isSupported()}}]),r}(EventEmitter),GapService=function(){function o(){_classCallCheck$1(this,o),_defineProperty$1(this,"_prevCurrentTime",0)}return _createClass$1(o,[{key:"do",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(r){var n=r.currentTime,s=0;if(this._prevCurrentTime===n){var a=Buffer$1.info(Buffer$1.get(r),n);if(!a.buffers.length)return;e&&a.nextStart||a.nextStart&&a.nextStart-n<t?s=a.nextStart+.1:a.end&&a.end-n>i&&!r.seeking&&(s=n+.1)}this._prevCurrentTime=n,s&&n!==s&&(r.currentTime=s)}}}]),o}(),SeiService=function(){function o(u){var r=this;_classCallCheck$1(this,o),_defineProperty$1(this,"_seiSet",new Set),this.emitter=u,u.on(EVENT.SEI,function(t){t&&r._seiSet.add(t)})}return _createClass$1(o,[{key:"throw",value:function(r,t){var e=this;if(!(r==null||!this._seiSet.size)){var i=r-.2,n=r+.2,s=[];this._seiSet.forEach(function(a){a.time>=i&&a.time<=n&&s.push(a)}),s.forEach(function(a){e._seiSet.delete(a),e.emitter.emit(EVENT.SEI_IN_TIME,a)}),t&&this._seiSet.forEach(function(a){a.time<r-5&&e._seiSet.delete(a)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),o}(),SKIP_SMALL_CHUNK=1e3,MAX_CHUNK_SAVE_SIZE=50,MAX_SEGMENT_SAVE_SIZE=3,LONGTIME_NO_RECEIVE=3e3,BandwidthService=function(){function o(u){_classCallCheck$1(this,o),_defineProperty$1(this,"_chunkSpeed",0),_defineProperty$1(this,"_chunkCache",[]),_defineProperty$1(this,"_speeds",[]),_defineProperty$1(this,"_totalSize",0),_defineProperty$1(this,"_totalCost",0),this._opts=u||{}}return _createClass$1(o,[{key:"addRecord",value:function(r,t){!r||!t||(this._speeds.push(8e3*r/t),this._speeds=this._speeds.slice(-MAX_SEGMENT_SAVE_SIZE))}},{key:"addChunkRecord",value:function(r,t){var e,i;if(!(!r||!t||r<(((e=this._opts)===null||e===void 0?void 0:e.skipChunkSize)||SKIP_SMALL_CHUNK))){this._totalSize+=r,this._totalCost+=t,this._chunkSpeed=8e3*r/t,this._chunkCache.push({size:r,duration:t,timestamp:performance.now()});var n=((i=this._opts)===null||i===void 0?void 0:i.chunkCountForSpeed)||MAX_CHUNK_SAVE_SIZE;this._chunkCache.length>n&&(this._chunkCache=this._chunkCache.slice(-n))}}},{key:"getAvgSpeed",value:function(){var r;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce(function(s,a){return s+=a})/this._speeds.length;var t=this._chunkCache[this._chunkCache.length-1],e=performance.now()-t.timestamp;e>(((r=this._opts)===null||r===void 0?void 0:r.longtimeNoReceived)||LONGTIME_NO_RECEIVE)&&this._chunkCache.push({size:0,duration:e,timestamp:performance.now()});var i=this._chunkCache.reduce(function(s,a){return s+=a.size},0),n=this._chunkCache.reduce(function(s,a){return s+=a.duration},0);return 8e3*i/n}},{key:"getLatestSpeed",value:function(){return!this._chunkCache.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),o}(),Stats=function(){function o(u){_classCallCheck$1(this,o),_defineProperty$1(this,"encodeType",""),_defineProperty$1(this,"audioCodec",""),_defineProperty$1(this,"videoCodec",""),_defineProperty$1(this,"domain",""),_defineProperty$1(this,"fps",0),_defineProperty$1(this,"bitrate",0),_defineProperty$1(this,"width",0),_defineProperty$1(this,"height",0),_defineProperty$1(this,"samplerate",0),_defineProperty$1(this,"channelCount",0),_defineProperty$1(this,"gop",0),_defineProperty$1(this,"_bitsAccumulateSize",0),_defineProperty$1(this,"_bitsAccumulateDuration",0),_defineProperty$1(this,"_startGopId",-1),this._timescale=u}return _createClass$1(o,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(r){this.encodeType=r}},{key:"setFpsFromScriptData",value:function(r){var t,e=r.data,i=e==null||(t=e.onMetaData)===null||t===void 0?void 0:t.framerate;i&&i>0&&i<100&&(this.fps=i)}},{key:"setVideoMeta",value:function(r){if(this.width=r.width,this.height=r.height,this.videoCodec=r.codec,this.encodeType=r.codecType,r.fpsNum&&r.fpsDen){var t=r.fpsNum/r.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(r){this.audioCodec=r.codec,this.samplerate=r.sampleRate,this.channelCount=r.channelCount}},{key:"setDomain",value:function(r){this.domain=r.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(r){var t=this;if((!this.fps||this.fps>=100)&&r.length){var e=r.reduce(function(i,n){return i+=n.duration},0)/r.length;this.fps=Math.round(this._timescale/e)}r.forEach(function(i){t._startGopId===-1&&(t._startGopId=i.gopId),i.gopId===t._startGopId&&t.gop++,t._bitsAccumulateDuration+=i.duration/(t._timescale/1e3),t._bitsAccumulateSize+=i.units.reduce(function(n,s){return n+=s.length},0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=t._bitsAccumulateSize*8,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)})}}]),o}(),MediaStatsService=function(){function o(u){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;_classCallCheck$1(this,o),_defineProperty$1(this,"_core",null),_defineProperty$1(this,"_samples",[]),this._core=u,this._timescale=r,this._stats=new Stats(r),this._bindEvents()}return _createClass$1(o,[{key:"getStats",value:function(){var r,t,e,i,n,s,a,l,c,f,h,p=((r=this._core)===null||r===void 0?void 0:r.media)||{},d=p.currentTime,v=d===void 0?0:d,g=p.decodeFps,y=g===void 0?0:g;return _objectSpread2(_objectSpread2({},this._stats.getStats()),{},{downloadSpeed:((t=this._core)===null||t===void 0||(e=t.speedInfo)===null||e===void 0?void 0:e.call(t).speed)||0,avgSpeed:((i=this._core)===null||i===void 0||(n=i.speedInfo)===null||n===void 0?void 0:n.call(i).avgSpeed)||0,totalReceivedByte:((s=this._core)===null||s===void 0||(a=s.speedInfo)===null||a===void 0?void 0:a.call(s).totalSize)||0,totalReceivedCost:((l=this._core)===null||l===void 0||(c=l.speedInfo)===null||c===void 0?void 0:c.call(l).totalCost)||0,currentTime:v,bufferEnd:((f=this._core)===null||f===void 0||(h=f.bufferInfo())===null||h===void 0?void 0:h.remaining)||0,decodeFps:y})}},{key:"_bindEvents",value:function(){var r=this;this._core.on(EVENT.DEMUXED_TRACK,function(t){var e=t.videoTrack;return r._stats.updateBitrate(e.samples)}),this._core.on(EVENT.FLV_SCRIPT_DATA,function(t){r._stats.setFpsFromScriptData(t)}),this._core.on(EVENT.METADATA_PARSED,function(t){t.type==="video"?r._stats.setVideoMeta(t.track):r._stats.setAudioMeta(t.track)}),this._core.on(EVENT.TTFB,function(t){r._stats.setDomain(t.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new Stats(this._timescale)}}]),o}();function _iterableToArrayLimit(o,u){var r=o==null?null:typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(r!=null){var t,e,i,n,s=[],a=!0,l=!1;try{if(i=(r=r.call(o)).next,u===0){if(Object(r)!==r)return;a=!1}else for(;!(a=(t=i.call(r)).done)&&(s.push(t.value),s.length!==u);a=!0);}catch(c){l=!0,e=c}finally{try{if(!a&&r.return!=null&&(n=r.return(),Object(n)!==n))return}finally{if(l)throw e}}return s}}function _classCallCheck(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties(o,u){for(var r=0;r<u.length;r++){var t=u[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(o,_toPropertyKey(t.key),t)}}function _createClass(o,u,r){return u&&_defineProperties(o.prototype,u),r&&_defineProperties(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o}function _defineProperty(o,u,r){return u=_toPropertyKey(u),u in o?Object.defineProperty(o,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[u]=r,o}function _inherits(o,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(u&&u.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),u&&_setPrototypeOf(o,u)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf(o)}function _setPrototypeOf(o,u){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(o,u)}function _isNativeReflectConstruct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _assertThisInitialized(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function _possibleConstructorReturn(o,u){if(u&&(typeof u=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(o)}function _createSuper(o){var u=_isNativeReflectConstruct();return function(){var t=_getPrototypeOf(o),e;if(u){var i=_getPrototypeOf(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _slicedToArray(o,u){return _arrayWithHoles(o)||_iterableToArrayLimit(o,u)||_unsupportedIterableToArray(o,u)||_nonIterableRest()}function _toConsumableArray(o){return _arrayWithoutHoles(o)||_iterableToArray(o)||_unsupportedIterableToArray(o)||_nonIterableSpread()}function _arrayWithoutHoles(o){if(Array.isArray(o))return _arrayLikeToArray(o)}function _arrayWithHoles(o){if(Array.isArray(o))return o}function _iterableToArray(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)}function _unsupportedIterableToArray(o,u){if(o){if(typeof o=="string")return _arrayLikeToArray(o,u);var r=Object.prototype.toString.call(o).slice(8,-1);if(r==="Object"&&o.constructor&&(r=o.constructor.name),r==="Map"||r==="Set")return Array.from(o);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(o,u)}}function _arrayLikeToArray(o,u){(u==null||u>o.length)&&(u=o.length);for(var r=0,t=new Array(u);r<u;r++)t[r]=o[r];return t}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _toPrimitive(o,u){if(typeof o!="object"||o===null)return o;var r=o[Symbol.toPrimitive];if(r!==void 0){var t=r.call(o,u||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(o)}function _toPropertyKey(o){var u=_toPrimitive(o,"string");return typeof u=="symbol"?u:String(u)}var TrackType={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType={AV1:"av1",AVC:"avc",HEVC:"hevc"},AudioCodecType={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m",OPUS:"opus"},WarningType={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},VideoTrack=function(){function o(){_classCallCheck(this,o),_defineProperty(this,"id",1),_defineProperty(this,"type",TrackType.VIDEO),_defineProperty(this,"codecType",VideoCodecType.AVC),_defineProperty(this,"pid",-1),_defineProperty(this,"hvcC",void 0),_defineProperty(this,"codec",""),_defineProperty(this,"timescale",0),_defineProperty(this,"formatTimescale",0),_defineProperty(this,"sequenceNumber",0),_defineProperty(this,"baseMediaDecodeTime",0),_defineProperty(this,"baseDts",0),_defineProperty(this,"duration",0),_defineProperty(this,"warnings",[]),_defineProperty(this,"samples",[]),_defineProperty(this,"pps",[]),_defineProperty(this,"sps",[]),_defineProperty(this,"vps",[]),_defineProperty(this,"fpsNum",0),_defineProperty(this,"fpsDen",0),_defineProperty(this,"sarRatio",[]),_defineProperty(this,"width",0),_defineProperty(this,"height",0),_defineProperty(this,"nalUnitSize",4),_defineProperty(this,"present",!1),_defineProperty(this,"isVideoEncryption",!1),_defineProperty(this,"isAudioEncryption",!1),_defineProperty(this,"isVideo",!0),_defineProperty(this,"lastKeyFrameDts",0),_defineProperty(this,"kid",null),_defineProperty(this,"pssh",null),_defineProperty(this,"ext",void 0)}return _createClass(o,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var r=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-r.dts+t.duration}return 0}},{key:"exist",value:function(){return/av01/.test(this.codec)?!0:!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),o}(),AudioTrack=function(){function o(){_classCallCheck(this,o),_defineProperty(this,"id",2),_defineProperty(this,"type",TrackType.AUDIO),_defineProperty(this,"codecType",AudioCodecType.AAC),_defineProperty(this,"pid",-1),_defineProperty(this,"codec",""),_defineProperty(this,"sequenceNumber",0),_defineProperty(this,"sampleDuration",0),_defineProperty(this,"timescale",0),_defineProperty(this,"formatTimescale",0),_defineProperty(this,"baseMediaDecodeTime",0),_defineProperty(this,"duration",0),_defineProperty(this,"warnings",[]),_defineProperty(this,"samples",[]),_defineProperty(this,"baseDts",0),_defineProperty(this,"sampleSize",16),_defineProperty(this,"sampleRate",0),_defineProperty(this,"channelCount",0),_defineProperty(this,"objectType",0),_defineProperty(this,"sampleRateIndex",0),_defineProperty(this,"config",[]),_defineProperty(this,"present",!1),_defineProperty(this,"isVideoEncryption",!1),_defineProperty(this,"isAudioEncryption",!1),_defineProperty(this,"kid",null),_defineProperty(this,"ext",void 0)}return _createClass(o,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&(this.codecType===AudioCodecType.AAC||this.codecType===AudioCodecType.G711PCMA||this.codecType===AudioCodecType.G711PCMU||this.codecType===AudioCodecType.OPUS))}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var r=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-r.dts+t.duration}return 0}}]),o}(),VideoSample=function(){function o(u,r,t){_classCallCheck(this,o),_defineProperty(this,"flag",{}),_defineProperty(this,"keyframe",!1),_defineProperty(this,"gopId",0),_defineProperty(this,"duration",0),_defineProperty(this,"size",0),_defineProperty(this,"units",[]),_defineProperty(this,"chromaFormat",420),this.originPts=this.pts=u,this.originDts=this.dts=r,t&&(this.units=t)}return _createClass(o,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),o}(),AudioSample=_createClass(function o(u,r,t,e){_classCallCheck(this,o),_defineProperty(this,"duration",1024),_defineProperty(this,"flag",{dependsOn:2,isNonSyncSample:0}),_defineProperty(this,"keyframe",!0),this.originPts=this.pts=this.dts=u,this.data=r,this.size=r.byteLength,this.sampleOffset=e,t&&(this.duration=t)}),Sample=_createClass(function o(u,r){_classCallCheck(this,o),_defineProperty(this,"time",0),this.data=u,this.originPts=this.pts=r}),FlvScriptSample=function(o){_inherits(r,o);var u=_createSuper(r);function r(){return _classCallCheck(this,r),u.apply(this,arguments)}return _createClass(r)}(Sample),SeiSample=function(o){_inherits(r,o);var u=_createSuper(r);function r(){return _classCallCheck(this,r),u.apply(this,arguments)}return _createClass(r)}(Sample),MetadataTrack=function(){function o(){_classCallCheck(this,o),_defineProperty(this,"id",3),_defineProperty(this,"type",TrackType.METADATA),_defineProperty(this,"timescale",0),_defineProperty(this,"flvScriptSamples",[]),_defineProperty(this,"seiSamples",[])}return _createClass(o,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),o}(),Logger$1=function(){function o(u){_classCallCheck(this,o),this.name=u||"",this._prefix="[".concat(this.name,"]")}return _createClass(o,[{key:"warn",value:function(){var r;if(!o.disabled){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];(r=console).warn.apply(r,[this._prefix].concat(e))}}}],[{key:"enable",value:function(){o.disabled=!1}},{key:"disable",value:function(){o.disabled=!0}}]),o}();_defineProperty(Logger$1,"disabled",!0);var isBrowser=typeof window<"u",ua=isBrowser&&navigator.userAgent.toLocaleLowerCase(),isSafari=isBrowser&&/^((?!chrome|android).)*safari/.test(ua),isFirefox=isBrowser&&ua.includes("firefox"),isAndroid=isBrowser&&ua.includes("android"),AAC=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"getRateIndexByRate",value:function(r){return o.FREQ.indexOf(r)}},{key:"parseADTS",value:function(r,t){for(var e=r.length,i=0;i+2<e&&!(r[i]===255&&(r[i+1]&246)===240);)i++;if(!(i>=e)){var n=i,s=[],a=(r[i+2]&60)>>>2,l=o.FREQ[a];if(!l)throw new Error("Invalid sampling index: ".concat(a));for(var c=((r[i+2]&192)>>>6)+1,f=(r[i+2]&1)<<2|(r[i+3]&192)>>>6,h=o._getConfig(a,f,c),p=h.config,d=h.codec,v,g,y=0,m=o.getFrameDuration(l);i+7<e;){if(r[i]!==255||(r[i+1]&246)!==240){i++;continue}if(g=(r[i+3]&3)<<11|r[i+4]<<3|(r[i+5]&224)>>5,!g||e-i<g)break;v=(~r[i+1]&1)*2,s.push({pts:t+y*m,data:r.subarray(i+7+v,i+g)}),y++,i+=g}return{skip:n,remaining:i>=e?void 0:r.subarray(i),frames:s,samplingFrequencyIndex:a,sampleRate:l,objectType:c,channelCount:f,codec:d,config:p,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(r){if(r.length){var t=r[0]>>>3,e=(r[0]&7)<<1|r[1]>>>7,i=(r[1]&120)>>>3,n=o.FREQ[e];if(n){var s=o._getConfig(e,i,t),a=s.config,l=s.codec;return{samplingFrequencyIndex:e,sampleRate:n,objectType:t,channelCount:i,config:a,codec:l,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*t/r}},{key:"_getConfig",value:function(r,t,e){var i=[],n,s;return isFirefox?r>=6?(n=5,s=r-3):(n=2,s=r):isAndroid?(n=2,s=r):(n=e===2||e===5?e:5,s=r,r>=6?s=r-3:t===1&&(n=2,s=r)),i[0]=n<<3,i[0]|=(r&14)>>1,i[1]=(r&1)<<7,i[1]|=t<<3,n===5&&(i[1]|=(s&14)>>1,i[2]=(s&1)<<7,i[2]|=8,i[3]=0),{config:i,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(r,t){switch(r){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),o}();_defineProperty(AAC,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var OPUS=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"getFrameDuration",value:function(r){return 20}},{key:"parseHeaderPackets",value:function(r){if(r.length){for(var t=new DataView(r.buffer,r.byteOffset,r.byteLength),e="",i=0;i<8;i++)e+=String.fromCodePoint(r[i]);if(e!=="OpusHead")throw new Error("Invalid Opus MagicSignature");var n=r[9];console.log("Pre-skip",r[10],r[11]);var s=t.getUint32(12,!0),a=t.getInt16(16,!0);if(s){var l="opus",c="opus",f=new Uint8Array(r.buffer,r.byteOffset+8,r.byteLength-8);return{outputGain:a,sampleRate:s,channelCount:n,config:f,codec:l,originCodec:c}}}}}]),o}(),LARGE_AV_FIRST_FRAME_GAP=500,AUDIO_GAP_OVERLAP_THRESHOLD_COUNT=3,MAX_SILENT_FRAME_DURATION=1e3,AUDIO_EXCEPTION_LOG_EMIT_DURATION=5e3,MAX_VIDEO_FRAME_DURATION=1e3,MAX_DTS_DELTA_WITH_NEXT_CHUNK=200,VIDEO_EXCEPTION_LOG_EMIT_DURATION=5e3,TRACK_BROKEN_CHECK_TIME=5,FlvFixer=function(){function o(u,r,t){_classCallCheck(this,o),this.videoTrack=u,this.audioTrack=r,this.metadataTrack=t,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return _createClass(o,[{key:"fix",value:function(){var r=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*1e3);var n=this.videoTrack,s=this.audioTrack;(e||!i)&&(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),e&&!i&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(s,n),!i&&t&&(this._audioNextPts=this._videoNextDts=t);var a=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(a&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(s),this._keyFrameInNextChunk=!1,this._fixVideo(n),this.metadataTrack.exist()){var l=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(c){c.pts=c.originPts-r._baseDts,c.time=Math.max(0,c.pts)/l}),this.metadataTrack.flvScriptSamples.forEach(function(c){c.pts=c.originPts-r._baseDts,c.time=Math.max(0,c.pts)/l})}n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].dts),s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].pts*s.timescale/1e3)}},{key:"_fixVideo",value:function(r){var t=this,e=r.samples;if(e.length){e.forEach(function(m){m.dts-=t._baseDts,m.pts-=t._baseDts,m.keyframe&&(t._keyFrameInNextChunk=!0)});var i;if(r.fpsNum&&r.fpsDen)i=r.timescale*(r.fpsDen/r.fpsNum);else if(r.length>1){var n=r.samples[0],s=r.samples[e.length-1];i=Math.floor((s.dts-n.dts)/(e.length-1))}else i=this._lastVideoDuration||40;var a=e.pop();if(this._videoLastSample&&e.unshift(this._videoLastSample),this._videoLastSample=a,!!e.length){if(this._videoNextDts===void 0){var l=e[0];this._videoNextDts=l.dts}var c=e.length,f=0,h=e[0],p=this._videoNextDts-h.dts;if(Math.abs(p)>MAX_DTS_DELTA_WITH_NEXT_CHUNK){if(Math.abs(h.dts-this._lastVideoExceptionChunkFirstDtsDot)>VIDEO_EXCEPTION_LOG_EMIT_DURATION){var d;this._lastVideoExceptionChunkFirstDtsDot=h.dts,r.warnings.push({type:WarningType.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:h.dts,nextSampleDts:(d=e[1])===null||d===void 0?void 0:d.dts,sampleDuration:p})}this._videoTimestampBreak>=TRACK_BROKEN_CHECK_TIME?(this._videoNextDts=h.dts,this._videoTimestampBreak=0):(h.dts+=p,h.pts+=p,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var v=0;v<c;v++){var g=e[v].dts,y=e[v+1];v<c-1?f=y.dts-g:a?f=a.dts-g:f=i,(f>MAX_VIDEO_FRAME_DURATION||f<0)&&(this._videoTimestampBreak++,Math.abs(g-this._lastVideoExceptionLargeGapDot)>VIDEO_EXCEPTION_LOG_EMIT_DURATION&&(this._lastVideoExceptionLargeGapDot=g,r.warnings.push({type:WarningType.LARGE_VIDEO_GAP,time:g/r.timescale,dts:g,originDts:e[v].originDts,nextDts:this._videoNextDts,sampleDuration:f,refSampleDuration:i})),f=i),e[v].duration=f,this._videoNextDts+=f,this._lastVideoDuration=f}}}}},{key:"_fixAudio",value:function(r){var t=this,e=r.samples;e.length&&(e.forEach(function(i){i.dts=i.pts-=t._baseDts}),this._doFixAudioInternal(r,e,1e3))}},{key:"_calculateBaseDts",value:function(r,t){var e=r.samples,i=t.samples;if(!e.length&&!i.length)return!1;var n=1/0,s=1/0;e.length&&(r.baseDts=n=e[0].pts),i.length&&(t.baseDts=s=i[0].dts),this._baseDts=Math.min(n,s);var a=s-n;return Number.isFinite(a)&&Math.abs(a)>LARGE_AV_FIRST_FRAME_GAP&&t.warnings.push({type:WarningType.LARGE_AV_SHIFT,videoBaseDts:s,audioBasePts:n,baseDts:this._baseDts,delta:a}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){var r=this._calculateBaseDts(this.audioTrack,this.videoTrack);r&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(r,t,e){if(!r.sampleDuration)switch(r.codecType){case AudioCodecType.AAC:{r.sampleDuration=AAC.getFrameDuration(r.timescale,e);break}case AudioCodecType.OPUS:{r.sampleDuration=OPUS.getFrameDuration(r.samples,e);break}case AudioCodecType.G711PCMA:case AudioCodecType.G711PCMU:{r.sampleDuration=this._getG711Duration(r);break}default:console.error("can't fix audio codecType:",r.codecType);break}var i=r.sampleDuration,n=r.codecType===AudioCodecType.OPUS?20:r.codecType===AudioCodecType.AAC?1024:i*r.timescale/1e3;if(this._audioNextPts===void 0){var s=t[0];this._audioNextPts=s.pts}for(var a=0;a<t.length;a++){var l=this._audioNextPts,c=t[a],f=c.pts-l;if(a===0&&this._audioTimestampBreak>=TRACK_BROKEN_CHECK_TIME&&this._keyFrameInNextChunk&&(l=this._audioNextPts=c.dts,f=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&f>=AUDIO_GAP_OVERLAP_THRESHOLD_COUNT*i&&f<=MAX_SILENT_FRAME_DURATION&&!isSafari){var h=this._getSilentFrame(r)||t[0].data.subarray(),p=Math.floor(f/i);Math.abs(c.pts-this._lastAudioExceptionGapDot)>AUDIO_EXCEPTION_LOG_EMIT_DURATION&&(this._lastAudioExceptionGapDot=c.pts,r.warnings.push({type:WarningType.AUDIO_FILLED,pts:c.pts,originPts:c.originPts,count:p,nextPts:l,refSampleDuration:i}));for(var d=0;d<p;d++){var v=new AudioSample(Math.floor(this._audioNextPts+i)-Math.floor(this._audioNextPts),h,n);v.originPts=Math.floor(this._baseDts+l),t.splice(a,0,v),this._audioNextPts+=i,a++}a--}else if(f<=-AUDIO_GAP_OVERLAP_THRESHOLD_COUNT*i&&f>=-1*MAX_SILENT_FRAME_DURATION)Math.abs(c.pts-this._lastAudioExceptionOverlapDot)>AUDIO_EXCEPTION_LOG_EMIT_DURATION&&(this._lastAudioExceptionOverlapDot=c.pts,r.warnings.push({type:WarningType.AUDIO_DROPPED,pts:c.pts,originPts:c.originPts,nextPts:l,refSampleDuration:i})),t.splice(a,1),a--;else{if(Math.abs(f)>MAX_SILENT_FRAME_DURATION&&(this._audioTimestampBreak++,Math.abs(c.pts-this._lastAudioExceptionLargeGapDot)>AUDIO_EXCEPTION_LOG_EMIT_DURATION&&(this._lastAudioExceptionLargeGapDot=c.pts,r.warnings.push({type:WarningType.LARGE_AUDIO_GAP,time:c.pts/1e3,pts:c.pts,originPts:c.originPts,nextPts:l,sampleDuration:f,refSampleDuration:i}))),r.codecType===AudioCodecType.OPUS){var g=t[t.length-1];g&&(g.duration=c.pts-g.pts)}else c.dts=c.pts=l,c.duration=n;this._audioNextPts+=i}}}},{key:"_getG711Duration",value:function(r){var t=r.sampleSize,e=r.channelCount,i=r.sampleRate,n=r.samples[0];if(n)return n.data.byteLength*2/e/(t/8)/i*1e3}},{key:"_getSilentFrame",value:function(r){return r.codecType===AudioCodecType.AAC?AAC.getSilentFrame(r.codec,r.channelCount):new Uint8Array(8*r.sampleDuration*r.channelCount)}}]),o}();function concatUint8Array(){for(var o=arguments.length,u=new Array(o),r=0;r<o;r++)u[r]=arguments[r];u=u.filter(Boolean);var t=new Uint8Array(u.reduce(function(i,n){return i+n.byteLength},0)),e=0;return u.forEach(function(i){t.set(i,e),e+=i.byteLength}),t}function readBig32(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(o[u]<<24>>>0)+(o[u+1]<<16)+(o[u+2]<<8)+(o[u+3]||0)}function getAvcCodec(o){for(var u="avc1.",r,t=0;t<3;t++)r=o[t].toString(16),r.length<2&&(r="0".concat(r)),u+=r;return u}function parse(o){if(!Array.isArray(o)){for(var u=[],r="",t=0;t<o.length;t++)t%2&&(r=o[t-1]+o[t],u.push(parseInt(r,16)),r="");return u}return o.map(function(e){return parseInt(e,16)})}var NALu=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"parseAnnexB",value:function(r){for(var t=r.length,e=2,i=0;r[e]!==null&&r[e]!==void 0&&r[e]!==1;)e++;if(e++,i=e+2,i>=t)return[];for(var n=[];i<t;)switch(r[i]){case 0:if(r[i-1]!==0){i+=2;break}else if(r[i-2]!==0){i++;break}e!==i-2&&n.push(r.subarray(e,i-2));do i++;while(r[i]!==1&&i<t);e=i+1,i=e+2;break;case 1:if(r[i-1]!==0||r[i-2]!==0){i+=3;break}e!==i-2&&n.push(r.subarray(e,i-2)),e=i+1,i=e+2;break;default:i+=3;break}return e<t&&n.push(r.subarray(e)),n}},{key:"parseAvcC",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(r.length<4)){for(var e=r.length,i=[],n=0,s;n+t<e;)if(s=readBig32(r,n),t===3&&(s>>>=8),n+=t,!!s){if(n+s>e)break;i.push(r.subarray(n,n+s)),n+=s}return i}}},{key:"parseSEI",value:function(r,t){for(var e=r.length,i=t?2:1,n=0,s=0,a="";r[i]===255;)n+=255,i++;for(n+=r[i++];r[i]===255;)s+=255,i++;if(s+=r[i++],n===5&&e>i+16)for(var l=0;l<16;l++)a+=r[i].toString(16),i++;return{payload:r.subarray(i,i+s),type:n,size:s,uuid:a}}},{key:"removeEPB",value:function(r){for(var t=r.byteLength,e=[],i=1;i<t-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(e.push(i+2),i+=2):i++;if(!e.length)return r;var n=t-e.length,s=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===e[0]&&(a++,e.shift()),s[i]=r[a];return s}}]),o}(),ExpGolomb=function(){function o(u){if(_classCallCheck(this,o),_defineProperty(this,"_bytesAvailable",void 0),_defineProperty(this,"_bitsAvailable",0),_defineProperty(this,"_word",0),!u)throw new Error("ExpGolomb data params is required");this._data=u,this._bytesAvailable=u.byteLength,this._bytesAvailable&&this._loadWord()}return _createClass(o,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var r=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(t===0)throw new Error("No bytes available");var e=new Uint8Array(4);e.set(this._data.subarray(r,r+t)),this._word=new DataView(e.buffer).getUint32(0),this._bitsAvailable=t*8,this._bytesAvailable-=t}},{key:"skipBits",value:function(r){if(this._bitsAvailable>r)this._word<<=r,this._bitsAvailable-=r;else{r-=this._bitsAvailable;var t=Math.floor(r/8);r-=t*8,this._bytesAvailable-=t,this._loadWord(),this._word<<=r,this._bitsAvailable-=r}}},{key:"readBits",value:function(r){if(r>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,r),e=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=r-t,t>0&&this._bitsAvailable?e<<t|this.readBits(t):e}},{key:"skipLZ",value:function(){var r;for(r=0;r<this._bitsAvailable;++r)if(this._word&2147483648>>>r)return this._word<<=r,this._bitsAvailable-=r,r;return this._loadWord(),r+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var r=this.skipLZ();return this.readBits(r+1)-1}},{key:"readEG",value:function(){var r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(r){for(var t=8,e=8,i,n=0;n<r;n++)e!==0&&(i=this.readEG(),e=(t+i+256)%256),t=e===0?t:e}}]),o}(),AVC=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(r){if(!(r.length<7)){for(var t=(r[4]&3)+1,e,i=[],n=[],s=6,a=r[5]&31,l,c=0;c<a;c++)if(l=r[s]<<8|r[s+1],s+=2,!!l){var f=r.subarray(s,s+l);s+=l,i.push(f),e||(e=o.parseSPS(NALu.removeEPB(f)))}var h=r[s];s++;for(var p,d=0;d<h;d++)p=r[s]<<8|r[s+1],s+=2,p&&(n.push(r.subarray(s,s+p)),s+=p);return{sps:e,spsArr:i,ppsArr:n,nalUnitSize:t}}}},{key:"parseSPS",value:function(r){var t=new ExpGolomb(r);t.readUByte();var e=t.readUByte(),i=t.readUByte(),n=t.readUByte();t.skipUEG();var s=420;if(e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128||e===138||e===144){var a=t.readUEG();if(a<=3&&(s=[0,420,422,444][a]),a===3&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var l=a!==3?8:12,c=0;c<l;c++)t.readBool()&&(c<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var f=t.readUEG();if(f===0)t.readUEG();else if(f===1){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var h=t.readUEG(),p=0;p<h;p++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var d=t.readUEG(),v=t.readUEG(),g=t.readBits(1);g===0&&t.skipBits(1),t.skipBits(1);var y=0,m=0,S=0,_=0;t.readBool()&&(y=t.readUEG(),m=t.readUEG(),S=t.readUEG(),_=t.readUEG());var A,k,w,I,N;if(t.readBool()){if(t.readBool()){var x=t.readUByte();switch(x){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var M=t.readBits(32),b=t.readBits(32);k=t.readBool(),w=b,I=M*2,N=w/I}}return{codec:getAvcCodec(r.subarray(1,4)),profileIdc:e,profileCompatibility:i,levelIdc:n,chromaFormat:s,width:Math.ceil((d+1)*16-2*(y+m)),height:(2-g)*(v+1)*16-(g?2:4)*(S+_),sarRatio:A,fpsNum:w,fpsDen:I,fps:N,fixedFrame:k}}}]),o}(),HEVC=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(r.length<23)){t=t||{};for(var e=(r[21]&3)+1,i,n,s=[],a=[],l=[],c=23,f=r[22],h,p,d,v=0;v<f;v++){h=r[c]&63,p=r[c+1]<<8|r[c+2],c+=3;for(var g=0;g<p;g++)if(d=r[c]<<8|r[c+1],c+=2,!!d){switch(h){case 32:{var y=r.subarray(c,c+d);i||(i=o.parseVPS(NALu.removeEPB(y),t)),l.push(y)}break;case 33:{var m=r.subarray(c,c+d);n||(n=o.parseSPS(NALu.removeEPB(m),t)),s.push(m)}break;case 34:a.push(r.subarray(c,c+d));break}c+=d}}return{hvcC:t,sps:n,spsArr:s,ppsArr:a,vpsArr:l,nalUnitSize:e}}}},{key:"parseVPS",value:function(r,t){t=t||{};var e=new ExpGolomb(r);e.readUByte(),e.readUByte(),e.readBits(12);var i=e.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,i+1),e.readBits(17),o._parseProfileTierLevel(e,i,t),t}},{key:"parseSPS",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t||{};var e=new ExpGolomb(r);e.readUByte(),e.readUByte(),e.readBits(4);var i=e.readBits(3);t.numTemporalLayers=Math.max(i+1,t.numTemporalLayers||0),t.temporalIdNested=e.readBits(1),o._parseProfileTierLevel(e,i,t),e.readUEG();var n=t.chromaFormatIdc=e.readUEG(),s=420;n<=3&&(s=[0,420,422,444][n]);var a=0;n===3&&(a=e.readBits(1));var l=e.readUEG(),c=e.readUEG(),f=e.readBits(1),h,p,d,v;if(f===1&&(h=e.readUEG(),p=e.readUEG(),d=e.readUEG(),v=e.readUEG()),t.bitDepthLumaMinus8=e.readUEG(),t.bitDepthChromaMinus8=e.readUEG(),f===1){var g=(n===1||n===2)&&a===0?2:1,y=n===1&&a===0?2:1;l-=g*(p+h),c-=y*(v+d)}return{codec:"hev1.1.6.L93.B0",width:l,height:c,chromaFormat:s,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(r,t,e){var i=e.generalTierFlag||0;e.generalProfileSpace=r.readBits(2),e.generalTierFlag=Math.max(r.readBits(1),i),e.generalProfileIdc=Math.max(r.readBits(5),e.generalProfileIdc||0),e.generalProfileCompatibilityFlags=r.readBits(32),e.generalConstraintIndicatorFlags=[r.readBits(8),r.readBits(8),r.readBits(8),r.readBits(8),r.readBits(8),r.readBits(8)];var n=r.readBits(8);i<e.generalTierFlag?e.generalLevelIdc=n:e.generalLevelIdc=Math.max(n,e.generalLevelIdc||0);var s=[],a=[];if(t>r.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(t));for(var l=0;l<t;l++)s[l]=r.readBits(1),a[l]=r.readBits(1);t>0&&r.readBits((8-t)*2);for(var c=0;c<t;c++)s[c]!==0&&(r.readBits(2),r.readBits(1),r.readBits(5),r.readBits(16),r.readBits(16),r.readBits(4),r.readBits(16),r.readBits(16),r.readBits(12)),a[c]!==0&&r.readBits(8)}}]),o}(),UTF8=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"decode",value:function(r){for(var t=[],e=r,i=0,n=r.length;i<n;){if(e[i]<128){t.push(String.fromCharCode(e[i])),++i;continue}else if(!(e[i]<192)){if(e[i]<224){if(o._checkContinuation(e,i,1)){var s=(e[i]&31)<<6|e[i+1]&63;if(s>=128){t.push(String.fromCharCode(s&65535)),i+=2;continue}}}else if(e[i]<240){if(o._checkContinuation(e,i,2)){var a=(e[i]&15)<<12|(e[i+1]&63)<<6|e[i+2]&63;if(a>=2048&&(a&63488)!==55296){t.push(String.fromCharCode(a&65535)),i+=3;continue}}}else if(e[i]<248&&o._checkContinuation(e,i,3)){var l=(e[i]&7)<<18|(e[i+1]&63)<<12|(e[i+2]&63)<<6|e[i+3]&63;if(l>65536&&l<1114112){l-=65536,t.push(String.fromCharCode(l>>>10|55296)),t.push(String.fromCharCode(l&1023|56320)),i+=4;continue}}}t.push(String.fromCharCode(65533)),++i}return t.join("")}},{key:"_checkContinuation",value:function(r,t,e){var i=r;if(t+e<i.length){for(;e--;)if((i[++t]&192)!==128)return!1;return!0}else return!1}}]),o}(),AMF=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"parse",value:function(r){if(!(r.length<3)){var t={},e=o._parseValue(new DataView(r.buffer,r.byteOffset,r.byteLength)),i=o._parseValue(new DataView(r.buffer,r.byteOffset+e.size,r.byteLength-e.size));return t[e.data]=i.data,t}}},{key:"_parseValue",value:function(r){var t=r.byteLength,e=r.getUint8(0),i=1,n=!1,s;switch(e){case 0:s=r.getFloat64(1),i+=8;break;case 1:{s=!!r.getUint8(1),i+=1;break}case 2:{var a=o._parseString(new DataView(r.buffer,r.byteOffset+i,r.byteLength-i)),l=a.data,c=a.size;s=l,i+=c}break;case 3:{s={};var f=0;for((r.getUint32(t-4)&16777215)===9&&(f=3);i<t-4;){var h=o._parseObject(new DataView(r.buffer,r.byteOffset+i,r.byteLength-i-f)),p=h.size,d=h.data,v=h.isEnd;if(v)break;s[d.name]=d.value,i+=p}if(i<=t-3){var g=r.getUint32(i-1)&16777215;g===9&&(i+=3)}}break;case 8:{s={},i+=4;var y=0;for((r.getUint32(t-4)&16777215)===9&&(y=3);i<t-8;){var m=o._parseObject(new DataView(r.buffer,r.byteOffset+i,r.byteLength-i-y)),S=m.size,_=m.data,A=m.isEnd;if(A)break;s[_.name]=_.value,i+=S}if(i<=t-3){var k=r.getUint32(i-1)&16777215;k===9&&(i+=3)}}break;case 9:s=void 0,i=1,n=!0;break;case 10:{s=[];var w=r.getUint32(1);i+=4;for(var I=0;I<w;I++){var N=o._parseValue(new DataView(r.buffer,r.byteOffset+i,r.byteLength-i)),x=N.data,M=N.size;s.push(x),i+=M}}break;case 11:{var b=r.getFloat64(i)+r.getInt16(i+8)*6e4;s=new Date(b),i+=10}break;case 12:{var T=r.getUint32(1);i+=4,s="",T>0&&(s=UTF8.decode(new Uint8Array(r.buffer,r.byteOffset+i,T))),i+=T}break;default:i=t;break}return{data:s,size:i,isEnd:n}}},{key:"_parseString",value:function(r){var t=r.getUint16(0),e="";return t>0&&(e=UTF8.decode(new Uint8Array(r.buffer,r.byteOffset+2,t))),{data:e,size:2+t}}},{key:"_parseObject",value:function(r){if(!(r.byteLength<3)){var t=o._parseString(r),e=o._parseValue(new DataView(r.buffer,r.byteOffset+t.size,r.byteLength-t.size));return{data:{name:t.data,value:e.data},size:t.size+e.size,isEnd:e.isEnd}}}}]),o}(),FlvSoundFormat={MP3:2,G711A:7,G711M:8,AAC:10,OPUS:13},logger$2=new Logger$1("FlvDemuxer"),FlvDemuxer=function(){function o(u,r,t){_classCallCheck(this,o),_defineProperty(this,"_headerParsed",!1),_defineProperty(this,"_remainingData",null),_defineProperty(this,"_gopId",0),_defineProperty(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=u||new VideoTrack,this.audioTrack=r||new AudioTrack,this.metadataTrack=t||new MetadataTrack,this._fixer=new FlvFixer(this.videoTrack,this.audioTrack,this.metadataTrack)}return _createClass(o,[{key:"demux",value:function(r){var t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0,s=this.audioTrack,a=this.videoTrack,l=this.metadataTrack;if((e||!i)&&(this._remainingData=null),e&&(this._headerParsed=!1),e?(a.reset(),s.reset(),l.reset()):(a.samples=[],s.samples=[],l.seiSamples=[],l.flvScriptSamples=[],a.warnings=[],s.warnings=[],this._remainingData&&(r=concatUint8Array(this._remainingData,r),this._remainingData=null)),!r.length)return{videoTrack:a,audioTrack:s,metadataTrack:l};var c=0;if(!this._headerParsed){if(!o.probe(r))throw new Error("Invalid flv file");s.present=(r[4]&4)>>>2!==0,a.present=(r[4]&1)!==0,this._headerParsed=!0,c=readBig32(r,5)+4}for(var f=r.length,h,p,d,v,g;c+15<f&&(h=r[c],p=r[c+1]<<16|r[c+2]<<8|r[c+3],!(c+15+p>f));)d=(r[c+7]<<24>>>0)+(r[c+4]<<16)+(r[c+5]<<8)+r[c+6],c+=11,v=r.subarray(c,c+p),h===8?this._parseAudio(v,d):h===9?(n&&(this.seamlessLoadingSwitching=!0),this._parseVideo(v,d)):h===18?this._parseScript(v,d):logger$2.warn("Invalid tag type: ".concat(h)),c+=p,g=readBig32(r,c),g!==11+p&&logger$2.warn("Invalid PrevTagSize ".concat(g," (").concat(11+p,")")),c+=4;c<f&&(this._remainingData=r.subarray(c)),s.formatTimescale=a.formatTimescale=a.timescale=l.timescale=1e3,s.timescale=s.codecType===AudioCodecType.OPUS?1e3:s.sampleRate||0,!s.exist()&&s.hasSample()&&s.reset(),!a.exist()&&a.hasSample()&&a.reset();var y=l.flvScriptSamples[l.flvScriptSamples.length-1],m=y==null||(t=y.data)===null||t===void 0?void 0:t.onMetaData;return m&&(a!=null&&a.exist()&&(m.hasOwnProperty("duration")&&(a.duration=m.duration*1e3),m.hasOwnProperty("width")&&m.hasOwnProperty("height")&&(a.width=m.width,a.height=m.height)),s!=null&&s.exist()&&m.hasOwnProperty("duration")&&(s.duration=m.duration*1e3)),{videoTrack:a,audioTrack:s,metadataTrack:l}}},{key:"fix",value:function(r,t,e){return this._fixer.fix(r,t,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(r,t,e,i,n){return this.demux(r,t,e,n),this.fix(i,t,e)}},{key:"_parseAudio",value:function(r,t){if(r.length){var e=(r[0]&240)>>>4,i=this.audioTrack;if(e!==FlvSoundFormat.AAC&&e!==FlvSoundFormat.G711A&&e!==FlvSoundFormat.G711M&&e!==FlvSoundFormat.OPUS){logger$2.warn("Unsupported sound format: ".concat(e)),i.reset();return}if(e!==FlvSoundFormat.AAC&&e!==FlvSoundFormat.OPUS){var n=(r[0]&12)>>2,s=(r[0]&2)>>1,a=r[0]&1;i.sampleRate=o.AUDIO_RATE[n],i.sampleSize=s?16:8,i.channelCount=a+1}switch(e){case FlvSoundFormat.G711A:case FlvSoundFormat.G711M:this._parseG711(r,t,e);break;case FlvSoundFormat.AAC:this._parseAac(r,t);break;case FlvSoundFormat.OPUS:this._parseOpus(r,t);break}}}},{key:"_parseOpus",value:function(r,t){var e=this.audioTrack,i=r[1];switch(e.codecType=AudioCodecType.OPUS,i){case 0:{var n=OPUS.parseHeaderPackets(r.subarray(2));n?(e.codec=n.codec,e.channelCount=n.channelCount,e.sampleRate=n.sampleRate,e.config=n.config,e.sampleDuration=OPUS.getFrameDuration([],e.timescale)):(e.reset(),logger$2.warn("Cannot parse AudioSpecificConfig",r));break}case 1:{if(t==null)return;var s=new AudioSample(t,r.subarray(2),e.sampleDuration);e.samples.push(s);break}default:logger$2.warn("Unknown OpusPacketType: ".concat(i))}}},{key:"_parseG711",value:function(r,t,e){var i=this.audioTrack;i.codecType=e===7?AudioCodecType.G711PCMA:AudioCodecType.G711PCMU,i.sampleRate=8e3,i.codec=i.codecType,i.samples.push(new AudioSample(t,r.subarray(1)))}},{key:"_parseAac",value:function(r,t){var e=this.audioTrack;if(e.codecType=AudioCodecType.AAC,r[1]===0){var i=AAC.parseAudioSpecificConfig(r.subarray(2));i?(e.codec=i.codec,e.channelCount=i.channelCount,e.sampleRate=i.sampleRate,e.config=i.config,e.objectType=i.objectType,e.sampleRateIndex=i.samplingFrequencyIndex):(e.reset(),logger$2.warn("Cannot parse AudioSpecificConfig",r))}else if(r[1]===1){if(t==null)return;e.samples.push(new AudioSample(t,r.subarray(2)))}else logger$2.warn("Unknown AACPacketType: ".concat(r[1]))}},{key:"_parseVideo",value:function(r,t){var e=this;if(!(r.length<6)){var i=(r[0]&240)>>>4,n=r[0]&15,s=this.videoTrack;if(n!==7&&n!==12){s.reset(),logger$2.warn("Unsupported codecId: ".concat(n));return}var a=n===12;s.codecType=a?VideoCodecType.HEVC:VideoCodecType.AVC;var l=r[1],c=(r[2]<<16|r[3]<<8|r[4])<<8>>8;if(l===0){var f=r.subarray(5),h=a?HEVC.parseHEVCDecoderConfigurationRecord(f):AVC.parseAVCDecoderConfigurationRecord(f);if(h){var p=h.hvcC,d=h.sps,v=h.ppsArr,g=h.spsArr,y=h.vpsArr,m=h.nalUnitSize;p&&(s.hvcC=s.hvcC||p),d&&(s.codec=d.codec,s.width=d.width,s.height=d.height,s.sarRatio=d.sarRatio,s.fpsNum=d.fpsNum,s.fpsDen=d.fpsDen),g.length&&(s.sps=g),v.length&&(s.pps=v),y&&y.length&&(s.vps=y),m&&(s.nalUnitSize=m)}else logger$2.warn("Cannot parse ".concat(a?"HEVC":"AVC","DecoderConfigurationRecord"),r)}else if(l===1){var S=NALu.parseAvcC(r.subarray(5),s.nalUnitSize);if(S=this._checkAddMetaNalToUnits(a,S,s),S&&S.length){var _=new VideoSample(t+c,t,S);if(this.seamlessLoadingSwitching&&t<s.lastKeyFrameDts)return;this.seamlessLoadingSwitching=!1,i===1&&(_.setToKeyframe(),s.lastKeyFrameDts=t),s.samples.push(_),S.forEach(function(A){var k=a?A[0]>>>1&63:A[0]&31;switch(k){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&k!==5||a&&k===5)break;_.setToKeyframe();break;case 6:case 39:case 40:if(!a&&k!==6||a&&k===6)break;e.metadataTrack.seiSamples.push(new SeiSample(NALu.parseSEI(NALu.removeEPB(A),a),t+c));break}}),_.keyframe&&this._gopId++,_.gopId=this._gopId}else logger$2.warn("Cannot parse NALUs",r)}else l===2||logger$2.warn("Unknown AVCPacketType: ".concat(l))}}},{key:"_checkAddMetaNalToUnits",value:function(r,t,e){if(!r||!this._needAddMetaBeforeKeyFrameNal)return this._needAddMetaBeforeKeyFrameNal=!1,t;var i=t.map(function(n){return n[0]>>>1&63});return i.includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(e.pps[0]),t.unshift(e.sps[0]),t.unshift(e.vps[0]),t.filter(Boolean))}},{key:"_parseScript",value:function(r,t){this.metadataTrack.flvScriptSamples.push(new FlvScriptSample(AMF.parse(r),t))}}],[{key:"probe",value:function(r){return r[0]!==70||r[1]!==76||r[2]!==86||r[3]!==1?!1:readBig32(r,5)>=9}}]),o}();_defineProperty(FlvDemuxer,"AUDIO_RATE",[5500,11e3,22e3,44e3]);function Concat(o){for(var u=0,r=arguments.length,t=new Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];t.forEach(function(s){u+=s.length});var i=new o(u),n=0;return t.forEach(function(s){i.set(s,n),n+=s.length}),i}var Buffer=function(){function o(){_classCallCheck(this,o),this.buffer=new Uint8Array(0)}return _createClass(o,[{key:"write",value:function(){for(var r=this,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(function(n){n?r.buffer=Concat(Uint8Array,r.buffer,n):window.console.warn(n)})}}],[{key:"writeUint16",value:function(r){return new Uint8Array([r>>8&255,r&255])}},{key:"writeUint32",value:function(r){return new Uint8Array([r>>24,r>>16&255,r>>8&255,r&255])}}]),o}(),UINT32_MAX=Math.pow(2,32)-1,MP4=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"box",value:function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];e=e.filter(Boolean);var n=8+e.reduce(function(l,c){return l+c.byteLength},0),s=new Uint8Array(n);s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(r,4);var a=8;return e.forEach(function(l){s.set(l,a),a+=l.byteLength}),s}},{key:"ftyp",value:function(r){var t=r.find(function(e){return e.type===TrackType.VIDEO&&e.codecType===VideoCodecType.HEVC});return t?o.FTYPHEV1:o.FTYPAVC1}},{key:"initSegment",value:function(r){var t=o.ftyp(r),e=concatUint8Array(t,o.moov(r));return e}},{key:"pssh",value:function(r){var t=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],parse(r.kid),[0,0,0,0]));return o.box(o.types.pssh,t)}},{key:"moov",value:function(r){if(r[0].useEME&&(r[0].encv||r[0].enca)){r[0].pssh||(r[0].pssh={kid:r[0].kid});var t=this.pssh(r[0].pssh);return o.box.apply(o,[o.types.moov,o.mvhd(r[0].mvhdDurtion||r[0].duration,r[0].mvhdTimecale||r[0].timescale),o.mvex(r)].concat(_toConsumableArray(r.map(function(e){return o.trak(e)})),[t]))}else return o.box.apply(o,[o.types.moov,o.mvhd(r[0].mvhdDurtion||r[0].duration,r[0].mvhdTimecale||r[0].timescale)].concat(_toConsumableArray(r.map(function(e){return o.trak(e)})),[o.mvex(r)]))}},{key:"mvhd",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=o.box(o.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return e}},{key:"trak",value:function(r){var t=o.box(o.types.trak,o.tkhd(r.id,r.tkhdDuration||0,r.width,r.height),o.mdia(r));return t}},{key:"tkhd",value:function(r,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=o.box(o.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,i>>8&255,i&255,0,0]));return n}},{key:"mdia",value:function(r){var t=o.box(o.types.mdia,o.mdhd(r.duration,r.timescale),o.hdlr(r.type),o.minf(r));return t}},{key:"mdhd",value:function(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=o.box(o.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,85,196,0,0]));return e}},{key:"hdlr",value:function(r){var t=o.box(o.types.hdlr,o.HDLR_TYPES[r]);return t}},{key:"minf",value:function(r){var t=o.box(o.types.minf,r.type===TrackType.VIDEO?o.VMHD:o.SMHD,o.DINF,o.stbl(r));return t}},{key:"stbl",value:function(r){var t=[];r&&r.ext&&r.ext.stss&&t.push(o.stss(r.ext.stss.entries));var e=o.box(o.types.stbl,o.stsd(r),o.STTS,t[0],o.STSC,o.STSZ,o.STCO);return e}},{key:"stsd",value:function(r){var t;r.type==="audio"?r.useEME&&r.enca?t=o.enca(r):r.codecType===AudioCodecType.OPUS?t=o.opus(r):t=o.mp4a(r):r.useEME&&r.encv?t=o.encv(r):r.av1C?t=o.av01(r):t=o.avc1hev1(r);var e=o.box(o.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t);return e}},{key:"enca",value:function(r){var t=r.enca.channelCount,e=r.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,e>>8&255,e&255,0,0]),n=o.esds(r.config),s=o.sinf(r.enca);return o.box(o.types.enca,i,n,s)}},{key:"encv",value:function(r){var t,e,i=r.sps.length>0?r.sps[0]:[],n=r.pps.length>0?r.pps[0]:[],s=r.width,a=r.height,l=r.sarRatio[0],c=r.sarRatio[1],f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,s&255,a>>8&255,a&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((t=(e=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,i.length&255]).concat.apply(e,_toConsumableArray(i)).concat([1,n.length>>>8&255,n.length&255])).concat.apply(t,_toConsumableArray(n))),p=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),d=o.sinf(r.encv),v=new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255]);return o.box(o.types.encv,f,o.box(o.types.avcC,h),o.box(o.types.btrt,p),d,o.box(o.types.pasp,v))}},{key:"schi",value:function(r){var t=new Uint8Array([]),e=o.tenc(r);return o.box(o.types.schi,t,e)}},{key:"tenc",value:function(r){var t=new Uint8Array([0,0,0,0,0,0,r.default_IsEncrypted&255,r.default_IV_size&255].concat(parse(r.default_KID)));return o.box(o.types.tenc,t)}},{key:"sinf",value:function(r){var t=new Uint8Array([]),e=new Uint8Array([r.data_format.charCodeAt(0),r.data_format.charCodeAt(1),r.data_format.charCodeAt(2),r.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),n=o.schi(r);return o.box(o.types.sinf,t,o.box(o.types.frma,e),o.box(o.types.schm,i),n)}},{key:"av01",value:function(r){return o.box(o.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r.width>>8&255,r.width&255,r.height>>8&255,r.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r.av1C,r.colr)}},{key:"avc1hev1",value:function(r){var t=r.codecType===VideoCodecType.HEVC,e=t?o.types.hvc1:o.types.avc1,i=t?o.hvcC(r):o.avcC(r),n=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r.width>>8&255,r.width&255,r.height>>8&255,r.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t?n.push(o.box(o.types.fiel,new Uint8Array([1,0]))):r.sarRatio&&r.sarRatio.length>1&&n.push(o.pasp(r.sarRatio)),o.box.apply(o,[e].concat(n))}},{key:"avcC",value:function(r){var t,e,i=[],n=[],s;return r.sps.forEach(function(a){s=a.byteLength,i.push(s>>>8&255),i.push(s&255),i.push.apply(i,_toConsumableArray(a))}),r.pps.forEach(function(a){s=a.byteLength,n.push(s>>>8&255),n.push(s&255),n.push.apply(n,_toConsumableArray(a))}),o.box(o.types.avcC,new Uint8Array((t=(e=[1,i[3],i[4],i[5],255,224|r.sps.length]).concat.apply(e,i).concat([r.pps.length])).concat.apply(t,n)))}},{key:"hvcC",value:function(r){var t=r.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var e=r.vps,i=r.sps,n=r.pps,s;if(t){var a=t.generalProfileCompatibilityFlags,l=t.generalConstraintIndicatorFlags,c=(e.length&&1)+(i.length&&1)+(n.length&&1);s=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,a>>>24,a>>>16,a>>>8,a,l[0],l[1],l[2],l[3],l[4],l[5],t.generalLevelIdc,240,0,252,t.chromaFormatIdc|252,t.bitDepthLumaMinus8|248,t.bitDepthChromaMinus8|248,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,c];var f=function(p){var d;s.push(p.length>>8,p.length),(d=s).push.apply(d,_toConsumableArray(p))};e.length&&(s.push(160,0,e.length),e.forEach(f)),i.length&&(s.push(161,0,i.length),i.forEach(f)),n.length&&(s.push(162,0,n.length),n.forEach(f))}else s=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return o.box(o.types.hvcC,new Uint8Array(s))}},{key:"pasp",value:function(r){var t=_slicedToArray(r,2),e=t[0],i=t[1];return o.box(o.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"mp4a",value:function(r){return o.box(o.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,r.sampleRate>>8&255,r.sampleRate&255,0,0]),r.config.length?o.esds(r.config):void 0)}},{key:"esds",value:function(r){var t=r.length,e=o.box(o.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(r).concat([6,1,2])));return e}},{key:"opus",value:function(r){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,r.sampleRate>>8&255,r.sampleRate&255,0,0]),e=r.config.length?o.dOps(r):[];return o.box(o.types.Opus,t,e)}},{key:"dOps",value:function(r){if(r.config)return r.config[4]=r.sampleRate>>>24&255,r.config[5]=r.sampleRate>>>16&255,r.config[6]=r.sampleRate>>>8&255,r.config[7]=r.sampleRate&255,o.box(o.types.dOps,r.config)}},{key:"mvex",value:function(r){var t=o.box.apply(o,[o.types.mvex].concat(_toConsumableArray(r.map(function(e){return o.trex(e.id)}))));return t}},{key:"trex",value:function(r){var t=o.box(o.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return t}},{key:"trex1",value:function(r){var t=o.box(o.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return t}},{key:"trex2",value:function(r){var t=o.box(o.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return t}},{key:"moof",value:function(r){var t=o.box.apply(o,[o.types.moof,o.mfhd(r[0].samples?r[0].samples[0].gopId:0)].concat(_toConsumableArray(r.map(function(e){return o.traf(e)}))));return t}},{key:"mfhd",value:function(r){var t=o.box(o.types.mfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]));return t}},{key:"traf",value:function(r){var t=o.tfhd(r.id),e=o.tfdt(r,r.baseMediaDecodeTime),i=0,n;if(r.isVideo&&r.videoSenc&&(n=r.videoSenc,n.forEach(function(T){i=i+8,T.subsamples&&T.subsamples.length&&(i=i+2,i=i+T.subsamples.length*6)})),r.videoSencLength=i,!r.useEME||!r.isVideoEncryption&&!r.isAudioEncryption){var s=o.sdtp(r),a=16+20+8+16+8+8;return o.box(o.types.traf,t,e,s,o.trun(r.samples,s.byteLength+a))}else if(r.isVideoEncryption)if(r.isVideo){var l=o.saiz(r),c=o.saio(r),f=o.trun1(r),h=o.senc(r),p=o.box(o.types.traf,t,e,l,c,f,h);return p}else if(r.isAudioEncryption){var g=o.sbgp(),y=o.saiz(r),m=o.saio(r),S=o.senc(r),_=o.trun1(r),A=o.box(o.types.traf,t,e,g,y,m,S,_);return A}else{var d=o.sbgp(),v=o.trun1(r);return o.box(o.types.traf,t,e,d,v)}else if(r.isVideo){var k=o.trun1(r);return o.box(o.types.traf,t,e,k)}else{var w=o.sbgp(),I=o.saiz(r),N=o.saio(r),x=o.senc(r),M=o.trun1(r),b=o.box(o.types.traf,t,e,w,I,N,x,M);return b}}},{key:"sdtp",value:function(r){var t=new Buffer;return r.samples.forEach(function(e){t.write(new Uint8Array(r.isVideo?[e.keyframe?32:16]:[16]))}),o.box(o.types.sdtp,this.extension(0,0),t.buffer)}},{key:"trun1",value:function(r){var t=new Buffer,e=Buffer.writeUint32(r.samples.length),i=null;if(r.isVideo){var n=r.videoSencLength;i=Buffer.writeUint32(r.samples.length*16+n+149),!r.isVideoEncryption&&r.isAudioEncryption&&(i=Buffer.writeUint32(r.samples.length*16+92))}else{var s=r.samples.length*12+124;r.isAudioEncryption&&(s=r.samples.length*12+8*r.audioSenc.length+177),i=Buffer.writeUint32(s)}return r.samples.forEach(function(a){t.write(Buffer.writeUint32(a.duration)),t.write(Buffer.writeUint32(a.size)),t.write(Buffer.writeUint32(a.keyframe?33554432:65536)),r.isVideo&&t.write(Buffer.writeUint32(a.cts?a.cts:0))}),o.box(o.types.trun,this.extension(0,r.flags),e,i,t.buffer)}},{key:"senc",value:function(r){var t=new Buffer,e=r.samples.length,i=r.isVideo?16:8,n=r.isVideo?2:0,s=[],a=0;return r.isVideo?(s=r.videoSenc,a=r.videoSencLength):s=r.audioSenc,a=a||i*e,t.write(Buffer.writeUint32(16+a),o.types.senc,this.extension(0,n)),t.write(Buffer.writeUint32(e)),s.forEach(function(l){for(var c=0;c<l.InitializationVector.length;c++)t.write(new Uint8Array([l.InitializationVector[c]]));l.subsamples&&l.subsamples.length&&(t.write(Buffer.writeUint16(l.subsamples.length)),l.subsamples.forEach(function(f){t.write(Buffer.writeUint16(f.BytesOfClearData)),t.write(Buffer.writeUint32(f.BytesOfProtectedData))}))}),t.buffer}},{key:"saio",value:function(r){var t=r.samples.length*12+141;!r.isVideo&&r.isAudioEncryption&&(t=149);var e=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]);return o.box(o.types.saio,e)}},{key:"saiz",value:function(r){var t=r.samples.length,e=new Uint8Array([0,0,0,0,16,t>>24&255,t>>16&255,t>>8&255,t&255]);return o.box(o.types.saiz,e)}},{key:"sbgp",value:function(){var r=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return o.box(o.types.sbgp,this.extension(0,0),r)}},{key:"extension",value:function(r,t){return new Uint8Array([r,t>>16&255,t>>8&255,t&255])}},{key:"tfhd",value:function(r){return o.box(o.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]))}},{key:"tfdt",value:function(r,t){var e=Math.floor(t/(UINT32_MAX+1)),i=Math.floor(t%(UINT32_MAX+1));return r.useEME&&(r.isVideoEncryption||r.isAudioEncryption)?o.box(o.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])):o.box(o.types.tfdt,new Uint8Array([1,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"trun",value:function(r,t){var e=r.length,i=12+16*e;t+=8+i;var n=new Uint8Array(i);n.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(var s=0;s<e;s++){var a=r[s],l=a.duration,c=a.size,f=a.flag,h=f===void 0?{}:f,p=a.cts,d=p===void 0?0:p;n.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h.isLeading<<2|(h.dependsOn===null||h.dependsOn===void 0?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(h.isNonSyncSample===null||h.isNonSyncSample===void 0?1:h.isNonSyncSample),h.degradationPriority&61440,h.degradationPriority&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*s)}return o.box(o.types.trun,n)}},{key:"moovMP4",value:function(r){return o.box.apply(o,[o.types.moov,o.mvhd(r[0].duration,r[0].timescale)].concat(_toConsumableArray(r.map(function(t){return o.trackMP4(t)}))))}},{key:"trackMP4",value:function(r){return o.box(o.types.trak,o.tkhd(r.id,r.duration,r.width,r.height),o.mdiaMP4(r))}},{key:"mdiaMP4",value:function(r){return o.box(o.types.mdia,o.mdhd(r.duration,r.timescale),o.hdlr(r.type),o.minfMP4(r))}},{key:"minfMP4",value:function(r){return o.box(o.types.minf,r.type===TrackType.VIDEO?o.VMHD:o.SMHD,o.DINF,o.stblMP4(r))}},{key:"stblMP4",value:function(r){var t=r.ext,e=[o.stsd(r),o.stts(t.stts),o.stsc(t.stsc),o.stsz(t.stsz),o.stco(t.stco)];return t.stss.length&&e.push(o.stss(t.stss)),t.ctts.length&&e.push(o.ctts(t.ctts)),o.box.apply(o,[o.types.stbl].concat(e))}},{key:"stts",value:function(r){var t=r.length,e=new Uint8Array(8*t),i=0;return r.forEach(function(n){var s=n.value,a=n.count;e.set([a>>24,a>>16&255,a>>8&255,a&255,s>>24,s>>16&255,s>>8&255,s&255],i),i+=8}),o.box(o.types.stts,concatUint8Array(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsc",value:function(r){var t=r.length,e=new Uint8Array(12*t),i=0;return r.forEach(function(n){var s=n.firstChunk,a=n.samplesPerChunk,l=n.sampleDescIndex;e.set([s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255],i),i+=12}),o.box(o.types.stsc,concatUint8Array(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsz",value:function(r){var t=r.length,e=new Uint8Array(4*t),i=0;return r.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],i),i+=4}),o.box(o.types.stsz,concatUint8Array(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stco",value:function(r){var t=r.length,e=new Uint8Array(4*t),i=0;return r.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],i),i+=4}),o.box(o.types.stco,concatUint8Array(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stss",value:function(r){var t=r.length,e=new Uint8Array(4*t),i=0;return r.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],i),i+=4}),o.box(o.types.stss,concatUint8Array(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"ctts",value:function(r){var t=r.length,e=new Uint8Array(8*t),i=0;return r.forEach(function(n){var s=n.value,a=n.count;e.set([a>>24,a>>16&255,a>>8&255,a&255,s>>24,s>>16&255,s>>8&255,s&255],i),i+=8}),o.box(o.types.ctts,concatUint8Array(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"styp",value:function(){return o.box(o.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(r){var t=r.timescale,e=r.samples[0].duration,i=e*r.samples.length,n=r.samples[0].sampleOffset*e,s=8;r.samples.forEach(function(h){s+=h.size});var a=0;if(r.isVideo){var l=0,c;r.videoSenc&&(c=r.videoSenc),r.isVideo&&c.forEach(function(h){l=l+8,h.subsamples&&h.subsamples.length&&(l=l+2,l=l+h.subsamples.length*6)}),r.videoSencLength=l,a=s+141+r.samples.length*16+l,r.useEME&&r.isAudioEncryption&&!r.isVideoEncryption&&(a=s+r.samples.length*16+84)}else a=s+116+r.samples.length*12,r.useEME&&r.isAudioEncryption&&(a=s+169+r.samples.length*12+8*r.audioSenc.length);var f=new Uint8Array([0,0,0,0,0,0,0,r.id&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,0,0,0,1,0,a>>16&255,a>>8&255,a&255,i>>24&255,i>>16&255,i>>8&255,i&255,144,0,0,0]);return o.box(o.types.sidx,f)}},{key:"mdat",value:function(r){var t=o.box(o.types.mdat,r);return t}}]),o}();_defineProperty(MP4,"types",["Opus","dOps","av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(o,u){return o[u]=[u.charCodeAt(0),u.charCodeAt(1),u.charCodeAt(2),u.charCodeAt(3)],o},Object.create(null)));_defineProperty(MP4,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});_defineProperty(MP4,"FTYPAVC1",MP4.box(MP4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));_defineProperty(MP4,"FTYPHEV1",MP4.box(MP4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));_defineProperty(MP4,"DINF",MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));_defineProperty(MP4,"VMHD",MP4.box(MP4.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));_defineProperty(MP4,"SMHD",MP4.box(MP4.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));_defineProperty(MP4,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));_defineProperty(MP4,"STTS",MP4.box(MP4.types.stts,MP4.StblTable));_defineProperty(MP4,"STSC",MP4.box(MP4.types.stsc,MP4.StblTable));_defineProperty(MP4,"STSZ",MP4.box(MP4.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));_defineProperty(MP4,"STCO",MP4.box(MP4.types.stco,MP4.StblTable));var Logger=function(){function o(u,r){_classCallCheck(this,o),this.name=u||"",this._prefix="[".concat(this.name,"]"),o.disabled=r}return _createClass(o,[{key:"debug",value:function(){var r;if(!o.disabled){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];(r=console).debug.apply(r,[this._prefix].concat(e))}}},{key:"log",value:function(){var r;if(!o.disabled){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];(r=console).log.apply(r,[this._prefix].concat(e))}}},{key:"warn",value:function(){var r;if(!o.disabled){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];(r=console).warn.apply(r,[this._prefix].concat(e))}}},{key:"error",value:function(){var r;if(!o.disabled){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];(r=console).error.apply(r,[this._prefix].concat(e))}}},{key:"table",value:function(){var r;o.disabled||(console.group(this._prefix),(r=console).table.apply(r,arguments),console.groupEnd())}}],[{key:"enable",value:function(){o.disabled=!1}},{key:"disable",value:function(){o.disabled=!0}}]),o}();_defineProperty(Logger,"disabled",!0);var FMP4Remuxer=function(){function o(u,r,t){_classCallCheck(this,o),this.videoTrack=u,this.audioTrack=r;var e=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=e&&Number(e[1])<50,this.log=new Logger("FMP4Remuxer",t&&t.openLog?!t.openLog:!0)}return _createClass(o,[{key:"remux",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.videoTrack,i=this.audioTrack,n=e.exist(),s=i.exist(),a,l,c,f=[];r&&(t&&t.initMerge?(n&&f.push(this.videoTrack),s&&f.push(this.audioTrack),c=MP4.initSegment(f)):(n&&(a=MP4.initSegment([this.videoTrack])),s&&(l=MP4.initSegment([this.audioTrack]))));var h,p;return n&&e.hasSample()&&(h=this._remuxVideo()),s&&i.hasSample()&&(p=this._remuxAudio()),e.samples=[],i.samples=[],{initSegment:c,videoInitSegment:a,audioInitSegment:l,videoSegment:h,audioSegment:p}}},{key:"_remuxVideo",value:function(){var r=this.videoTrack;this.forceFirstIDR&&(r.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=r.samples,e=/av01/.test(r.codec),i=0;e?t.forEach(function(S){i+=S.data.byteLength}):t.forEach(function(S){i+=S.units.reduce(function(_,A){return _+A.byteLength},0),i+=S.units.length*4});var n=new Uint8Array(i);if(e)for(var s=0,a=t.length,l=0,c;s<a;s++)c=t[s],n.set(c.data,l),c.size=c.data.byteLength,l+=c.size;else for(var f=new DataView(n.buffer),h=function(_,A){A=t[p];var k=0;A.units.forEach(function(w){f.setUint32(_,w.byteLength),_+=4,n.set(w,_),_+=w.byteLength,k+=4+w.byteLength}),A.size=k,v=_,g=A},p=0,d=t.length,v=0,g;p<d;p++)h(v,g);var y=MP4.mdat(n),m=MP4.moof([r]);return concatUint8Array(m,y)}},{key:"_remuxAudio",value:function(){var r=this.audioTrack,t=new Uint8Array(r.samples.reduce(function(n,s){return n+s.size},0));r.samples.reduce(function(n,s){return t.set(s.data,n),n+s.size},0);var e=MP4.mdat(t),i=MP4.moof([r]);return concatUint8Array(i,e)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),o}(),TransferCost=function(){function o(){_classCallCheck$2(this,o),_defineProperty$2(this,"_ttfb",0),_defineProperty$2(this,"_demuxStart",0),_defineProperty$2(this,"_demuxEnd",0),_defineProperty$2(this,"_demuxCost",0),_defineProperty$2(this,"_remuxStart",0),_defineProperty$2(this,"_remuxEnd",0),_defineProperty$2(this,"_remuxCost",0),_defineProperty$2(this,"_appendStart",0),_defineProperty$2(this,"_appendEnd",0),_defineProperty$2(this,"_appendCost",0)}return _createClass$2(o,[{key:"set",value:function(r,t){this["_".concat(r)]=t}},{key:"start",value:function(r){this["_".concat(r,"Start")]=Date.now()}},{key:"end",value:function(r){this["_".concat(r,"End")]=Date.now(),this["_".concat(r,"Cost")]=this["_".concat(r,"Cost")]+(this["_".concat(r,"End")]-this["_".concat(r,"Start")])}},{key:"transferCost",get:function(){return{ttfbCost:this._ttfb,demuxCost:this._demuxCost,remuxCost:this._remuxCost,appendCost:this._appendCost}}}]),o}(),TRANSFER_EVENT={TTFB:"ttfb",DEMUX:"demux",REMUX:"remux",APPEND:"append"},logger$1=new Logger$2("BufferService"),BufferService=function(){function o(u,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};_classCallCheck$2(this,o),_defineProperty$2(this,"flv",null),_defineProperty$2(this,"_demuxer",new FlvDemuxer),_defineProperty$2(this,"_remuxer",null),_defineProperty$2(this,"_mse",null),_defineProperty$2(this,"_softVideo",null),_defineProperty$2(this,"_sourceCreated",!1),_defineProperty$2(this,"_needInitSegment",!0),_defineProperty$2(this,"_discontinuity",!0),_defineProperty$2(this,"_contiguous",!1),_defineProperty$2(this,"_initSegmentId",""),_defineProperty$2(this,"_cachedBuffer",null),_defineProperty$2(this,"_demuxStartTime",0),_defineProperty$2(this,"_opts",null),this.flv=u,this._opts=t,r?this._softVideo=r:(this._remuxer=new FMP4Remuxer(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new MSE(null,{preferMMS:typeof t.preferMMS=="boolean"?t.preferMMS:!!t.perferMMS}),this._mse.bindMedia(u.media))}return _createClass$2(o,[{key:"baseDts",get:function(){var r,t;return(r=this._demuxer)===null||r===void 0||(t=r._fixer)===null||t===void 0?void 0:t._baseDts}},{key:"blobUrl",get:function(){var r;return(r=this._mse)===null||r===void 0?void 0:r.url}},{key:"isFull",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:MSE.VIDEO;return this._mse.isFull(r)}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(r){this._contiguous=!1,this._demuxStartTime=r}},{key:"reset",value:function(){var u=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function t(){var e,i=arguments;return _regeneratorRuntime$1().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!e)){s.next=6;break}return s.next=4,this._mse.unbindMedia();case 4:return s.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="",this.resetSeamlessSwitchStats();case 12:case"end":return s.stop()}},t,this)}));function r(){return u.apply(this,arguments)}return r}()},{key:"resetSeamlessSwitchStats",value:function(){this.seamlessLoadingSwitch=null,this.seamlessLoadingSwitching=!1,this._demuxer&&(this._demuxer.seamlessLoadingSwitching=!1)}},{key:"endOfStream",value:function(){var u=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function t(){return _regeneratorRuntime$1().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=7;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.flv.emit(EVENT.BUFFEREOS);case 5:i.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return i.stop()}},t,this)}));function r(){return u.apply(this,arguments)}return r}()},{key:"updateDuration",value:function(){var u=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function t(e){return _regeneratorRuntime$1().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=7;break}if(this._mse.isOpened){n.next=4;break}return n.next=4,this._mse.open();case 4:return logger$1.debug("update duration",e),n.next=7,this._mse.updateDuration(e);case 7:case"end":return n.stop()}},t,this)}));function r(t){return u.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var u=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function t(){return _regeneratorRuntime$1().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=3;break}return i.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return i.stop()}},t,this)}));function r(){return u.apply(this,arguments)}return r}()},{key:"appendBuffer",value:function(){var u=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function t(e){var i=this,n,s,a,l,c,f,h,p,d,v,g,y,m,S,_,A,k;return _regeneratorRuntime$1().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(n=!1,this._cachedBuffer&&(e=concatUint8Array$1(this._cachedBuffer,e),this._cachedBuffer=null),s=this._demuxer,!(!e||!e.length||!s)){I.next=5;break}return I.abrupt("return");case 5:I.prev=5,this.flv._transferCost.start(TRANSFER_EVENT.DEMUX),s.demuxAndFix(e,this.seamlessLoadingSwitching||this._discontinuity,this._contiguous,this._demuxStartTime,this.seamlessLoadingSwitching),this.seamlessLoadingSwitching=!1,this.flv._transferCost.end(TRANSFER_EVENT.DEMUX),I.next=15;break;case 12:throw I.prev=12,I.t0=I.catch(5),new StreamingError(ERR.DEMUX,ERR.SUB_TYPES.FLV,I.t0);case 15:if(a=s.videoTrack,l=s.audioTrack,c=s.metadataTrack,!this.seamlessLoadingSwitch){I.next=25;break}if(f=a.samples.findIndex(function(N){return N.originDts===a.lastKeyFrameDts}),!(f>=0)){I.next=25;break}return a.samples.splice(f),I.next=22,this.seamlessLoadingSwitch();case 22:this.seamlessLoadingSwitch=null,e=null,n=!0;case 25:if(h=a.exist(),p=l.exist(),this._opts.onlyAudio&&(h=!1,a.present=!1),this._opts.onlyVideo&&(p=!1,l.present=!1),!(!h&&a.present||!p&&l.present)){I.next=42;break}if(d=0,v=h?a:p?l:void 0,v&&v.samples.length&&(d=(v.samples[v.samples.length-1].originPts-v.samples[0].originPts)/v.timescale*1e3),!(d>this._opts.analyzeDuration)){I.next=40;break}logger$1.warn("analyze duration exceeded, ".concat(d,"ms"),v),a.present=h,l.present=p,this.flv.emit(EVENT.ANALYZE_DURATION_EXCEEDED,{duration:d}),I.next=42;break;case 40:return this._cachedBuffer=e,I.abrupt("return");case 42:if(g=a.type,y=l.type,this._fireEvents(a,l,c),n||(this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0),m=this._mse,S=function(){var x;if((x=i.flv)!==null&&x!==void 0&&x.emit){var M;(M=i.flv)===null||M===void 0||M.emit(EVENT.APPEND_BUFFER,{})}},this.flv.emit(EVENT.DEMUXED_TRACK,{videoTrack:a}),_="".concat(a.codec,"/").concat(a.width,"/").concat(a.height,"/").concat(l.codec,"/").concat(l.config),_!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=_,this._emitMetaParsedEvent(a,l)),!m){I.next=81;break}if(this._sourceCreated){I.next=59;break}return I.next=55,m.open();case 55:h&&(logger$1.log("codec: video/mp4;codecs=".concat(a.codec)),m.createSource(g,"video/mp4;codecs=".concat(a.codec))),p&&(logger$1.log("codec: audio/mp4;codecs=".concat(l.codec)),m.createSource(y,"audio/mp4;codecs=".concat(l.codec))),this._sourceCreated=!0,this.flv.emit(EVENT.SOURCEBUFFER_CREATED);case 59:I.prev=59,this._needInitSegment&&!this._opts.mseLowLatency&&(a.duration=this._opts.durationForMSELowLatencyOff*a.timescale,l.duration=this._opts.durationForMSELowLatencyOff*p.timescale),this.flv._transferCost.start(TRANSFER_EVENT.REMUX),A=this._remuxer.remux(this._needInitSegment),this.flv._transferCost.end(TRANSFER_EVENT.REMUX),I.next=69;break;case 66:throw I.prev=66,I.t1=I.catch(59),new StreamingError(ERR.REMUX,ERR.SUB_TYPES.FMP4,I.t1);case 69:if(!(this._needInitSegment&&!A.videoInitSegment&&!A.audioInitSegment)){I.next=71;break}return I.abrupt("return");case 71:return this._needInitSegment=!1,k=[],A.videoInitSegment&&k.push(m.append(g,A.videoInitSegment)),A.audioInitSegment&&k.push(m.append(y,A.audioInitSegment)),A.videoSegment&&k.push(m.append(g,A.videoSegment)),A.audioSegment&&k.push(m.append(y,A.audioSegment)),this.flv._transferCost.start(TRANSFER_EVENT.APPEND),I.abrupt("return",Promise.all(k).then(S).then(function(){i.flv._transferCost.end(TRANSFER_EVENT.APPEND),S()}));case 81:this._softVideo&&(this._softVideo.appendBuffer(a,l),S());case 82:case"end":return I.stop()}},t,this,[[5,12],[59,66]])}));function r(t){return u.apply(this,arguments)}return r}()},{key:"evictBuffer",value:function(){var u=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function t(e){var i=this,n,s,a,l;return _regeneratorRuntime$1().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(n=this.flv.media,!(!this._mse||!this._demuxer||!n||!e||e<0)){f.next=3;break}return f.abrupt("return");case 3:if(s=n.currentTime,a=s-e,!(a<=0)){f.next=7;break}return f.abrupt("return");case 7:if(l=Buffer$1.start(Buffer$1.get(n)),!(l+1>=a)){f.next=10;break}return f.abrupt("return");case 10:return f.abrupt("return",this._mse.clearBuffer(0,a).then(function(){return i.flv.emit(EVENT.REMOVE_BUFFER,{removeEnd:a})}));case 11:case"end":return f.stop()}},t,this)}));function r(t){return u.apply(this,arguments)}return r}()},{key:"_emitMetaParsedEvent",value:function(r,t){r.exist()&&this.flv.emit(EVENT.METADATA_PARSED,{type:"video",track:r,meta:{codec:r.codec,timescale:r.timescale,width:r.width,height:r.height,sarRatio:r.sarRatio,baseDts:r.baseDts}}),t.exist()&&this.flv.emit(EVENT.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),logger$1.debug("track parsed",r,t)}},{key:"_fireEvents",value:function(r,t,e){var i=this;logger$1.debug("videoTrack samples count: ".concat(r.samples.length,", audioTrack samples count: ").concat(t.samples.length)),e.flvScriptSamples.forEach(function(n){i.flv.emit(EVENT.FLV_SCRIPT_DATA,n),logger$1.debug("flvScriptData",n)}),r.samples.forEach(function(n){n.keyframe&&i.flv.emit(EVENT.KEYFRAME,{pts:n.originPts})}),r.warnings.forEach(function(n){var s;switch(n.type){case WarningType.LARGE_AV_SHIFT:s=EVENT.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case WarningType.LARGE_VIDEO_GAP:s=EVENT.LARGE_VIDEO_DTS_GAP_DETECT;break;case WarningType.LARGE_VIDEO_GAP_BETWEEN_CHUNK:s=EVENT.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}s&&i.flv.emit(EVENT.STREAM_EXCEPTION,_objectSpread2$1(_objectSpread2$1({},n),{},{type:s})),logger$1.warn("video exception",n)}),t.warnings.forEach(function(n){var s;switch(n.type){case WarningType.LARGE_AUDIO_GAP:s=EVENT.LARGE_AUDIO_DTS_GAP_DETECT;break;case WarningType.AUDIO_FILLED:s=EVENT.AUDIO_GAP_DETECT;break;case WarningType.AUDIO_DROPPED:s=EVENT.AUDIO_OVERLAP_DETECT;break}s&&i.flv.emit(EVENT.STREAM_EXCEPTION,_objectSpread2$1(_objectSpread2$1({},n),{},{type:s})),logger$1.warn("audio exception",n)}),e.seiSamples.forEach(function(n){i.flv.emit(EVENT.SEI,_objectSpread2$1(_objectSpread2$1({},n),{},{sei:{code:n.data.type,content:n.data.payload,dts:n.pts}}))})}}]),o}();function getOption(o){var u=_objectSpread2$1({retryCount:3,retryDelay:1e3,disconnectRetryCount:0,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,defaultVodLoadSize:1e7,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1,keepStatusAfterSwitch:!0,onlyVideo:!1,onlyAudio:!1,preferMMS:!1,mseLowLatency:!0,durationForMSELowLatencyOff:6,chunkCountForSpeed:50,skipChunkSize:1e3,longtimeNoReceived:3e3,enableStartGapJump:!0},o);return u.isLive&&u.preloadTime&&(u.maxLatency||(u.maxLatency=u.preloadTime*2),u.targetLatency||(u.targetLatency=u.preloadTime),(u.disconnectTime===null||u.disconnectTime===void 0)&&(u.disconnectTime=u.maxLatency)),u}function searchKeyframeIndex(o,u){var r=0,t=o.length-1,e=0,i=0,n=t;for(u<o[0]&&(r=0,i=n+1);i<=n;)if(e=i+Math.floor((n-i)/2),e===t||u>=o[e]&&u<o[e+1]){r=e;break}else o[e]<u?i=e+1:n=e-1;return r}var logger=new Logger$2("flv"),MAX_HOLE=.1,MAX_START_GAP=.3,Flv=function(o){_inherits$2(r,o);var u=_createSuper$2(r);function r(t){var e;return _classCallCheck$2(this,r),e=u.call(this),_defineProperty$2(_assertThisInitialized$2(e),"media",null),_defineProperty$2(_assertThisInitialized$2(e),"_loading",!1),_defineProperty$2(_assertThisInitialized$2(e),"_opts",null),_defineProperty$2(_assertThisInitialized$2(e),"_bufferService",null),_defineProperty$2(_assertThisInitialized$2(e),"_gapService",null),_defineProperty$2(_assertThisInitialized$2(e),"_stats",null),_defineProperty$2(_assertThisInitialized$2(e),"_mediaLoader",null),_defineProperty$2(_assertThisInitialized$2(e),"_maxChunkWaitTimer",null),_defineProperty$2(_assertThisInitialized$2(e),"_tickTimer",null),_defineProperty$2(_assertThisInitialized$2(e),"_tickInterval",500),_defineProperty$2(_assertThisInitialized$2(e),"_urlSwitching",!1),_defineProperty$2(_assertThisInitialized$2(e),"_seamlessSwitching",!1),_defineProperty$2(_assertThisInitialized$2(e),"_disconnectRetryCount",0),_defineProperty$2(_assertThisInitialized$2(e),"_preLoadEndPoint",0),_defineProperty$2(_assertThisInitialized$2(e),"_keyframes",null),_defineProperty$2(_assertThisInitialized$2(e),"_acceptRanges",!0),_defineProperty$2(_assertThisInitialized$2(e),"_onProgress",function(){var i=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function n(s,a,l,c){var f,h,p,d,v,g,y,m,S,_;return _regeneratorRuntime$1().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(f=l.startTime,h=l.endTime,p=l.st,d=l.firstByteTime,e._loading=!a,e._firstProgressEmit){k.next=13;break}if(e.media){k.next=6;break}return(v=e._mediaLoader)===null||v===void 0||v.cancel(),k.abrupt("return");case 6:g=c.headers,y=p?d-p:h-f,e.emit(EVENT.TTFB,{url:e._opts.url,responseUrl:c.url,elapsed:y}),e.emit(EVENT.LOAD_RESPONSE_HEADERS,{headers:g}),e._transferCost.set(TRANSFER_EVENT.TTFB,y),e._acceptRanges=!!(g!=null&&g.get("Accept-Ranges"))||!!(g!=null&&g.get("Content-Range")),e._firstProgressEmit=!0;case 13:if(e._bufferService){k.next=15;break}return k.abrupt("return");case 15:return clearTimeout(e._maxChunkWaitTimer),e._bandwidthService.addChunkRecord(s==null?void 0:s.byteLength,h-f),k.prev=17,k.next=20,e._bufferService.appendBuffer(s);case 20:(m=e._bufferService)===null||m===void 0||m.evictBuffer(e._opts.bufferBehind),k.next=33;break;case 23:if(k.prev=23,k.t0=k.catch(17),!(!e.isLive&&e._bufferService.isFull())){k.next=32;break}return k.next=28,e._mediaLoader.cancel();case 28:return e._loading=!1,S=e.bufferInfo().remaining,e._opts.preloadTime=parseInt(S)/2,k.abrupt("return");case 32:return k.abrupt("return",e._emitError(StreamingError.create(k.t0)));case 33:if(e._urlSwitching&&(e._urlSwitching=!1,e.emit(EVENT.SWITCH_URL_SUCCESS,{url:e._opts.url})),e._seamlessSwitching&&(e._seamlessSwitching=!1,e._tick()),!(a&&!e.media.seeking)){k.next=40;break}return e.emit(EVENT.LOAD_COMPLETE),logger.debug("load done"),e.isLive&&e._disconnectRetryCount<=0&&e._end(),k.abrupt("return");case 40:if(e.isLive){k.next=42;break}return k.abrupt("return");case 42:_=e._opts.maxReaderInterval,_&&e._firstProgressEmit&&(clearTimeout(e._maxChunkWaitTimer),e._maxChunkWaitTimer=setTimeout(function(){if(e._disconnectRetryCount){e._disconnectRetryCount--,e.load();return}logger.debug("onMaxChunkWait",_),e._end()},_));case 44:case"end":return k.stop()}},n,null,[[17,23]])}));return function(n,s,a,l){return i.apply(this,arguments)}}()),_defineProperty$2(_assertThisInitialized$2(e),"_onRetryError",function(i,n){logger.debug("load retry",i,n),e.emit(EVENT.LOAD_RETRY,{error:StreamingError.network(i),retryTime:n})}),_defineProperty$2(_assertThisInitialized$2(e),"_end",function(){e._clear(),e._bufferService&&e._bufferService.endOfStream(),logger.debug("end stream")}),_defineProperty$2(_assertThisInitialized$2(e),"_resetDisconnectCount",function(){e._disconnectRetryCount=e._opts.disconnectRetryCount}),_defineProperty$2(_assertThisInitialized$2(e),"_tick",function(){clearTimeout(e._tickTimer);var i=_assertThisInitialized$2(e),n=i.media;if(n){e._tickTimer=setTimeout(e._tick,e._tickInterval);var s=Buffer$1.end(Buffer$1.get(n));if(!(s<MAX_HOLE||!n.readyState)){var a=e._opts;if(isMediaPlaying(n)&&n.currentTime)e._gapService&&e._gapService.do(n,a.maxJumpDistance,e.isLive,3);else{if(!n.currentTime&&e._gapService&&a.enableStartGapJump){var l=e._opts.mseLowLatency||e._opts.mseLowLatency===!1&&e.bufferInfo(MAX_START_GAP).nextStart;l&&e._gapService.do(n,a.maxJumpDistance,e.isLive,3);return}a.isLive&&n.readyState===4&&s-n.currentTime>a.disconnectTime&&e.disconnect()}}}}),_defineProperty$2(_assertThisInitialized$2(e),"_onPlay",function(){var i,n,s=e._opts.softDecode||((i=e.media)===null||i===void 0||(n=i.buffered)===null||n===void 0?void 0:n.length);if(e.isLive){!e._loading&&s&&e.replay(void 0,!0);return}var a=e.bufferInfo();(a.start||a.nextStart)>MAX_HOLE&&e._tick()}),_defineProperty$2(_assertThisInitialized$2(e),"_onLoadeddata",function(){e.isLive&&!e._opts.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(i){})}),_defineProperty$2(_assertThisInitialized$2(e),"_onSeeking",_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(){return _regeneratorRuntime$1().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:!e.isLive&&e.seekable&&(e._preLoadEndPoint=-1,e._checkPreload());case 1:case"end":return s.stop()}},i)}))),_defineProperty$2(_assertThisInitialized$2(e),"_onTimeupdate",function(){if(e.media){var i=e._opts,n=e.media.currentTime;if(i.isLive&&i.maxLatency&&i.targetLatency){var s=Buffer$1.end(Buffer$1.get(e.media)),a=s-n;a>=i.maxLatency&&(e.media.currentTime=s-i.targetLatency,e.emit(EVENT.CHASEFRAME,{currentTime:e.media.currentTime,latency:i.targetLatency}))}e._seiService.throw(n,!0),!(i.isLive||!e.seekable||e._loading)&&e._checkPreload()}}),_defineProperty$2(_assertThisInitialized$2(e),"_onWaiting",function(){e.isLive&&!e._loading&&e._disconnectRetryCount&&(e._disconnectRetryCount--,e.load())}),_defineProperty$2(_assertThisInitialized$2(e),"_onBufferUpdate",function(){if(!e._opts.isLive){var i=e.bufferInfo(),n=i.end,s=i.nextEnd;Math.abs((n||s)-e.media.duration)<1&&(e._end(),e.media.readyState<=2&&e._tick())}}),_defineProperty$2(_assertThisInitialized$2(e),"_checkPreload",_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(){var n,s,a,l,c,f,h,p,d,v;return _regeneratorRuntime$1().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(n=e.bufferInfo(),s=n.remaining,a=s===void 0?0:s,l=e._opts,c=e._keyframes.filepositions,f=e._keyframes.times,h=e.media.currentTime,!(a<l.preloadTime)){y.next=19;break}if(p=searchKeyframeIndex(e._keyframes.times,h+a+MAX_HOLE),d=searchKeyframeIndex(e._keyframes.times,h+a+e._opts.preloadTime),d===p&&(d=p+1),e._preLoadEndPoint!==d){y.next=11;break}return y.abrupt("return");case 11:if(v=c[p],v!=null){y.next=14;break}return y.abrupt("return");case 14:return y.next=16,e._mediaLoader.cancel();case 16:e._loadData(null,[v,c[d]]),e._preLoadEndPoint=d,e._bufferService.unContiguous(f[p]);case 19:case"end":return y.stop()}},i)}))),_defineProperty$2(_assertThisInitialized$2(e),"_onFlvScriptData",function(i){var n,s,a,l,c=(n=i.data)===null||n===void 0||(s=n.onMetaData)===null||s===void 0?void 0:s.keyframes,f=(a=i.data)===null||a===void 0||(l=a.onMetaData)===null||l===void 0?void 0:l.duration;c&&(e._keyframes=c),!e._opts.isLive&&f&&e._bufferService.updateDuration(f)}),e._opts=getOption(t),e.media=e._opts.media||document.createElement("video"),e._opts.media=null,e._firstProgressEmit=!1,e._mediaLoader=new NetLoader(_objectSpread2$1(_objectSpread2$1({},e._opts.fetchOptions),{},{retry:e._opts.retryCount,retryDelay:e._opts.retryDelay,timeout:e._opts.loadTimeout,onRetryError:e._onRetryError,onProgress:e._onProgress,responseType:"arraybuffer"})),e._disconnectRetryCount=e._opts.disconnectRetryCount,e._transferCost=new TransferCost,e._bufferService=new BufferService(_assertThisInitialized$2(e),e._opts.softDecode?e.media:void 0,e._opts),e._seiService=new SeiService(_assertThisInitialized$2(e)),e._bandwidthService=new BandwidthService({chunkCountForSpeed:e._opts.chunkCountForSpeed,skipChunkSize:e._opts.skipChunkSize,longtimeNoReceived:e._opts.longtimeNoReceived}),e._stats=new MediaStatsService(_assertThisInitialized$2(e)),e._opts.softDecode||(e._gapService=new GapService),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e.media.addEventListener("progress",e._onBufferUpdate),e.media.addEventListener("waiting",e._onWaiting),e.on(EVENT.FLV_SCRIPT_DATA,e._onFlvScriptData),e}return _createClass$2(r,[{key:"version",get:function(){return"3.0.20"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"loader",get:function(){return this._mediaLoader}},{key:"blobUrl",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.blobUrl}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed(),totalSize:this._bandwidthService.getTotalSize(),totalCost:this._bandwidthService.getTotalCost()}}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"bufferInfo",value:function(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:MAX_HOLE;return Buffer$1.info(Buffer$1.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,i)}},{key:"playbackQuality",value:function(){return getVideoPlaybackQuality(this.media)}},{key:"load",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(n){var s,a=arguments;return _regeneratorRuntime$1().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s=a.length>1&&a[1]!==void 0?a[1]:!1,this._bufferService){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,this._reset(s);case 5:this._loadData(n,this._opts.isLive?[]:[0,this._opts.defaultVodLoadSize]),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 8:case"end":return c.stop()}},i,this)}));function e(i){return t.apply(this,arguments)}return e}()},{key:"replay",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(){var n=this,s,a,l=arguments;return _regeneratorRuntime$1().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s=l.length>0&&l[0]!==void 0?l[0]:this._opts.seamlesslyReload,a=l.length>1?l[1]:void 0,this.media){f.next=4;break}return f.abrupt("return");case 4:if(this._resetDisconnectCount(),!s){f.next=11;break}return f.next=8,this._clear();case 8:setTimeout(function(){n._seamlessSwitching=!0,n._loadData(n._opts.url),n._bufferService.seamlessSwitch()}),f.next=13;break;case 11:return f.next=13,this.load();case 13:return f.abrupt("return",this.media.play(!a).catch(function(){}));case 14:case"end":return f.stop()}},i,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"disconnect",value:function(){var e;return logger.debug("disconnect!"),(e=this._bufferService)===null||e===void 0||e.resetSeamlessSwitchStats(),this._clear()}},{key:"switchURL",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(n,s){var a=this;return _regeneratorRuntime$1().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this._bufferService){c.next=2;break}return c.abrupt("return");case 2:if(this._resetDisconnectCount(),!(this._loading&&s)){c.next=6;break}return this._bufferService.seamlessLoadingSwitch=function(){var f=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function h(p){return _regeneratorRuntime$1().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,a._clear();case 2:a._bufferService.seamlessLoadingSwitching=!0,a._urlSwitching=!0,a._seamlessSwitching=!0,a._bufferService.seamlessSwitch(),a._loadData(n);case 7:case"end":return v.stop()}},h)}));return function(h){return f.apply(this,arguments)}}(),c.abrupt("return");case 6:if(!(!s||!this._opts.isLive)){c.next=11;break}return c.next=9,this.load(n);case 9:return this._urlSwitching=!0,c.abrupt("return",this.media.play(!0).catch(function(){}));case 11:return c.next=13,this._clear();case 13:setTimeout(function(){a._urlSwitching=!0,a._seamlessSwitching=!0,a._loadData(n),a._bufferService.seamlessSwitch()});case 14:case"end":return c.stop()}},i,this)}));function e(i,n){return t.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(){return _regeneratorRuntime$1().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(this.media){s.next=2;break}return s.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),this.media.removeEventListener("waiting",this._onWaiting),this.media.removeEventListener("progress",this._onBufferUpdate),s.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null,this._bufferService=null;case 14:case"end":return s.stop()}},i,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_emitError",value:function(e){var i,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;logger.table(e),logger.error(e),logger.error((i=this.media)===null||i===void 0?void 0:i.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(EVENT.SWITCH_URL_FAILED,e)),this.emit(EVENT.ERROR,e),n&&(this._seiService.reset(),this._end())}},{key:"_reset",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(){var n,s=arguments;return _regeneratorRuntime$1().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=s.length>0&&s[0]!==void 0?s[0]:!1,this._seiService.reset(),this._bandwidthService.reset(),this._stats.reset(),l.next=6,this._clear();case 6:return l.next=8,this._bufferService.reset(n);case 8:case"end":return l.stop()}},i,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(n,s){var a;return _regeneratorRuntime$1().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n&&(this._opts.url=n),a=n=this._opts.url,n){c.next=4;break}throw new Error("Source url is missing");case 4:if(this._opts.preProcessUrl&&(a=this._opts.preProcessUrl(n).url),this._mediaLoader.finnalUrl=a,this.emit(EVENT.LOAD_START,{url:a,seamlessSwitching:this._seamlessSwitching}),logger.debug("load data, loading:",this._loading,a),!this._loading){c.next=11;break}return c.next=11,this._mediaLoader.cancel();case 11:return this._loading=!0,c.prev=12,c.next=15,this._mediaLoader.load({url:a,range:s});case 15:c.next=21;break;case 17:return c.prev=17,c.t0=c.catch(12),this._loading=!1,c.abrupt("return",this._emitError(StreamingError.network(c.t0),!1));case 21:case"end":return c.stop()}},i,this,[[12,17]])}));function e(i,n){return t.apply(this,arguments)}return e}()},{key:"_clear",value:function(){var t=_asyncToGenerator$1(_regeneratorRuntime$1().mark(function i(){return _regeneratorRuntime$1().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this._mediaLoader){s.next=3;break}return s.next=3,this._mediaLoader.cancel();case 3:clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),this._loading=!1,this._firstProgressEmit=!1;case 7:case"end":return s.stop()}},i,this)}));function e(){return t.apply(this,arguments)}return e}()}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?MSE.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){Logger$2.enable(),Logger$1.enable()}},{key:"disableLogger",value:function(){Logger$2.disable(),Logger$1.disable()}}]),r}(EventEmitter);try{localStorage.getItem("xgd")?Flv.enableLogger():Flv.disableLogger()}catch(o){}var PluginExtension=function(){function o(u,r){var t=this;_classCallCheck$2(this,o),_defineProperty$2(this,"_onLowDecode",function(){var e,i,n,s,a=t._opts,l=a.media,c=a.innerDegrade,f=a.backupURL;(e=t._plugin)===null||e===void 0||(i=e.player)===null||i===void 0||i.emit("lowdecode",l.degradeInfo),(n=t._plugin)===null||n===void 0||(s=n.player)===null||s===void 0||s.emit("core_event",_objectSpread2$1(_objectSpread2$1({},l.degradeInfo),{},{eventName:EVENT.LOWDECODE})),(c===1||c===3)&&f&&t._degrade(f)}),_defineProperty$2(this,"_degrade",function(e){var i=t._plugin.player,n=i.video;if((n==null?void 0:n.TAG)==="MVideo"){var s=i.video.degradeVideo;i.video=s,n.degrade(e),e&&(i.config.url=e);var a=i.root.firstChild;a.TAG==="MVideo"&&i.root.replaceChild(s,a);var l=t._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(l),i.once("canplay",function(){i.play()})}}),_defineProperty$2(this,"forceDegradeToVideo",function(e){var i=t._opts.innerDegrade;(i===1||i===3)&&t._degrade(e)}),this._opts=u,this._plugin=r,this._init()}return _createClass$2(o,[{key:"_init",value:function(){var r=this._opts,t=r.media,e=r.isLive,i=r.preloadTime,n=r.innerDegrade,s=r.decodeMode;if(t){if(!e&&t.setPlayMode){t.setPlayMode("VOD");return}n&&t.setAttribute("innerdegrade",n),i&&t.setAttribute("preloadtime",i),t.setDecodeMode&&t.setDecodeMode(s),this._bindEvents()}}},{key:"_bindEvents",value:function(){var r=this._opts.media;r.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var r,t;(r=this._opts)===null||r===void 0||(t=r.media)===null||t===void 0||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),o}(),FlvPlugin=function(o){_inherits$2(r,o);var u=_createSuper$2(r);function r(){var t;_classCallCheck$2(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t=u.call.apply(u,[this].concat(i)),_defineProperty$2(_assertThisInitialized$2(t),"logger",logger),_defineProperty$2(_assertThisInitialized$2(t),"flv",null),_defineProperty$2(_assertThisInitialized$2(t),"pluginExtension",null),_defineProperty$2(_assertThisInitialized$2(t),"getStats",function(){var s;return(s=t.flv)===null||s===void 0?void 0:s.getStats()}),_defineProperty$2(_assertThisInitialized$2(t),"destroy",function(){var s;t.flv&&(t.flv.destroy(),t.flv=null),(s=t.pluginExtension)===null||s===void 0||s.destroy(),t.pluginExtension=null}),_defineProperty$2(_assertThisInitialized$2(t),"_onSwitchURL",function(s,a){if(t.flv){var l,c;t.player.config.url=s,_typeof$1(a)==="object"&&(a=a.seamless),t.flv.switchURL(s,a),!a&&(l=t.player.config)!==null&&l!==void 0&&(c=l.flv)!==null&&c!==void 0&&c.keepStatusAfterSwitch&&t._keepPauseStatus()}}),_defineProperty$2(_assertThisInitialized$2(t),"_keepPauseStatus",function(){var s=t.player.paused;s&&t.player.once("canplay",function(){t.player.pause()})}),_defineProperty$2(_assertThisInitialized$2(t),"_onDefinitionChange",function(s){var a=s.to;t.flv&&t.flv.switchURL(a)}),t}return _createClass$2(r,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,i,n=(e=this.player)===null||e===void 0||(i=e.config)===null||i===void 0?void 0:i.mediaType;return!!n&&n!=="video"&&n!=="audio"}},{key:"loader",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.loader}},{key:"transferCost",get:function(){return this.flv._transferCost.transferCost}},{key:"beforePlayerInit",value:function(){var e=this,i=this.player.config,n=this.player.media||this.player.video;if(i.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var s=i.flv||{};if((s.disconnectTime===null||s.disconnectTime===void 0)&&(s.disconnectTime=0),this.flv=new Flv(_objectSpread2$1({softDecode:this.softDecode,isLive:i.isLive,media:n,preProcessUrl:function(c,f){var h,p;return((h=e.player)===null||h===void 0||(p=h.preProcessUrl)===null||p===void 0?void 0:p.call(h,c,f))||{url:c,ext:f}}},s)),this.softDecode||BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var c;return(c=e.flv)===null||c===void 0?void 0:c.blobUrl},configurable:!0}}),this.softDecode&&(this.pluginExtension=new PluginExtension(_objectSpread2$1({media:this.player.video,isLive:i.isLive},i.flv),this),this.player.forceDegradeToVideo=function(){for(var l,c=arguments.length,f=new Array(c),h=0;h<c;h++)f[h]=arguments[h];return(l=e.pluginExtension)===null||l===void 0?void 0:l.forceDegradeToVideo.apply(l,f)}),i.isLive){var a;(a=this.player)===null||a===void 0||a.useHooks("replay",function(){var l;return(l=e.flv)===null||l===void 0?void 0:l.replay()})}this.on(URL_CHANGE,this._onSwitchURL),this.on(DESTROY,this.destroy),this._transError(),this._transCoreEvent(EVENT.TTFB),this._transCoreEvent(EVENT.LOAD_START),this._transCoreEvent(EVENT.LOAD_RESPONSE_HEADERS),this._transCoreEvent(EVENT.LOAD_COMPLETE),this._transCoreEvent(EVENT.LOAD_RETRY),this._transCoreEvent(EVENT.SOURCEBUFFER_CREATED),this._transCoreEvent(EVENT.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(EVENT.APPEND_BUFFER),this._transCoreEvent(EVENT.REMOVE_BUFFER),this._transCoreEvent(EVENT.BUFFEREOS),this._transCoreEvent(EVENT.KEYFRAME),this._transCoreEvent(EVENT.CHASEFRAME),this._transCoreEvent(EVENT.METADATA_PARSED),this._transCoreEvent(EVENT.SEI),this._transCoreEvent(EVENT.SEI_IN_TIME),this._transCoreEvent(EVENT.FLV_SCRIPT_DATA),this._transCoreEvent(EVENT.STREAM_EXCEPTION),this._transCoreEvent(EVENT.SWITCH_URL_SUCCESS),this._transCoreEvent(EVENT.SWITCH_URL_FAILED),this.flv.load(i.url,!0)}}},{key:"_transError",value:function(){var e=this;this.flv.on(EVENT.ERROR,function(i){e.player&&e.player.emit(ERROR,new Errors(e.player,i))})}},{key:"_transCoreEvent",value:function(e){var i=this;this.flv.on(e,function(n){i.player&&i.player.emit("core_event",_objectSpread2$1(_objectSpread2$1({},n),{},{eventName:e}))})}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e,i){return Flv.isSupported(e,i)}},{key:"isSupportedMMS",value:function(){return typeof ManagedMediaSource<"u"}}]),r}(BasePlugin);_defineProperty$2(FlvPlugin,"Flv",Flv);const index_min="",LiveVideoJsPlayer222_vue_vue_type_style_index_0_scoped_f7d3174a_lang="",_sfc_main$1={__name:"LiveVideoJsPlayer222",emits:["ready","error"],setup(o,{expose:u,emit:r}){const t=ref(null);let e=null;const i=r;onUnmounted(()=>{n()});function n(){e&&(e.pause(),e.destroy(),e=null)}function s(a){e?e.switchURL(a):(e=new PresetPlayer({id:"mse",isLive:!0,plugins:[FlvPlugin],url:a,height:"100%",width:"100%",controls:!1,videoFillMode:"auto",volume:1,autoplay:!0,autoplayMuted:!0,closePauseVideoFocus:!0,closePlayVideoFocus:!0,closeVideoClick:!0,closeVideoDblclick:!0,closeDelayBlur:!0}),e.on(LOADED_DATA,()=>{i("ready")}),e.on(ERROR,l=>{console.error("catch:",l),i("error")}),e.on(ENDED,()=>{i("error")}),e.on(PLAY,()=>{e.muted&&(e.muted=!1)}),e.play())}return u({setUrlSrc:s}),(a,l)=>(openBlock(),createElementBlock("div",{ref_key:"videoPlayer",ref:t,id:"mse"},null,512))}},__unplugin_components_1=_export_sfc(_sfc_main$1,[["__scopeId","data-v-f7d3174a"]]),_imports_1="data:image/webp;base64,UklGRiYBAABXRUJQVlA4WAoAAAAQAAAAJwAALwAAQUxQSLAAAAABgGvb1vHqtBnpbJUZdvIGtl2pzAOzNq8V4+yrNiIQtG2bLpYO4CjoN52q3TVBllrtdm8dwLLvu91u96JnL3dmt6ui7CLM5S/1BCBzB0/hCidPEfUuflyYMZWusP8IZbipjaeCUr3CCjJhqn1esvDUUQqXxkzy1SUzMT8TCmUvtvZzJ5rACr7Civ7oAv9CL7+4yI/OB2skhBUjVGUC9aQh/gWnu91zgxAnqTaN9GOPAFZQOCBQAAAA8AQAnQEqKAAwAD5xKo9HpKKhITxgkA4JaQAVIADwQCut+u9tU5BdCjInIk5KUXoAAP7pcVn/w6Zz83UE///7Qhv6Y3//xDoRX47QAAAAAAA=",_imports_2=""+new URL("../webp/name-158fe861.webp",import.meta.url).href,LiveDetail_vue_vue_type_style_index_0_scoped_34f3b02f_lang="",_hoisted_1={class:"root"},_hoisted_2={class:"drawer"},_hoisted_3={class:"rtm"},_sfc_main={__name:"LiveDetail",setup(o){const u=ref(null),r=ref(null),t=ref(null),e=ref(null),i=ref(null),n=ref(null),s=ref(null),a=ref(null),l=ref(null),c=ref(!1),f=ref(!1),h=ref(!1),p=ref(""),d=useRoute(),v=ref(""),g=ref("");let y=null,m=null,S=0;onBeforeRouteUpdate((G,H)=>{c.value=!1,f.value=!1,h.value=!1,y=null,m=null,S=0,v.value=G.params.cover,g.value=G.params.chName,_()}),onMounted(()=>{v.value=d.params.cover,g.value=d.params.chName,_()});function _(){A(),k()}onBeforeRouteLeave((G,H,Q)=>{api.offLive(C(),"1").then(J=>{J&&J instanceof ApiException,Q(!0)})});function A(){api.getUserInfo(getUID(),C()).then(G=>{y=G,u.value.setSelfInfoCardBean(y)})}function k(){api.audienceLive(C()).then(G=>{G&&(m=G,m.liveStatus===1?size(m.streamer)<=0?(N(),I()):(r.value.setUrlSrc(m.streamer),N(),I()):w())})}function w(){c.value=!0,nextTick(()=>{l.value.setData(m)})}function I(){api.getAudienceList(C()).then(G=>{G&&t.value.setHotValue(G.renqi)})}function N(){m&&t.value.setData(m)}const x=G=>{if(y!==null&&y.isAllowGag===!1){showToast({message:"你被禁言了",position:"middle"});return}u.value.chatRoomTxt(G)},M=()=>{e.value.show(),i.value.show(!1)},b=()=>{m&&(i.value.setData("LIVE",C(),m.anchorId),i.value.show())},T=(G,H)=>{const Q={senderAvatar:getAvatar(),senderName:getName(),receiveName:(m==null?void 0:m.name)||"",giftId:G.propId,giftName:G.propName||"",giftUrl:G.propImage||"",count:H,giftSvga:G.svgaUrl||"",level:(y==null?void 0:y.level)||1};u.value.chatRoomGift(Q),s.value.setData(Q),a.value.setData(Q.giftSvga)};function C(){return g.value}function D(){showConfirmDialog({title:"充值提示？",message:"你的余额不足，请充值",cancelButtonText:"跳过",confirmButtonText:"继续操作"}).then(()=>{e.value.showFlag()}).catch(()=>{B()})}function P(G){api.ticketCharges(C()).then(H=>{H instanceof ApiException?D():(h.value!==!1&&(h.value=!1),G&&m.type===LIVE_TICKETS_TYPE.DURATION_TICKETS&&setTimeout(()=>{P(!0)},1e3*60))})}function B(){history.back()}const $=()=>{function G(){if(!m)return;let ne="";switch(m.type){case LIVE_TICKETS_TYPE.PRIVATE_TICKETS:ne=`主播开启了付费直播，${m.amount}钻石/场是否付费进入？`;break;case LIVE_TICKETS_TYPE.DURATION_TICKETS:ne=`主播开启了付费直播，${m.amount}钻石/分钟是否付费进入？`;break}showConfirmDialog({title:"付费直播？",message:ne,cancelButtonText:"跳过",confirmButtonText:"继续操作"}).then(()=>{switch(m.type){case LIVE_TICKETS_TYPE.PRIVATE_TICKETS:P(!1);break;case LIVE_TICKETS_TYPE.DURATION_TICKETS:P(!0);break}}).catch(()=>{B()})}const H=()=>{p.value=m.cover,h.value=!0,t.value.goneCost(),G()},Q=()=>{switch(m.type){case LIVE_TICKETS_TYPE.PRIVATE_TICKETS:case LIVE_TICKETS_TYPE.DURATION_TICKETS:return!0;default:return!1}};(()=>{if(m&&Q())switch(m.isPreview){case 0:t.value.showCostTip(m.type,m.amount||0);const ne=window.setInterval(function(){S++;const ie=m.previewTs-S;ie<=0?(window.clearInterval(ne),H()):t.value.showCostTimerTip(ie)},1e3);break;case 1:H();break;case 2:h.value=!1;break}})(),u.value.apiFakeMessage()},F=()=>{w(),K()},K=()=>{i.value.show(!1),e.value.hidden()};function Y(G){f.value=G}return(G,H)=>{const Q=__unplugin_components_0,J=__unplugin_components_1,ne=__unplugin_components_2,ie=__unplugin_components_3,se=__unplugin_components_4,X=__unplugin_components_5,ce=__unplugin_components_6,he=__unplugin_components_7$1,ye=__unplugin_components_8,Ee=__unplugin_components_9,Te=__unplugin_components_10;return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(Q,mergeProps({url:v.value,isDecrypt:!1,loadingIcon:unref(ic_placeholder)},{class:"bg"}),null,16),createVNode(J,{onReady:$,onError:F,ref_key:"liveVideoJsPlayerRef",ref:r},null,512),createVNode(ne,{class:"svga",ref_key:"svgaPlayerRef",ref:a},null,512),createVNode(Transition,{name:"fade"},{default:withCtx(()=>[createVNode(ie,{ref_key:"giftDialogRef",ref:i,onDiamond:M,onSendGiftSuccess:T,class:"gift_dialog"},null,512)]),_:1}),createVNode(Transition,{name:"fade"},{default:withCtx(()=>[createVNode(se,{ref_key:"rechargeModalRef",ref:e,class:"recharge",onClose:B},null,512)]),_:1}),createBaseVNode("div",_hoisted_2,[createVNode(X,{class:"homeowner_info_view",ref_key:"homeownerInfoViewRef",ref:t},null,512),createBaseVNode("div",_hoisted_3,[createBaseVNode("img",{class:"close-icon",src:_imports_0$5,alt:"Close",onClick:B}),createBaseVNode("div",{class:"text-image-view",onClick:H[0]||(H[0]=_e=>Y(!0))},H[2]||(H[2]=[createBaseVNode("img",{class:"icon",src:_imports_1,alt:"icon"},null,-1),createBaseVNode("span",{class:"text"},"为您推荐",-1)]))]),createVNode(ce,{class:"gift_recycler",ref_key:"giftRcvViewRef",ref:s},null,512),createVNode(he,{ref_key:"publicScreenRcvViewRef",ref:u,class:"public_screen_rcv_view"},null,512),createVNode(ye,{ref_key:"sendMsgViewRef",ref:n,class:"send_msg",onSendMsg:x},null,512),createBaseVNode("img",{src:_imports_2,class:"gift",alt:"",onClick:b}),createVNode(Transition,{name:"fade"},{default:withCtx(()=>[withDirectives(createVNode(Ee,{onClose:H[1]||(H[1]=_e=>Y(!1)),class:"slide-component"},null,512),[[vShow,f.value]])]),_:1}),withDirectives(createVNode(Q,mergeProps({url:p.value,isDecrypt:!1,loadingIcon:unref(ic_placeholder)},{class:"pay-tip-mask-image"}),null,16),[[vShow,h.value]])]),c.value?(openBlock(),createBlock(Te,{key:0,ref_key:"downMicRecViewRef",ref:l,onClose:B,class:"drawer"},null,512)):createCommentVNode("",!0)])}}},LiveDetail=_export_sfc(_sfc_main,[["__scopeId","data-v-34f3b02f"]]);export{LiveDetail as default};
