import{Y as ae,X as se,r as w,Q as ue,az as ge,aA as ce,aB as Re,x as fe,aC as J,S as xe,_ as Ve,D as oe,aD as Ee,aE as Ie,aF as Ce,o as re,h as ne,w as A,b as He,B as ve,aG as q,ax as me,ay as ye,d as pe,H as ee,aH as Se,R as he}from"./index-e280f67c.js";import{i as Le,E as Oe,P as Me}from"./ic_empty_no_data_note-05a81f4b.js";function $e(l,r,e){const{attrs:a,on:n,...h}=r;let m={};return n&&Object.entries(n).forEach(k=>{const[z,b]=k;m[`on${z[0].toUpperCase()+z.slice(1)}`]=b}),ae(l,{...a,...m,...h},e)}const G=$e;function Fe(l,r,e){const{attrs:a,on:n,...h}=r;let m={};return n&&Object.entries(n).forEach(k=>{const[z,b]=k;m[`on${z[0].toUpperCase()+z.slice(1)}`]=b}),ae(l,{...a,...m,...h},{default:()=>e})}const De=Fe;function Ne(l,r,e){const{attrs:a,on:n,...h}=r;let m={};return n&&Object.entries(n).forEach(k=>{const[z,b]=k,V=`on${z[0].toUpperCase()+z.slice(1)}`;m[V]=b}),ae(l,{...a,...m,...h},e)}const Ge=Ne;function Ke(l,r){var e;return(e=l.$slots)==null?void 0:e[r]}const R=Ke,Ue=l=>{const r=w(null);return ue(()=>{l.resizeObserver&&r.value&&l.resizeObserver.observe(r.value)}),ge(()=>{l.resizeObserver&&r.value&&l.resizeObserver.unobserve(r.value)}),{itemRefEl:r}},Pe=se({name:"ObserverItem",props:{resizeObserver:{type:ResizeObserver,require:!0},id:{type:[String,Number],require:!0}},setup(l){return Ue(l)},render(){var l;const{id:r}=this;return G("div",{ref:"itemRefEl",attrs:{"data-id":r}},[(l=R(this,"default"))==null?void 0:l()])}}),Ae={itemGap:0,fixed:!1,buffer:0,bufferTop:0,bufferBottom:0,scrollDistance:0,horizontal:!1,fixSelection:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""};function je(l,r){const e=new Proxy(l,{get(i,o){var s;return(s=Reflect.get(i,o))!=null?s:Reflect.get(Ae,o)}}),a=w(null),n=w(null),h=w(null),m=w(null),k=w(null),z=w(null),b=new Map,V=w(0);let H="backward",E=!1,I=!1,L=!1,O=null;const u=ce({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),t=ce({views:0,offset:0,listTotalSize:0,virtualSize:0,inViewBegin:0,inViewEnd:0,renderBegin:0,renderEnd:0,bufferTop:0,bufferBottom:0});function $(){const i=e.horizontal?"scrollLeft":"scrollTop";return a.value?a.value[i]:0}function d(){return u.headerSize+u.footerSize+u.stickyHeaderSize+u.stickyFooterSize}function S(){return t.listTotalSize+u.headerSize+u.footerSize+u.stickyHeaderSize+u.stickyFooterSize}function p(i){var o;return e.fixed?e.minSize+e.itemGap:(o=b.get(String(i)))!=null?o:e.minSize+e.itemGap}function M(i,o){b.set(String(i),o)}function g(i){b.delete(String(i))}function x(i){var o,s;if(e.fixed)return{top:(e.minSize+e.itemGap)*i,current:e.minSize+e.itemGap,bottom:(e.minSize+e.itemGap)*(i+1)};const{itemKey:f}=e;let v=u.headerSize;for(let y=0;y<=i-1;y+=1){const C=p((o=e.list[y])==null?void 0:o[f]);v+=C}const B=p((s=e.list[i])==null?void 0:s[f]);return{top:v,current:B,bottom:v+B}}function T(i){L=!0;const o=e.horizontal?"scrollLeft":"scrollTop";a.value&&(a.value[o]=i)}async function F(i){if(i<0)return;if(i>=e.list.length-1){U();return}let{top:o}=x(i);T(o);const s=()=>{const{top:f}=x(i);if(T(f),o!==f){o=f,O=s;return}O=null};O=s}async function c(i){var o;const{top:s,bottom:f}=x(i),v=$(),B=$()+u.clientSize,y=p((o=e.list[i])==null?void 0:o[e.itemKey]);if(s<v&&v<f&&y<u.clientSize){T(s);return}if(s+u.stickyHeaderSize<B&&B<f+u.stickyHeaderSize&&y<u.clientSize){T(f-u.clientSize+u.stickyHeaderSize);return}if(s+u.stickyHeaderSize>=B){F(i);return}if(f<=v){F(i);return}}async function K(){T(0),setTimeout(()=>{var i;const o=e.horizontal?"scrollLeft":"scrollTop";((i=a==null?void 0:a.value)==null?void 0:i[o])!==0&&K()},3)}async function U(){T(S()),setTimeout(()=>{Math.abs(Math.round(t.offset+u.clientSize)-Math.round(S()))>2&&U()},3)}function j(i){var o;i<t.inViewBegin&&(E=!0),t.inViewBegin=i,t.inViewEnd=Math.min(i+t.views,e.list.length-1),(o=r==null?void 0:r.rangeUpdate)==null||o.call(r,t.inViewBegin,t.inViewEnd)}function Q(){var i,o;const{views:s,offset:f,inViewBegin:v}=t,{itemKey:B}=e,y=f-u.headerSize;let C=v,P=Te();if(y<0){j(0);return}if(H==="forward"){if(y>=P)return;for(let N=C-1;N>=0;N-=1){const Y=p((i=e.list[N])==null?void 0:i[B]);if(P-=Y,P<=y&&y<P+Y){C=N;break}}}if(H==="backward"){if(y<=P)return;for(let N=C;N<=e.list.length-1;N+=1){const Y=p((o=e.list[N])==null?void 0:o[B]);if(P<=y&&y<P+Y){C=N;break}P+=Y}E=!1}C!==t.inViewBegin&&j(C)}function D(i){var o,s,f;(o=r==null?void 0:r.scroll)==null||o.call(r,i);const v=$();v!==t.offset&&(H=v<t.offset?"forward":"backward",t.offset=v,Q(),H==="forward"&&t.offset-e.scrollDistance<=0&&((s=r==null?void 0:r.toTop)==null||s.call(r,e.list[0])),H==="backward"&&Math.round(t.offset+e.scrollDistance)>=Math.round(t.listTotalSize+d()-u.clientSize)&&((f=r==null?void 0:r.toBottom)==null||f.call(r,e.list[e.list.length-1])))}function W(){const i=Math.ceil(u.clientSize/(e.minSize+e.itemGap))+1;t.views=i}function be(){W(),j(t.inViewBegin)}function te(){var i;if(e.fixed){t.listTotalSize=(e.minSize+e.itemGap)*e.list.length;return}const{itemKey:o}=e;let s=0;for(let f=0;f<=e.list.length-1;f+=1)s+=p((i=e.list[f])==null?void 0:i[o]);t.listTotalSize=s}function de(){t.offset=0,t.listTotalSize=0,t.virtualSize=0,t.inViewBegin=0,t.inViewEnd=0,t.renderBegin=0,t.renderEnd=0,b.clear(),ie()}function ke(i){te();let o=0;i.forEach(s=>{o+=p(s[e.itemKey])}),Z(),T(t.offset-o),Q()}function _e(i){te();let o=0;i.forEach(s=>{o+=p(s[e.itemKey])}),Z(),T(t.offset+o),I=!0,L=!1,Q()}function ie(){V.value+=1}let _;typeof ResizeObserver<"u"&&(_=new ResizeObserver(i=>{var o;let s=0;for(const f of i){const v=f.target.dataset.id;if(v){const B=p(v);let y=0;if(f.borderBoxSize){const C=Array.isArray(f.borderBoxSize)?f.borderBoxSize[0]:f.borderBoxSize;y=e.horizontal?C.inlineSize:C.blockSize}else y=e.horizontal?f.contentRect.width:f.contentRect.height;v==="client"?(u.clientSize=y,be()):v==="header"?u.headerSize=y:v==="footer"?u.footerSize=y:v==="stickyHeader"?u.stickyHeaderSize=y:v==="stickyFooter"?u.stickyFooterSize=y:B!==y&&(M(v,y),s+=y-B,(o=r==null?void 0:r.itemResize)==null||o.call(r,v,y))}}t.listTotalSize+=s,O&&O(),(E||I)&&s!==0&&!L&&(E=!1,I=!1,T(t.offset+s)),L=!1}));const Z=()=>{var i;let o=0;const s=t.renderBegin;for(let f=0;f<s;f++)o+=p((i=e.list[f])==null?void 0:i[e.itemKey]);t.virtualSize=o};Re(()=>{e.bufferTop?t.bufferTop=e.bufferTop:t.bufferTop=e.buffer,e.bufferBottom?t.bufferBottom=e.bufferBottom:t.bufferBottom=e.buffer}),ue(()=>{a.value&&(a.value.addEventListener("scroll",D),_==null||_.observe(a.value)),k.value&&(_==null||_.observe(k.value)),z.value&&(_==null||_.observe(z.value)),h.value&&(_==null||_.observe(h.value)),m.value&&(_==null||_.observe(m.value)),e.start?F(e.start):e.offset&&T(e.offset)}),ge(()=>{a.value&&(a.value.removeEventListener("scroll",D),_==null||_.unobserve(a.value),u.clientSize=0),k.value&&(_==null||_.unobserve(k.value),u.stickyHeaderSize=0),z.value&&(_==null||_.unobserve(z.value),u.stickyFooterSize=0),h.value&&(_==null||_.unobserve(h.value),u.headerSize=0),m.value&&(_==null||_.unobserve(m.value),u.footerSize=0)});function Te(){return t.virtualSize+X(t.renderBegin,t.inViewBegin)}function X(i,o){var s;const f=Math.min(i,o),v=Math.max(i,o);let B=0;for(let y=f;y<v;y+=1)B+=p((s=e.list[y])==null?void 0:s[e.itemKey]);return B}function Be(){return t}const le=fe([]);function we(i,o){const s=t.renderBegin;t.renderBegin=i,t.renderEnd=o,i>s?t.virtualSize+=X(i,s):t.virtualSize-=X(i,s),le.value=e.list.slice(t.renderBegin,t.renderEnd+1),Z()}return J(()=>[t.inViewBegin,t.inViewEnd,V.value],(i,o)=>{if(i&&o){const[s]=i,f=t.renderBegin;let v=s,B=t.inViewEnd;if(v=Math.max(0,v-t.bufferTop),B=Math.min(B+t.bufferBottom,e.list.length-1>0?e.list.length-1:0),e!=null&&e.renderControl){const{begin:y,end:C}=e.renderControl(s,t.inViewEnd);v=y,B=C}t.renderBegin=v,t.renderEnd=B,v>f?t.virtualSize+=X(v,f):t.virtualSize-=X(v,f),le.value=e.list.slice(t.renderBegin,t.renderEnd+1)}},{immediate:!0}),J(()=>e.list.length,()=>{if(e.list.length<=0){de();return}te(),j(t.inViewBegin),Z(),ie()},{immediate:!0}),{props:e,renderList:le,clientRefEl:a,listRefEl:n,headerRefEl:h,footerRefEl:m,stickyHeaderRefEl:k,stickyFooterRefEl:z,reactiveData:t,slotSize:u,sizesMap:b,resizeObserver:_,getReactiveData:Be,getOffset:$,getSlotSize:d,reset:de,scrollToIndex:F,manualRender:we,scrollIntoView:c,scrollToTop:K,scrollToBottom:U,scrollToOffset:T,getItemSize:p,deleteItemSize:g,deletedList2Top:ke,addedList2Top:_e,getItemPosByIndex:x,forceUpdate:ie}}const ze=se({name:"VirtList",emits:{scroll:l=>l,toTop:l=>l,toBottom:l=>l,itemResize:(l,r)=>!0,rangeUpdate:(l,r)=>!0},props:{list:{type:Array,default:()=>[]},itemKey:{type:[String,Number],required:!0},minSize:{type:Number,default:20,required:!0},itemGap:{type:Number,default:0},renderControl:{type:Function,default:void 0},fixed:{type:Boolean,default:!1},buffer:{type:Number,default:0},bufferTop:{type:Number,default:0},bufferBottom:{type:Number,default:0},scrollDistance:{type:Number,default:0},horizontal:{type:Boolean,default:!1},start:{type:Number,default:0},offset:{type:Number,default:0},listStyle:{type:String,default:""},listClass:{type:String,default:""},itemStyle:{type:String,default:""},itemClass:{type:String,default:""},headerClass:{type:String,default:""},headerStyle:{type:String,default:""},footerClass:{type:String,default:""},footerStyle:{type:String,default:""},stickyHeaderClass:{type:String,default:""},stickyHeaderStyle:{type:String,default:""},stickyFooterClass:{type:String,default:""},stickyFooterStyle:{type:String,default:""}},setup(l,r){return je(l,{scroll:a=>{r.emit("scroll",a)},toTop:a=>{r.emit("toTop",a)},toBottom:a=>{r.emit("toBottom",a)},itemResize:(a,n)=>{r.emit("itemResize",a,n)},rangeUpdate:(a,n)=>{r.emit("rangeUpdate",a,n)}})},render(){const{renderList:l,reactiveData:r,resizeObserver:e}=this,{itemGap:a,itemKey:n,horizontal:h,listStyle:m,listClass:k,itemStyle:z,itemClass:b,headerClass:V,headerStyle:H,footerClass:E,footerStyle:I,stickyHeaderClass:L,stickyHeaderStyle:O,stickyFooterClass:u,stickyFooterStyle:t}=this.props,$=()=>{var c;return R(this,"stickyHeader")?G("div",{key:"slot-sticky-header",class:L,style:`position: sticky; z-index: 10; ${h?"left: 0":"top: 0;"} ${O}`,ref:"stickyHeaderRefEl",attrs:{"data-id":"stickyHeader"}},[(c=R(this,"stickyHeader"))==null?void 0:c()]):null},d=()=>{var c;return R(this,"stickyFooter")?G("div",{key:"slot-sticky-footer",class:u,style:`position: sticky; z-index: 10; ${h?"right: 0":"bottom: 0;"} ${t}`,ref:"stickyFooterRefEl",attrs:{"data-id":"stickyFooter"}},[(c=R(this,"stickyFooter"))==null?void 0:c()]):null},S=()=>{var c;return R(this,"header")?G("div",{key:"slot-header",class:V,style:H,ref:"headerRefEl",attrs:{"data-id":"header"}},[(c=R(this,"header"))==null?void 0:c()]):null},p=()=>{var c;return R(this,"footer")?G("div",{key:"slot-footer",class:E,style:I,ref:"footerRefEl",attrs:{"data-id":"footer"}},[(c=R(this,"footer"))==null?void 0:c()]):null},{listTotalSize:M,virtualSize:g,renderBegin:x}=r,T=a>0?`padding: ${a/2}px 0; `:"",F=()=>{var c,K;const U=[];for(let D=0;D<l.length;D+=1){const W=l[D];U.push(De(Pe,{key:W[n],class:b,style:`${T}${z}`,attrs:{id:W[n],resizeObserver:e}},(c=R(this,"default"))==null?void 0:c({itemData:W,index:x+D})))}if(U.length===0&&R(this,"empty")){const D=this.slotSize.clientSize-this.getSlotSize();U.push(G("div",{key:`slot-empty-${D}`,style:`height: ${D}px`},[(K=R(this,"empty"))==null?void 0:K()]))}const j=h?`will-change: width; min-width: ${M}px; display: flex; ${m}`:`will-change: height; min-height: ${M}px; ${m}`,Q=h?`width: ${g}px; will-change: width;`:`height: ${g}px; will-change: height;`;return G("div",{ref:"listRefEl",class:k,style:j},[G("div",{style:Q}),U])};return G("div",{ref:"clientRefEl",class:"virt-list__client",style:"width: 100%; height: 100%; overflow: auto;",attrs:{"data-id":"client"}},[$(),S(),F(),p(),d()])}}),qe={scroll:l=>l,toTop:l=>l,toBottom:l=>l,itemResize:(l,r)=>!0,rangeUpdate:(l,r)=>!0},Qe=se({name:"VirtGrid",emits:qe,props:{list:{type:Array,default:()=>[]},gridItems:{type:Number,default:2},itemStyle:{type:String,default:""}},setup(l,r){const e=r.emit,a=w(0),n=w(null),h=fe([]);function m(){var d;if(l.gridItems<=0)return;const S=[];for(let p=0;p<l.list.length;p+=l.gridItems){const M=[];for(let g=0;g<l.gridItems&&!(p+g>=l.list.length);g+=1)M.push(l.list[p+g]);S.push({_id:p,children:M})}h.value=S,(d=n==null?void 0:n.value)==null||d.forceUpdate()}function k(d,S){var p;const M=(p=n==null?void 0:n.value)==null?void 0:p.getReactiveData();if(M){const g=Math.floor((M==null?void 0:M.inViewBegin)*S/d);xe(()=>{var x;(x=n==null?void 0:n.value)==null||x.scrollToIndex(g)})}}function z(d){var S;const p=Math.floor(d/l.gridItems);(S=n==null?void 0:n.value)==null||S.scrollToIndex(p)}function b(d){var S;const p=Math.floor(d/l.gridItems);(S=n==null?void 0:n.value)==null||S.scrollIntoView(p)}function V(){var d;(d=n==null?void 0:n.value)==null||d.scrollToTop()}function H(){var d;(d=n==null?void 0:n.value)==null||d.scrollToBottom()}function E(d){var S;(S=n==null?void 0:n.value)==null||S.scrollToOffset(d)}function I(d){e("scroll",d)}function L(d){e("toTop",d)}function O(d){e("toBottom",d)}function u(d,S){e("itemResize",d,S)}function t(d,S){e("rangeUpdate",d,S)}function $(){a.value+=1}return J(()=>a.value,()=>{m()}),J(()=>l.list.length,()=>{m()},{immediate:!0}),J(()=>l.gridItems,(d,S)=>{l.gridItems<=0||(h.value=[],m(),d&&S&&k(d,S))},{immediate:!0}),{virtListRef:n,gridList:h,updateList:m,scrollToIndex:z,scrollIntoView:b,scrollToTop:V,scrollToBottom:H,scrollToOffset:E,forceUpdate:$,onScroll:I,onToTop:L,onToBottom:O,onItemResize:u,onRangeUpdate:t}},render(){const{onScroll:l,onToTop:r,onToBottom:e,onItemResize:a,onRangeUpdate:n}=this,h=m=>{var k;const{itemData:z}=m,b=[];for(let V=0;V<z.children.length;V+=1)b.push((k=R(this,"default"))==null?void 0:k({itemData:z.children[V],index:m.index*this.gridItems+V,rowIndex:m.index}));return b};return Ge(ze,{ref:"virtListRef",attrs:{list:this.gridList,itemKey:"_id",itemStyle:`display: flex; min-width: min-content; ${this.itemStyle}`,...this.$attrs},on:{scroll:l,toTop:r,toBottom:e,itemResize:a,rangeUpdate:n}},{default:h,stickyHeader:R(this,"stickyHeader"),stickyFooter:R(this,"stickyFooter"),header:R(this,"header"),footer:R(this,"footer"),empty:R(this,"empty")})}});const We={__name:"VVL",props:{apiPromise:Function,dataConvert:Function,dataHook:Function,disabledRefresh:{type:Boolean,default:!1},disabledLoadMore:{type:Boolean,default:!1},disabledEmpty:{type:Boolean,default:!1},externalDataFlag:{type:Boolean,default:!1},columnNum:{type:Number,default:2},keyProp:{type:String,default:""},arrKey:{type:String,default:"data"},minSize:{type:Number,default:20},itemGap:{type:Number,default:0},virtType:{type:Number,default:0}},setup(l,{expose:r}){const e=l,a=fe([]),n=w(null),h=w(null),m=w(!1),k=w(!1),z=w(!1),b=w(!1),V=w(null),H=w(Le),E=w(!1);let I=0;const L=oe(()=>e.externalDataFlag?e.externalDataFlag:e.disabledRefresh),O=oe(()=>Se(e.minSize)),u=oe(()=>Se(e.itemGap));function t(){e.externalDataFlag||S(!1)}function $(){e.externalDataFlag||L.value||(E.value=!1)}function d(g){e.externalDataFlag||!L.value&&!E.value&&(E.value=!0)}ue(()=>{E.value=L.value,!e.externalDataFlag&&p()}),Ee((g,x,T)=>{switch(e.virtType){case 0:I=n.value.virtListRef.getOffset();break;case 1:I=n.value.getOffset();break}T()}),Ie(g=>{if(I>0)switch(e.virtType){case 0:n.value.virtListRef.scrollToOffset(I);break;case 1:n.value.scrollToOffset(I);break}}),Ce(()=>{});function S(g){if(m.value||z.value)return;if(g)b.value=!1,m.value=!0,z.value=!1;else{if(b.value)return;m.value=!1,z.value=!0}let x;g?x=1:h.value&&(x=Number(h.value.current_page)+1);const T=()=>{m.value=!1,k.value=!1,z.value=!1;const c=h.value;c?(b.value=Number(c.current_page)>=c.last_page&&he(c[e.arrKey])<c.per_page||he(c[e.arrKey])===0,b.value):b.value=!0},F=c=>e.dataConvert?e.dataConvert(c):c;e.apiPromise(x.toString()).then(c=>{if(h.value=c,c){const K=c[e.arrKey];m.value?(a.value=F(K),n.value.forceUpdate(),n.value.scrollToTop()):(a.value.push(...F(K)),n.value.forceUpdate()),T(),g&&e.dataHook&&e.dataHook(c)}else T()})}const p=()=>{e.externalDataFlag||S(!0)};return r({refresh:p,setData:g=>{a.value=g,n.value.forceUpdate(),n.value.scrollToTop()}}),(g,x)=>{const T=Oe,F=Me;return re(),ne(F,{modelValue:k.value,"onUpdate:modelValue":x[0]||(x[0]=c=>k.value=c),onRefresh:p,disabled:E.value,class:"pull-refresh"},{default:A(()=>[He("div",{class:"root",ref_key:"scrollContainer",ref:V},[e.virtType===0?(re(),ne(ve(Qe),{key:0,ref_key:"virtRef",ref:n,list:a.value,gridItems:e.columnNum,minSize:O.value,itemGap:u.value,itemStyle:"display: flex;justify-content: space-between;",onToBottom:t,onToTop:$,onScroll:d},{header:A(()=>[q(g.$slots,"header",{},void 0,!0)]),default:A(c=>[q(g.$slots,"default",me(ye(c)),void 0,!0)]),empty:A(()=>[e.disabledEmpty?ee("",!0):q(g.$slots,"empty",{key:0},()=>[pe(T,{image:H.value,description:"暂无数据，请稍后再试～",class:"empty_img"},null,8,["image"])],!0)]),_:3},8,["list","gridItems","minSize","itemGap"])):ee("",!0),e.virtType===1?(re(),ne(ve(ze),{key:1,itemKey:e.keyProp,ref_key:"virtRef",ref:n,list:a.value,minSize:O.value,itemGap:u.value,onToBottom:t,onToTop:$,onScroll:d},{header:A(()=>[q(g.$slots,"header",{},void 0,!0)]),default:A(c=>[q(g.$slots,"default",me(ye(c)),void 0,!0)]),empty:A(()=>[e.disabledEmpty?ee("",!0):q(g.$slots,"empty",{key:0},()=>[pe(T,{image:H.value,description:"暂无数据，请稍后再试～",class:"empty_img"},null,8,["image"])],!0)]),_:3},8,["itemKey","list","minSize","itemGap"])):ee("",!0)],512)]),_:3},8,["modelValue","disabled"])}}},Je=Ve(We,[["__scopeId","data-v-c0aa7ffd"]]);export{Je as _};
